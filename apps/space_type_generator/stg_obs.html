<!DOCTYPE html>
<html>
  <head>

    <meta charset="UTF-8">
    <title>STG _v.stripes</title>

    <script src="../lib/p5.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="./css/stripesStyle_obs.css" />

    <!-- <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:100,300,300i,400" rel="stylesheet"> -->

    <script src="./js/sketch_stripes_obs.js" type="text/javascript"></script>
    <script src="./js/keyboardEngine_190221.js" type="text/javascript"></script>

    <style> body {padding: 0; margin: 0;} canvas {vertical-align: top;} </style>

    </head>

  <body>

    <div class="bottom">
      <!-- <h1>SPACE TYPE GENERATOR</h1> -->
      <!-- <h2> _v. Stripes </h2> -->
     <textarea id="textfield" autofocus>SPACE TYPE GENERATOR _V.STRIPES</textarea>
          <!-- <textarea id="textfield" autofocus> NO JUSTICE. NO PEACE. </textarea> -->

      <!-- <div class ="slug">
        <p>a kinetic type generator from <a href="http://www.kielm.com">kielm</a><br><br>
          <a href="https://www.buymeacoffee.com/kieldm">Buy me a coffee</a> to help support STG<br>
          </p>
          <button onclick="myFunction()">ReadMe</button>
      </div>

      <div class="dropdown">
        <button class="dropbtn">Select...</button>
        <div class="dropdown-content">
          <a href="index.html">CYLINDER</a>
          <a href="field.html">FIELD</a>
          <a href="stripes.html">STRIPES</a>
          <a href="coil.html">COIL</a>
          <a href="flag.html">FLAG</a>
          <a href="morisawa.html">MORISAWA</a>
          <a href="cascade.html">CASCADE</a>
          <a href="ribbon.html">RIBBON</a>
          <a href="layers.html">LAYERS</a>
          <a href="danger.html">DANGER</a>
          <a href="string.html">STRING</a>
          <a href="badge.html">BADGE</a>
          <a href="clutter.html">CLUTTER</a>
          <a href="construct.html">CONSTRUCT</a>
          <a href="snap.html">SNAP</a>
          <a href="flash.html">FLASH</a>
          <a href="pow.html">POW</a>
          <a href="crash.html">CRASH</a>
          <a href="crashclock.html">CRASH CLOCK</a>
          <a href="vessel.html">VESSEL</a>
          <a href="vessel.html">VESSEL</a>
          <a href="shine.html">SHINE</a>
        </div>
      </div> -->

    </div>
    <!-- load obs websocket library -->
    <script src="../lib/obs-ws.js"></script>
    <!-- fetch websocket connection details from localhost web server -->
    
    <!-- <script src="../obs_webSocket_details/websocketDetails.js"></script> -->
    <script src="../lib/obsWssConnectionManager.js"></script>
    
    <script>
      var timer
      const APP_FOLDER = "apps/space_type_generator/presets";
      let PRESET_SETTINGS
      obsWss.on("InputSettingsChanged", async function (event) {
        // console.log(event);
        switch (event.inputName) {
          case 'cursor':
            break;
          case 'keyHotkey':
            if (event.inputSettings.text.includes('+')) {
              //console.log(event);
              setText(event.inputSettings.text);
              timer = 3;
            }
            break;
          default:
            break;
        }
      })

      //onload get query paramater
      window.addEventListener('load', async function() {
        const params = new URLSearchParams(window.location.search)
        if(params.has("preset")){
          loadSettings(params.get("preset"))    
        }
        
      })

      //get file name from qp
      window.loadSettings = async (presetName) => {
        console.log("preset",presetName)
        const select = document.getElementById('loadSelect');
        const filename = presetName;
        if(!filename) return;
        
        try {
          const response = await fetch(`/api/file/get?folder=${APP_FOLDER}&filename=${filename}.json`);
          if(!response.ok) throw new Error("File not found");
          
          PRESET_SETTINGS = await response.json();
          
          //do something with returned file
          setup();
          
          // alert("Settings loaded");
        } catch(e) {
          console.error(e);
          alert("Error loading settings");
        }
      };

      function setStripeSettings(json){
        typeXSlider.value(json.typeX);
        typeYSlider.value(json.typeY);
        typeStrokeSlider.value(json.typeStroke);
        trackingSlider.value(json.tracking);
        ribbonCountSlider.value(json.ribbonCount);
        ribbonSpaceXSlider.value(json.ribbonSpaceX);
        ribbonSpaceYSlider.value(json.ribbonSpaceY);
        ribbonSizeSlider.value(json.ribbonSize);
        ribbonOffsetSlider.value(json.ribbonOffset);
        yWaveSlider.value(json.yWave);
        speedSlider.value(json.speed);
        offsetSlider.value(json.offset);
        slopeSlider.value(json.slope);

        inp1.value(json.inp1color);
        inp2.value(json.inp2color);
        inp3.value(json.inp3color);
        inp4.value(json.inp4color);
        inp5.value(json.inp5color);
        inp1check.checked(json.inp1check);
        inp2check.checked(json.inp2check);
        inp3check.checked(json.inp3check);
        inp4check.checked(json.inp4check);
        inp5check.checked(json.inp5check);

        // inp.value(json.text);

        inpNumber = json.inpNumber;
        bkgdColorPicker.value(json.bkgdColor)
      }

      function setText(newText){
        setStripeSettings(PRESET_SETTINGS)
        inp.value(newText);
      }


    </script>
    <!-- <script>
        function myFunction() {
          alert("SPACE TYPE GENERATOR\n_v.stripes 1.0\nDesign and coding by KielM.com\nThanks for using! Let me know what you make.\nkiel.d.m@gmail.com");        }
    </script> -->

  </body>

</html>
