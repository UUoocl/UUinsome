/**
 * @file patch.js
 * @description Minified Cables.gl patch export.
 * This file contains the core engine and simulation data for the fluid highlight effect.
 * Do not edit manually.
 */
(()=>{var fe={};(()=>{fe.d=(e,t)=>{for(var i in t){if(fe.o(t,i)&&!fe.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{fe.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{fe.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var de={};(()=>{"use strict";fe.r(de);fe.d(de,{Anim:()=>u,AnimKey:()=>l,CONSTANTS:()=>h,EMBED:()=>F,Link:()=>I,LoadingStatus:()=>M,Op:()=>P,Patch:()=>N,PatchVariable:()=>re,Port:()=>S,Profiler:()=>y,RenderLoop:()=>ue,Timer:()=>O,default:()=>ce,now:()=>R,utils:()=>e});var e={};fe.r(e);fe.d(e,{ajax:()=>A,basename:()=>Y,cacheBust:()=>E,clamp:()=>_,cleanJson:()=>c,copyArray:()=>T,escapeHTML:()=>ne,filename:()=>K,float32Concat:()=>X,generateUUID:()=>o,getShortOpName:()=>i,isNumeric:()=>x,logErrorConsole:()=>Q,logStack:()=>q,map:()=>v,prefixedHash:()=>m,request:()=>Z,shortId:()=>b,shuffleArray:()=>n,simpleId:()=>d,smoothStep:()=>g,smootherStep:()=>p,uniqueArray:()=>J,uuid:()=>a});class V{constructor(e,t,i,n){this.targetObj=e;this.id=t;this.eventName=i;this.cb=n}remove(){this.targetObj.off(this.id)}}class D{constructor(){this._simpleIdCounter=0}uuid(){let i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e==="x"?t:t&3|8).toString(16)})}isNumeric(e){const t=parseFloat(e);return!isNaN(t)&&isFinite(t)}simpleId(){this._simpleIdCounter++;return this._simpleIdCounter}pathLookup(e,t){const i=t.split(".");if(i.length==1){return e[i[0]]}return this.pathLookup(e[i[0]],i.slice(1).join("."))}}const k=new D;class r{constructor(e,t){this.initiator=e;this._options=t;if(!this.initiator){console.error("no log initator given");CABLES.logStack()}}stack(e){console.info("["+this.initiator+"] ",e);console.log((new Error).stack)}groupCollapsed(e){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments);console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)||!CABLES.UI){console.error("["+this.initiator+"]",...arguments)}if(this._options&&this._options.onError){this._options.onError(this.initiator,...arguments)}}errorGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)}warn(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:1},...arguments)||!CABLES.logSilent)console.warn("["+this.initiator+"]",...arguments)}verbose(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}info(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.info("["+this.initiator+"]",...arguments)}log(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}logGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)}userInteraction(e){}}class t{#eventLog=new r("eventtarget");#listeners={};#logEvents=false;#logName="";#eventCallbacks={};#countErrorUnknowns=0;eventsPaused=false;constructor(){}on(e,t,i=""){const n=(i||"")+k.simpleId();const r=new V(this,n,e,t);if(!this.#eventCallbacks[e])this.#eventCallbacks[e]=[r];else this.#eventCallbacks[e].push(r);this.#listeners[r.id]=r;return r}removeAllEventListeners(){for(const e in this.#listeners){this.off(this.#listeners[e])}}addEventListener(e,t,i=""){return this.on(e,t,i)}hasEventListener(e,t=null){if(e&&!t){if(typeof e=="string")return!!this.#listeners[e];else return!!this.#listeners[e.id]}else{this.#eventLog.warn("old eventtarget function haseventlistener!");if(e&&t){if(this.#eventCallbacks[e]){const i=this.#eventCallbacks[e].indexOf(t);return i!==-1}}}}hasListenerForEventName(e){return this.#eventCallbacks[e]&&this.#eventCallbacks[e].length>0}removeEventListener(e){return this.off(e)}off(e){if(e===null||e===undefined){this.#eventLog.warn("removeEventListener id null",e);return}let i=e;if(e.eventName)i=e.id;if(typeof i!="string"){console.log("old function signature: removeEventListener! use listener id");return}const n=this.#listeners[i];if(!n){if(this.#countErrorUnknowns==20)this.#eventLog.warn("stopped reporting unknown events");if(this.#countErrorUnknowns<20)this.#eventLog.warn("could not find event...",i,n);this.#countErrorUnknowns++;return}let r=0;let s=true;while(s){s=false;let t=-1;for(let e=0;e<this.#eventCallbacks[n.eventName].length;e++){if(this.#eventCallbacks[n.eventName][e].id.indexOf(i)===0){s=true;t=e}}if(t!==-1){this.#eventCallbacks[n.eventName].splice(t,1);delete this.#listeners[i];r++}}if(r==0)console.log("no events removed",n.eventName,i);return}logEvents(e,t){this.#logEvents=e;this.#logName=t}emitEvent(t,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null){if(this.eventsPaused)return;if(this.#logEvents)this.#eventLog.log("[event] ",this.#logName,t,this.#eventCallbacks);if(this.#eventCallbacks[t]){for(let e=0;e<this.#eventCallbacks[t].length;e++){if(this.#eventCallbacks[t][e]){this.#eventCallbacks[t][e].cb(i,n,r,s,a,o,l,h)}}}else{if(this.#logEvents)this.#eventLog.log("[event] has no event callback",t,this.#eventCallbacks)}}}class l{anim=null;id=CABLES.simpleId();time=0;value=0;onChange=null;_easing=0;bezCp1=null;bezCp2=null;bezAn=null;cb=null;cbTriggered=false;temp={};uiAttribs={};clip=null;clipId=null;constructor(e,t){this.anim=e.anim||t||null;this.setEasing(u.EASING_LINEAR);this.set(e)}setClip(e,t){this.clipId=e;this.clip=t;if(this.anim)this.anim.emitEvent(u.EVENT_CHANGE)}emitChange(){if(this.anim.batchMode)return;if(!this.anim)return;this.bezAn=null;if(this.onChange!==null)this.onChange();this.anim.forceChangeCallbackSoon();for(let e=0;e<this.anim.keys.length;e++)this.anim.keys[e].bezAn=null}delete(){if(this.anim)this.anim.remove(this);else console.log("animkey without anim...")}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}if(this.anim)this.anim.emitEvent(u.EVENT_CHANGE)}setEasing(e){if(this.anim.uiAttribs.readOnly)return;if(this.anim.uiAttribs.muted)return;let t=false;if(this._easing!=e)t=true;this._easing=e;if(this._easing!=u.EASING_CLIP){this.clipId="";this.clip=null}if(this._easing==u.EASING_LINEAR)this.ease=this.easeLinear;else if(this._easing==u.EASING_ABSOLUTE)this.ease=this.easeAbsolute;else if(this._easing==u.EASING_SMOOTHSTEP)this.ease=l.easeSmoothStep;else if(this._easing==u.EASING_SMOOTHERSTEP)this.ease=l.easeSmootherStep;else if(this._easing==u.EASING_CUBIC_IN)this.ease=l.easeCubicIn;else if(this._easing==u.EASING_CUBIC_OUT)this.ease=l.easeCubicOut;else if(this._easing==u.EASING_CUBIC_INOUT)this.ease=l.easeCubicInOut;else if(this._easing==u.EASING_EXPO_IN)this.ease=l.easeExpoIn;else if(this._easing==u.EASING_EXPO_OUT)this.ease=l.easeExpoOut;else if(this._easing==u.EASING_EXPO_INOUT)this.ease=l.easeExpoInOut;else if(this._easing==u.EASING_SIN_IN)this.ease=l.easeSinIn;else if(this._easing==u.EASING_SIN_OUT)this.ease=l.easeSinOut;else if(this._easing==u.EASING_SIN_INOUT)this.ease=l.easeSinInOut;else if(this._easing==u.EASING_BACK_OUT)this.ease=l.easeOutBack;else if(this._easing==u.EASING_BACK_IN)this.ease=l.easeInBack;else if(this._easing==u.EASING_BACK_INOUT)this.ease=l.easeInOutBack;else if(this._easing==u.EASING_ELASTIC_IN)this.ease=l.easeInElastic;else if(this._easing==u.EASING_ELASTIC_OUT)this.ease=l.easeOutElastic;else if(this._easing==u.EASING_BOUNCE_IN)this.ease=l.easeInBounce;else if(this._easing==u.EASING_BOUNCE_OUT)this.ease=l.easeOutBounce;else if(this._easing==u.EASING_QUART_OUT)this.ease=l.easeOutQuart;else if(this._easing==u.EASING_QUART_IN)this.ease=l.easeInQuart;else if(this._easing==u.EASING_QUART_INOUT)this.ease=l.easeInOutQuart;else if(this._easing==u.EASING_QUINT_OUT)this.ease=l.easeOutQuint;else if(this._easing==u.EASING_QUINT_IN)this.ease=l.easeInQuint;else if(this._easing==u.EASING_QUINT_INOUT)this.ease=l.easeInOutQuint;else if(this._easing==u.EASING_CLIP)this.ease=this.easeAbsolute;else if(this._easing==u.EASING_CUBICSPLINE){if(this.ease!=this.easeCubicSpline){this.ease=this.easeCubicSpline;this.bezReset()}this.bezAn=null}else{this._easing=u.EASING_LINEAR;this.ease=this.easeLinear}if(t)this.emitChange()}bezReset(){let e=.5;const t=this.anim.getPrevKey(this.time);if(t)e=(this.time-t.time)/2;let i=.5;const n=this.anim.getNextKey(this.time);if(n)i=(n.time-this.time)/2;this.bezCp1=[-Math.min(e,i),0];this.bezCp2=[Math.min(e,i),0];this.emitChange()}trigger(){this.cb();this.cbTriggered=true}setValue(e){this.value=e;this.emitChange()}setBezCp1(e,t){this.bezCp1=[e,t];this.emitChange()}setBezCp2(e,t){this.bezCp2=[e,t];this.emitChange()}set(e){if(e){if(e.hasOwnProperty("e"))this.setEasing(e.e);if(e.cb){this.cb=e.cb;this.cbTriggered=false}if(e.hasOwnProperty("cp1")){this.bezCp1=e.cp1;this.bezCp2=e.cp2}if(e.hasOwnProperty("t"))this.time=e.t;if(e.hasOwnProperty("time"))this.time=e.time;if(e.hasOwnProperty("v"))this.value=e.v;else if(e.hasOwnProperty("value"))this.value=e.value;if(e.hasOwnProperty("uiAttribs"))this.setUiAttribs(e.uiAttribs);if(e.clipId)this.clipId=e.clipId}this.emitChange()}getSerialized(){const e={};e.t=this.time;e.v=this.value;e.e=this._easing;e.uiAttribs=this.uiAttribs;if(this.clipId)e.clipId=this.clipId;if(this._easing===u.EASING_CUBICSPLINE){e.cp1=this.bezCp1;e.cp2=this.bezCp2}return e}getEasing(){return this._easing}easeCubicSpline(e,t){if(!this.bezAn){const i=30;this.bezAn=new u;for(let e=0;e<=i+1;e++){const n=l.cubicSpline(e/i,this,t);this.bezAn.setValue(n[0],n[1])}}return this.bezAn.getValue(this.time+e*(t.time-this.time))}easeLinear(e,t){return l.linear(e,this,t)}easeAbsolute(){return this.value}}l.cubicSpline=function(e,t,i){const n=1-e;const r=n*n;const s=e*e;const a=r*n;const o=3*r*e;const l=3*n*s;const h=s*e;t.bezCp1=t.bezCp1||[-.5,0];t.bezCp2=t.bezCp2||[.5,0];i.bezCp1=i.bezCp1||[-.5,0];i.bezCp2=i.bezCp2||[.5,0];const u=Math.min(i.time,t.bezCp2[0]+t.time);const c=Math.max(t.time,i.bezCp1[0]+i.time);const f=a*t.time+o*u+l*c+h*i.time;const d=a*t.value+o*(t.bezCp2[1]+t.value)+l*(i.bezCp1[1]+i.value)+h*i.value;return[f,d]};l.linear=function(e,t,i){return t.value+(i.value-t.value)*e};const B=function(e){return e=2**(10*(e-1))};l.easeExpoIn=function(e,t){e=B(e);return l.linear(e,this,t)};const U=function(e){e=-(2**(-10*e))+1;return e};l.easeExpoOut=function(e,t){e=U(e);return l.linear(e,this,t)};const G=function(e){e*=2;if(e<1){e=.5*2**(10*(e-1))}else{e--;e=.5*(-(2**(-10*e))+2)}return e};l.easeExpoInOut=function(e,t){e=G(e);return l.linear(e,this,t)};l.easeSinIn=function(e,t){e=-1*Math.cos(e*Math.PI/2)+1;return l.linear(e,this,t)};l.easeSinOut=function(e,t){e=Math.sin(e*Math.PI/2);return l.linear(e,this,t)};l.easeSinInOut=function(e,t){e=-.5*(Math.cos(Math.PI*e)-1);return l.linear(e,this,t)};const j=function(e){e=e*e*e;return e};l.easeCubicIn=function(e,t){e=j(e);return l.linear(e,this,t)};l.easeInQuint=function(e,t){e=e*e*e*e*e;return l.linear(e,this,t)};l.easeOutQuint=function(e,t){e=(e-=1)*e*e*e*e+1;return l.linear(e,this,t)};l.easeInOutQuint=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e*e;else e=.5*((e-=2)*e*e*e*e+2);return l.linear(e,this,t)};l.easeInQuart=function(e,t){e=e*e*e*e;return l.linear(e,this,t)};l.easeOutQuart=function(e,t){e=-1*((e-=1)*e*e*e-1);return l.linear(e,this,t)};l.easeInOutQuart=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e;else e=-.5*((e-=2)*e*e*e-2);return l.linear(e,this,t)};l.bounce=function(e){if((e/=1)<1/2.75)e=7.5625*e*e;else if(e<2/2.75)e=7.5625*(e-=1.5/2.75)*e+.75;else if(e<2.5/2.75)e=7.5625*(e-=2.25/2.75)*e+.9375;else e=7.5625*(e-=2.625/2.75)*e+.984375;return e};l.easeInBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeOutBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeInElastic=function(e,t){let i=1.70158;let n=0;let r=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!n)n=a*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=-(r*2**(10*(e-=1))*Math.sin((e*a-i)*(2*Math.PI)/n))+s}return l.linear(e,this,t)};l.easeOutElastic=function(e,t){let i=1.70158;let n=0;let r=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!n)n=a*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=r*2**(-10*e)*Math.sin((e*a-i)*(2*Math.PI)/n)+o+s}return l.linear(e,this,t)};l.easeInBack=function(e,t){const i=1.70158;e=e*e*((i+1)*e-i);return l.linear(e,this,t)};l.easeOutBack=function(e,t){const i=1.70158;e=(e=e/1-1)*e*((i+1)*e+i)+1;return l.linear(e,this,t)};l.easeInOutBack=function(e,t){let i=1.70158;const n=1/2;if((e/=1/2)<1)e=n*(e*e*(((i*=1.525)+1)*e-i));else e=n*((e-=2)*e*(((i*=1.525)+1)*e+i)+2);return l.linear(e,this,t)};const H=function(e){e--;e=e*e*e+1;return e};l.easeCubicOut=function(e,t){e=H(e);return l.linear(e,this,t)};const z=function(e){e*=2;if(e<1)e=.5*e*e*e;else{e-=2;e=.5*(e*e*e+2)}return e};l.easeCubicInOut=function(e,t){e=z(e);return l.linear(e,this,t)};l.easeSmoothStep=function(e,t){const i=Math.max(0,Math.min(1,e));e=i*i*(3-2*i);return l.linear(e,this,t)};l.easeSmootherStep=function(e,t){const i=Math.max(0,Math.min(1,(e-0)/(1-0)));e=i*i*i*(i*(i*6-15)+10);return l.linear(e,this,t)};let $={};class u extends t{static EVENT_KEY_DELETE="keyDelete";static EVENT_CHANGE="onChange";static EVENT_UIATTRIB_CHANGE="uiattrchange";static LOOP_OFF=0;static LOOP_REPEAT=1;static LOOP_MIRROR=2;static LOOP_OFFSET=3;static EASING_LINEAR=0;static EASING_ABSOLUTE=1;static EASING_SMOOTHSTEP=2;static EASING_SMOOTHERSTEP=3;static EASING_CUBICSPLINE=4;static EASING_CUBIC_IN=5;static EASING_CUBIC_OUT=6;static EASING_CUBIC_INOUT=7;static EASING_EXPO_IN=8;static EASING_EXPO_OUT=9;static EASING_EXPO_INOUT=10;static EASING_SIN_IN=11;static EASING_SIN_OUT=12;static EASING_SIN_INOUT=13;static EASING_BACK_IN=14;static EASING_BACK_OUT=15;static EASING_BACK_INOUT=16;static EASING_ELASTIC_IN=17;static EASING_ELASTIC_OUT=18;static EASING_BOUNCE_IN=19;static EASING_BOUNCE_OUT=21;static EASING_QUART_IN=22;static EASING_QUART_OUT=23;static EASING_QUART_INOUT=24;static EASING_QUINT_IN=25;static EASING_QUINT_OUT=26;static EASING_QUINT_INOUT=27;static EASING_CLIP=28;static EASINGNAMES=["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out","Clip"];#tlActive=true;uiAttribs={};loop=0;onLooped=null;_timesLooped=0;#needsSort=false;_cachedIndex=0;port=null;keys=[];onChange=null;stayInTimeline=false;batchMode=false;constructor(e={}){super();e=e||{};this.id=a();this._log=new r("Anim");this.name=e.name||null;this.defaultEasing=e.defaultEasing||u.EASING_LINEAR}forceChangeCallback(){if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this)}forceChangeCallbackSoon(){if(this.batchMode)return;if(!this.forcecbto)this.forcecbto=setTimeout(()=>{this.forceChangeCallback();this.forcecbto=null},50)}getLoop(){return this.loop}setLoop(e){if(e===false)e=0;if(e===true)e=1;this.loop=e;this.emitEvent(u.EVENT_CHANGE,this)}hasEnded(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return true;if(this.keys[this.keys.length-1].time<=e)return true;return false}hasStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return false;if(e>=this.keys[0].time)return true;return false}isRising(e){if(this.#needsSort)this.sortKeys();if(this.hasEnded(e))return false;const t=this.getKeyIndex(e);if(this.keys[t].value<this.keys[t+1].value)return true;return false}clearBefore(e){if(this.#needsSort)this.sortKeys();const t=this.getValue(e);const i=this.getKeyIndex(e);this.setValue(e,t);if(i>1){this.keys.splice(0,i);this.#needsSort=true}}clear(e){if(this.#needsSort)this.sortKeys();let t=0;if(e)t=this.getValue(e);for(let e=0;e<this.keys.length;e++)this.emitEvent(u.EVENT_KEY_DELETE,this.keys[e]);this.keys.length=0;if(e)this.setValue(e,t);this.#needsSort=true;if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this)}checkIsSorted(){let t=true;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e].time>this.keys[e+1].time){t=false;break}return t}sortKeys(){if(this.batchMode)return;if(!this.checkIsSorted()){this.keys.sort((e,t)=>{return e.time-t.time});this.#needsSort=false;if(this.keys.length>999&&this.keys.length%1e3==0)console.log(this.name,this.keys.length);this.emitEvent(u.EVENT_CHANGE)}}hasDuplicates(){const t={};let i=0;for(let e=0;e<this.keys.length;e++){t[this.keys[e].time]=1;i++}const e=Object.keys(t);if(e.length!=i){return true}return false}removeDuplicates(){if(this.hasDuplicates()){if(this.#needsSort)this.sortKeys();let t=0;while(this.hasDuplicates()){for(let e=0;e<this.keys.length-1;e++){if(this.keys[e].time==this.keys[e+1].time){const i=this.keys[e];this.keys.splice(e,1);this.emitEvent(u.EVENT_KEY_DELETE,i)}t++}}this.#needsSort=true}}getLengthLoop(){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return this.lastKey.time-this.firstKey.time}getLength(){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return 0;return this.lastKey.time}getKeyIndex(t){if(this.#needsSort)this.sortKeys();let i=0;let n=0;if(this._cachedIndex&&this.keys.length>this._cachedIndex&&t>=this.keys[this._cachedIndex].time)n=this._cachedIndex;for(let e=n;e<this.keys.length;e++){if(t>=this.keys[e].time)i=e;if(this.keys[e].time>t){if(t!=0)this._cachedIndex=i;return i}}return i}setValue(t,i,n=null){if(isNaN(i))CABLES.logStack();if(this.#needsSort)this.sortKeys();let r=null;if(!this.batchMode)if(this.keys.length==0||t<=this.lastKey.time)for(let e=0;e<this.keys.length;e++)if(this.keys[e].time==t){r=this.keys[e];this.keys[e].setValue(i);this.keys[e].cb=n;break}if(!r){r=new l({time:t,value:i,e:this.defaultEasing,cb:n,anim:this});this.keys.push(r)}if(!this.batchMode){if(this.onChange)this.onChange();this.emitEvent(u.EVENT_CHANGE,this);this.#needsSort=true}return r}setKeyEasing(e,t){if(this.keys[e]){this.keys[e].setEasing(t);this.emitEvent(u.EVENT_CHANGE,this)}}deserialize(t,e,i){if(t.loop)this.loop=t.loop;if(t.tlActive)this.#tlActive=t.tlActive;if(t.height)this.uiAttribs.height=t.height;if(e){while(this.keys.length)this.keys[0].delete();this.keys.length=0}for(const n in t.keys){let e=new l(t.keys[n],this);this.keys.push(e);if(i)if(t.keys[n].clipId){i[t.keys[n].clipId]=i[t.keys[n].clipId]||[];if(i)i[t.keys[n].clipId].push(e)}}this.sortKeys()}getSerialized(){const t={};t.keys=[];t.loop=this.loop;if(this.#tlActive)t.tlActive=this.tlActive;if(this.uiAttribs.height)t.height=this.uiAttribs.height;for(let e=0;e<this.keys.length;e++)t.keys.push(this.keys[e].getSerialized());return t}getKey(e){if(this.#needsSort)this.sortKeys();const t=this.getKeyIndex(e);return this.keys[t]}getNextKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)+1;if(t>=this.keys.length)return null;return this.keys[t]}getPrevKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)-1;if(t<0)return null;return this.keys[t]}isFinished(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return true;return e>this.lastKey.time}isStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return false;return e>=this.firstKey.time}remove(t,i){for(let e=0;e<this.keys.length;e++){if(this.keys[e]==t){this.emitEvent(u.EVENT_KEY_DELETE,this.keys[e]);this.keys.splice(e,1);this.#needsSort=true;if(i===undefined){this.emitEvent(u.EVENT_CHANGE,this)}return}}}get lastKey(){if(this.#needsSort)this.sortKeys();return this.keys[this.keys.length-1]}get firstKey(){if(this.#needsSort)this.sortKeys();return this.keys[0]}getLoopIndex(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return(e-this.firstKey.time)/this.getLengthLoop()}getValue(e=0){let t=0;if(this.keys.length===0)return 0;if(this.#needsSort)this.sortKeys();if(!this.loop&&e>this.lastKey.time){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}if(e<this.firstKey.time)return this.keys[0].value;if(this.loop&&this.keys.length>1&&e>this.lastKey.time){const o=this.getLoopIndex(e);if(o>this._timesLooped){this._timesLooped++;if(this.onLooped)this.onLooped()}e=(e-this.firstKey.time)%this.getLengthLoop();if(this.loop==u.LOOP_REPEAT){}else if(this.loop==u.LOOP_MIRROR){if(Math.floor(o)%2==1)e=this.getLengthLoop()-e}else if(this.loop==u.LOOP_OFFSET){t=(this.lastKey.value-this.keys[0].value)*Math.floor(o)}e+=this.firstKey.time}const i=this.getKeyIndex(e);if(i>=this.keys.length-1){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}const n=i+1;const r=this.keys[i];const s=this.keys[n];if(r.cb&&!r.cbTriggered)r.trigger();if(!s)return-1;const a=(e-r.time)/(s.time-r.time);if(r.getEasing()==u.EASING_CLIP){if(!r.clip&&this.port){const l=this.port.op.patch;const h=l.getVar(r.clipId)?.getValue();if(h)r.clip=h}if(r.clip&&r.clip.getValue){return r.clip.getValue(a*r.clip.getLength())}else{console.log("no clip found")}}return r.ease(a,s)+t}addKey(e){if(e.time===undefined){this._log.warn("key time undefined, ignoring!")}else{this.keys.push(e);if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this);this.#needsSort=true}}sortSoon(){this.#needsSort=true}easingFromString(e){if(e=="linear")return u.EASING_LINEAR;if(e=="absolute")return u.EASING_ABSOLUTE;if(e=="smoothstep")return u.EASING_SMOOTHSTEP;if(e=="smootherstep")return u.EASING_SMOOTHERSTEP;if(e=="Cubic In")return u.EASING_CUBIC_IN;if(e=="Cubic Out")return u.EASING_CUBIC_OUT;if(e=="Cubic In Out")return u.EASING_CUBIC_INOUT;if(e=="Expo In")return u.EASING_EXPO_IN;if(e=="Expo Out")return u.EASING_EXPO_OUT;if(e=="Expo In Out")return u.EASING_EXPO_INOUT;if(e=="Sin In")return u.EASING_SIN_IN;if(e=="Sin Out")return u.EASING_SIN_OUT;if(e=="Sin In Out")return u.EASING_SIN_INOUT;if(e=="Back In")return u.EASING_BACK_IN;if(e=="Back Out")return u.EASING_BACK_OUT;if(e=="Back In Out")return u.EASING_BACK_INOUT;if(e=="Elastic In")return u.EASING_ELASTIC_IN;if(e=="Elastic Out")return u.EASING_ELASTIC_OUT;if(e=="Bounce In")return u.EASING_BOUNCE_IN;if(e=="Bounce Out")return u.EASING_BOUNCE_OUT;if(e=="Quart Out")return u.EASING_QUART_OUT;if(e=="Quart In")return u.EASING_QUART_IN;if(e=="Quart In Out")return u.EASING_QUART_INOUT;if(e=="Quint Out")return u.EASING_QUINT_OUT;if(e=="Quint In")return u.EASING_QUINT_IN;if(e=="Quint In Out")return u.EASING_QUINT_INOUT;console.log("unknown anim easing?",e)}createPort(e,t,i){const n=e.inDropDown(t,u.EASINGNAMES,"linear");n.set("linear");n.defaultValue=0;n.onChange=()=>{this.defaultEasing=this.easingFromString(n.get());this.emitEvent("onChangeDefaultEasing",this);if(i)i()};return n}get tlActive(){return this.#tlActive}set tlActive(e){if(CABLES.UI){this.#tlActive=e;window.gui.emitEvent("tlActiveChanged",this);this.forceChangeCallbackSoon()}}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}this.emitEvent(u.EVENT_UIATTRIB_CHANGE)}hasKeyframesBetween(t,i){for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>=t&&this.keys[e].time<=i)return true;return false}static initClipsFromVars(i){for(const t in i.missingClipAnims){const n=i.getVar(t);for(let e=0;e<i.missingClipAnims[t].length;e++){i.missingClipAnims[t].clip=n.getValue();delete i.missingClipAnims[t]}}}}const h={ANIM:{EASINGS:u.EASINGNAMES,EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27,EASING_CLIP:28},OP:{OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_NUMBER:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_TRIGGER:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},PORT:{PORT_DIR_IN:0,PORT_DIR_OUT:1},PACO:{PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15,PACO_OP_RELOAD:16}};Math.randomSeed=1;Math.setRandomSeed=function(e){Math.randomSeed=e*50728129;if(e!=0){Math.randomSeed=Math.seededRandom()*17624813;Math.randomSeed=Math.seededRandom()*9737333}};Math.seededRandom=function(e,t){if(Math.randomSeed===0)Math.randomSeed=Math.random()*999;e=e||1;t=t||0;Math.randomSeed=(Math.randomSeed*9301+49297)%233280;const i=Math.randomSeed/233280;return t+i*(e-t)};String.prototype.endl=function(){return this+"\n"};String.prototype.contains=function(e){console.warn("string.contains deprecated, use string.includes");console.log((new Error).stack);return this.includes(e)};function W(){}W();function X(e,t){if(!(e instanceof Float32Array))e=new Float32Array(e);if(!(t instanceof Float32Array))t=new Float32Array(t);const i=new Float32Array(e.length+t.length);i.set(e);i.set(t,e.length);return i}const i=function(e){let t=e.split(".")[e.split(".").length-1];if(t.includes(h.OP.OP_VERSION_PREFIX)){const i=t.split(h.OP.OP_VERSION_PREFIX)[1];t=t.substring(0,t.length-(h.OP.OP_VERSION_PREFIX+i).length)}return t};const n=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1));const n=t[e];t[e]=t[i];t[i]=n}return t};const s={};const b=function(){let e=Math.random().toString(36).substr(2,9);if(s.hasOwnProperty(e))e=b();s[e]=true;return e};const a=function(){let i=(new Date).getTime();const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e=="x"?t:t&3|8).toString(16)});return e};const o=a;function c(t){for(const e in t){if(t[e]&&typeof objValue==="object"&&t[e].constructor===Object)t[e]=c(t[e]);if(t[e]===null||t[e]===undefined)delete t[e];else if(Array.isArray(t[e])&&t[e].length==0)delete t[e]}return t}const m=function(i,e="id"){let n=0;if(i.length>0){for(let t=0;t<i.length;t++){let e=i.charCodeAt(t);n=(n<<5)-n+e;n&=n}}return e+""+n};let f=0;const d=function(){f++;return f};const g=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*(3-2*t);return e};const p=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*t*(t*(t*6-15)+10);return e};const _=function(e,t,i){return Math.min(Math.max(e,t),i)};const v=function(e,t,i,n,r,s=0,a=true){if(a){if(e>=i)return r;if(e<=t)return n}let o=false;const l=Math.min(t,i);const h=Math.max(t,i);if(l!=t)o=true;let u=false;const c=Math.min(n,r);const f=Math.max(n,r);if(c!=n)u=true;let d=0;let g=0;if(o)d=(h-e)*(f-c)/(h-l);else d=(e-l)*(f-c)/(h-l);if(u)g=f-d;else g=d+c;if(!s)return g;if(s==1){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*(3-2*e)*(r-n)}if(s==2){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*e*(e*(e*6-15)+10)*(r-n)}return g};function x(e){return!isNaN(parseFloat(e))&&isFinite(e)}const E=function(e=""){if(!e)return"";if(e.startsWith("data:"))return;if(e.includes("?"))e+="&";else e+="?";return e+"cache="+CABLES.uuid()};const T=function(t,i){if(!t)return null;i=i||[];i.length=t.length;for(let e=0;e<t.length;e++)i[e]=t[e];return i};const Y=function(e){let t=CABLES.filename(e);const i=t.split(".");t=i[0];return t};const q=function(){console.log("logstack",(new Error).stack)};const K=function(e){let t="";if(!e)return"";if(e.startsWith("data:")&&e.includes(":")){const i=e.split(",");return i[0]}let i=(e+"").split("/");if(i.length>0){const n=i[i.length-1];let e=n.split("?");t=e[0]}return t||""};function A(e,t,i,n,r,s,a={},o={}){const l={url:e,cb:t,method:i,data:n,contenttype:r,sync:false,jsonP:s,headers:a};if(o&&o.credentials)l.credentials=o.credentials;Z(l)}function Z(t){if(!t.hasOwnProperty("asynch"))t.asynch=true;let i;try{i=new XMLHttpRequest}catch(e){}i.onreadystatechange=function(){if(i.readyState!=4)return;if(t.cb){if(i.status==200||i.status==0)t.cb(false,i.responseText,i);else t.cb(true,i.responseText,i)}};try{i.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync)}catch(e){if(t.cb&&e)t.cb(true,e.msg,i)}if(typeof t.headers==="object"){if(t.headers){const n=Object.keys(t.headers);for(let e=0;e<n.length;e++){const r=n[e];const s=t.headers[r];i.setRequestHeader(r,s)}}}if(t.credentials&&t.credentials!=="omit"){i.withCredentials=true}try{if(!t.post&&!t.data){i.send()}else{i.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded");i.send(t.data||t.post)}}catch(e){if(t.cb)t.cb(true,e.msg,i)}}const Q=function(e){CABLES.errorConsole=CABLES.errorConsole||{log:[]};CABLES.errorConsole.log.push({initiator:e,arguments:arguments});if(!CABLES.errorConsole.ele){const t=document.createElement("div");t.id="cablesErrorConsole";t.style.width="90%";t.style.height="300px";t.style.zIndex="9999999";t.style.display="inline-block";t.style.position="absolute";t.style.padding="10px";t.style.fontFamily="monospace";t.style.color="red";t.style.backgroundColor="#200";CABLES.errorConsole.ele=t;document.body.appendChild(t)}let n="ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";for(let i=0;i<CABLES.errorConsole.log.length;i++){n+=CABLES.errorConsole.log[i].initiator+" ";for(let e=1;e<CABLES.errorConsole.log[i].arguments.length;e++){if(e>2)n+=", ";let t=CABLES.errorConsole.log[i].arguments[e];if(t.constructor.name.indexOf("Error")>-1||t.constructor.name.indexOf("error")>-1){let e="Uncaught ErrorEvent ";if(t.message)e+=" message: "+t.message;n+=e}else if(typeof t=="string")n+=t;else if(typeof t=="number")n+=String(t)+" "}n+="<br/>"}CABLES.errorConsole.ele.innerHTML=n};function J(i){const n={},r=[];for(let e=0,t=i.length;e<t;++e){if(!n.hasOwnProperty(i[e])){r.push(i[e]);n[i[e]]=1}}return r}const ee={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};const te=/[&<>"']/g;const ie=RegExp(te.source);const ne=function(e){return e&&ie.test(e)?e.replace(te,function(e){return ee[e]}):e||""};class S extends t{static DIR_IN=0;static DIR_OUT=1;static TYPE_VALUE=0;static TYPE_NUMBER=0;static TYPE_FUNCTION=1;static TYPE_TRIGGER=1;static TYPE_OBJECT=2;static TYPE_TEXTURE=2;static TYPE_ARRAY=3;static TYPE_DYNAMIC=4;static TYPE_STRING=5;static EVENT_UIATTRCHANGE="onUiAttrChange";static EVENT_VALUE_CHANGE="change";static EVENT_LINK_CHANGED="onLinkChanged";static EVENT_LINK_REMOVED="onLinkRemoved";#oldAnimVal=-5711;animMuted=false;lastAnimTime=0;#uiActiveState=true;#valueBeforeLink=null;#animated=false;#useVariableName=null;#op=null;constructor(e,t,i,n={}){super();this.data={};this._log=new r("core_port");this.direction=S.DIR_IN;this.id=String(CABLES.simpleId());this.#op=e;this.links=[];this.value=0;this.name=t;this.type=i||S.TYPE_VALUE;this.uiAttribs=n||{};this.anim=null;this.defaultValue=null;this.ignoreValueSerialize=false;this.onLinkChanged=null;this.crashed=false;this.onValueChanged=null;this.onTriggered=null;this.changeAlways=false;this.forceRefChange=false;this.activityCounter=0;this.apf=0;this.activityCounterStartFrame=0;this.canLink=null;this.preserveLinks=null;this.indexPort=null}get parent(){this._log.stack("use port.op, not .parent");return this.op}get title(){return this.uiAttribs.title||this.name}get op(){return this.#op}get val(){return this.get()}set val(e){this.setValue(e)}copyLinkedUiAttrib(e,t){if(!CABLES.UI)return;if(!this.isLinked())return;const i={};i[e]=this.links[0].getOtherPort(this).getUiAttrib(e);t.setUiAttribs(i)}getValueForDisplay(){let e=this.value;if(typeof this.value==="string"||this.value instanceof String){if(e.length>1e3){e=e.substring(0,999);e+="..."}if(this.uiAttribs&&this.uiAttribs.display=="boolnum"){e+=" - ";if(!this.value)e+="false";else e+="true"}e=e.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"});if(e.length>100)e=e.substring(0,100)}else{e=String(this.value)}return e}onAnimToggle(){}_onAnimToggle(){this.onAnimToggle()}remove(){this.removeLinks();this.#op.removePort(this)}setUiAttribs(e){let t=false;if(!this.uiAttribs)this.uiAttribs={};for(const i in e){if(e[i]===undefined){delete this.uiAttribs[i];continue}if(this.uiAttribs[i]!=e[i])t=true;this.uiAttribs[i]=e[i];if(i=="group"&&this.indexPort)this.indexPort.setUiAttribs({group:e[i]})}if(e.hasOwnProperty("expose"))this.#op.patch.emitEvent("subpatchExpose",this.#op.uiAttribs.subPatch);if(t)this.emitEvent(S.EVENT_UIATTRCHANGE,e,this)}getUiAttribs(){return this.uiAttribs}getUiAttrib(e){if(!this.uiAttribs||!this.uiAttribs.hasOwnProperty(e))return null;return this.uiAttribs[e]}get(){if(CABLES.UI&&this.#animated&&this.lastAnimTime==this.#op.patch.timer.getTime()&&!CABLES.UI.keyframeAutoCreate){return this.value}if(!this.animMuted&&this.#animated&&this.lastAnimFrame!=this.#op.patch.getFrameNum()){this.lastAnimTime=this.#op.patch.timer.getTime();this.lastAnimFrame=this.#op.patch.getFrameNum();let e=this.anim.getValue(this.#op.patch.timer.getTime());if(this.value!=e){this.value=e;this.#oldAnimVal=this.value;this.forceChange()}}return this.value}setRef(e){this.forceRefChange=true;this.set(e)}set(e){this.setValue(e)}setValue(t){if(t===undefined)t=null;if(CABLES.UI&&CABLES.UI.showDevInfos)if(this.direction==h.PORT.PORT_DIR_OUT&&this.type==S.TYPE_OBJECT&&t&&!this.forceRefChange)this._log.warn("object port ["+this.name+"] uses .set ["+this.op.objName+"]");if(this.#op.enabled&&!this.crashed){if(t!==this.value||this.changeAlways||this.type==S.TYPE_TEXTURE||this.type==S.TYPE_ARRAY){if(CABLES.UI&&this.#animated){CABLES.UI.PREVISKEYVAL=null;if(!CABLES.UI.keyframeAutoCreate)CABLES.UI.PREVISKEYVAL=t}if(CABLES.UI&&this.#animated&&CABLES.UI.keyframeAutoCreate){let e=this.#op.patch.timer.getTime();if(CABLES.UI&&CABLES.Patch.getGui().glTimeline)CABLES.Patch.getGui().glTimeline.createKey(this.anim,e,t);else this.anim.setValue(e,t)}else{try{this.value=t;this.forceChange()}catch(e){this.crashed=true;this.setValue=function(e){};this.onTriggered=function(){};this._log.error("exception in ",this.#op);this._log.error(e);this.#op.patch.emitEvent("exception",e,this.#op)}if(this.#op&&this.#op.patch&&this.#op.patch.isEditorMode()&&this.type==S.TYPE_TEXTURE)CABLES.Patch.getGui().texturePreview().updateTexturePort(this)}if(this.direction==h.PORT.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}}}updateAnim(){if(!this.#animated||this.animMuted)return;this.value=this.get();if(this.#oldAnimVal!=this.value||this.changeAlways){this.#oldAnimVal=this.value;this.forceChange()}this.#oldAnimVal=this.value}forceChange(){if(this.onValueChanged||this.onChange){}this._activity();this.emitEvent(S.EVENT_VALUE_CHANGE,this.value,this);if(this.onChange)this.onChange(this,this.value);else if(this.onValueChanged)this.onValueChanged(this,this.value)}static getTypeString(e){if(e==S.TYPE_VALUE)return"Number";if(e==S.TYPE_FUNCTION)return"Trigger";if(e==S.TYPE_OBJECT)return"Object";if(e==S.TYPE_DYNAMIC)return"Dynamic";if(e==S.TYPE_ARRAY)return"Array";if(e==S.TYPE_STRING)return"String";return"Unknown"}getTypeString(){return S.getTypeString(this.type)}deSerializeSettings(e){if(!e)return;if(e.animated)this.setAnimated(e.animated);if(e.useVariable)this.setVariableName(e.useVariable);if(e.title)this.setUiAttribs({title:e.title});if(e.expose)this.setUiAttribs({expose:true});if(e.order)this.setUiAttribs({order:e.order});if(e.multiPortManual)this.setUiAttribs({multiPortManual:e.multiPortManual});if(e.multiPortNum)this.setUiAttribs({multiPortNum:e.multiPortNum});if(e.anim){if(!this.anim)this.anim=new u({name:"port "+this.name});this.#op.hasAnimPort=true;this.anim.port=this;this.anim.deserialize(e.anim,true,this.op.patch.clipAnims);this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.bindAnimListeners();this.anim.sortKeys()}}setInitialValue(e){if(this.op.preservedPortLinks[this.name]){for(let e=0;e<this.op.preservedPortLinks[this.name].length;e++){const t=this.op.preservedPortLinks[this.name][e];this.op.patch._addLink(t.objIn,t.objOut,t.portIn,t.portOut)}}if(this.op.preservedPortValues&&this.op.preservedPortValues.hasOwnProperty(this.name)&&this.op.preservedPortValues[this.name]!==undefined){this.set(this.op.preservedPortValues[this.name])}else if(e!==undefined)this.set(e);if(e!==undefined)this.defaultValue=e}getSerialized(){let t={name:this.getName()};if(!this.ignoreValueSerialize&&this.links.length===0){if(this.type==S.TYPE_OBJECT&&this.value&&this.value.tex){}else t.value=this.value}if(this.#useVariableName)t.useVariable=this.#useVariableName;if(this.#animated)t.animated=true;if(this.anim)t.anim=this.anim.getSerialized();if(this.uiAttribs.multiPortNum)t.multiPortNum=this.uiAttribs.multiPortNum;if(this.uiAttribs.multiPortManual)t.multiPortManual=this.uiAttribs.multiPortManual;if(this.uiAttribs.display=="file")t.display=this.uiAttribs.display;if(this.uiAttribs.expose){t.expose=true;if(this.uiAttribs.hasOwnProperty("order"))t.order=this.uiAttribs.order}if(this.uiAttribs.title)t.title=this.uiAttribs.title;if((this.preserveLinks||this.direction==h.PORT.PORT_DIR_OUT)&&this.links.length>0){t.links=[];for(const e in this.links){if(!this.links[e].ignoreInSerialize&&(this.links[e].portIn&&this.links[e].portOut))t.links.push(this.links[e].getSerialized())}}if(this.direction==S.DIR_IN&&this.links.length>0){for(const e in this.links){if(!this.links[e].portIn||!this.links[e].portOut)continue;const i=this.links[e].getOtherPort(this);if(i.op.isInBlueprint2&&this.op.isInBlueprint2){if(i.op.isInBlueprint2()&&!this.op.isInBlueprint2()){t.links=t.links||[];t.links.push(this.links[e].getSerialized())}}}}if(t.links&&t.links.length==0)delete t.links;if(this.type===S.TYPE_FUNCTION)delete t.value;if(this.type===S.TYPE_FUNCTION&&this.links.length==0)t=null;if(t&&Object.keys(t).length==1&&t.name)t=null;c(t);return t}shouldLink(e,t){return!!(e&&t)}removeLinks(){let e=0;while(this.links.length>0){e++;if(e>5e3){this._log.warn("could not delete links... / infinite loop");this.links.length=0;break}this.links[0].remove()}}removeLink(t){for(let e=0;e<this.links.length;e++)if(this.links[e]==t)this.links.splice(e,1);if(this.direction==S.DIR_IN){if(this.type==S.TYPE_VALUE)this.setValue(this.#valueBeforeLink||0);else this.setValue(this.#valueBeforeLink||null)}if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(S.EVENT_LINK_CHANGED);this.emitEvent(S.EVENT_LINK_REMOVED);this.#op.emitEvent(S.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getName(){return this.name}getTitle(){if(this.uiAttribs.title)return this.uiAttribs.title;return this.name}addLink(e){this.#valueBeforeLink=this.value;this.links.push(e);if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(S.EVENT_LINK_CHANGED);this.#op.emitEvent(S.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getLinkTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]}removeLinkTo(t){for(const e in this.links){if(this.links[e].portIn==t||this.links[e].portOut==t){this.links[e].remove();if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(S.EVENT_LINK_CHANGED);this.emitEvent(S.EVENT_LINK_REMOVED);return}}}isLinkedTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return true;return false}_activity(){this.activityCounter++}trigger(){const t=this.links.length;this._activity();if(t===0)return;if(!this.#op.enabled)return;let i=null;try{for(let e=0;e<t;++e){if(this.links[e].portIn){i=this.links[e].portIn;i.op.patch.pushTriggerStack(i);if(!i._onTriggered){console.log(i,i._onTriggered)}i._onTriggered();i.op.patch.popTriggerStack()}if(this.links[e])this.links[e].activity()}}catch(e){if(!i)return console.error("unknown port error");i.op.enabled=false;i.op.setUiError("crash","op crashed, port exception "+i.name,3);if(this.#op.patch.isEditorMode()){if(i.op.onError)i.op.onError(e)}this._log.error("exception in port: ",i.name,i.op.name,i.op.id);this._log.error(e)}}call(){this._log.warn("call deprecated - use trigger() ");this.trigger()}execute(){}setVariableName(e){this.#useVariableName=e;this.#op.patch.on("variableRename",(e,t)=>{if(e!=this.#useVariableName)return;this.#useVariableName=t})}getVariableName(){return this.#useVariableName}setVariable(e){this.setAnimated(false);const t={useVariable:false};if(this._variableIn&&this._varChangeListenerId){this._variableIn.off(this._varChangeListenerId);this._variableIn=null}if(e){this._variableIn=this.#op.patch.getVar(e);if(!this._variableIn){}else{if(this.type==S.TYPE_OBJECT){this._varChangeListenerId=this._variableIn.on("change",()=>{this.set(null);this.set(this._variableIn.getValue())})}else{this._varChangeListenerId=this._variableIn.on("change",this.set.bind(this))}this.set(this._variableIn.getValue())}this.#useVariableName=e;t.useVariable=true;t.variableName=this.#useVariableName}else{t.variableName=this.#useVariableName=null;t.useVariable=false}this.setUiAttribs(t);this.#op.patch.emitEvent("portSetVariable",this.#op,this,e)}_handleNoTriggerOpAnimUpdates(e){let t=false;if(!t){if(e)this._notriggerAnimUpdate=this.#op.patch.on("onRenderFrame",()=>{this.updateAnim()});else if(this._notriggerAnimUpdate)this._notriggerAnimUpdate=this.#op.patch.off(this._notriggerAnimUpdate)}}bindAnimListeners(){this.anim.on(u.EVENT_CHANGE,()=>{this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.updateAnimMaxTimeSoon()});this.anim.on(u.EVENT_KEY_DELETE,()=>{this.#op.patch.updateAnimMaxTimeSoon()})}setAnimated(e){let t=false;if(this.#animated!=e){this.#animated=e;this.#op.hasAnimPort=true;t=true}if(this.#animated&&!this.anim){this.anim=new u({name:"port "+this.name});this.bindAnimListeners()}if(this.#animated){let e=0;if(this.#op.patch.gui&&this.#op.patch.gui.glTimeline)e=this.#op.patch.timer.getTime();if(this.anim.keys.length==0)this.anim.setValue(e,this.value)}else{this.anim=null}this._handleNoTriggerOpAnimUpdates(e);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim);this.setUiAttribs({isAnimated:this.#animated});if(t)this._onAnimToggle()}toggleAnim(){this.setAnimated(!this.#animated);this.setUiAttribs({isAnimated:this.#animated});this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim)}getType(){return this.type}isLinked(){return this.links.length>0||this.#animated||this.#useVariableName!=null}isBoundToVar(){const e=this.#useVariableName!=null;this.uiAttribs.boundToVar=e;return e}isAnimated(){return this.#animated}isHidden(){return this.uiAttribs.hidePort}_onTriggered(e){this._activity();this.#op.updateAnims();if(this.#op.enabled&&this.onTriggered)this.onTriggered();if(this.#op.enabled)this.emitEvent("trigger",e)}_onSetProfiling(e){if(this.op.patch.debuggerEnabled){const t=e;this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - port "+this.name+": set value to "+e,exec:()=>{this.setValue(t)}});return}this.#op.patch.profiler.add("port",this);this.setValue(e);this.#op.patch.profiler.add("port",null)}_onTriggeredProfiling(){if(this.#op.enabled&&this.onTriggered){if(this.op.patch.debuggerEnabled){console.log();this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - triggered "+this.name,exec:()=>{this.onTriggered()}});return}this.#op.patch.profiler.add("port",this);this.onTriggered();this.#op.patch.profiler.add("port",null)}}onValueChange(e){this.onChange=e}hidePort(){}static portTypeNumberToString(e){if(e==S.TYPE_VALUE)return"value";if(e==S.TYPE_FUNCTION)return"function";if(e==S.TYPE_OBJECT)return"object";if(e==S.TYPE_ARRAY)return"array";if(e==S.TYPE_STRING)return"string";if(e==S.TYPE_DYNAMIC)return"dynamic";return"unknown"}}class I extends t{constructor(e){super();this.id=CABLES.simpleId();this.portIn=null;this.portOut=null;this._patch=e;this.activityCounter=0;this.ignoreInSerialize=false}setValue(e){if(e===undefined)this._setValue();else this.portIn.set(e)}activity(){this.activityCounter++}_setValue(){if(!this.portOut){this.remove();return}const e=this.portOut.get();if(e==e){if(this.portIn.type!=S.TYPE_FUNCTION)this.activity();if(this.portIn.get()!==e){this.portIn.set(e)}else{if(this.portIn.changeAlways)this.portIn.set(e);if(this.portOut.forceRefChange)this.portIn.forceChange()}}}getOtherPort(e){if(e==this.portIn)return this.portOut;return this.portIn}remove(){if(this.portIn)this.portIn.removeLink(this);if(this.portOut)this.portOut.removeLink(this);if(this._patch){this._patch.emitEvent("onUnLink",this.portIn,this.portOut,this)}if(this.portIn&&(this.portIn.type==S.TYPE_OBJECT||this.portIn.type==S.TYPE_ARRAY)){this.portIn.set(null);if(this.portIn.links.length>0)this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())}if(this.portIn)this.portIn.op._checkLinksNeededToWork();if(this.portOut)this.portOut.op._checkLinksNeededToWork();this.portIn=null;this.portOut=null;this._patch=null}link(e,t){if(!I.canLink(e,t)){console.warn("[core_link] cannot link ports!",e,t);return false}if(e.direction==S.DIR_IN){this.portIn=e;this.portOut=t}else{this.portIn=t;this.portOut=e}e.addLink(this);t.addLink(this);this.setValue();e.op._checkLinksNeededToWork();t.op._checkLinksNeededToWork()}getSerialized(){const e={};e.portIn=this.portIn.getName();e.portOut=this.portOut.getName();e.objIn=this.portIn.op.id;e.objOut=this.portOut.op.id;return e}static canLinkText(e,t){if(e.direction==t.direction){let e="(out)";if(t.direction==S.DIR_IN)e="(in)";return"can not link: same direction "+e}if(e.op==t.op)return"can not link: same op";if(e.type!=S.TYPE_DYNAMIC&&t.type!=S.TYPE_DYNAMIC){if(e.type!=t.type)return"can not link: different type"}if(CABLES.UI&&e.type==S.TYPE_OBJECT&&t.type==S.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType)if(e.uiAttribs.objType!=t.uiAttribs.objType)return"incompatible objects"}if(!e)return"can not link: port 1 invalid";if(!t)return"can not link: port 2 invalid";if(e.direction==S.DIR_IN&&e.isAnimated())return"can not link: is animated";if(t.direction==S.DIR_IN&&t.isAnimated())return"can not link: is animated";if(e.isLinkedTo(t))return"ports already linked";if(e.canLink&&!e.canLink(t)||t.canLink&&!t.canLink(e))return"Incompatible";return"can link"}static canLink(e,t){if(!e)return false;if(!t)return false;if(e.direction==S.DIR_IN&&e.isAnimated())return false;if(t.direction==S.DIR_IN&&t.isAnimated())return false;if(e.isHidden()||t.isHidden())return false;if(e.isLinkedTo(t))return false;if(e.direction==t.direction)return false;if(CABLES.UI&&e.type==S.TYPE_OBJECT&&t.type==S.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType){if(e.uiAttribs.objType.indexOf("sg_")==0&&t.uiAttribs.objType.indexOf("sg_")==0)return true;if(e.uiAttribs.objType!=t.uiAttribs.objType)return false}}if(e.type!=t.type&&(e.type!=S.TYPE_DYNAMIC&&t.type!=S.TYPE_DYNAMIC))return false;if(e.type==S.TYPE_DYNAMIC||t.type==S.TYPE_DYNAMIC)return true;if(e.op==t.op)return false;if(e.canLink&&!e.canLink(t))return false;if(t.canLink&&!t.canLink(e))return false;return true}}class M extends t{constructor(e){super();this._log=new r("LoadingStatus");this._loadingAssets={};this._cbFinished=[];this._assetTasks=[];this._percent=0;this._count=0;this._countFinished=0;this._order=0;this._startTime=0;this._patch=e;this._wasFinishedPrinted=false;this._loadingAssetTaskCb=false}setOnFinishedLoading(e){this._cbFinished.push(e)}getNumAssets(){return this._countFinished}getProgress(){return this._percent}checkStatus(){this._countFinished=0;this._count=0;for(const e in this._loadingAssets){this._count++;if(!this._loadingAssets[e].finished){this._countFinished++}}this._percent=(this._count-this._countFinished)/this._count;if(this._countFinished===0){for(let e=0;e<this._cbFinished.length;e++){if(this._cbFinished[e]){const t=this._cbFinished[e];setTimeout(()=>{t(this._patch);this.emitEvent("finishedAll")},100)}}if(!this._wasFinishedPrinted){this._wasFinishedPrinted=true;this.print()}this.emitEvent("finishedAll")}}getList(){let t=[];for(const e in this._loadingAssets){t.push(this._loadingAssets[e])}return t}getListJobs(){let t=[];for(const e in this._loadingAssets){if(!this._loadingAssets[e].finished)t.push(this._loadingAssets[e].name)}return t}print(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets){t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"])}this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s");this._log.table(t);this._log.groupEnd()}finished(e){const t=this._loadingAssets[e];if(t){if(t.finished)this._log.warn("loading job was already finished",t);if(t.op)t.op.setUiAttribs({loading:false});t.finished=true;t.timeEnd=Date.now()}this.checkStatus();this.emitEvent("finishedTask");return null}_startAssetTasks(){for(let e=0;e<this._assetTasks.length;e++)this._assetTasks[e]();this._assetTasks.length=0}addAssetLoadingTask(e){if(this._patch.isEditorMode()&&!CABLES.UI.loaded){this._assetTasks.push(e);if(!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this));this._loadingAssetTaskCb=true}else{e()}this.emitEvent("addAssetTask")}existByName(t){for(let e in this._loadingAssets){if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return true}}start(e,t,i){if(this._startTime==0)this._startTime=Date.now();const n=o();t=t||"unknown";if(t.length>100)t=t.substring(0,100);if(i)i.setUiAttrib({loading:true});this._loadingAssets[n]={id:n,op:i,type:e,name:t,finished:false,timeStart:Date.now(),order:this._order};this._order++;this.emitEvent("startTask");return n}}const C=function(){return window.performance.now()};const R=function(){return C()};class O extends t{static EVENT_PLAY_PAUSE="playPause";static EVENT_TIME_CHANGED="timeChanged";#lastTime=0;#timeOffset=0;#currentTime=0;#paused=true;#delay=0;#timeStart=0;#ts;constructor(){super();this.#timeStart=0;this.overwriteTime=-1}#internalNow(){if(this.#ts)return this.#ts;return C()}#getTime(){this.#lastTime=(this.#internalNow()-this.#timeStart)/1e3;return this.#lastTime+this.#timeOffset}setDelay(e){this.#delay=e;this.emitEvent(O.EVENT_TIME_CHANGED)}isPlaying(){return!this.#paused}update(e){if(e)this.#ts=e;if(this.#paused)return;this.#currentTime=this.#getTime();return this.#currentTime}getMillis(){return this.get()*1e3}get(){return this.getTime()}getTime(){if(this.overwriteTime>=0)return this.overwriteTime-this.#delay;return this.#currentTime-this.#delay}togglePlay(){if(this.#paused)this.play();else this.pause()}setTime(e){if(isNaN(e)||e<0)e=0;this.#timeStart=this.#internalNow();this.#timeOffset=e;this.#currentTime=e;this.emitEvent(O.EVENT_TIME_CHANGED)}setOffset(e){if(this.#currentTime+e<0){this.#timeStart=this.#internalNow();this.#timeOffset=0;this.#currentTime=0}else{this.#timeOffset+=e;this.#currentTime=this.#lastTime+this.#timeOffset}this.emitEvent(O.EVENT_TIME_CHANGED)}play(){this.#timeStart=this.#internalNow();this.#paused=false;this.emitEvent(O.EVENT_PLAY_PAUSE)}pause(){this.#timeOffset=this.#currentTime;this.#paused=true;this.emitEvent(O.EVENT_PLAY_PAUSE)}static now(){return window.performance.now()}}class y{constructor(e){this.startFrame=e.getFrameNum();this.items={};this.currentId=null;this.currentStart=0;this._patch=e}getItems(){return this.items}clear(){this.currentStart=performance.now();if(this.paused)return;this.items={}}togglePause(){this.paused=!this.paused;if(!this.paused){this.items={};this.currentStart=performance.now()}}add(e,t){if(this.paused)return;if(this.currentId!==null){if(!t||t.id!=this.currentId){const i=this.items[this.currentId];if(i){i.timeUsed+=performance.now()-this.currentStart;i._timePsCount++;i._timePsMs+=performance.now()-this.currentStart;if(i._timePsStart==0||performance.now()>i._timePsStart+1e3){i.timePsMs=i._timePsMs;i.timePsMsAvg=i._timePsMs/i._timePsCount;i.timePsCount=i._timePsCount;i._timePsCount=0;i._timePsMs=0;i._timePsStart=performance.now()}if(!i.peakTime||R()-i.peakTime>5e3){i.peak=0;i.peakTime=R()}i.peak=Math.max(i.peak,performance.now()-this.currentStart)}}}if(t!==null){if(!this.items[t.id]){this.items[t.id]={numTriggers:0,timeUsed:0,timeUsedFrame:0,timePsMsAvg:0,timePsMs:0,_timePsCount:0,_timePsMs:0,_timePsStart:performance.now()}}if(this.items[t.id].lastFrame!=this._patch.getFrameNum())this.items[t.id].numTriggers=0;this.items[t.id].lastFrame=this._patch.getFrameNum();this.items[t.id].numTriggers++;this.items[t.id].opid=t.op.id;this.items[t.id].title=t.op.name+"."+t.name;this.items[t.id].subPatch=t.op.uiAttribs.subPatch;this.currentId=t.id;this.currentStart=performance.now()}else{this.currentId=null}}print(){console.log("--------");for(const e in this.items){console.log(this.items[e].title+": "+this.items[e].numTriggers+" / "+this.items[e].timeUsed)}}}class re extends t{#name;constructor(e,t,i){super();this.#name=e;this.type=i;this.setValue(t)}addListener(e){this.on("change",e,"var")}getValue(){return this._v}get name(){return this.#name}getName(){return this.#name}setValue(e){this._v=e;this.emitEvent("change",e,this)}}class N extends t{static EVENT_OP_DELETED="onOpDelete";static EVENT_OP_ADDED="onOpAdd";static EVENT_PAUSE="pause";static EVENT_RESUME="resume";static EVENT_PATCHLOADEND="patchLoadEnd";static EVENT_VARIABLES_CHANGED="variablesChanged";static EVENT_RENDER_FRAME="onRenderFrame";static EVENT_RENDERED_ONE_FRAME="renderedOneFrame";static EVENT_LINK="onLink";static EVENT_VALUESSET="loadedValueSet";static EVENT_DISPOSE="dispose";static EVENT_ANIM_MAXTIME_CHANGE="animmaxtimechange";#renderOneFrame=false;#initialDeserialize=true;ops=[];settings={};animMaxTime=0;missingClipAnims={};constructor(e){super();this._log=new r("core_patch",{onError:e.onError});this.renderloop=null;this.config=e||{glCanvasResizeToWindow:false,prefixAssetPath:"",prefixJsPath:"",silent:true,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0};this.timer=new O;this.freeTimer=new O;this.animFrameOps=[];this.gui=false;CABLES.logSilent=this.silent=true;this.profiler=null;this.aborted=false;this._crashedOps=[];this._animReq=null;this._opIdCache={};this._triggerStack=[];this.storeObjNames=false;this.loading=new M(this);this._volumeListeners=[];this.namedTriggers={};this._origData=null;this.tempData=this.frameStore={};if(!function(){return!this}())console.log("not in strict mode: core patch");if(this.config.hasOwnProperty("silent"))this.silent=CABLES.logSilent=this.config.silent;if(!this.config.hasOwnProperty("doRequestAnimation"))this.config.doRequestAnimation=true;if(!this.config.prefixAssetPath)this.config.prefixAssetPath="";if(!this.config.prefixJsPath)this.config.prefixJsPath="";if(!this.config.masterVolume)this.config.masterVolume=1;this._variables={};this.vars={};if(e&&e.vars)this.vars=e.vars;this.cgl=null;this.cgp=null;this._subpatchOpCache={};window.dispatchEvent(new CustomEvent("INIT_CG",{detail:this}));this.loading.setOnFinishedLoading(this.config.onFinishedLoading);if(!CABLES.OPS){this.aborted=true;throw new Error("no CABLES.OPS found")}this.freeTimer.play();if(this.config.patch){this.deSerialize(this.config.patch)}else if(this.config.patchFile){A(this.config.patchFile,(e,t)=>{try{const i=JSON.parse(t);if(e){const n="";this._log.error("err",e);this._log.error("data",i);this._log.error("data",i.msg);return}this.deSerialize(i)}catch(e){this._log.error("could not load/parse patch ",e)}})}this.timer.play();console.log("made with https://cables.gl");this.cg=undefined}static getGui(){return window.gui}isPlaying(){if(this.renderloop)return!this.renderloop.paused;return false}renderOneFrame(){}isEditorMode(){return this.config.editorMode===true}pause(){this.emitEvent(N.EVENT_PAUSE);if(this.renderloop)this.renderloop.pause();this.freeTimer.pause()}resume(){this.freeTimer.play();this.emitEvent(N.EVENT_RESUME);if(this.renderloop)this.renderloop.resume()}setVolume(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)}getAssetPath(t=null){if(this.config.hasOwnProperty("assetPath")){return this.config.assetPath}else if(this.isEditorMode()){let e=t||N.getGui().project()._id;return"/assets/"+e+"/"}else if(document.location.href.indexOf("cables.gl")>0||document.location.href.indexOf("cables.local")>0){const i=document.location.pathname.split("/");let e=t||i[i.length-1];return"/assets/"+e+"/"}else{return"assets/"}}getJsPath(){if(this.config.hasOwnProperty("jsPath")){return this.config.jsPath}else{return"js/"}}getFilePath(e){if(!e)return e;e=String(e);if(e.indexOf("https:")===0||e.indexOf("http:")===0)return e;if(e.indexOf("data:")===0)return e;if(e.indexOf("file:")===0)return e;e=e.replace("//","/");if(e.startsWith(this.config.prefixAssetPath))e=e.replace(this.config.prefixAssetPath,"");return this.config.prefixAssetPath+e+(this.config.suffixAssetPath||"")}clear(){this.emitEvent("patchClearStart");this.animFrameOps.length=0;this.timer=new O;while(this.ops.length>0)this.deleteOp(this.ops[0].id);this._opIdCache={};this.emitEvent("patchClearEnd")}createOp(e,t,i=null){let n=null;let r="";try{if(!e){console.error("createop identifier false",e);console.log((new Error).stack);return}if(e.indexOf("Ops.")===-1){const s=e;if(CABLES.OPS[s]){r=CABLES.OPS[s].objName;try{n=new CABLES.OPS[s].f(this,r,t,s)}catch(e){this._crashedOps.push(r);this._log.error("[instancing error] constructor: "+r,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+r,e)}else{n=new CABLES.Op(this,r,t);n.setUiError("instancingError","Failed to instanciate op",3);n.setEnabled(false);if(this.#initialDeserialize)N.getGui().patchView.store.opCrashed=true}}n.opId=s}else{if(i){e=i;this._log.warn("could not find op by id: "+s)}else{throw new Error("could not find op by id: "+s,{cause:"opId:"+s})}}}if(!n){r=e;const a=e.split(".");const o=N.getOpClass(r);if(!o){this.emitEvent("criticalError",{title:"Unknown op: "+r,text:"Unknown op: "+r});this._log.error("unknown op: "+r);throw new Error("unknown op: "+r)}else{if(a.length==2)n=new window[a[0]][a[1]](this,r,t);else if(a.length==3)n=new window[a[0]][a[1]][a[2]](this,r,t);else if(a.length==4)n=new window[a[0]][a[1]][a[2]][a[3]](this,r,t);else if(a.length==5)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]](this,r,t);else if(a.length==6)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]](this,r,t);else if(a.length==7)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]](this,r,t);else if(a.length==8)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]](this,r,t);else if(a.length==9)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]](this,r,t);else if(a.length==10)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]][a[9]](this,r,t);else console.log("parts.length",a.length)}if(n){n.opId=null;for(const e in CABLES.OPS){if(CABLES.OPS[e].objName==r)n.opId=e}}}}catch(e){this._crashedOps.push(r);this._log.error("[instancing error] "+r,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+r,e)}else{if(this.#initialDeserialize)N.getGui().patchView.store.opCrashed=true}}if(n){n._objName=r;n.patch=this}else{this._log.log("no op was created!?",e,t)}return n}addOp(e,t,i,n=false,r=null){const s=this.createOp(e,i,r);if(s){t=t||{};if(t.hasOwnProperty("errors"))delete t.errors;if(t.hasOwnProperty("error"))delete t.error;t.subPatch=t.subPatch||0;s.setUiAttribs(t);if(s.onCreate)s.onCreate();if(s.hasOwnProperty("onAnimFrame")&&s.onAnimFrame)this.addOnAnimFrame(s);if(s.hasOwnProperty("onMasterVolumeChanged"))this._volumeListeners.push(s);if(this._opIdCache[s.id]){this._log.warn("opid with id "+s.id+" already exists in patch!");this.deleteOp(s.id)}this.ops.push(s);this._opIdCache[s.id]=s;if(this._subPatchCacheAdd)this._subPatchCacheAdd(t.subPatch,s);this.emitEvent(N.EVENT_OP_ADDED,s,n);if(s.init)s.init();s.emitEvent(P.EVENT_INIT,n)}else{this._log.error("addop: op could not be created: ",e)}return s}addOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t){return}this.animFrameOps.push(t)}removeOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++){if(this.animFrameOps[e]==t){this.animFrameOps.splice(e,1);return}}}addOnAnimFrameCallback(e){this.animFrameCallbacks.push(e)}removeOnAnimCallback(t){for(let e=0;e<this.animFrameCallbacks.length;e++){if(this.animFrameCallbacks[e]==t){this.animFrameCallbacks.splice(e,1);return}}}updateAnimMaxTimeSoon(){if(this.toAnimMaxTime)clearTimeout(this.toAnimMaxTime);this.toAnimMaxTime=setTimeout(()=>{this.updateAnimMaxTime()},50)}updateAnimMaxTime(){let i=0;for(let t=0;t<this.ops.length;t++){if(this.ops[t].hasAnimPort){for(let e=0;e<this.ops[t].portsIn.length;e++){if(this.ops[t].portsIn[e].anim){if(this.ops[t].portsIn[e].anim.lastKey&&this.ops[t].portsIn[e].anim.lastKey.time>i){i=this.ops[t].portsIn[e].anim.lastKey.time}}}}}if(i!=this.animMaxTime){this.animMaxTime=i;this.emitEvent(N.EVENT_ANIM_MAXTIME_CHANGE)}}deleteOp(n,r,s){let a=false;for(let i=0;i<this.ops.length;i++){if(this.ops[i].id==n){const o=this.ops[i];let e=null;let t=null;if(o){a=true;if(r){if(o.portsIn.length>0&&o.portsIn[0].isLinked()&&(o.portsOut.length>0&&o.portsOut[0].isLinked())){if(o.portsIn[0].getType()==o.portsOut[0].getType()&&o.portsIn[0].links[0]){e=o.portsIn[0].links[0].getOtherPort(o.portsIn[0]);t=o.portsOut[0].links[0].getOtherPort(o.portsOut[0])}}}const l=this.ops[i];l.removeLinks();this.ops.splice(i,1);l.emitEvent("delete",l);this.emitEvent(N.EVENT_OP_DELETED,l,s);if(this.clearSubPatchCache)this.clearSubPatchCache(l.uiAttribs.subPatch);if(l.onDelete)l.onDelete(s);l.cleanUp();if(e!==null&&t!==null){this.link(e.op,e.getName(),t.op,t.getName())}delete this._opIdCache[n];break}}}if(!a)this._log.warn("core patch deleteop: not found...",n)}getFrameNum(){if(this.renderloop)return this.renderloop.frameNum}updateAnims(t,i,e){if(!this.renderloop)return;this.timer.update(e);this.freeTimer.update(e);t=t||this.timer.getTime();for(let e=0;e<this.animFrameOps.length;++e)if(this.animFrameOps[e].onAnimFrame)this.animFrameOps[e].onAnimFrame(t,this.renderloop.frameNum,i)}link(e,t,i,n,r=false,s=false){if(!e)return this._log.warn("link: op1 is null ");if(!i)return this._log.warn("link: op2 is null");const a=e.getPort(t,r);const o=i.getPort(n,r);if(!a)return this._log.warn("port1 not found! "+t+" ("+e.objName+")");if(!o)return this._log.warn("port2 not found! "+n+" of "+i.name+"("+i.objName+")",i);if(!a.shouldLink(a,o)||!o.shouldLink(a,o))return false;if(I.canLink(a,o)){const l=new I(this);l.link(a,o);this.emitEvent(N.EVENT_LINK,a,o,l,s);return l}}serialize(e){const t={};e=e||{};t.ops=[];t.settings=this.settings;for(let e=0;e<this.ops.length;e++){const i=this.ops[e];if(i&&i.getSerialized)t.ops.push(i.getSerialized())}c(t);if(e.asObject)return t;return JSON.stringify(t)}getOpsByRefId(t){const e=N.getGui().uiProfiler.start("[corepatchetend] getOpsByRefId");const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].storage&&this.ops[e].storage.ref==t)i.push(this.ops[e]);e.finish();return i}getOpById(e){return this._opIdCache[e]}getOpsByObjName(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].objName==t)i.push(this.ops[e]);return i}getOpsByOpId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].opId==t)i.push(this.ops[e]);return i}getSubPatchOpsByName(t,i){const n=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)n.push(this.ops[e]);return n}getSubPatchOp(e,t){return this.getFirstSubPatchOpByName(e,t)}getFirstSubPatchOpByName(t,i){for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)return this.ops[e];return null}_addLink(e,t,i,n){return this.link(this.getOpById(e),i,this.getOpById(t),n,false,true)}logStartup(e){if(window.logStartup)window.logStartup(e)}deSerialize(a,e={genIds:false,createRef:false}){if(this.aborted)return;const n=[];const t=this.loading.start("core","deserialize");if(typeof a==="string")a=JSON.parse(a);if(this.#initialDeserialize){this.namespace=a.namespace||"";this.name=a.name||"";this.settings=a.settings}this.emitEvent("patchLoadStart");a.ops=a.ops||[];this.logStartup("add "+a.ops.length+" ops... ");const r=[];for(let i=0;i<a.ops.length;i++){const s=CABLES.now();const o=a.ops[i];let t=null;try{if(o.opId)t=this.addOp(o.opId,o.uiAttribs,o.id,true,o.objName);else t=this.addOp(o.objName,o.uiAttribs,o.id,true)}catch(e){this._log.error("[instancing error] op data:",o,e)}if(t){r.push(t);if(e.genIds)t.id=b();t.portsInData=o.portsIn;t._origData=JSON.parse(JSON.stringify(o));t.storage=o.storage;if(o.portsIn)for(let e=0;e<o.portsIn.length;e++){const h=o.portsIn[e];if(h&&h.hasOwnProperty("name")){const u=t.getPort(h.name);if(u&&(u.uiAttribs.display=="bool"||u.uiAttribs.type=="bool")&&!isNaN(h.value))h.value=h.value==true?1:0;if(u&&h.value!==undefined&&u.type!=S.TYPE_TEXTURE)u.set(h.value);if(u){u.deSerializeSettings(h)}else{t.preservedPortValues=t.preservedPortValues||{};t.preservedPortValues[h.name]=h.value}}}if(o.portsOut)for(let e=0;e<o.portsOut.length;e++){const h=o.portsOut[e];if(h&&h.hasOwnProperty("name")){const c=t.getPort(h.name);if(c){c.deSerializeSettings(h);if(c.uiAttribs.hasOwnProperty("title")){t.preservedPortTitles=t.preservedPortTitles||{};t.preservedPortTitles[c.name]=c.uiAttribs.title}if(c.type!=S.TYPE_TEXTURE&&h.hasOwnProperty("value"))c.set(a.ops[i].portsOut[e].value);if(h.expose)c.setUiAttribs({expose:true})}}}n.push(t)}const l=Math.round(100*(CABLES.now()-s))/100;if(!this.silent&&l>5)console.log("long op init ",a.ops[i].objName,l)}this.logStartup("add ops done");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoadedValueSet){this.ops[e].onLoadedValueSet(this.ops[e]._origData);this.ops[e].onLoadedValueSet=null;this.ops[e]._origData=null}this.ops[e].emitEvent(N.EVENT_VALUESSET)}this.logStartup("creating links");if(e.opsCreated)e.opsCreated(r);if(a.ops){for(let s=0;s<a.ops.length;s++){if(a.ops[s].portsIn){for(let t=0;t<a.ops[s].portsIn.length;t++){if(a.ops[s].portsIn[t]&&a.ops[s].portsIn[t].links){for(let e=0;e<a.ops[s].portsIn[t].links.length;e++){this._addLink(a.ops[s].portsIn[t].links[e].objIn,a.ops[s].portsIn[t].links[e].objOut,a.ops[s].portsIn[t].links[e].portIn,a.ops[s].portsIn[t].links[e].portOut)}}}}if(a.ops[s].portsOut)for(let r=0;r<a.ops[s].portsOut.length;r++)if(a.ops[s].portsOut[r]&&a.ops[s].portsOut[r].links){for(let n=0;n<a.ops[s].portsOut[r].links.length;n++){if(a.ops[s].portsOut[r].links[n]){if(a.ops[s].portsOut[r].links[n].subOpRef){const f=this.getOpById(a.ops[s].portsOut[r].links[n].objOut);let t=null;let i=0;for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[r].links[n].subOpRef&&f.uiAttribs.subPatch==this.ops[e].uiAttribs.subPatch){i=this.ops[e].patchId.get();break}}for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[r].links[n].refOp&&this.ops[e].uiAttribs.subPatch==i){t=this.ops[e];break}}if(!t)this._log.warn("could not find op for lost link");else{this._addLink(t.id,a.ops[s].portsOut[r].links[n].objOut,a.ops[s].portsOut[r].links[n].portIn,a.ops[s].portsOut[r].links[n].portOut)}}else{const i=this._addLink(a.ops[s].portsOut[r].links[n].objIn,a.ops[s].portsOut[r].links[n].objOut,a.ops[s].portsOut[r].links[n].portIn,a.ops[s].portsOut[r].links[n].portOut);if(!i){const d=this.getOpById(a.ops[s].portsOut[r].links[n].objIn);const g=this.getOpById(a.ops[s].portsOut[r].links[n].objOut);if(!d)console.log("could not find link op1");if(!g)console.log("could not find link op2");const p=a.ops[s].portsOut[r].links[n].portIn;if(d&&!d.getPort(p)){d.preservedPortLinks[p]=d.preservedPortLinks[p]||[];d.preservedPortLinks[p].push(a.ops[s].portsOut[r].links[n])}const m=a.ops[s].portsOut[r].links[n].portOut;if(g&&!g.getPort(m)){g.preservedPortLinks[p]=g.preservedPortLinks[p]||[];g.preservedPortLinks[p].push(a.ops[s].portsOut[r].links[n])}}}}}}}}this.logStartup("calling ops onloaded");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoaded){this.ops[e].onLoaded();this.ops[e].onLoaded=null}}this.logStartup("initializing ops...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].init){try{this.ops[e].init();this.ops[e].init=null}catch(e){console.error("op.init crash",e)}}}this.logStartup("initializing vars...");if(this.config.variables)for(const _ in this.config.variables)this.setVarValue(_,this.config.variables[_]);this.logStartup("initializing var ports");for(let e=0;e<this.ops.length;e++){this.ops[e].initVarPorts();delete this.ops[e].uiAttribs.pasted}setTimeout(()=>{this.loading.finished(t)},100);this.updateAnimMaxTime();if(this.config.onPatchLoaded)this.config.onPatchLoaded(this);this.emitEvent(N.EVENT_PATCHLOADEND,n,a,e.genIds);this.#initialDeserialize=false}profile(e){this.profiler=new y(this);for(let e=0;e<this.ops.length;e++)this.ops[e].profile()}setVariable(e,t){if(this._variables[e]!==undefined){this._variables[e].setValue(t)}else{this._log.warn("variable "+e+" not found!")}}_sortVars(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((e,t)=>{return e.localeCompare(t,"en",{sensitivity:"base"})}).forEach(e=>{t[e]=this._variables[e]});this._variables=t}hasVar(e){return this._variables[e]!==undefined}setVarValue(e,t,i){if(this.hasVar(e)){this._variables[e].setValue(t)}else{this._variables[e]=new re(e,t,i);this._sortVars();this.emitEvent(N.EVENT_VARIABLES_CHANGED)}return this._variables[e]}getVarValue(e,t){if(this._variables.hasOwnProperty(e))return this._variables[e].getValue()}getVar(e){if(this._variables.hasOwnProperty(e))return this._variables[e]}deleteVar(i){for(let t=0;t<this.ops.length;t++)for(let e=0;e<this.ops[t].portsIn.length;e++)if(this.ops[t].portsIn[e].getVariableName()==i)this.ops[t].portsIn[e].setVariable(null);delete this._variables[i];this.emitEvent("variableDeleted",i);this.emitEvent("variablesChanged")}getVars(t){if(t===undefined)return this._variables;if(t===1)return{};const e=N.getGui().uiProfiler.start("[corepatchetend] getVars");const i=[];let n="";if(t==S.TYPE_STRING)n="string";else if(t==S.TYPE_VALUE)n="number";else if(t==S.TYPE_ARRAY)n="array";else if(t==S.TYPE_OBJECT)n="object";else if(t==S.TYPE_DYNAMIC)n="dynamic";else{console.log("unknown port type",t);console.log((new Error).stack)}for(const e in this._variables){if(!this._variables[e].type||this._variables[e].type==n||this._variables[e].type==t)i.push(this._variables[e])}e.finish();return i}preRenderOps(){this._log.log("prerendering...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].preRender){this.ops[e].preRender();this._log.log("prerender "+this.ops[e].objName)}}}dispose(){this.pause();this.clear();this.emitEvent(N.EVENT_DISPOSE)}pushTriggerStack(e){this._triggerStack.push(e)}popTriggerStack(){this._triggerStack.pop()}printTriggerStack(){if(this._triggerStack.length==0){return}console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].op.objName+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++){t.push(e+". "+this._triggerStack[e].op.objName+" "+this._triggerStack[e].name)}console.table(t);console.groupEnd()}get containerElement(){if(this.config.containerElement)return this.config.containerElement;if(this.cg&&this.cg.canvas.parentElement)return this.cg.canvas.parentElement;if(this.cgl&&this.cgl.canvas.parentElement)return this.cgl.canvas.parentElement;return document.body}getDocument(){return this.containerElement.ownerDocument}static getOpClass(e){const t=e.split(".");let i=null;try{if(t.length==2)i=window[t[0]][t[1]];else if(t.length==3)i=window[t[0]][t[1]][t[2]];else if(t.length==4)i=window[t[0]][t[1]][t[2]][t[3]];else if(t.length==5)i=window[t[0]][t[1]][t[2]][t[3]][t[4]];else if(t.length==6)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]];else if(t.length==7)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]];else if(t.length==8)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]];else if(t.length==9)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]];else if(t.length==10)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]][t[9]];return i}catch(e){return null}}static replaceOpIds(n,r){const t={};for(const e in n.ops){t[n.ops[e].id]=n.ops[e]}for(const i in n.ops){for(const o in n.ops[i].portsOut){const l=n.ops[i].portsOut[o].links;if(l){let e=l.length;while(e--){if(l[e]&&(!t[l[e].objIn]||!t[l[e].objOut])){if(!r.doNotUnlinkLostLinks){l.splice(e,1)}else{if(r.fixLostLinks){const h=N.getGui().corePatch().getOpById(l[e].objIn);if(!h)console.log("op not found!");else{const u=N.getGui().patchView.getSubPatchOuterOp(h.uiAttribs.subPatch);if(u){h.storage=h.storage||{};h.storage.ref=h.storage.ref||b();l[e].refOp=h.storage.ref;l[e].subOpRef=u.storage.ref}}}}}}}}}for(const t in n.ops){const h=n.ops[t];const c=h.id;let e=b();if(r.prefixHash)e=m(r.prefixHash+c);else if(r.prefixId)e=r.prefixId+c;else if(r.refAsId){if(h.storage&&h.storage.ref){e=h.storage.ref;delete h.storage.ref}else{h.storage=h.storage||{};h.storage.ref=e=b()}}const f=h.id=e;if(r.oldIdAsRef){h.storage=h.storage||{};h.storage.ref=c}for(const i in n.ops){if(n.ops[i].portsIn)for(const o in n.ops[i].portsIn){if(n.ops[i].portsIn[o].links){let e=n.ops[i].portsIn[o].links.length;while(e--)if(n.ops[i].portsIn[o].links[e]===null)n.ops[i].portsIn[o].links.splice(e,1);for(e in n.ops[i].portsIn[o].links){if(n.ops[i].portsIn[o].links[e].objIn===c)n.ops[i].portsIn[o].links[e].objIn=f;if(n.ops[i].portsIn[o].links[e].objOut===c)n.ops[i].portsIn[o].links[e].objOut=f}}}if(n.ops[i].portsOut)for(const o in n.ops[i].portsOut){if(n.ops[i].portsOut[o].links){let e=n.ops[i].portsOut[o].links.length;while(e--)if(n.ops[i].portsOut[o].links[e]===null)n.ops[i].portsOut[o].links.splice(e,1);for(e in n.ops[i].portsOut[o].links){if(n.ops[i].portsOut[o].links[e].objIn===c)n.ops[i].portsOut[o].links[e].objIn=f;if(n.ops[i].portsOut[o].links[e].objOut===c)n.ops[i].portsOut[o].links[e].objOut=f}}}}}const s=[];const a=[];for(let i=0;i<n.ops.length;i++){if(n.ops[i].storage&&n.ops[i].storage.subPatchVer){for(let t=0;t<n.ops[i].portsIn.length;t++){if(n.ops[i].portsIn[t].name==="patchId"){let e=b();if(r.prefixHash)e=m(r.prefixHash+n.ops[i].portsIn[t].value);const d=n.ops[i].portsIn[t].value;const g=n.ops[i].portsIn[t].value=e;s.push(g);for(let e=0;e<n.ops.length;e++){if(n.ops[e].uiAttribs){if(n.ops[e].uiAttribs.subPatch===d){n.ops[e].uiAttribs.subPatch=g;a.push(n.ops[e].id)}}}}}}}for(const p in n.ops){let t=false;for(let e=0;e<a.length;e++){if(n.ops[p].id===a[e]){t=true;break}}if(!t&&n.ops[p].uiAttribs&&r.parentSubPatchId!=null)n.ops[p].uiAttribs.subPatch=r.parentSubPatchId}return n}}class se extends S{constructor(e,t,i,n,r){super(e,t,i,n);this.get=()=>{let e=super.get();if(CABLES.UI){if(e===""||e===null||e===undefined||n.values&&n.values.indexOf(String(e))===-1){this.op.setUiError("invalidswitch","Invalid Value ["+this.name+']: "'+e+'"',1)}else this.op.setUiError("invalidswitch",null)}if(e===null||e===undefined)e="";return e};this.indexPort=r;this.indexPort.set=e=>{const t=n.values;if(!t){return}let i=Math.floor(e);i=Math.min(i,t.length-1);i=Math.max(i,0);this.indexPort.setValue(i);this.set(t[i]);if(this.op.patch.isEditorMode()&&performance.now()-(this.lastTime||0)>100&&N.getGui()&&N.getGui().patchView.isCurrentOp(this.op)){N.getGui().opParams.show(this.op);this.lastTime=performance.now()}}}setUiAttribs(e){const t=e.hidePort;e.hidePort=true;super.setUiAttribs(e);if(typeof t!=="undefined")this.indexPort.setUiAttribs({hidePort:t})}}class ae extends se{setUiAttribs(e){if(this.indexPort.isLinked()){for(const t in e){if(t=="greyout"&&!e[t])e[t]="true"}}super.setUiAttribs(e)}}const w=2;class oe extends S{constructor(e,i,n,r,t,s){super(e,i,S.TYPE_ARRAY,t);this.setUiAttribs({multiPort:true,group:this.name,order:-1});this.ports=[];this.direction=r;this._uiAttribsPorts=s;const a=()=>{const t=[];let i=1;if(this.uiAttribs.multiPortManual)i=0;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let s=!this.uiAttribs.multiPortManual||false;if(this.direction==h.PORT.PORT_DIR_OUT)s=false;for(let r=0;r<this.ports.length;r++){let e;let t=false;let i;let n={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[r].name])i=this.op.preservedPortTitles[this.ports[r].name];if(r==0)e=this.ports.length;if(!this.uiAttribs.multiPortManual)if(r==this.ports.length-1){i="add port";t=true;s=true}for(const a in this._uiAttribsPorts){n[a]=this._uiAttribsPorts[a]}n.addPort=t;n.longPort=e;n.title=i;n.greyout=s;n.group=this.name;this.ports[r].setUiAttribs(n)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++){if(!this.ports[e])this.ports.splice(e,1)}if(!this.uiAttribs.multiPortManual){if(this.ports.length>w)for(let e=this.ports.length-1;e>1;e--){if(!this.ports[e].isLinked())this.uiAttribs.multiPortNum=e;else break}}a()};this.countPorts=()=>{const e=N.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let i=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const n=this.ports[e+1];const r=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!n||!r){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,n.name,r.op,r.name);i=true}break}}if(!this.uiAttribs.multiPortManual){let t=true;while(t){t=false;for(let e=this.ports.length-1;e>1;e--){if(this.ports[e]&&this.ports[e].links.length>0&&this.ports[e-1].links.length==0){const r=this.ports[e].links[0].getOtherPort(this.ports[e]);this.ports[e].links[0].remove();const n=this.ports[e-1];if(n&&this.ports[e]){this.op.patch.link(this.op,n.name,r.op,r.name);t=true;i=true;break}}}}}if(!this.uiAttribs.multiPortManual){while(this.ports.length>w&&!this.ports[this.ports.length-1].isLinked()&&!this.ports[this.ports.length-2].isLinked()){let e=this.ports.length-1;if(!this.ports[e].isLinked()&&this.ports[e-1]&&!this.ports[e-1].isLinked()){this.ports[e].setUiAttribs({removed:true});this.ports[e].remove();this.ports.splice(e,1)}}}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(i)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered()});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=n;const t=new S(this.op,i+"_"+this.ports.length,n,e);t.direction=r;if(this.direction==h.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(n==S.TYPE_NUMBER)t.setInitialValue(0);else if(n==S.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<w;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(w,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts()};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||w;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.toggleManual=()=>{this.setUiAttribs({multiPortManual:!this.uiAttribs.multiPortManual});this.op.refreshParams()};this.on("onUiAttrChange",e=>{if(e.hasOwnProperty("multiPortManual")){o();this.removeInvalidPorts();this.checkNum();this.countPorts();o()}});this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}const L=2;class le extends S{constructor(e,i,n,r,t,s){super(e,i,S.TYPE_ARRAY,t);this.setUiAttribs({multiPort2:true,multiPort:true,group:this.name,order:-1,multiPortManual:true});this.ports=[];this.direction=r;this._uiAttribsPorts=s;const a=()=>{const t=[];let i=1;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let s=!this.uiAttribs.multiPortManual;if(this.direction==h.PORT.PORT_DIR_OUT)s=false;for(let r=0;r<this.ports.length;r++){let e;let t=false;let i;let n={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[r].name])i=this.op.preservedPortTitles[this.ports[r].name];if(r==0)e=this.ports.length;if(r==this.ports.length-1){i="add port";t=true;s=true}for(const a in this._uiAttribsPorts)n[a]=this._uiAttribsPorts[a];n.addPort=t;n.longPort=e;n.title=i;n.greyout=s;n.group=this.name;this.ports[r].setUiAttribs(n)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++)if(!this.ports[e])this.ports.splice(e,1);a()};this.countPorts=()=>{const e=N.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let t=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const i=this.ports[e+1];const n=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!i||!n){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,i.name,n.op,n.name);t=true}break}}if(this.ports.length>1&&this.ports[this.ports.length-1].uiAttribs.addPort&&this.ports[this.ports.length-1].isLinked()){this.ports[this.ports.length-1].uiAttribs.addPort=false;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+1})}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(t)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered(i)});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=n;const t=new S(this.op,i+"_"+this.ports.length,n,e);t.direction=r;if(this.direction==h.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(n==S.TYPE_NUMBER)t.setInitialValue(0);else if(n==S.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<L;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(L,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts();if(this.ports.length>1&&this.ports[this.ports.length-1].uiAttribs.addPort&&this.ports[this.ports.length-1].isLinked()){this.ports[this.ports.length-1].removeLinks();console.log("found invalid")}};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||L;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}class P extends t{static OP_VERSION_PREFIX="_v";static EVENT_INIT="init";static EVENT_UIATTR_CHANGE="onUiAttribsChange";static UI_ERRORLEVEL_HINT=0;static UI_ERRORLEVEL_WARNING=1;static UI_ERRORLEVEL_ERROR=2;static UI_ERRORLEVEL_NOTWORKING=3;#objName="";_log=new r("core_op");#shortOpName="";opId="";portsOut=[];patch=null;data={};storage={};portsIn=[];portsInData=[];uiAttribs={};enabled=true;onAnimFrame=null;preservedPortTitles={};preservedPortValues={};preservedPortLinks={};linkTimeRules={needsLinkedToWork:[],needsStringToWork:[],needsParentOp:null};shouldWork={};hasUiErrors=0;uiErrors={};hasAnimPort=false;patchId=null;constructor(e,t,i=null){super();this.opId=i;this.#objName=t;this.patch=e;this.#shortOpName=CABLES.getShortOpName(t);this.getTitle();this.id=i||b();this.onAddPort=null;this.onCreate=null;this.onResize=null;this.onLoaded=null;this.onDelete=null;this.onError=null;this._instances=null;this.preRender=null;this.init=null}isInBlueprint2(){return false}getSubPatch(){return 0}get name(){return this.getTitle()}set name(e){this.setTitle(e)}set _objName(e){this.#objName=e;this._log=new r("op "+e)}get objName(){return this.#objName}get shortName(){return this.#shortOpName}require(e){if(CABLES.platform&&CABLES.StandaloneElectron&&!CABLES.platform.frontendOptions.isElectron)this.setUiError("notstandalone","This op will only work in cables standalone version",3);return null}checkMainloopExists(){if(!CABLES.UI)return;if(!this.patch.tempData.mainloopOp)this.setUiError("nomainloop","patch should have a mainloop to use this op");else this.setUiError("nomainloop",null)}getTitle(){if(!this.uiAttribs)return"nouiattribs"+this.shortName;return this.uiAttribs.title||this.#shortOpName}setTitle(e){if(e!=this.getTitle())this._setUiAttrib({title:e})}setStorage(e){if(!e)return;this.storage=this.storage||{};let t=false;for(const i in e){if(this.storage[i]!=e[i])t=true;this.storage[i]=e[i]}if(t)this.emitEvent("onStorageChange",e)}isSubPatchOp(){if(this.patchId&&this.storage)return this.storage.subPatchVer||this.storage.blueprintVer||0;return false}setUiAttrib(e){this._setUiAttrib(e)}setUiAttribs(e){this._setUiAttrib(e)}uiAttr(e){this._setUiAttrib(e)}_setUiAttrib(e){if(!e)return;if(typeof e!="object")this._log.error("op.uiAttrib attribs are not of type object");if(!this.uiAttribs)this.uiAttribs={};let t=false;let i=false;if(CABLES.UI&&e.hasOwnProperty("translate")&&(!this.uiAttribs.translate||this.uiAttribs.translate.x!=e.translate.x||this.uiAttribs.translate.y!=e.translate.y))i=true;if(e.hasOwnProperty("title")&&e.title!=this.uiAttribs.title){this.uiAttribs.title=e.title;t=true}if(e.hasOwnProperty("disabled")){t=true;this.setEnabled(!e.disabled)}for(const n in e){if(this.uiAttribs[n]!=e[n])t=true;this.uiAttribs[n]=e[n]}if(this.uiAttribs.hasOwnProperty("highlighted")&&this.uiAttribs.highlighted==false)delete this.uiAttribs.highlighted;if(this.uiAttribs.hasOwnProperty("highlightedMore")&&this.uiAttribs.highlightedMore==false)delete this.uiAttribs.highlightedMore;if(this.uiAttribs.hasOwnProperty("selected")&&this.uiAttribs.selected==false)delete this.uiAttribs.selected;if(this.uiAttribs.hasOwnProperty("selected"))t=true;if(t){this.emitEvent(P.EVENT_UIATTR_CHANGE,e);this.patch.emitEvent("onUiAttribsChange",this,e)}if(i)this.emitEvent("move")}getName(){return this.#shortOpName}addOutPort(e){e.direction=h.PORT.PORT_DIR_OUT;if(e.op!=this)console.error("port op is not this...");this.portsOut.push(e);this.emitEvent("onPortAdd",e);return e}hasDynamicPort(){let e=0;for(e=0;e<this.portsIn.length;e++){if(this.portsIn[e].type==S.TYPE_DYNAMIC)return true;if(this.portsIn[e].getName()=="dyn")return true}for(e=0;e<this.portsOut.length;e++){if(this.portsOut[e].type==S.TYPE_DYNAMIC)return true;if(this.portsOut[e].getName()=="dyn")return true}return false}addInPort(e,t){e.direction=S.DIR_IN;e._op=this;if(!t){this.portsIn.push(e)}else{const i=this.portsIn.indexOf(t);this.portsIn.splice(i+1,0,e)}this.emitEvent("onPortAdd",e);return e}inFunction(e,t){return this.inTrigger(e,t)}inTrigger(e,t){const i=this.addInPort(new S(this,e,S.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}inTriggerButton(e,t){const i=this.addInPort(new S(this,e,S.TYPE_FUNCTION,{display:"button"}));if(t!==undefined)i.set(t);return i}inUiTriggerButtons(e,t){const i=this.addInPort(new S(this,e,S.TYPE_FUNCTION,{display:"buttons"}));if(t!==undefined)i.set(t);return i}inValueFloat(e,t){return this.inFloat(e,t)}inValue(e,t){return this.inFloat(e,t)}inFloat(e,t){const i=this.addInPort(new S(this,e,S.TYPE_VALUE));i.setInitialValue(t);return i}inValueBool(e,t){return this.inBool(e,t)}inBool(e,t){const i=this.addInPort(new S(this,e,S.TYPE_NUMBER,{display:"bool"}));if(t===true)t=1;if(t===false)t=0;i.setInitialValue(t);return i}inMultiPort(e,t,i){const n={addPort:true,hidePort:true};const r=new oe(this,e,t,S.DIR_IN,n,i);r.ignoreValueSerialize=true;this.addInPort(r);r.initPorts();return r}inMultiPort2(e,t,i){const n={addPort:true,hidePort:true};const r=new le(this,e,t,S.DIR_IN,n,i);r.ignoreValueSerialize=true;this.addInPort(r);r.initPorts();return r}outMultiPort(e,t,i={}){const n=new oe(this,e,t,h.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);n.ignoreValueSerialize=true;this.addOutPort(n);n.initPorts();return n}outMultiPort2(e,t,i={}){const n=new le(this,e,t,h.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);n.ignoreValueSerialize=true;this.addOutPort(n);n.initPorts();return n}inValueString(e,t){const i=this.addInPort(new S(this,e,S.TYPE_VALUE,{type:"string"}));i.value="";i.setInitialValue(t);return i}inString(e,t){const i=this.addInPort(new S(this,e,S.TYPE_STRING,{type:"string"}));t=t||"";i.setInitialValue(t);return i}inTextarea(e,t){const i=this.addInPort(new S(this,e,S.TYPE_STRING,{type:"string",display:"text"}));i.value="";if(t!==undefined){i.set(t);i.defaultValue=t}return i}inStringEditor(e,t,i,n=true){const r=this.addInPort(new S(this,e,S.TYPE_STRING,{type:"string",display:"editor",editShortcut:true,editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inValueEditor(e,t,i,n=true){const r=this.addInPort(new S(this,e,S.TYPE_NUMBER,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inValueSelect(e,t,i,n){return this.inDropDown(e,t,i,n)}inDropDown(e,t,i,n){let r=null;if(!n){const s=new S(this,e+" index",S.TYPE_NUMBER,{increment:"integer",hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new ae(this,e,S.TYPE_NUMBER,{display:"dropdown",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=()=>{o.setUiAttribs({greyout:s.isLinked()})};r=this.addInPort(o);if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);r.defaultValue=i;a.defaultValue=l}}else{const o=new S(this,e,S.TYPE_VALUE,{display:"dropdown",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inSwitch(e,t,i,n){let r=null;if(!n){if(!i)i=t[0];const s=new S(this,e+" index",S.TYPE_VALUE,{increment:"integer",values:t,hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new se(this,e,S.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})};r=this.addInPort(o);if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);r.defaultValue=i;a.defaultValue=l}}else{const o=new S(this,e,S.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inValueInt(e,t){return this.inInt(e,t)}inInt(e,t){const i=this.addInPort(new S(this,e,S.TYPE_VALUE,{increment:"integer"}));if(t!==undefined){i.set(t);i.defaultValue=t}return i}inFile(e,t,i){const n=this.addInPort(new S(this,e,S.TYPE_VALUE,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inUrl(e,t,i){const n=this.addInPort(new S(this,e,S.TYPE_STRING,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inTexture(e,t){const i=this.addInPort(new S(this,e,S.TYPE_OBJECT,{display:"texture",objType:"texture",preview:true}));i.ignoreValueSerialize=true;if(t!==undefined)i.set(t);return i}inObject(e,t,i){const n=this.addInPort(new S(this,e,S.TYPE_OBJECT,{objType:i}));n.ignoreValueSerialize=true;if(t!==undefined)n.set(t);return n}inGradient(e,t){const i=this.addInPort(new S(this,e,S.TYPE_VALUE,{display:"gradient"}));if(t!==undefined)i.set(t);return i}getPortVisibleIndex(t){let i=this.portsIn;if(t.direction==h.PORT_DIR_OUT)i=this.portsOut;let n=0;for(let e=0;e<i.length;e++){if(i[e].uiAttribs.hidePort)continue;n++;if(i[e]==t)return n}}inArray(e,t=undefined,i=undefined){let n=i;if(!i&&CABLES.isNumeric(t))n=t;const r=this.addInPort(new S(this,e,S.TYPE_ARRAY,{stride:n}));if(t!==undefined&&(Array.isArray(t)||t==null))r.set(t);return r}inValueSlider(e,t,i,n){return this.inFloatSlider(e,t,i,n)}inFloatSlider(e,t,i,n){const r={display:"range"};if(i!=undefined&&n!=undefined){r.min=i;r.max=n}const s=this.addInPort(new S(this,e,S.TYPE_VALUE,r));if(t!==undefined){s.set(t);s.defaultValue=t}return s}outFunction(e,t){return this.outTrigger(e,t)}outTrigger(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}outValue(e,t){return this.outNumber(e,t)}outNumber(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_VALUE));if(t!==undefined)i.set(t);return i}outValueBool(e,t){return this.outBool(e,t)}outBool(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_VALUE,{display:"bool"}));if(t!==undefined)i.set(t);else i.set(0);return i}outBoolNum(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_VALUE,{display:"boolnum"}));i.set=function(e){this.setValue(e?1:0)}.bind(i);if(t!==undefined)i.set(t);else i.set(0);return i}outValueString(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_VALUE,{type:"string"}));if(t!==undefined)i.set(t);return i}outString(e,t){const i=this.addOutPort(new S(this,e,S.TYPE_STRING,{type:"string"}));if(t!==undefined)i.set(t);else i.set("");return i}outObject(e,t,i){const n=this.addOutPort(new S(this,e,S.TYPE_OBJECT,{objType:i||null}));n.set(t||null);n.ignoreValueSerialize=true;return n}outArray(e,t,i){if(!i&&CABLES.isNumeric(t))i=t;const n=this.addOutPort(new S(this,e,S.TYPE_ARRAY,{stride:i}));if(t!==undefined&&(Array.isArray(t)||t==null))n.set(t);n.ignoreValueSerialize=true;return n}outTexture(e,t){console.log("outtexture not overwritte.,..");return null}inDynamic(e,t,i,n){const r=new S(this,e,S.TYPE_DYNAMIC,i);r.shouldLink=()=>{if(t&&Array.isArray(t))return false;return true};this.addInPort(r);if(n!==undefined){r.set(n);r.defaultValue=n}return r}removeLinks(){for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].removeLinks();for(let e=0;e<this.portsOut.length;e++)this.portsOut[e].removeLinks()}getSerialized(){const t={};if(this.opId)t.opId=this.opId;if(this.patch.storeObjNames)t.objName=this.objName;t.id=this.id;t.uiAttribs=JSON.parse(JSON.stringify(this.uiAttribs))||{};if(this.storage&&Object.keys(this.storage).length>0)t.storage=JSON.parse(JSON.stringify(this.storage));if(this.uiAttribs.hasOwnProperty("working")&&this.uiAttribs.working==true)delete this.uiAttribs.working;if(t.uiAttribs.hasOwnProperty("uierrors"))delete t.uiAttribs.uierrors;if(t.uiAttribs.hasOwnProperty("highlighted"))delete t.uiAttribs.highlighted;if(t.uiAttribs.hasOwnProperty("highlightedMore"))delete t.uiAttribs.highlightedMore;if(t.uiAttribs.hasOwnProperty("heatmapIntensity"))delete t.uiAttribs.heatmapIntensity;if(t.uiAttribs.title==="")delete t.uiAttribs.title;if(t.uiAttribs.color===null)delete t.uiAttribs.color;if(t.uiAttribs.comment===null)delete t.uiAttribs.comment;if(t.uiAttribs.title==this.#shortOpName||(this.uiAttribs.title||"").toLowerCase()==this.#shortOpName.toLowerCase())delete t.uiAttribs.title;t.portsIn=[];t.portsOut=[];for(let e=0;e<this.portsIn.length;e++){const i=this.portsIn[e].getSerialized();if(i)t.portsIn.push(i)}for(let e=0;e<this.portsOut.length;e++){const i=this.portsOut[e].getSerialized();if(i)t.portsOut.push(i)}if(t.portsIn.length==0)delete t.portsIn;if(t.portsOut.length==0)delete t.portsOut;c(t);return t}getFirstOutPortByType(t){for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].type==t)return this.portsOut[e]}getFirstInPortByType(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].type==t)return this.portsIn[e]}getPort(e,t=false){return this.getPortByName(e,t)}getPortByName(t,e=false){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t||this.portsIn[e].id.toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t||this.portsOut[e].id.toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t||this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t||this.portsOut[e].id==t)return this.portsOut[e]}}getPortById(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]}updateAnims(){if(this.hasAnimPort)for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].updateAnim()}log(){this._log.log(...arguments)}error(){this._log.error(...arguments)}logError(){this._log.error(...arguments)}warn(){this._log.warn(...arguments)}logWarn(){this._log.warn(...arguments)}verbose(){this._log.verbose(...arguments)}logVerbose(){this._log.verbose(...arguments)}profile(){for(let e=0;e<this.portsIn.length;e++){this.portsIn[e]._onTriggered=this.portsIn[e]._onTriggeredProfiling;this.portsIn[e].set=this.portsIn[e]._onSetProfiling}}cleanUp(){if(this._instances){for(let e=0;e<this._instances.length;e++)if(this._instances[e].onDelete)this._instances[e].onDelete();this._instances.length=0}for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].setAnimated(false);if(this.onAnimFrame)this.patch.removeOnAnimFrame(this)}instanced(e){return false}initInstancable(){}hasUiError(e){return this.uiErrors.hasOwnProperty(e)&&this.uiErrors[e]}setUiError(e,t,i=2,n={}){}setEnabled(e){this.enabled=e;this.emitEvent("onEnabledChange",e)}setPortGroup(t,i){for(let e=0;e<i.length;e++){if(i[e])if(i[e].setUiAttribs)i[e].setUiAttribs({group:t});else this._log.error("setPortGroup: invalid port!")}}setUiAxisPorts(e,t,i){if(e)e.setUiAttribs({axis:"X"});if(t)t.setUiAttribs({axis:"Y"});if(i)i.setUiAttribs({axis:"Z"})}removePort(t){for(let e=0;e<this.portsIn.length;e++){if(this.portsIn[e]==t){this.portsIn.splice(e,1);this.emitEvent(P.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}for(let e=0;e<this.portsOut.length;e++){if(this.portsOut[e]==t){this.portsOut.splice(e,1);this.emitEvent(P.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}}toWorkNeedsParent(e){this.linkTimeRules.needsParentOp=e}toWorkShouldNotBeChild(e,t){if(!this.patch.isEditorMode())return;this.linkTimeRules.forbiddenParent=e;if(t!=undefined)this.linkTimeRules.forbiddenParentType=t}toWorkPortsNeedsString(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsStringToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsStringToWork.push(arguments[e])}toWorkPortsNeedToBeLinked(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsLinkedToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsLinkedToWork.push(arguments[e])}toWorkPortsNeedToBeLinkedReset(){if(!this.patch.isEditorMode())return;this.linkTimeRules.needsLinkedToWork.length=0;if(this.checkLinkTimeWarnings)this.checkLinkTimeWarnings()}initVarPorts(){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getVariableName())this.portsIn[e].setVariable(this.portsIn[e].getVariableName())}checkLinkTimeWarnings(){}_checkLinksNeededToWork(){}refreshParams(){if(this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp())N.getGui().opParams.show(this)}isCurrentUiOp(){if(this.patch.isEditorMode())return N.getGui().patchView.isCurrentOp(this)}checkGraphicsApi(e=1){if(this.patch.isEditorMode())if(this.patch.cg&&this.patch.cg.gApi!=e)this.setUiError("wronggapi","Wrong graphics API",2)}}const F={};F.addPatch=function(e,t){let i=e;let n=o();if(typeof e=="string"){n=e;i=document.getElementById(n);if(!i){console.error(n+" Polyshape Container Element not found!");return}}const r=document.createElement("canvas");r.id="glcanvas_"+n;r.width=i.clientWidth;r.height=i.clientHeight;window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth);this.height=i.clientHeight}.bind(r));i.appendChild(r);t=t||{};t.glCanvasId=r.id;if(!t.onError){t.onError=function(e){console.error(e)}}CABLES.patch=new N(t);return r};const he=function(){let t=null;const i=[];this.onChanged=function(e){i.push(e)};this.getValue=function(){return t};this.setValue=function(e){t=e;this.emitChanged()};this.emitChanged=function(){for(let e=0;e<i.length;e++){i[e]()}}};class ue extends t{paused=false;frameNum=0;frameStartTime=0;exec(e){}pause(){}resume(){}}CABLES=CABLES||{};CABLES={...CABLES,...h.PORT,...h.PACO,...h.ANIM,...h.OP};CABLES.EMBED=F;CABLES.Link=I;CABLES.Port=S;CABLES.Op=P;CABLES.Profiler=y;CABLES.Patch=N;CABLES.Timer=O;CABLES.Variable=he;CABLES.LoadingStatus=M;CABLES.now=R;CABLES.internalNow=C;CABLES.Anim=u;CABLES.AnimKey=l;CABLES.RenderLoop=ue;CABLES.shortId=b;CABLES.uuid=a;CABLES.getShortOpName=i;CABLES.simpleId=d;CABLES.clamp=_;CABLES.map=v;CABLES.shuffleArray=n;CABLES.generateUUID=o;CABLES.prefixedHash=m;CABLES.smoothStep=g;CABLES.smootherStep=p;CABLES.cacheBust=E;CABLES.copyArray=T;CABLES.basename=Y;CABLES.logStack=q;CABLES.filename=K;CABLES.ajax=A;CABLES.logErrorConsole=Q;CABLES.isNumeric=x;CABLES.uniqueArray=J;CABLES.OPS=[];CABLES.utils=e;CABLES.CONSTANTS=h;CABLES.SHARED={};CABLES.SHARED.Events=t;CABLES.SHARED.Logger=r;const ce=CABLES;if(!function(){return!this}())console.warn("not in strict mode: index core")})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in de)e[t]=de[t];if(de.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();var CABLES=CABLES||{};CABLES.build={timestamp:1765905240353,created:"2025-12-16T17:14:00.353Z",git:{branch:"master",commit:"9fcc94f55ff19aae41cda73b4d136cebd8cd57f4",date:"1765801614",message:"gradients"}};if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["Z14eIm"]={_id:"66ce988c5e6f885e13482393",ops:[{id:"d7839aa5-7713-43e7-992f-401aab81c285",uiAttribs:{},portsIn:[{name:"FPS Limit",value:0},{name:"Reduce FPS not focussed",value:1},{name:"Reduce FPS loading",value:0},{name:"Clear",value:1},{name:"ClearAlpha",value:1},{name:"Fullscreen Button",value:0},{name:"Active",value:1},{name:"Hires Displays",value:0},{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"ecafc36c-437e-431e-ba0c-9975b96a09cb",objOut:"d7839aa5-7713-43e7-992f-401aab81c285"}]},{name:"width",value:640},{name:"height",value:360}],objName:"Ops.Gl.MainLoop"},{id:"557e884f-ebad-4263-9caf-1fc0afe114ec",uiAttribs:{},portsIn:[{name:"Opacity",value:.762},{name:"Default Minimized",value:0},{name:"Minimized Opacity",value:.182},{name:"Show undo button",value:1},{name:"Show Minimize",value:0},{name:"Title",value:"Sim Settings"},{name:"Side",value:0},{name:"Default CSS",value:1}],portsOut:[{name:"childs",title:"Children",links:[{portIn:"link",portOut:"childs",objIn:"a0e2e7e7-b541-4a35-9c36-7da3d7614955",objOut:"557e884f-ebad-4263-9caf-1fc0afe114ec"}]},{name:"Opfened",value:false,title:"Opened"}],objName:"Ops.Sidebar.Sidebar"},{id:"4ec10bc9-e714-4ae8-b40c-16470ed74af1",uiAttribs:{},portsIn:[{name:"Text",value:"Color Width"},{name:"Input",value:640},{name:"Default",value:1920}],portsOut:[{name:"Children",links:[{portIn:"Link",portOut:"Children",objIn:"38013909-23ed-436f-b53f-587a38299510",objOut:"4ec10bc9-e714-4ae8-b40c-16470ed74af1"}]},{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f",objOut:"4ec10bc9-e714-4ae8-b40c-16470ed74af1"},{portIn:"Value",portOut:"Result",objIn:"09d1bfec-fb13-4a88-b863-0ae0cbe3eef1",objOut:"4ec10bc9-e714-4ae8-b40c-16470ed74af1"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"71f6678d-8aab-4757-92bc-7e4f9b2d63cf",uiAttribs:{},portsIn:[{name:"Text",value:"Sim Width"},{name:"Input",value:128},{name:"Default",value:128}],portsOut:[{name:"Children",links:[{portIn:"link",portOut:"Children",objIn:"9cf4e12c-43f2-4d77-9949-e13e283522dc",objOut:"71f6678d-8aab-4757-92bc-7e4f9b2d63cf"}]},{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"f91cb011-a3fe-4f3a-8cea-09fed96f139e",objOut:"71f6678d-8aab-4757-92bc-7e4f9b2d63cf"},{portIn:"Value",portOut:"Result",objIn:"406e872d-ae7d-400b-8873-f9f2b2600d86",objOut:"71f6678d-8aab-4757-92bc-7e4f9b2d63cf"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"9cf4e12c-43f2-4d77-9949-e13e283522dc",uiAttribs:{},portsIn:[{name:"Text",value:"Sim Height"}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"34051f3e-ff10-4e4b-a6cd-8c72055db044",objOut:"9cf4e12c-43f2-4d77-9949-e13e283522dc"}]}],objName:"Ops.Sidebar.DisplayValue_v2"},{id:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"f91cb011-a3fe-4f3a-8cea-09fed96f139e",objOut:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f"},{portIn:"Number",portOut:"result",objIn:"adf7d757-2ae4-424e-b8f3-322e3ed4daa4",objOut:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f"},{portIn:"Value",portOut:"result",objIn:"c33d1e5d-e91d-4025-8937-5d3e0871f536",objOut:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f"}]}],objName:"Ops.Math.Divide"},{id:"f91cb011-a3fe-4f3a-8cea-09fed96f139e",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"8eeba0f0-47f6-459b-9435-b370a18a976b",objOut:"f91cb011-a3fe-4f3a-8cea-09fed96f139e"},{portIn:"Value",portOut:"result",objIn:"8926bd43-ccaf-4b27-86a3-66be0602d595",objOut:"f91cb011-a3fe-4f3a-8cea-09fed96f139e"}]}],objName:"Ops.Math.Divide"},{id:"8eeba0f0-47f6-459b-9435-b370a18a976b",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"9cf4e12c-43f2-4d77-9949-e13e283522dc",objOut:"8eeba0f0-47f6-459b-9435-b370a18a976b"}]}],objName:"Ops.String.NumberToString_v2"},{id:"38013909-23ed-436f-b53f-587a38299510",uiAttribs:{},portsIn:[{name:"Text",value:"Color Heigth"},{name:"Input",value:360},{name:"Default",value:1080}],portsOut:[{name:"Children",links:[{portIn:"Link",portOut:"Children",objIn:"71f6678d-8aab-4757-92bc-7e4f9b2d63cf",objOut:"38013909-23ed-436f-b53f-587a38299510"}]},{name:"Result",links:[{portIn:"number2",portOut:"Result",objIn:"ab9849e5-663f-499c-9a7d-3fac1ae8b69f",objOut:"38013909-23ed-436f-b53f-587a38299510"},{portIn:"Value",portOut:"Result",objIn:"0d72798e-2ab7-4c10-9c54-b9fe711a45c0",objOut:"38013909-23ed-436f-b53f-587a38299510"}]}],objName:"Ops.Sidebar.NumberInput_v2"},{id:"34051f3e-ff10-4e4b-a6cd-8c72055db044",uiAttribs:{},portsIn:[{name:"Text",value:"Aspect Ratio"}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"b39bcb66-8af9-4609-b788-9373ae477cd4",objOut:"34051f3e-ff10-4e4b-a6cd-8c72055db044"}]}],objName:"Ops.Sidebar.DisplayValue_v2"},{id:"adf7d757-2ae4-424e-b8f3-322e3ed4daa4",uiAttribs:{},portsIn:[{name:"Decimal Places",value:4}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"34051f3e-ff10-4e4b-a6cd-8c72055db044",objOut:"adf7d757-2ae4-424e-b8f3-322e3ed4daa4"}]}],objName:"Ops.String.NumberToString_v2"},{id:"09d1bfec-fb13-4a88-b863-0ae0cbe3eef1",uiAttribs:{},portsIn:[{name:"Variable",value:"ColorWidth"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"0d72798e-2ab7-4c10-9c54-b9fe711a45c0",objOut:"09d1bfec-fb13-4a88-b863-0ae0cbe3eef1"}]}],objName:"Ops.Vars.VarTriggerNumber"},{id:"0d72798e-2ab7-4c10-9c54-b9fe711a45c0",uiAttribs:{},portsIn:[{name:"Variable",value:"ColorHeight"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"406e872d-ae7d-400b-8873-f9f2b2600d86",objOut:"0d72798e-2ab7-4c10-9c54-b9fe711a45c0"}]}],objName:"Ops.Vars.VarTriggerNumber"},{id:"406e872d-ae7d-400b-8873-f9f2b2600d86",uiAttribs:{},portsIn:[{name:"Variable",value:"SimWidth"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"8926bd43-ccaf-4b27-86a3-66be0602d595",objOut:"406e872d-ae7d-400b-8873-f9f2b2600d86"}]}],objName:"Ops.Vars.VarTriggerNumber"},{id:"8926bd43-ccaf-4b27-86a3-66be0602d595",uiAttribs:{},portsIn:[{name:"Variable",value:"SimHeight"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"c33d1e5d-e91d-4025-8937-5d3e0871f536",objOut:"8926bd43-ccaf-4b27-86a3-66be0602d595"}]}],objName:"Ops.Vars.VarTriggerNumber"},{id:"b39bcb66-8af9-4609-b788-9373ae477cd4",uiAttribs:{},portsIn:[{name:"Text",value:"Update Simulation"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Pressed Trigger",links:[{portIn:"Trigger",portOut:"Pressed Trigger",objIn:"09d1bfec-fb13-4a88-b863-0ae0cbe3eef1",objOut:"b39bcb66-8af9-4609-b788-9373ae477cd4"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"d1f9527d-d5ff-4711-84c2-e18b8e1d9a13",uiAttribs:{},portsIn:[{name:"Text",value:"Sizes"},{name:"Show Title",value:1},{name:"Default Minimized",value:0},{name:"Visible",value:1}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"2c349170-e60a-4778-98b5-e6f376d387f3",objOut:"d1f9527d-d5ff-4711-84c2-e18b8e1d9a13"}]},{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"4ec10bc9-e714-4ae8-b40c-16470ed74af1",objOut:"d1f9527d-d5ff-4711-84c2-e18b8e1d9a13"}]}],objName:"Ops.Sidebar.Group"},{id:"3f3524d0-5a0f-4b3d-b04e-61ece175b991",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Force index",value:0},{name:"Force",value:"Resolution"},{name:"Center In Parent",value:0},{name:"Scale to fit Parent",value:0},{name:"Set Width",value:640},{name:"Set Height",value:360,useVariable:"ColorHeight"},{name:"Aspect Ratio index",value:3},{name:"Aspect Ratio",value:"16:9"},{name:"Ratio",value:0},{name:"Fill Parent index",value:0},{name:"Fill Parent",value:"Auto"}],portsOut:[{name:"Next",links:[{portIn:"exe",portOut:"Next",objIn:"c38515e6-dd6c-4ccb-9895-34f344b029da",objOut:"3f3524d0-5a0f-4b3d-b04e-61ece175b991"}]},{name:"Width",value:640},{name:"Height",value:360},{name:"Margin Left",value:0},{name:"Margin Top",value:0}],objName:"Ops.Gl.ForceCanvasSize"},{id:"c38515e6-dd6c-4ccb-9895-34f344b029da",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",objOut:"c38515e6-dd6c-4ccb-9895-34f344b029da"}]},{name:"trigger 1",links:[{portIn:"render",portOut:"trigger 1",objIn:"1eeaed12-85e7-46f3-afc2-b3d212db53ea",objOut:"c38515e6-dd6c-4ccb-9895-34f344b029da"}]},{name:"trigger 2",links:[{portIn:"Render",portOut:"trigger 2",objIn:"ce03dbd9-67ca-48e0-984a-f4873adf63b9",objOut:"c38515e6-dd6c-4ccb-9895-34f344b029da"}]},{name:"trigger 15",links:[{portIn:"render",portOut:"trigger 15",objIn:"9ddd0c53-16d8-46ab-a1e0-7f31deaa6c38",objOut:"c38515e6-dd6c-4ccb-9895-34f344b029da"}]}],objName:"Ops.Trigger.Sequence"},{id:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\nuniform vec2 uPoint;\nuniform vec3 uColor;\nuniform float uRadius;\nuniform float uAspectRatio;\n\nuniform sampler2D ColorInputTex;\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    vec2 p = vUV.xy - uPoint;\n    p.x *= uAspectRatio;\n    \n    vec3 splat = exp(-dot(p,p) / uRadius) * uColor;\n    vec3 base = texture(ColorInputTex, vUV.st).rgb;\n    \n    vec4 col= vec4(base + splat, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:640,useVariable:"ColorWidth"},{name:"uRes Y",value:360,useVariable:"ColorHeight"},{name:"uPoint X",value:1,useVariable:"MousePosX"},{name:"uPoint Y",value:0,useVariable:"MousePosY"},{name:"uRadius",value:.001,useVariable:"SplatRadius"},{name:"uAspectRatio",value:1.7777777777777777,useVariable:"AspectRatio"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817",objOut:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817",objOut:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"c33d1e5d-e91d-4025-8937-5d3e0871f536",uiAttribs:{},portsIn:[{name:"Variable",value:"AspectRatio"}],objName:"Ops.Vars.VarTriggerNumber"},{id:"2c349170-e60a-4778-98b5-e6f376d387f3",uiAttribs:{},portsIn:[{name:"Text",value:"Splat Settings"},{name:"Show Title",value:1},{name:"Default Minimized",value:0},{name:"Visible",value:1}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"57baeaa8-0d46-4ff4-b445-3b35635d74b7",objOut:"2c349170-e60a-4778-98b5-e6f376d387f3"}]},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"b7183062-3cec-4152-b014-31453eea41d0",objOut:"2c349170-e60a-4778-98b5-e6f376d387f3"}]}],objName:"Ops.Sidebar.Group"},{id:"2016ba59-a0c1-4bc1-9924-8a6be8c455f9",uiAttribs:{},portsIn:[{name:"Text",value:"Hex Color"},{name:"Input Red",value:0},{name:"Input Green",value:.1843137254901961},{name:"Input Blue",value:1},{name:"Input Opacity",value:1},{name:"Default",value:"#005fff"},{name:"Show Opacity",value:0}],portsOut:[{name:"Red",links:[{portIn:"X",portOut:"Red",objIn:"21442eee-f786-46d1-bc4e-b9f62cc5823a",objOut:"2016ba59-a0c1-4bc1-9924-8a6be8c455f9"}]},{name:"Green",links:[{portIn:"Y",portOut:"Green",objIn:"21442eee-f786-46d1-bc4e-b9f62cc5823a",objOut:"2016ba59-a0c1-4bc1-9924-8a6be8c455f9"}]},{name:"Blue",links:[{portIn:"Z",portOut:"Blue",objIn:"21442eee-f786-46d1-bc4e-b9f62cc5823a",objOut:"2016ba59-a0c1-4bc1-9924-8a6be8c455f9"}]},{name:"Opacity",value:1},{name:"Hex",value:"#002fff"}],objName:"Ops.Sidebar.ColorPicker_v3"},{id:"7b4084a2-ba51-4262-80cc-2d838bb35054",uiAttribs:{},portsIn:[{name:"Text",value:"Radius"},{name:"Min",value:0},{name:"Max",value:.01},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:.001},{name:"Default",value:.001}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"2f4b9f00-6327-479e-a4be-c22f894eda97",objOut:"7b4084a2-ba51-4262-80cc-2d838bb35054"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"a37694c0-79fc-4d2c-91c7-440335408db4",objOut:"7b4084a2-ba51-4262-80cc-2d838bb35054"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"a37694c0-79fc-4d2c-91c7-440335408db4",uiAttribs:{},portsIn:[{name:"Variable",value:"SplatRadius"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"2f6b8643-ce61-45ba-8741-6c755b4b05aa",uiAttribs:{},portsIn:[{name:"Variable",value:"MousePosY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"807e5e76-b4b9-40dc-b30d-d15442fbc545",uiAttribs:{},portsIn:[{name:"Variable",value:"MousePosX"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"ddef724b-0ab6-48c2-bb30-d7918cc01290",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"MouseDragX"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"7985b544-f586-4b6a-8d1c-fe305aebd871",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"MouseDragY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"b7a68a24-b9ec-43a4-bd86-bc16b07ffa7a",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"b5f85bc4-27aa-48b0-aaaa-83e27426ac3b",objOut:"b7a68a24-b9ec-43a4-bd86-bc16b07ffa7a"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"7f0db51a-755a-45a2-813e-4a0ac4ce531c",uiAttribs:{},portsIn:[{name:"Variable",value:"SplatColor"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"fcccb455-bf82-4bfc-9772-e4de243a637c",uiAttribs:{},portsIn:[{name:"Variable",value:"SplatColor"}],portsOut:[{name:"Value",links:[{portIn:"In",portOut:"Value",objIn:"ccfba2f3-fbaf-42d7-aafc-06972e5e5c99",objOut:"fcccb455-bf82-4bfc-9772-e4de243a637c"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"d67b2777-39d4-456e-ada2-2131bc6ae24a",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"uColor X",portOut:"X",objIn:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",objOut:"d67b2777-39d4-456e-ada2-2131bc6ae24a"}]},{name:"Y",links:[{portIn:"uColor Y",portOut:"Y",objIn:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",objOut:"d67b2777-39d4-456e-ada2-2131bc6ae24a"}]},{name:"Z",links:[{portIn:"uColor Z",portOut:"Z",objIn:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",objOut:"d67b2777-39d4-456e-ada2-2131bc6ae24a"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:640,useVariable:"ColorWidth"},{name:"Height",value:360,useVariable:"ColorHeight"},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197",objOut:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"2c0837e7-390f-4397-b22c-694a1ce6fef9",objOut:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817"},{portIn:"Texture",portOut:"Texture",objIn:"9ddd0c53-16d8-46ab-a1e0-7f31deaa6c38",objOut:"0410a8ae-7a76-4ff4-a1b3-9dd43dc13817"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"10ea7052-2986-42d5-8368-60912076925e",uiAttribs:{},portsIn:[{name:"new min",value:1},{name:"new max",value:0},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"2f6b8643-ce61-45ba-8741-6c755b4b05aa",objOut:"10ea7052-2986-42d5-8368-60912076925e"}]}],objName:"Ops.Math.MapRange"},{id:"02c44273-c6c4-4077-b4d6-988fe45d8ef2",uiAttribs:{},portsIn:[{name:"new min",value:0},{name:"new max",value:1},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"807e5e76-b4b9-40dc-b30d-d15442fbc545",objOut:"02c44273-c6c4-4077-b4d6-988fe45d8ef2"}]}],objName:"Ops.Math.MapRange"},{id:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\nuniform vec2 uPoint;\nuniform vec3 uColor;\nuniform float uRadius;\nuniform float uAspectRatio;\n\nuniform sampler2D inTex;\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    vec2 p = vUV.xy - uPoint;\n    p.x *= uAspectRatio;\n    \n    vec3 splat = exp(-dot(p,p) / uRadius) * uColor;\n    vec3 base = texture(inTex, vUV.st).rgb;\n    \n    vec4 col= vec4(base + splat, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"},{name:"uPoint X",value:1,useVariable:"MousePosX"},{name:"uPoint Y",value:0,useVariable:"MousePosY"},{name:"uColor X",useVariable:"MouseDragX"},{name:"uColor Y",useVariable:"MouseDragY"},{name:"uColor Z",value:0},{name:"uRadius",value:.001,useVariable:"SplatRadius"},{name:"uAspectRatio",value:1.7777777777777777,useVariable:"AspectRatio"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"7763c8f1-d37e-4712-af63-3717a5eaf871",objOut:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"7763c8f1-d37e-4712-af63-3717a5eaf871",objOut:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"7763c8f1-d37e-4712-af63-3717a5eaf871",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"c8978c43-859a-4b1c-a2be-2f084a6d85e5",objOut:"7763c8f1-d37e-4712-af63-3717a5eaf871"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"59fd7d7b-ef8a-4830-854f-50c41278afe4",objOut:"7763c8f1-d37e-4712-af63-3717a5eaf871"},{portIn:"VelocityInputTex",portOut:"Texture",objIn:"c8978c43-859a-4b1c-a2be-2f084a6d85e5",objOut:"7763c8f1-d37e-4712-af63-3717a5eaf871"},{portIn:"VelocityInputTex",portOut:"Texture",objIn:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a",objOut:"7763c8f1-d37e-4712-af63-3717a5eaf871"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"2f4b9f00-6327-479e-a4be-c22f894eda97",uiAttribs:{},portsIn:[{name:"Text",value:"Splat Force"},{name:"Min",value:1e-5},{name:"Max",value:2e3},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:1e3},{name:"Default",value:1e3}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"f173ac22-4e81-4c43-b97d-b038a655d427",objOut:"2f4b9f00-6327-479e-a4be-c22f894eda97"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"f173ac22-4e81-4c43-b97d-b038a655d427",uiAttribs:{},portsIn:[{name:"Variable",value:"MouseSplatForce"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"59fd7d7b-ef8a-4830-854f-50c41278afe4",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Texture Out",links:[{portIn:"Value",portOut:"Texture Out",objIn:"393b09ab-55cd-412a-ba1a-c2c257cbf7ee",objOut:"59fd7d7b-ef8a-4830-854f-50c41278afe4"}]},{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"c8978c43-859a-4b1c-a2be-2f084a6d85e5",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\nuniform sampler2D VelocityInputTex;\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    ivec2 viUV = ivec2(gl_FragCoord.xy);\n    \n    ivec2 pL = ivec2(viUV.x - 1, viUV.y);\n    ivec2 pR = ivec2(viUV.x + 1, viUV.y);\n    ivec2 pT = ivec2(viUV.x, viUV.y + 1);\n    ivec2 pB = ivec2(viUV.x, viUV.y - 1);\n    \n    float L = texelFetch(VelocityInputTex, pL, 0).x;\n    float R = texelFetch(VelocityInputTex, pR, 0).x;\n    float T = texelFetch(VelocityInputTex, pT, 0).x;\n    float B = texelFetch(VelocityInputTex, pB, 0).x;\n    \n    float curl = R - L - T + B;\n    \n    vec4 col= vec4(0.5 * curl, 0.0, 0.0, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"923138d2-d69f-41dc-b604-5e7adcbbf7a0",objOut:"c8978c43-859a-4b1c-a2be-2f084a6d85e5"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"923138d2-d69f-41dc-b604-5e7adcbbf7a0",objOut:"c8978c43-859a-4b1c-a2be-2f084a6d85e5"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"923138d2-d69f-41dc-b604-5e7adcbbf7a0",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a",objOut:"923138d2-d69f-41dc-b604-5e7adcbbf7a0"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"5fc043ea-58f5-4ef6-a2c7-9fcf9fffe72d",objOut:"923138d2-d69f-41dc-b604-5e7adcbbf7a0"},{portIn:"CurlInputTex",portOut:"Texture",objIn:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a",objOut:"923138d2-d69f-41dc-b604-5e7adcbbf7a0"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"5fc043ea-58f5-4ef6-a2c7-9fcf9fffe72d",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\nuniform float uDelta;\nuniform float uVorticity;\n\nuniform sampler2D VelocityInputTex;\nuniform sampler2D CurlInputTex;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    ivec2 viUV = ivec2(gl_FragCoord.xy);\n    \n    ivec2 pL = ivec2(viUV.x - 1, viUV.y);\n    ivec2 pR = ivec2(viUV.x + 1, viUV.y);\n    ivec2 pT = ivec2(viUV.x, viUV.y + 1);\n    ivec2 pB = ivec2(viUV.x, viUV.y - 1);\n\n    float L = texelFetch(CurlInputTex, pL, 0).x;\n    float R = texelFetch(CurlInputTex, pR, 0).x;\n    float T = texelFetch(CurlInputTex, pT, 0).x;\n    float B = texelFetch(CurlInputTex, pB, 0).x;\n    float C = texelFetch(CurlInputTex, ivec2(viUV), 0).x;\n    \n    vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n    force /= length(force) + 0.0001;\n    force *= uVorticity * C;\n    force.y *= -1.0;\n    \n    vec2 vel = texelFetch(VelocityInputTex, ivec2(viUV), 0).xy;\n    \n    vec4 col= vec4(vel + force * uDelta, 0.0, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"},{name:"uDelta",value:.01880000000447035,useVariable:"DeltaTime"},{name:"uVorticity",value:5,useVariable:"FluidVorticity"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"739a93df-1683-4223-b0ea-06a6a8c264ed",objOut:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"739a93df-1683-4223-b0ea-06a6a8c264ed",objOut:"18b48b4b-5c66-4c2c-b3b9-77c1fc711d9a"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"739a93df-1683-4223-b0ea-06a6a8c264ed",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"8a27691b-7d3c-4a80-b5dd-297ff6616a44",objOut:"739a93df-1683-4223-b0ea-06a6a8c264ed"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"f081fa42-1d8f-4bc9-9ffe-182c5abe2b56",objOut:"739a93df-1683-4223-b0ea-06a6a8c264ed"},{portIn:"vorticityInputTex",portOut:"Texture",objIn:"8a27691b-7d3c-4a80-b5dd-297ff6616a44",objOut:"739a93df-1683-4223-b0ea-06a6a8c264ed"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"f081fa42-1d8f-4bc9-9ffe-182c5abe2b56",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"f76222e3-cd66-4a9a-a1c7-425cbb8533d0",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"c182287d-3d2a-4cc5-abee-2a7eb33f0011",objOut:"f76222e3-cd66-4a9a-a1c7-425cbb8533d0"}]},{name:"Was Triggered",value:1}],objName:"Ops.Trigger.TriggerOnce"},{id:"c182287d-3d2a-4cc5-abee-2a7eb33f0011",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"LoadBang"}],objName:"Ops.Trigger.TriggerSend"},{id:"ebf28332-af25-4c6f-a82e-d14d49961b5f",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"LoadBang"}],portsOut:[{name:"Triggered",links:[{portIn:"Trigger",portOut:"Triggered",objIn:"09d1bfec-fb13-4a88-b863-0ae0cbe3eef1",objOut:"ebf28332-af25-4c6f-a82e-d14d49961b5f"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"2330c9b8-12ca-4762-bc0f-4888f9c09393",uiAttribs:{},portsIn:[{name:"Play Timeline",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"59a62449-ce5f-47f8-81ef-39f72e1266a3",objOut:"2330c9b8-12ca-4762-bc0f-4888f9c09393"}]},{name:"Finished Initial Loading",value:1},{name:"Loading",links:[{portIn:"Boolean",portOut:"Loading",objIn:"b7e1b39f-3c15-45ba-b9bf-4a061dda58a9",objOut:"2330c9b8-12ca-4762-bc0f-4888f9c09393"}]},{name:"Progress",value:1},{name:"Trigger Loading Finished ",links:[{portIn:"Exec",portOut:"Trigger Loading Finished ",objIn:"f76222e3-cd66-4a9a-a1c7-425cbb8533d0",objOut:"2330c9b8-12ca-4762-bc0f-4888f9c09393"}]}],objName:"Ops.Cables.LoadingStatus_v2"},{id:"59a62449-ce5f-47f8-81ef-39f72e1266a3",uiAttribs:{},portsOut:[{name:"Trigger out",links:[{portIn:"Trigger",portOut:"Trigger out",objIn:"3f3524d0-5a0f-4b3d-b04e-61ece175b991",objOut:"59a62449-ce5f-47f8-81ef-39f72e1266a3"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"b7e1b39f-3c15-45ba-b9bf-4a061dda58a9",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Pass Through",portOut:"Result",objIn:"59a62449-ce5f-47f8-81ef-39f72e1266a3",objOut:"b7e1b39f-3c15-45ba-b9bf-4a061dda58a9"}]}],objName:"Ops.Boolean.Not"},{id:"fa97dac2-3f95-4a78-a568-4506a98f40cb",uiAttribs:{},portsIn:[{name:"Smooth",value:0},{name:"Seconds",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"2330c9b8-12ca-4762-bc0f-4888f9c09393",objOut:"fa97dac2-3f95-4a78-a568-4506a98f40cb"},{portIn:"exe",portOut:"trigger",objIn:"02c41921-e0d0-47ce-808f-47eccaaccb22",objOut:"fa97dac2-3f95-4a78-a568-4506a98f40cb"}]},{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"66534c8c-ec9e-43cc-aa66-f30fbe994b89",objOut:"fa97dac2-3f95-4a78-a568-4506a98f40cb"}]}],objName:"Ops.Anim.TimeDelta"},{id:"57baeaa8-0d46-4ff4-b445-3b35635d74b7",uiAttribs:{},portsIn:[{name:"Text",value:"Simulation Settings"},{name:"Show Title",value:1},{name:"Default Minimized",value:0},{name:"Visible",value:1}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"92b4883e-046b-4cf4-a83b-221b7ac39db8",objOut:"57baeaa8-0d46-4ff4-b445-3b35635d74b7"}]},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"0e9d1904-5e24-45bd-af9b-a888a5920993",objOut:"57baeaa8-0d46-4ff4-b445-3b35635d74b7"}]}],objName:"Ops.Sidebar.Group"},{id:"0e9d1904-5e24-45bd-af9b-a888a5920993",uiAttribs:{},portsIn:[{name:"Text",value:"Vorticity"},{name:"Min",value:0},{name:"Max",value:20},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:5},{name:"Default",value:5}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"3fbb3142-1107-4f1e-b1f2-c23ea9ff68fb",objOut:"0e9d1904-5e24-45bd-af9b-a888a5920993"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"4df207a6-9dc6-461c-a66e-9d334e5ee9f6",objOut:"0e9d1904-5e24-45bd-af9b-a888a5920993"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"4df207a6-9dc6-461c-a66e-9d334e5ee9f6",uiAttribs:{},portsIn:[{name:"Variable",value:"FluidVorticity"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"8a27691b-7d3c-4a80-b5dd-297ff6616a44",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\n\nuniform sampler2D vorticityInputTex;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    vec2 pL = vec2(vUV.x - 1. / uRes.x, vUV.y);\n    vec2 pR = vec2(vUV.x + 1. / uRes.x, vUV.y);\n    vec2 pT = vec2(vUV.x, vUV.y + 1. / uRes.y);\n    vec2 pB = vec2(vUV.x, vUV.y - 1. / uRes.y);\n\n    float L = texture(vorticityInputTex, pL).x;\n    float R = texture(vorticityInputTex, pR).x;\n    float T = texture(vorticityInputTex, pT).y;\n    float B = texture(vorticityInputTex, pB).y;\n    \n    vec2 C = texture(vorticityInputTex, vUV).xy;\n    \n    if (pL.x < 0.0) { L = -C.x; }\n    if (pR.x > 1.0) { R = -C.x; }\n    if (pT.y > 1.0) { T = -C.y; }\n    if (pB.y < 0.0) { B = -C.y; }\n    \n    float divergence = 0.5 * (R - L + T - B);\n    \n    vec4 col= vec4(divergence, 0.0, 0.0, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"6211ec55-d201-441b-905a-6c0c22409ce8",objOut:"8a27691b-7d3c-4a80-b5dd-297ff6616a44"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"6211ec55-d201-441b-905a-6c0c22409ce8",objOut:"8a27691b-7d3c-4a80-b5dd-297ff6616a44"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"6211ec55-d201-441b-905a-6c0c22409ce8",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"exe",portOut:"Next",objIn:"677fd1ed-4914-433e-9358-8f1341d78178",objOut:"6211ec55-d201-441b-905a-6c0c22409ce8"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"b393957a-6367-4719-9239-743a5184ab33",objOut:"6211ec55-d201-441b-905a-6c0c22409ce8"},{portIn:"DivergenceInputTex",portOut:"Texture",objIn:"f2e7c354-7715-4a07-9373-42f8544fa7ed",objOut:"6211ec55-d201-441b-905a-6c0c22409ce8"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"b393957a-6367-4719-9239-743a5184ab33",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"ce03dbd9-67ca-48e0-984a-f4873adf63b9",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Pixel Format index",value:11},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"fddbc160-a1d2-410f-be22-c7f7753adc2e",objOut:"ce03dbd9-67ca-48e0-984a-f4873adf63b9"},{portIn:"Exec",portOut:"Next",objIn:"b87a79e7-717a-449c-bd0c-b708b8d3942f",objOut:"ce03dbd9-67ca-48e0-984a-f4873adf63b9"}]},{name:"texture_out",links:[{portIn:"divergenceInputTex",portOut:"texture_out",objIn:"1eeaed12-85e7-46f3-afc2-b3d212db53ea",objOut:"ce03dbd9-67ca-48e0-984a-f4873adf63b9"}]},{name:"Aspect Ratio",value:1.7777777777777777},{name:"Texture Width",value:128},{name:"Texture Height",value:72}],objName:"Ops.Gl.ImageCompose.ImageCompose_v3"},{id:"e37fd69f-da58-49e0-9a95-f560b861b2df",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Mask Invert",value:0},{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"A",value:1}],objName:"Ops.Gl.ImageCompose.Color_v2"},{id:"b87a79e7-717a-449c-bd0c-b708b8d3942f",uiAttribs:{},portsOut:[{name:"Was Triggered",links:[{portIn:"Value",portOut:"Was Triggered",objIn:"be65754a-2970-4cf7-af72-4b825da12269",objOut:"b87a79e7-717a-449c-bd0c-b708b8d3942f"}]}],objName:"Ops.Trigger.TriggerOnce"},{id:"be65754a-2970-4cf7-af72-4b825da12269",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"0645a491-1e44-4869-b61b-baa6575e59ae",objOut:"be65754a-2970-4cf7-af72-4b825da12269"}]}],objName:"Ops.Math.OneMinus"},{id:"1eeaed12-85e7-46f3-afc2-b3d212db53ea",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\nuniform float uClear;\n\nuniform sampler2D divergenceInputTex;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n\n    \n    vec4 col = uClear * texture(divergenceInputTex, vUV);\n    \n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"},{name:"uClear",value:.8,useVariable:"FluidPressure"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"3a533689-35cb-4b07-80d1-10b55d0da332",objOut:"1eeaed12-85e7-46f3-afc2-b3d212db53ea"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"3a533689-35cb-4b07-80d1-10b55d0da332",objOut:"1eeaed12-85e7-46f3-afc2-b3d212db53ea"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"3a533689-35cb-4b07-80d1-10b55d0da332",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"d7354166-e902-4c23-aed9-7c43cc079e8f",objOut:"3a533689-35cb-4b07-80d1-10b55d0da332"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"9b740e44-f886-4fa0-8bd9-eafb70203a87",objOut:"3a533689-35cb-4b07-80d1-10b55d0da332"},{portIn:"ClearPressureInputTex",portOut:"Texture",objIn:"f2e7c354-7715-4a07-9373-42f8544fa7ed",objOut:"3a533689-35cb-4b07-80d1-10b55d0da332"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"9b740e44-f886-4fa0-8bd9-eafb70203a87",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"3fbb3142-1107-4f1e-b1f2-c23ea9ff68fb",uiAttribs:{},portsIn:[{name:"Text",value:"Pressure"},{name:"Min",value:0},{name:"Max",value:1},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:.8},{name:"Default",value:.8}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"5a02101b-4cf3-40c6-bee8-4368ce0c8b88",objOut:"3fbb3142-1107-4f1e-b1f2-c23ea9ff68fb"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"7bbc2cee-106c-47cd-9d99-8e0f9e55a2e1",objOut:"3fbb3142-1107-4f1e-b1f2-c23ea9ff68fb"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"7bbc2cee-106c-47cd-9d99-8e0f9e55a2e1",uiAttribs:{},portsIn:[{name:"Variable",value:"FluidPressure"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"f2e7c354-7715-4a07-9373-42f8544fa7ed",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\nuniform sampler2D ClearPressureInputTex;\nuniform sampler2D DivergenceInputTex;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    vec2 pL = vec2(vUV.x - 1.5 / uRes.x, vUV.y);\n    vec2 pR = vec2(vUV.x + 1.5 / uRes.x, vUV.y);\n    vec2 pT = vec2(vUV.x, vUV.y + 1.5 / uRes.y);\n    vec2 pB = vec2(vUV.x, vUV.y - 1.5 / uRes.y);\n\n    float L = texture(ClearPressureInputTex, pL).x;\n    float R = texture(ClearPressureInputTex, pR).x;\n    float T = texture(ClearPressureInputTex, pT).x;\n    float B = texture(ClearPressureInputTex, pB).x;\n    \n    float divergence = texture(DivergenceInputTex, vUV.xy).x;\n    float pressure = (L + R + B + T - divergence) * 0.25;\n    \n    vec4 col= vec4(pressure, 0.0, 0.0, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"43e364ed-94cd-4eef-af49-77a370100e2c",objOut:"f2e7c354-7715-4a07-9373-42f8544fa7ed"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"43e364ed-94cd-4eef-af49-77a370100e2c",objOut:"f2e7c354-7715-4a07-9373-42f8544fa7ed"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"43e364ed-94cd-4eef-af49-77a370100e2c",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Texture",links:[{portIn:"PressureInputTex",portOut:"Texture",objIn:"ba75c154-853e-44e8-901b-f00e300a08a6",objOut:"43e364ed-94cd-4eef-af49-77a370100e2c"},{portIn:"Image",portOut:"Texture",objIn:"fddbc160-a1d2-410f-be22-c7f7753adc2e",objOut:"43e364ed-94cd-4eef-af49-77a370100e2c"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"0645a491-1e44-4869-b61b-baa6575e59ae",uiAttribs:{},portsIn:[{name:"number2",value:0,useVariable:"ResetSim"}],portsOut:[{name:"result",links:[{portIn:"Amount",portOut:"result",objIn:"e37fd69f-da58-49e0-9a95-f560b861b2df",objOut:"0645a491-1e44-4869-b61b-baa6575e59ae"}]}],objName:"Ops.Math.Sum"},{id:"fddbc160-a1d2-410f-be22-c7f7753adc2e",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"e37fd69f-da58-49e0-9a95-f560b861b2df",objOut:"fddbc160-a1d2-410f-be22-c7f7753adc2e"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"ba75c154-853e-44e8-901b-f00e300a08a6",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\n\nuniform sampler2D PressureInputTex;\nuniform sampler2D VorticityInputTex;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    \n    vec2 pL = vec2(vUV.x - 1. / uRes.x, vUV.y);\n    vec2 pR = vec2(vUV.x + 1. / uRes.x, vUV.y);\n    vec2 pT = vec2(vUV.x, vUV.y + 1. / uRes.y);\n    vec2 pB = vec2(vUV.x, vUV.y - 1. / uRes.y);\n\n    float L = texture(PressureInputTex, pL).x;\n    float R = texture(PressureInputTex, pR).x;\n    float T = texture(PressureInputTex, pT).x;\n    float B = texture(PressureInputTex, pB).x;\n    \n    vec2 velocity = texture(VorticityInputTex, vUV).xy;\n    velocity.xy -= vec2(R - L, T - B);\n\n    vec4 col= vec4(velocity, 0.0, 1.0);\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89",objOut:"ba75c154-853e-44e8-901b-f00e300a08a6"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89",objOut:"ba75c154-853e-44e8-901b-f00e300a08a6"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a",objOut:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"4dc71459-d71c-4c0f-ab90-882d334a72c7",objOut:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89"},{portIn:"InputTex1",portOut:"Texture",objIn:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a",objOut:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89"},{portIn:"InputTex2",portOut:"Texture",objIn:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a",objOut:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"4dc71459-d71c-4c0f-ab90-882d334a72c7",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"393b09ab-55cd-412a-ba1a-c2c257cbf7ee",uiAttribs:{},portsIn:[{name:"Variable",value:"vorticityTexture"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"4221b2b8-0e3c-4444-b802-9e06923491a0",uiAttribs:{},portsIn:[{name:"Variable",value:"vorticityTexture"}],portsOut:[{name:"Value",links:[{portIn:"VorticityInputTex",portOut:"Value",objIn:"ba75c154-853e-44e8-901b-f00e300a08a6",objOut:"4221b2b8-0e3c-4444-b802-9e06923491a0"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"5a02101b-4cf3-40c6-bee8-4368ce0c8b88",uiAttribs:{},portsIn:[{name:"Text",value:"Color Diffusion"},{name:"Min",value:0},{name:"Max",value:1},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:.5},{name:"Default",value:.5}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"abea2464-309a-4394-b170-024f4afbcf66",objOut:"5a02101b-4cf3-40c6-bee8-4368ce0c8b88"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"78c938f6-8bdf-4c91-9d76-22352ed3d347",objOut:"5a02101b-4cf3-40c6-bee8-4368ce0c8b88"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"abea2464-309a-4394-b170-024f4afbcf66",uiAttribs:{},portsIn:[{name:"Text",value:"Velocity Diffusion"},{name:"Min",value:1e-5},{name:"Max",value:.2},{name:"Step",value:1e-5},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:.2},{name:"Default",value:.2}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"3e8fa4d1-2fca-4b1a-ad78-d1e68617bcc7",objOut:"abea2464-309a-4394-b170-024f4afbcf66"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"a966d9ac-c671-4af5-b1d0-ba537532d5fd",objOut:"abea2464-309a-4394-b170-024f4afbcf66"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"78c938f6-8bdf-4c91-9d76-22352ed3d347",uiAttribs:{},portsIn:[{name:"Variable",value:"FluidColorDiffusion"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"a966d9ac-c671-4af5-b1d0-ba537532d5fd",uiAttribs:{},portsIn:[{name:"Variable",value:"FluidVelocityDiffusion"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\nuniform vec2 uRes2;\n\nuniform float uDelta;\nuniform float uDiffusion;\n\nuniform sampler2D InputTex1;\nuniform sampler2D InputTex2;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    vec2 vUV2 = gl_FragCoord.xy/vec2(uRes2.x,uRes2.y);\n    vec2 size = vec2(1.) / uRes2;\n    \n    //vec2 coord = vUV.xy - uDelta * texture(InputTex2, vUV.xy).xy * vUV2.xy;//* uRes2.xy; //Really????\n    vec2 coord = vUV.xy - uDelta * texture(InputTex2, vUV).xy * size; //Really????\n    vec4 result = texture(InputTex1, coord);\n    \n    float decay = 1.0 + uDiffusion * uDelta;\n    \n    vec4 col= result / decay;\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:128,useVariable:"SimWidth"},{name:"uRes Y",value:72,useVariable:"SimHeight"},{name:"uRes2 X",value:128,useVariable:"SimWidth"},{name:"uRes2 Y",value:72,useVariable:"SimHeight"},{name:"uDelta",value:.01880000000447035,useVariable:"DeltaTime"},{name:"uDiffusion",value:.2,useVariable:"FluidVelocityDiffusion"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"de91f1ff-edba-42fd-9905-c830eedea1f0",objOut:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"de91f1ff-edba-42fd-9905-c830eedea1f0",objOut:"8921c297-1e48-43d0-b1d6-65a4ad8a2f0a"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"de91f1ff-edba-42fd-9905-c830eedea1f0",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa",objOut:"de91f1ff-edba-42fd-9905-c830eedea1f0"},{portIn:"Render",portOut:"Next",objIn:"addda690-c4ae-43c1-a5b9-d483f7d7e7f3",objOut:"de91f1ff-edba-42fd-9905-c830eedea1f0"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"d8bbe77c-f61f-44b3-89ac-d4c5d855df1c",objOut:"de91f1ff-edba-42fd-9905-c830eedea1f0"},{portIn:"InputTex2",portOut:"Texture",objIn:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa",objOut:"de91f1ff-edba-42fd-9905-c830eedea1f0"},{portIn:"Image",portOut:"Texture",objIn:"864775ce-dcee-45cd-a527-03593344a251",objOut:"de91f1ff-edba-42fd-9905-c830eedea1f0"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"d8bbe77c-f61f-44b3-89ac-d4c5d855df1c",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"a5e5701f-074c-47d7-9a9a-2c1ea9e6c0c7",uiAttribs:{},portsIn:[{name:"Variable",value:"DeltaTime"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nuniform vec2 uRes;\nuniform vec2 uRes2;\n\nuniform float uDelta;\nuniform float uDiffusion;\n\nuniform sampler2D InputTex1;\nuniform sampler2D InputTex2;\n\n\n\n{{MODULES_HEAD}}\nvoid main()\n{\n    vec2 vUV = gl_FragCoord.xy/vec2(uRes.x,uRes.y);\n    vec2 vUV2 = gl_FragCoord.xy/vec2(uRes2.x,uRes2.y);\n    vec2 size = vec2(1.) / uRes2;\n    \n    //vec2 coord = vUV.xy - uDelta * texture(InputTex2, vUV.xy).xy * vUV2.xy;//* uRes2.xy; //Really????\n    vec2 coord = vUV.xy - uDelta * texture(InputTex2, vUV).xy * size; //Really????\n    vec4 result = texture(InputTex1, coord);\n    \n    float decay = 1.0 + uDiffusion * uDelta;\n    \n    vec4 col= result / decay;\n    {{MODULE_COLOR}}\n    outColor = col;\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"uRes X",value:640,useVariable:"ColorWidth"},{name:"uRes Y",value:360,useVariable:"ColorHeight"},{name:"uRes2 X",value:128,useVariable:"SimWidth"},{name:"uRes2 Y",value:72,useVariable:"SimHeight"},{name:"uDelta",value:.01880000000447035,useVariable:"DeltaTime"},{name:"uDiffusion",value:.5,useVariable:"FluidColorDiffusion"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4",objOut:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4",objOut:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4",uiAttribs:{},portsIn:[{name:"Use Viewport Size",value:0},{name:"Width",value:640,useVariable:"ColorWidth"},{name:"Height",value:360,useVariable:"ColorHeight"},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Floating Point",value:1},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"c0b41bc3-9b9e-4864-a66c-f9d81dbfb281",objOut:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4"}]},{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"ae804fce-7509-46b0-8051-8daab6451f09",objOut:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4"},{portIn:"Image",portOut:"Texture",objIn:"6f7140e1-8d73-4c5c-9663-6e84ac20292b",objOut:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4"}]}],objName:"Ops.Gl.Shader.ShaderToTexture"},{id:"e60c9733-0e97-4e5c-83c6-ccf8723a7573",uiAttribs:{},portsIn:[{name:"Variable",value:"colorTex"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"7a3ab22f-1182-4403-98b8-368843ea891b",uiAttribs:{},portsIn:[{name:"Variable",value:"colorTex"}],portsOut:[{name:"Value",links:[{portIn:"InputTex1",portOut:"Value",objIn:"cdc66d74-48f6-4780-85fa-9f19cccaa6aa",objOut:"7a3ab22f-1182-4403-98b8-368843ea891b"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"ae804fce-7509-46b0-8051-8daab6451f09",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"b1017690-3f03-4a70-a121-2b7c51e2e0d9",uiAttribs:{},portsIn:[{name:"Variable",value:"advectVelocityTex"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"6a9348f8-06b7-4efe-b19f-dc5f148352e6",uiAttribs:{},portsIn:[{name:"Variable",value:"advectColorTex"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"2c0837e7-390f-4397-b22c-694a1ce6fef9",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Texture Out",links:[{portIn:"Value",portOut:"Texture Out",objIn:"e60c9733-0e97-4e5c-83c6-ccf8723a7573",objOut:"2c0837e7-390f-4397-b22c-694a1ce6fef9"}]},{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"66534c8c-ec9e-43cc-aa66-f30fbe994b89",uiAttribs:{},portsIn:[{name:"number2",value:1e3}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"a5e5701f-074c-47d7-9a9a-2c1ea9e6c0c7",objOut:"66534c8c-ec9e-43cc-aa66-f30fbe994b89"}]}],objName:"Ops.Math.Divide"},{id:"5626e90a-51c8-4d42-ae89-08b3da56f96d",uiAttribs:{},portsIn:[{name:"Variable",value:"MouseDragX"}],portsOut:[{name:"Value",links:[{portIn:"uColor X",portOut:"Value",objIn:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197",objOut:"5626e90a-51c8-4d42-ae89-08b3da56f96d"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7e34f400-4ece-4dc1-a698-8019116fa5ee",uiAttribs:{},portsIn:[{name:"Variable",value:"MouseDragY"}],portsOut:[{name:"Value",links:[{portIn:"uColor Y",portOut:"Value",objIn:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197",objOut:"7e34f400-4ece-4dc1-a698-8019116fa5ee"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"9ddd0c53-16d8-46ab-a1e0-7f31deaa6c38",uiAttribs:{},portsIn:[{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],objName:"Ops.Gl.Meshes.FullscreenRectangle"},{id:"addda690-c4ae-43c1-a5b9-d483f7d7e7f3",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:128,useVariable:"SimWidth"},{name:"Height",value:72,useVariable:"SimHeight"},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Pixel Format index",value:11},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"864775ce-dcee-45cd-a527-03593344a251",objOut:"addda690-c4ae-43c1-a5b9-d483f7d7e7f3"},{portIn:"Exec",portOut:"Next",objIn:"c31d424a-b2c1-4415-b1ba-b1a4c5dabd33",objOut:"addda690-c4ae-43c1-a5b9-d483f7d7e7f3"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"4e798b03-9def-4f16-aaae-ae81093906d2",objOut:"addda690-c4ae-43c1-a5b9-d483f7d7e7f3"}]},{name:"Aspect Ratio",value:1.7777777777777777},{name:"Texture Width",value:128},{name:"Texture Height",value:72}],objName:"Ops.Gl.ImageCompose.ImageCompose_v3"},{id:"4e798b03-9def-4f16-aaae-ae81093906d2",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Texture Out",links:[{portIn:"Value",portOut:"Texture Out",objIn:"b1017690-3f03-4a70-a121-2b7c51e2e0d9",objOut:"4e798b03-9def-4f16-aaae-ae81093906d2"}]},{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"c7658a2e-b948-4c7c-9a53-1178f091d9a0",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Mask Invert",value:0},{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"A",value:1}],objName:"Ops.Gl.ImageCompose.Color_v2"},{id:"c31d424a-b2c1-4415-b1ba-b1a4c5dabd33",uiAttribs:{},portsOut:[{name:"Was Triggered",links:[{portIn:"Value",portOut:"Was Triggered",objIn:"122b259e-5911-4687-b839-d5a15aa8fb57",objOut:"c31d424a-b2c1-4415-b1ba-b1a4c5dabd33"}]}],objName:"Ops.Trigger.TriggerOnce"},{id:"122b259e-5911-4687-b839-d5a15aa8fb57",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"c5f36786-3a00-4eba-bba6-7e714d7443cf",objOut:"122b259e-5911-4687-b839-d5a15aa8fb57"}]}],objName:"Ops.Math.OneMinus"},{id:"c5f36786-3a00-4eba-bba6-7e714d7443cf",uiAttribs:{},portsIn:[{name:"number2",value:0,useVariable:"ResetSim"}],portsOut:[{name:"result",links:[{portIn:"Amount",portOut:"result",objIn:"c7658a2e-b948-4c7c-9a53-1178f091d9a0",objOut:"c5f36786-3a00-4eba-bba6-7e714d7443cf"}]}],objName:"Ops.Math.Sum"},{id:"864775ce-dcee-45cd-a527-03593344a251",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"c7658a2e-b948-4c7c-9a53-1178f091d9a0",objOut:"864775ce-dcee-45cd-a527-03593344a251"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"cb660a92-4b25-493b-8434-6f11144c6c98",uiAttribs:{},portsIn:[{name:"Variable",value:"advectVelocityTex"}],portsOut:[{name:"Value",links:[{portIn:"inTex",portOut:"Value",objIn:"c1cd1540-5e53-44be-b4ee-4a4aa3c72197",objOut:"cb660a92-4b25-493b-8434-6f11144c6c98"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"6f7140e1-8d73-4c5c-9663-6e84ac20292b",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"6b217302-6148-4bfe-8b9f-cd983b2dfbb6",objOut:"6f7140e1-8d73-4c5c-9663-6e84ac20292b"},{portIn:"Execute",portOut:"trigger",objIn:"4b91400a-5a9d-4691-bd4e-f6fcbde36b4c",objOut:"6f7140e1-8d73-4c5c-9663-6e84ac20292b"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"6ac936bf-f5ab-470b-8097-cfab15a2b19c",uiAttribs:{},portsIn:[{name:"number2",value:0,useVariable:"ResetSim"}],portsOut:[{name:"result",links:[{portIn:"Amount",portOut:"result",objIn:"6b217302-6148-4bfe-8b9f-cd983b2dfbb6",objOut:"6ac936bf-f5ab-470b-8097-cfab15a2b19c"},{portIn:"number1",portOut:"result",objIn:"a4339fb0-e8a6-4a25-b57d-8252c088d011",objOut:"6ac936bf-f5ab-470b-8097-cfab15a2b19c"}]}],objName:"Ops.Math.Sum"},{id:"de273f30-7c6b-4646-8be4-e38a7888b0b5",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"6ac936bf-f5ab-470b-8097-cfab15a2b19c",objOut:"de273f30-7c6b-4646-8be4-e38a7888b0b5"}]}],objName:"Ops.Math.OneMinus"},{id:"0067599b-528f-4d75-a1ff-a9f6e36a83ab",uiAttribs:{},portsOut:[{name:"Was Triggered",links:[{portIn:"Value",portOut:"Was Triggered",objIn:"de273f30-7c6b-4646-8be4-e38a7888b0b5",objOut:"0067599b-528f-4d75-a1ff-a9f6e36a83ab"}]}],objName:"Ops.Trigger.TriggerOnce"},{id:"6b217302-6148-4bfe-8b9f-cd983b2dfbb6",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Mask Invert",value:0},{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"A",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"4e38aa37-70e0-4966-ac36-06e0df8f6286",objOut:"6b217302-6148-4bfe-8b9f-cd983b2dfbb6"}]}],objName:"Ops.Gl.ImageCompose.Color_v2"},{id:"6147303b-e98f-40de-8de6-56110b925aca",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Texture Out",links:[{portIn:"Value",portOut:"Texture Out",objIn:"6a9348f8-06b7-4efe-b19f-dc5f148352e6",objOut:"6147303b-e98f-40de-8de6-56110b925aca"}]},{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"c0b41bc3-9b9e-4864-a66c-f9d81dbfb281",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:640,useVariable:"ColorWidth"},{name:"Height",value:360,useVariable:"ColorHeight"},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Pixel Format index",value:11},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Exec",portOut:"Next",objIn:"0067599b-528f-4d75-a1ff-a9f6e36a83ab",objOut:"c0b41bc3-9b9e-4864-a66c-f9d81dbfb281"},{portIn:"render",portOut:"Next",objIn:"6f7140e1-8d73-4c5c-9663-6e84ac20292b",objOut:"c0b41bc3-9b9e-4864-a66c-f9d81dbfb281"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"6147303b-e98f-40de-8de6-56110b925aca",objOut:"c0b41bc3-9b9e-4864-a66c-f9d81dbfb281"}]},{name:"Aspect Ratio",value:1.7777777777777777},{name:"Texture Width",value:640},{name:"Texture Height",value:360}],objName:"Ops.Gl.ImageCompose.ImageCompose_v3"},{id:"e7c895b8-9be7-455a-9aab-f85dd5f7bcdd",uiAttribs:{},portsIn:[{name:"Variable",value:"advectColorTex"}],portsOut:[{name:"Value",links:[{portIn:"ColorInputTex",portOut:"Value",objIn:"19a0a28f-a5f6-40a8-b126-05a8d8abdd70",objOut:"e7c895b8-9be7-455a-9aab-f85dd5f7bcdd"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"46def06c-43bd-4c61-a8e0-d67aeb397349",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"80eb9b33-910f-4e3d-b00b-268c0fdc76d4",objOut:"46def06c-43bd-4c61-a8e0-d67aeb397349"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"54400998-ad5c-48a4-a688-dba239bfede1",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"de91f1ff-edba-42fd-9905-c830eedea1f0",objOut:"54400998-ad5c-48a4-a688-dba239bfede1"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7b3a918e-4749-4850-8e87-a0138694d907",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"7b7769a6-b6f3-42b5-a96d-343ce7b52d89",objOut:"7b3a918e-4749-4850-8e87-a0138694d907"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8687e401-bc98-43ee-9b57-5ad179b6bdf9",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"43e364ed-94cd-4eef-af49-77a370100e2c",objOut:"8687e401-bc98-43ee-9b57-5ad179b6bdf9"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"5ba80768-ee9c-477b-bc5e-b35febb27ab1",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"3a533689-35cb-4b07-80d1-10b55d0da332",objOut:"5ba80768-ee9c-477b-bc5e-b35febb27ab1"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"caa03661-2a5d-40c3-99fb-c9e108a61a3b",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"6211ec55-d201-441b-905a-6c0c22409ce8",objOut:"caa03661-2a5d-40c3-99fb-c9e108a61a3b"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"f98bb596-e199-487d-aa87-c7c424f15a4b",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"739a93df-1683-4223-b0ea-06a6a8c264ed",objOut:"f98bb596-e199-487d-aa87-c7c424f15a4b"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"26f9cf10-b149-410b-ad61-b7ed394ed30f",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"923138d2-d69f-41dc-b604-5e7adcbbf7a0",objOut:"26f9cf10-b149-410b-ad61-b7ed394ed30f"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"f02d8517-8de4-465e-a6d4-198c8ab01fd3",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"filter index",portOut:"Value",objIn:"7763c8f1-d37e-4712-af63-3717a5eaf871",objOut:"f02d8517-8de4-465e-a6d4-198c8ab01fd3"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ccfba2f3-fbaf-42d7-aafc-06972e5e5c99",uiAttribs:{},portsIn:[{name:"Value",value:0,useVariable:"MouseIsDragged"}],portsOut:[{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"d67b2777-39d4-456e-ada2-2131bc6ae24a",objOut:"ccfba2f3-fbaf-42d7-aafc-06972e5e5c99"}]}],objName:"Ops.Array.ArrayMultiply"},{id:"afebd1d5-e432-4c9e-b1d6-b9b498c846f6",uiAttribs:{},portsIn:[{name:"Saturation",value:1},{name:"Brightness",value:.5}],portsOut:[{name:"R",links:[{portIn:"X",portOut:"R",objIn:"b7a68a24-b9ec-43a4-bd86-bc16b07ffa7a",objOut:"afebd1d5-e432-4c9e-b1d6-b9b498c846f6"}]},{name:"G",links:[{portIn:"Y",portOut:"G",objIn:"b7a68a24-b9ec-43a4-bd86-bc16b07ffa7a",objOut:"afebd1d5-e432-4c9e-b1d6-b9b498c846f6"}]},{name:"B",links:[{portIn:"Z",portOut:"B",objIn:"b7a68a24-b9ec-43a4-bd86-bc16b07ffa7a",objOut:"afebd1d5-e432-4c9e-b1d6-b9b498c846f6"}]}],objName:"Ops.Extension.Deprecated.HSBtoRGB"},{id:"69019fe8-1155-4c5c-905a-470bf18ea975",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"bfa280b9-abd2-4937-9b83-aefab3d2c9c3",objOut:"69019fe8-1155-4c5c-905a-470bf18ea975"}]}],objName:"Ops.Math.Sum"},{id:"84fbf144-9149-4bb9-b67d-6eca9dc5b711",uiAttribs:{},portsIn:[{name:"Speed",value:.5},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"number1",portOut:"Time",objIn:"69019fe8-1155-4c5c-905a-470bf18ea975",objOut:"84fbf144-9149-4bb9-b67d-6eca9dc5b711"}]}],objName:"Ops.Anim.Timer_v2"},{id:"bfa280b9-abd2-4937-9b83-aefab3d2c9c3",uiAttribs:{},portsIn:[{name:"number2",value:1},{name:"pingpong",value:0}],portsOut:[{name:"result",links:[{portIn:"Hue",portOut:"result",objIn:"afebd1d5-e432-4c9e-b1d6-b9b498c846f6",objOut:"bfa280b9-abd2-4937-9b83-aefab3d2c9c3"}]}],objName:"Ops.Math.Modulo"},{id:"21442eee-f786-46d1-bc4e-b9f62cc5823a",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"b5f85bc4-27aa-48b0-aaaa-83e27426ac3b",objOut:"21442eee-f786-46d1-bc4e-b9f62cc5823a"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"b5f85bc4-27aa-48b0-aaaa-83e27426ac3b",uiAttribs:{},portsIn:[{name:"Array 2",value:0},{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0},{name:"Array 8",value:0},{name:"Array 9",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"7f0db51a-755a-45a2-813e-4a0ac4ce531c",objOut:"b5f85bc4-27aa-48b0-aaaa-83e27426ac3b"}]}],objName:"Ops.Array.SwitchArray"},{id:"b7183062-3cec-4152-b014-31453eea41d0",uiAttribs:{},portsIn:[{name:"Text",value:"Auto Color Change"},{name:"Input",value:1},{name:"Default",value:1},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"e406a902-5ec3-4863-a1ca-d33ea3923b44",objOut:"b7183062-3cec-4152-b014-31453eea41d0"}]},{name:"Value",links:[{portIn:"Boolean",portOut:"Value",objIn:"b4113ea7-36c3-49ec-bca3-16aeef8c9599",objOut:"b7183062-3cec-4152-b014-31453eea41d0"},{portIn:"Play",portOut:"Value",objIn:"84fbf144-9149-4bb9-b67d-6eca9dc5b711",objOut:"b7183062-3cec-4152-b014-31453eea41d0"},{portIn:"bool",portOut:"Value",objIn:"e968a23e-1106-43ce-ab04-02871099e26e",objOut:"b7183062-3cec-4152-b014-31453eea41d0"}]}],objName:"Ops.Sidebar.Toggle_v3"},{id:"b4113ea7-36c3-49ec-bca3-16aeef8c9599",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Visible",portOut:"Result",objIn:"e406a902-5ec3-4863-a1ca-d33ea3923b44",objOut:"b4113ea7-36c3-49ec-bca3-16aeef8c9599"}]}],objName:"Ops.Boolean.Not"},{id:"e406a902-5ec3-4863-a1ca-d33ea3923b44",uiAttribs:{},portsIn:[{name:"Text",value:"Group"},{name:"Show Title",value:0},{name:"Default Minimized",value:0}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"7b4084a2-ba51-4262-80cc-2d838bb35054",objOut:"e406a902-5ec3-4863-a1ca-d33ea3923b44"}]},{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"2016ba59-a0c1-4bc1-9924-8a6be8c455f9",objOut:"e406a902-5ec3-4863-a1ca-d33ea3923b44"}]}],objName:"Ops.Sidebar.Group"},{id:"e968a23e-1106-43ce-ab04-02871099e26e",uiAttribs:{},portsOut:[{name:"number",links:[{portIn:"Index",portOut:"number",objIn:"b5f85bc4-27aa-48b0-aaaa-83e27426ac3b",objOut:"e968a23e-1106-43ce-ab04-02871099e26e"}]}],objName:"Ops.Boolean.BoolToNumber"},{id:"f238bd37-b4bc-4a98-a0cc-315ccd3df6dd",uiAttribs:{},portsIn:[{name:"Variable",value:"FilterModeNearstOrLinear"}],portsOut:[{name:"Value",links:[{portIn:"Filter index",portOut:"Value",objIn:"ce03dbd9-67ca-48e0-984a-f4873adf63b9",objOut:"f238bd37-b4bc-4a98-a0cc-315ccd3df6dd"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"89627477-6a6d-4017-8cee-d95c79160091",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"relative",value:0},{name:"normalize",value:0},{name:"flip y",value:1},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"smooth",value:0},{name:"smoothSpeed",value:20},{name:"multiply",value:1}],portsOut:[{name:"x",value:20},{name:"y",value:129},{name:"button down",links:[{portIn:"Value",portOut:"button down",objIn:"3b8d878a-8a38-431c-a3d5-198e1cc53867",objOut:"89627477-6a6d-4017-8cee-d95c79160091"}]},{name:"mouseOver",value:0},{name:"button",value:0}],objName:"Ops.Devices.Mouse.Mouse_v2"},{id:"c2f5e424-f18f-4ee0-9f8d-42aae8ebb1fd",uiAttribs:{},portsOut:[{name:"Was Triggered",links:[{portIn:"bool",portOut:"Was Triggered",objIn:"02c41921-e0d0-47ce-808f-47eccaaccb22",objOut:"c2f5e424-f18f-4ee0-9f8d-42aae8ebb1fd"}]}],objName:"Ops.Trigger.TriggerOnce"},{id:"3740091e-3462-4dac-9f04-3fdad2772fd2",uiAttribs:{},portsIn:[{name:"method index",value:7},{name:"method",value:"opacity"}],objName:"Ops.Html.CSS.CSSFilter"},{id:"02c41921-e0d0-47ce-808f-47eccaaccb22",uiAttribs:{},portsIn:[{name:"easing index",value:0},{name:"easing",value:"linear"},{name:"duration",value:.5},{name:"Direction index",value:0},{name:"Direction",value:"Both"},{name:"value false",value:100},{name:"value true",value:0}],portsOut:[{name:"value",links:[{portIn:"Value",portOut:"value",objIn:"3740091e-3462-4dac-9f04-3fdad2772fd2",objOut:"02c41921-e0d0-47ce-808f-47eccaaccb22"}]},{name:"finished",value:1}],objName:"Ops.Anim.BoolAnim"},{id:"212d822e-07a7-4d62-8086-a763cf0158ed",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Reset",portOut:"Next",objIn:"c2f5e424-f18f-4ee0-9f8d-42aae8ebb1fd",objOut:"212d822e-07a7-4d62-8086-a763cf0158ed"}]}],objName:"Ops.Boolean.TriggerChangedFalse"},{id:"d22afc6b-e403-416b-9705-1415a2ce44ea",uiAttribs:{},portsIn:[{name:"Duration",value:20}],portsOut:[{name:"Events",links:[{portIn:"Value",portOut:"Events",objIn:"212d822e-07a7-4d62-8086-a763cf0158ed",objOut:"d22afc6b-e403-416b-9705-1415a2ce44ea"}]}],objName:"Ops.Extension.Deprecated.InteractionListener"},{id:"d7354166-e902-4c23-aed9-7c43cc079e8f",uiAttribs:{},portsIn:[{name:"Repeats",value:1,useVariable:"FluidPressurePasses"},{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"f2e7c354-7715-4a07-9373-42f8544fa7ed",objOut:"d7354166-e902-4c23-aed9-7c43cc079e8f"}]},{name:"index",value:0}],objName:"Ops.Trigger.Repeat_v2"},{id:"a0e2e7e7-b541-4a35-9c36-7da3d7614955",uiAttribs:{},portsIn:[{name:"Text",value:'Reset Sim "R" - Key'},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"d1f9527d-d5ff-4711-84c2-e18b8e1d9a13",objOut:"a0e2e7e7-b541-4a35-9c36-7da3d7614955"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"f3a18646-a67c-48dd-848d-90b147d073e8",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"ResetButton"}],objName:"Ops.Trigger.TriggerSend"},{id:"38b9a289-5aa0-408f-8cdf-1c3a7a1a0e65",uiAttribs:{},portsIn:[{name:"key code",value:82},{name:"canvas only",value:0},{name:"Mod Key index",value:0},{name:"Mod Key",value:"none"},{name:"Enabled",value:1},{name:"Prevent Default",value:0}],portsOut:[{name:"Pressed",links:[{portIn:"bool 1",portOut:"Pressed",objIn:"dbf75f11-f9a8-444e-ae5c-0394eb932c4f",objOut:"38b9a289-5aa0-408f-8cdf-1c3a7a1a0e65"}]},{name:"Key",value:"R"}],objName:"Ops.Devices.Keyboard.KeyPressLearn"},{id:"8a926409-af35-4780-9176-0b93f68f7f29",uiAttribs:{},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"next",links:[{portIn:"false",portOut:"next",objIn:"12f37125-af72-4ed5-b7d3-003e24dccb0d",objOut:"8a926409-af35-4780-9176-0b93f68f7f29"}]},{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"d48d0a9c-0280-4b3f-bb13-f7439c4d83ef",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"ResetButton"}],portsOut:[{name:"Triggered",links:[{portIn:"exe",portOut:"Triggered",objIn:"8a926409-af35-4780-9176-0b93f68f7f29",objOut:"d48d0a9c-0280-4b3f-bb13-f7439c4d83ef"},{portIn:"True",portOut:"Triggered",objIn:"12f37125-af72-4ed5-b7d3-003e24dccb0d",objOut:"d48d0a9c-0280-4b3f-bb13-f7439c4d83ef"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"12f37125-af72-4ed5-b7d3-003e24dccb0d",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"bool 2",portOut:"Result",objIn:"dbf75f11-f9a8-444e-ae5c-0394eb932c4f",objOut:"12f37125-af72-4ed5-b7d3-003e24dccb0d"}]}],objName:"Ops.Boolean.BoolByTrigger"},{id:"dbf75f11-f9a8-444e-ae5c-0394eb932c4f",uiAttribs:{},portsIn:[{name:"bool 3",value:0},{name:"bool 4",value:0},{name:"bool 5",value:0},{name:"bool 6",value:0},{name:"bool 7",value:0},{name:"bool 8",value:0},{name:"bool 9",value:0},{name:"bool 10",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"46e18d36-408d-4c97-99f0-f435273ebfad",objOut:"dbf75f11-f9a8-444e-ae5c-0394eb932c4f"}]}],objName:"Ops.Boolean.Or"},{id:"46e18d36-408d-4c97-99f0-f435273ebfad",uiAttribs:{},portsIn:[{name:"Variable",value:"ResetSim"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"273b1cbf-14a2-4f99-91a3-409d4e2aa617",uiAttribs:{},portsIn:[{name:"Value",value:1},{name:"Variable",value:"FilterModeNearstOrLinear"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"3b8d878a-8a38-431c-a3d5-198e1cc53867",uiAttribs:{},portsOut:[{name:"True",links:[{portIn:"Exec",portOut:"True",objIn:"c2f5e424-f18f-4ee0-9f8d-42aae8ebb1fd",objOut:"3b8d878a-8a38-431c-a3d5-198e1cc53867"}]}],objName:"Ops.Boolean.TriggerOnChangeBoolean"},{id:"ecafc36c-437e-431e-ba0c-9975b96a09cb",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Visible",value:0},{name:"Measure GPU",value:1},{name:"Position index",value:1},{name:"Position",value:"bottom"},{name:"Open",value:0},{name:"Smooth Graph",value:1},{name:"Scale",value:4},{name:"Size",value:128}],portsOut:[{name:"childs",links:[{portIn:"exe",portOut:"childs",objIn:"fa97dac2-3f95-4a78-a568-4506a98f40cb",objOut:"ecafc36c-437e-431e-ba0c-9975b96a09cb"}]},{name:"FPS",value:61}],objName:"Ops.Gl.Performance"},{id:"677fd1ed-4914-433e-9358-8f1341d78178",uiAttribs:{},portsOut:[{name:"trigger 1",links:[{portIn:"render",portOut:"trigger 1",objIn:"ba75c154-853e-44e8-901b-f00e300a08a6",objOut:"677fd1ed-4914-433e-9358-8f1341d78178"}]}],objName:"Ops.Trigger.Sequence"},{id:"3e8fa4d1-2fca-4b1a-ad78-d1e68617bcc7",uiAttribs:{},portsIn:[{name:"Text",value:"Pressure Passes"},{name:"Min",value:1},{name:"Max",value:200},{name:"Step",value:1},{name:"Suffix",value:""},{name:"Grey Out",value:0},{name:"Visible",value:1},{name:"Input",value:1},{name:"Default",value:1}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"20d5125e-6ca9-4e83-8e1b-8694589eddc0",objOut:"3e8fa4d1-2fca-4b1a-ad78-d1e68617bcc7"}]}],objName:"Ops.Sidebar.Slider_v3"},{id:"20d5125e-6ca9-4e83-8e1b-8694589eddc0",uiAttribs:{},portsIn:[{name:"Variable",value:"FluidPressurePasses"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"4e38aa37-70e0-4966-ac36-06e0df8f6286",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"a0366864-50f9-434a-aae8-356fb2ee190b",uiAttribs:{},portsIn:[{name:"text",value:"Fast Fluid"},{name:"font",value:"Arial"},{name:"weight",value:"normal"},{name:"Maximize Size",value:0},{name:"fontSize",value:150},{name:"Line Height",value:1},{name:"Vertical Offset",value:0},{name:"Show Debug",value:0},{name:"Limit Lines",value:0},{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"texture width",value:640,useVariable:"ColorWidth"},{name:"texture height",value:360,useVariable:"ColorHeight"},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"align index",value:1},{name:"align",value:"center"},{name:"vertical align index",value:1},{name:"vertical align",value:"center"},{name:"Reuse Texture",value:1},{name:"Draw Mesh",value:1},{name:"Scale Mesh",value:1},{name:"Hard Edges",value:0},{name:"Opacity",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"Next",links:[{portIn:"exec",portOut:"Next",objIn:"2543f91c-5c32-4025-b0d2-3facfbb99474",objOut:"a0366864-50f9-434a-aae8-356fb2ee190b"}]},{name:"Ratio",value:.5625},{name:"texture",links:[{portIn:"texture0",portOut:"texture",objIn:"2543f91c-5c32-4025-b0d2-3facfbb99474",objOut:"a0366864-50f9-434a-aae8-356fb2ee190b"}]},{name:"Aspect",value:1.7777777777777777},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v4"},{id:"d6039d6f-f9c9-44c2-812f-790180cdc95d",uiAttribs:{},portsIn:[{name:"Text",value:"Select File:"},{name:"Id",value:""},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"}],portsOut:[{name:"Texture",links:[{portIn:"Value",portOut:"Texture",objIn:"f681ca37-258e-4806-acf7-16e31c4e151f",objOut:"d6039d6f-f9c9-44c2-812f-790180cdc95d"}]}],objName:"Ops.Extension.Deprecated.LocalTextureFile"},{id:"80c845d0-5f34-48e2-8047-77f2dd0e245c",uiAttribs:{},portsIn:[{name:"Text",value:"Start Texture"},{name:"Show Title",value:1},{name:"Default Minimized",value:0}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"d6039d6f-f9c9-44c2-812f-790180cdc95d",objOut:"80c845d0-5f34-48e2-8047-77f2dd0e245c"}]}],objName:"Ops.Sidebar.Group"},{id:"92b4883e-046b-4cf4-a83b-221b7ac39db8",uiAttribs:{},portsIn:[{name:"Text",value:"Use Start Texture"},{name:"Input",value:0},{name:"Default",value:0},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"80c845d0-5f34-48e2-8047-77f2dd0e245c",objOut:"92b4883e-046b-4cf4-a83b-221b7ac39db8"}]},{name:"Value",links:[{portIn:"Visible",portOut:"Value",objIn:"80c845d0-5f34-48e2-8047-77f2dd0e245c",objOut:"92b4883e-046b-4cf4-a83b-221b7ac39db8"},{portIn:"Value",portOut:"Value",objIn:"31f3013c-e241-41e3-a05d-fc15a1c96b77",objOut:"92b4883e-046b-4cf4-a83b-221b7ac39db8"},{portIn:"Value",portOut:"Value",objIn:"89d67a4b-0e0d-40fa-94a9-8082f55f24e1",objOut:"92b4883e-046b-4cf4-a83b-221b7ac39db8"}]}],objName:"Ops.Sidebar.Toggle_v3"},{id:"31f3013c-e241-41e3-a05d-fc15a1c96b77",uiAttribs:{},portsIn:[{name:"Variable",value:"UseStartTexture"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"f681ca37-258e-4806-acf7-16e31c4e151f",uiAttribs:{},portsIn:[{name:"Variable",value:"startTexture"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"a4339fb0-e8a6-4a25-b57d-8252c088d011",uiAttribs:{},portsIn:[{name:"number2",value:0,useVariable:"UseStartTexture"}],portsOut:[{name:"result",links:[{portIn:"amount",portOut:"result",objIn:"4e38aa37-70e0-4966-ac36-06e0df8f6286",objOut:"a4339fb0-e8a6-4a25-b57d-8252c088d011"}]}],objName:"Ops.Math.Multiply"},{id:"8529c7da-0a16-4aa9-bcc2-31a8bd3cb4d0",uiAttribs:{},portsIn:[{name:"Variable",value:"startTexture"}],portsOut:[{name:"Value",links:[{portIn:"Texture",portOut:"Value",objIn:"4fd5cf09-f5b1-4311-8bbd-6ef19e2652a2",objOut:"8529c7da-0a16-4aa9-bcc2-31a8bd3cb4d0"},{portIn:"texture1",portOut:"Value",objIn:"2543f91c-5c32-4025-b0d2-3facfbb99474",objOut:"8529c7da-0a16-4aa9-bcc2-31a8bd3cb4d0"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"2543f91c-5c32-4025-b0d2-3facfbb99474",uiAttribs:{},portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"texture",links:[{portIn:"Image",portOut:"texture",objIn:"4e38aa37-70e0-4966-ac36-06e0df8f6286",objOut:"2543f91c-5c32-4025-b0d2-3facfbb99474"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"4fd5cf09-f5b1-4311-8bbd-6ef19e2652a2",uiAttribs:{},portsOut:[{name:"Name",value:"emptyTexture"},{name:"PixelFormat",value:"RGBA 8bit ubyte"},{name:"Width",links:[{portIn:"number1",portOut:"Width",objIn:"11eee9e9-eb5e-4d0f-93c4-a51826497486",objOut:"4fd5cf09-f5b1-4311-8bbd-6ef19e2652a2"}]},{name:"Height",value:8},{name:"Ratio",value:1},{name:"Filter",value:"0 nearest"},{name:"Wrap",value:"0 repeat"},{name:"Flipped",value:0},{name:"HDR",value:0,title:"Float Texture"},{name:"Is Empty Default Texture",value:1},{name:"Is Default Texture",value:0},{name:"Is Cubemap",value:0},{name:"Id",value:"6643ac06-546f-4031-8180-16a29d720cd4"}],objName:"Ops.Gl.Textures.TextureInfo"},{id:"11eee9e9-eb5e-4d0f-93c4-a51826497486",uiAttribs:{},portsIn:[{name:"number2",value:8}],portsOut:[{name:"result",links:[{portIn:"bool",portOut:"result",objIn:"8ac2871d-200f-499d-80d2-d8ca65a17812",objOut:"11eee9e9-eb5e-4d0f-93c4-a51826497486"}]}],objName:"Ops.Math.Compare.GreaterThan"},{id:"4b91400a-5a9d-4691-bd4e-f6fcbde36b4c",uiAttribs:{},portsOut:[{name:"Trigger out",links:[{portIn:"Render",portOut:"Trigger out",objIn:"a0366864-50f9-434a-aae8-356fb2ee190b",objOut:"4b91400a-5a9d-4691-bd4e-f6fcbde36b4c"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"8eb1bcc0-82a5-4ea4-b4e3-df528c468200",uiAttribs:{},portsIn:[{name:"Variable",value:"UseStartTexture"}],portsOut:[{name:"Value",links:[{portIn:"Pass Through",portOut:"Value",objIn:"4b91400a-5a9d-4691-bd4e-f6fcbde36b4c",objOut:"8eb1bcc0-82a5-4ea4-b4e3-df528c468200"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8ac2871d-200f-499d-80d2-d8ca65a17812",uiAttribs:{},portsOut:[{name:"number",links:[{portIn:"num",portOut:"number",objIn:"2543f91c-5c32-4025-b0d2-3facfbb99474",objOut:"8ac2871d-200f-499d-80d2-d8ca65a17812"}]}],objName:"Ops.Boolean.BoolToNumber"},{id:"89d67a4b-0e0d-40fa-94a9-8082f55f24e1",uiAttribs:{},portsOut:[{name:"True",links:[{portIn:"Trigger",portOut:"True",objIn:"ef5e4b28-9351-4aae-af94-ab290d2ff73a",objOut:"89d67a4b-0e0d-40fa-94a9-8082f55f24e1"}]},{name:"False",links:[{portIn:"Trigger",portOut:"False",objIn:"ef5e4b28-9351-4aae-af94-ab290d2ff73a",objOut:"89d67a4b-0e0d-40fa-94a9-8082f55f24e1"}]}],objName:"Ops.Boolean.TriggerOnChangeBoolean"},{id:"ef5e4b28-9351-4aae-af94-ab290d2ff73a",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"ResetButton"}],objName:"Ops.Trigger.TriggerSend"},{id:"02ys465cq",uiAttribs:{},portsIn:[{name:"Value",value:840.27},{name:"Variable",value:"MouseInX"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"qe9cvw5ws",uiAttribs:{},portsIn:[{name:"Variable",value:"MouseInX"}],portsOut:[{name:"Value",links:[{portIn:"value",portOut:"Value",objIn:"02c44273-c6c4-4077-b4d6-988fe45d8ef2",objOut:"qe9cvw5ws"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"rncx4gytb",uiAttribs:{},portsIn:[{name:"Value",value:400},{name:"Variable",value:"MouseInY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"pbxt0418w",uiAttribs:{},portsIn:[{name:"Variable",value:"MouseInY"}],portsOut:[{name:"Value",links:[{portIn:"value",portOut:"Value",objIn:"10ea7052-2986-42d5-8368-60912076925e",objOut:"pbxt0418w"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"69pi0o60b",uiAttribs:{},portsIn:[{name:"Value",value:.5},{name:"Variable",value:"prevMousePosX"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"bnws9jfdr",uiAttribs:{},portsIn:[{name:"Value",value:.5},{name:"Variable",value:"prevMousePosY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"ks48n78y5",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"MouseMoving"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"e128b570-b198-43e6-9ff1-cc6925b04343",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"MouseIsDragged"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"8fx6zc7lv",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"monitorsXmin"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"oast05f3y",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"monitorsYmax"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"3ly02jjxq",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"monitorsYmin"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"qiccdan21",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"monitorsXmax"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"iury2mg38",uiAttribs:{},portsIn:[{name:"Variable",value:"monitorsXmin"}],portsOut:[{name:"Value",links:[{portIn:"old min",portOut:"Value",objIn:"02c44273-c6c4-4077-b4d6-988fe45d8ef2",objOut:"iury2mg38"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8kxs6qudj",uiAttribs:{},portsIn:[{name:"Variable",value:"monitorsXmax"}],portsOut:[{name:"Value",links:[{portIn:"old max",portOut:"Value",objIn:"02c44273-c6c4-4077-b4d6-988fe45d8ef2",objOut:"8kxs6qudj"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"cmxu10i2t",uiAttribs:{},portsIn:[{name:"Variable",value:"monitorsYmin"}],portsOut:[{name:"Value",links:[{portIn:"old min",portOut:"Value",objIn:"10ea7052-2986-42d5-8368-60912076925e",objOut:"cmxu10i2t"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"bna9agilj",uiAttribs:{},portsIn:[{name:"Variable",value:"monitorsYmax"}],portsOut:[{name:"Value",links:[{portIn:"old max",portOut:"Value",objIn:"10ea7052-2986-42d5-8368-60912076925e",objOut:"bna9agilj"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"dkvzamxwc",uiAttribs:{},portsIn:[{name:"Title",value:"Variables"}],objName:"Ops.Ui.Area"},{id:"8xu58rdfy",uiAttribs:{},portsIn:[{name:"Variable",value:"ResetSim"}],portsOut:[{name:"Value",links:[{portIn:"Visible",portOut:"Value",objIn:"557e884f-ebad-4263-9caf-1fc0afe114ec",objOut:"8xu58rdfy"}]}],objName:"Ops.Vars.VarGetNumber_v2"}],export:{time:"2026-01-07 01:30",service:"html",exportNumber:12}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["Z14eIm"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Html=Ops.Html||{};Ops.Math=Ops.Math||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Cables=Ops.Cables||{};Ops.String=Ops.String||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Html.CSS=Ops.Html.CSS||{};Ops.Extension=Ops.Extension||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Math.Compare=Ops.Math.Compare||{};Ops.Devices.Mouse=Ops.Devices.Mouse||{};Ops.Gl.ImageCompose=Ops.Gl.ImageCompose||{};Ops.Devices.Keyboard=Ops.Devices.Keyboard||{};Ops.Extension.Deprecated=Ops.Extension.Deprecated||{};Ops.Gl.MainLoop=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inValue("FPS Limit",0),i=n.outTrigger("trigger"),r=n.outNumber("width"),s=n.outNumber("height"),a=n.inValueBool("Reduce FPS not focussed",false),o=n.inValueBool("Reduce FPS loading"),l=n.inValueBool("Clear",true),h=n.inValueBool("ClearAlpha",true),u=n.inValueBool("Fullscreen Button",false),c=n.inValueBool("Active",true),f=n.inValueBool("Hires Displays",false),d=n.inSwitch("Pixel Unit",["Display","CSS"],"Display");n.onAnimFrame=M;f.onChange=function(){if(f.get())n.patch.cgl.pixelDensity=window.devicePixelRatio;else n.patch.cgl.pixelDensity=1;n.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()};c.onChange=function(){n.patch.removeOnAnimFrame(n);if(c.get()){n.setUiAttrib({extendTitle:""});n.onAnimFrame=M;n.patch.addOnAnimFrame(n);n.log("adding again!")}else{n.setUiAttrib({extendTitle:"Inactive"})}};const g=n.patch.cgl;let p=0;let m=0;let _=null;let b=false;if(!n.patch.cgl)n.uiAttr({error:"No webgl cgl context"});const v=vec3.create();vec3.set(v,0,0,0);const x=vec3.create();vec3.set(x,0,0,-2);u.onChange=I;setTimeout(I,100);let E=null;let T=true;let A=true;window.addEventListener("blur",()=>{T=false});window.addEventListener("focus",()=>{T=true});document.addEventListener("visibilitychange",()=>{A=!document.hidden});C();n.patch.tempData.mainloopOp=this;d.onChange=()=>{r.set(0);s.set(0)};function S(){if(o.get()&&n.patch.loading.getProgress()<1)return 5;if(a.get()){if(!A)return 10;if(!T)return 30}return t.get()}function I(){function e(){if(E)E.style.display="block"}function t(){if(E)E.style.display="none"}n.patch.cgl.canvas.addEventListener("mouseleave",t);n.patch.cgl.canvas.addEventListener("mouseenter",e);if(u.get()){if(!E){E=document.createElement("div");const i=n.patch.cgl.canvas.parentElement;if(i)i.appendChild(E);E.addEventListener("mouseenter",e);E.addEventListener("click",function(e){if(CABLES.UI&&!e.shiftKey)gui.toggleMaximizeCanvas();else g.fullScreen()})}E.style.padding="10px";E.style.position="absolute";E.style.right="5px";E.style.top="5px";E.style.width="20px";E.style.height="20px";E.style.cursor="pointer";E.style["border-radius"]="40px";E.style.background="#444";E.style["z-index"]="9999";E.style.display="none";E.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 490 490" style="width:20px;height:20px;" xml:space="preserve" width="512px" height="512px"><g><path d="M173.792,301.792L21.333,454.251v-80.917c0-5.891-4.776-10.667-10.667-10.667C4.776,362.667,0,367.442,0,373.333V480     c0,5.891,4.776,10.667,10.667,10.667h106.667c5.891,0,10.667-4.776,10.667-10.667s-4.776-10.667-10.667-10.667H36.416     l152.459-152.459c4.093-4.237,3.975-10.99-0.262-15.083C184.479,297.799,177.926,297.799,173.792,301.792z" fill="#FFFFFF"/><path d="M480,0H373.333c-5.891,0-10.667,4.776-10.667,10.667c0,5.891,4.776,10.667,10.667,10.667h80.917L301.792,173.792     c-4.237,4.093-4.354,10.845-0.262,15.083c4.093,4.237,10.845,4.354,15.083,0.262c0.089-0.086,0.176-0.173,0.262-0.262     L469.333,36.416v80.917c0,5.891,4.776,10.667,10.667,10.667s10.667-4.776,10.667-10.667V10.667C490.667,4.776,485.891,0,480,0z" fill="#FFFFFF"/><path d="M36.416,21.333h80.917c5.891,0,10.667-4.776,10.667-10.667C128,4.776,123.224,0,117.333,0H10.667     C4.776,0,0,4.776,0,10.667v106.667C0,123.224,4.776,128,10.667,128c5.891,0,10.667-4.776,10.667-10.667V36.416l152.459,152.459     c4.237,4.093,10.99,3.975,15.083-0.262c3.992-4.134,3.992-10.687,0-14.82L36.416,21.333z" fill="#FFFFFF"/><path d="M480,362.667c-5.891,0-10.667,4.776-10.667,10.667v80.917L316.875,301.792c-4.237-4.093-10.99-3.976-15.083,0.261     c-3.993,4.134-3.993,10.688,0,14.821l152.459,152.459h-80.917c-5.891,0-10.667,4.776-10.667,10.667s4.776,10.667,10.667,10.667     H480c5.891,0,10.667-4.776,10.667-10.667V373.333C490.667,367.442,485.891,362.667,480,362.667z" fill="#FFFFFF"/></g></svg>'}else{if(E){E.style.display="none";E.remove();E=null}}}n.onDelete=function(){g.gl.clearColor(0,0,0,0);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)};function M(e){if(!c.get())return;if(g.aborted||g.canvas.clientWidth===0||g.canvas.clientHeight===0)return;n.patch.cg=g;if(f.get())n.patch.cgl.pixelDensity=window.devicePixelRatio;const t=performance.now();n.patch.config.fpsLimit=S();if(g.canvasWidth==-1){g.setCanvas(n.patch.config.glCanvasId);return}if(g.canvasWidth!=r.get()||g.canvasHeight!=s.get()){let e=1;if(d.get()=="CSS")e=n.patch.cgl.pixelDensity;r.set(g.canvasWidth/e);s.set(g.canvasHeight/e)}if(CABLES.now()-m>1e3){CGL.fpsReport=CGL.fpsReport||[];if(n.patch.loading.getProgress()>=1&&m!==0)CGL.fpsReport.push(p);p=0;m=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;g.renderStart(g,v,x);if(l.get()){g.gl.clearColor(0,0,0,1);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)}i.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(g);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}g.renderEnd(g);n.patch.cg=null;if(h.get()){g.gl.clearColor(1,1,1,1);g.gl.colorMask(false,false,false,true);g.gl.clear(g.gl.COLOR_BUFFER_BIT);g.gl.colorMask(true,true,true,true)}if(!g.tempData.phong)g.tempData.phong={};p++;n.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function C(){clearTimeout(_);_=setTimeout(()=>{if(n.patch.getOpsByObjName(n.name).length>1){n.setUiError("multimainloop","there should only be one mainloop op!");if(!b)b=n.patch.addEventListener("onOpDelete",C)}else n.setUiError("multimainloop",null,1)},500)}}};CABLES.OPS["b0472a1d-db16-4ba6-8787-f300fbdc77bb"]={f:Ops.Gl.MainLoop,objName:"Ops.Gl.MainLoop"};Ops.Sidebar.Sidebar=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const i=a.attachments={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables *\n{\n    color: #BBBBBB !important;\n    font-family: Arial;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    width: var(--sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    /*outline-style: solid;*/\n    /*outline-color:red;*/\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n    background-position: -4px -9px;\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input:active\n{\n    background-color: #555 !important;\n}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n    display:block;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    /*outline: 0;*/\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n.sidebar__slider input[type=text],\n.sidebar__slider input[type=paddword]\n{\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover,\n.sidebar__slider input[type=password]:active,\n.sidebar__slider input[type=password]:focus,\n.sidebar__slider input[type=password]:hover\n{\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=date],\n.sidebar__text-input input[type=datetime-local],\n.sidebar__text-input input[type=text],\n.sidebar__text-input input[type=search],\n.sidebar__text-input input[type=password] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n\n\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    color-scheme: dark;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n\n\n\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover,\n.sidebar__text-input input[type=search]:active,\n.sidebar__text-input input[type=search]:focus,\n.sidebar__text-input input[type=search]:hover,\n.sidebar__text-input input[type=password]:active,\n.sidebar__text-input input[type=password]:focus,\n.sidebar__text-input input[type=password]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    /*outline: none;*/\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:inactive {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*.sidebar__select-select option*/\n/*{*/\n/*    background-color: #444444;*/\n/*    color: #bbb;*/\n/*}*/\n\n.sidebar__select-select option:checked\n{\n    background-color: #000;\n    color: #FFF;\n}\n\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n\n.sidebar__text-input-input::focus-visible,\n/*.sidebar__text-input-input:active,*/\n.sidebar__button-input:focus-visible,\n.sidebar__text-input:focus-visible\n/*.sidebar__text-input:active*/\n{\n    outline-style: solid;\n    outline-color:white;\n    outline-width: 1px;\n\n}\n\n"};const n="cables-sidebar-style";const r="cables-sidebar-dynamic-style";const o="sidebar-cables";const l="sidebar"+CABLES.uuid();const h="sidebar__items";const u="sidebar__close-button";const s="";const c="";let f=null;let F=null;let d=null;const e=a.inValueBool("Visible",true);const t=a.inValueSlider("Opacity",1);const g=a.inValueBool("Default Minimized");const p=a.inValueSlider("Minimized Opacity",.5);const m=a.inValueBool("Show undo button",false);const _=a.inValueBool("Show Minimize",false);const b=a.inString("Title","");const v=a.inValueBool("Side");const x=a.inValueBool("Default CSS",true);let E=a.patch.cgl.canvas.ownerDocument;const T=a.outObject("childs");T.setUiAttribs({title:"Children"});const A=a.outBool("Opfened");A.setUiAttribs({title:"Opened"});let S=E.querySelector("."+l);if(!S)S=D();const I=S.querySelector("."+h);T.set({parentElement:I,parentOp:a});y();P();w();x.onChange=()=>{P();w()};e.onChange=V;t.onChange=N;g.onChange=y;p.onChange=M;m.onChange=R;a.onDelete=B;function M(){w()}_.onChange=C;function C(e){if(!e||e.uiAttribs)e=E.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=E.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(_.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}v.onChange=function(){if(!S)return;if(v.get())S.classList.add("sidebar-cables-right");else S.classList.remove("sidebar-cables-right")};function R(){const e=E.querySelector(".sidebar-cables .sidebar__group-header");if(e){O(e)}}function O(e){if(e){const t=E.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!m.get()){t.remove()}}else{if(m.get()){const i=E.createElement("span");i.classList.add("sidebar__group-header-undo");i.classList.add("sidebar-icon-undo");i.addEventListener("click",function(e){e.stopPropagation();const t=E.querySelectorAll(".sidebar-cables .sidebar__reloadable");const i=E.createEvent("MouseEvents");i.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(i)})});e.appendChild(i)}}}C(e)}function y(){if(!f){return}if(g.get()){S.classList.add("sidebar--closed");if(e.get())A.set(false)}else{S.classList.remove("sidebar--closed");if(e.get())A.set(true)}}function N(){const e=t.get();S.style.opacity=e}function V(){if(!S)return;if(e.get()){S.style.display="block";if(!S.classList.contains("sidebar--closed"))A.set(true)}else{S.style.display="none";A.set(false)}}v.onChanged=function(){};function w(){const e=E.querySelectorAll("."+r);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}if(!x.get())return;const t=E.createElement("style");t.classList.add("cablesEle");t.classList.add(r);let i=".sidebar--closed .sidebar__close-button { ";i+="opacity: "+p.get();i+="}";const n=E.createTextNode(i);t.appendChild(n);E.body.appendChild(t)}function D(){const e=E.createElement("div");e.classList.add(o);e.classList.add(l);const t=a.patch.cgl.canvas.parentElement;const i=E.createElement("div");i.classList.add("sidebar__group");e.appendChild(i);const n=E.createElement("div");n.classList.add("sidebar__group-header");e.appendChild(n);const r=E.createElement("span");r.classList.add("sidebar__group-header-title");d=E.createElement("span");d.classList.add("sidebar__group-header-title-text");d.innerHTML=b.get();r.appendChild(d);n.appendChild(r);O(n);C(n);i.appendChild(n);e.appendChild(i);i.addEventListener("click",L);if(!t){a.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const s=E.createElement("div");s.classList.add(h);e.appendChild(s);f=E.createElement("div");f.classList.add(u);f.addEventListener("click",L);e.appendChild(f);return e}b.onChange=function(){if(d)d.innerHTML=b.get()};function k(e){}function L(e){e.stopPropagation();if(!S){a.logError("Sidebar could not be closed...");return}S.classList.toggle("sidebar--closed");const t=e.target;let i=s;if(S.classList.contains("sidebar--closed")){i=c;A.set(false)}else{A.set(true)}}function P(){const e=E.querySelectorAll("."+n);if(e){e.forEach(e=>{e.parentNode.removeChild(e)})}if(!x.get())return;const t=E.createElement("style");t.innerHTML=i.style_css;t.classList.add(n);t.classList.add("cablesEle");E.body.appendChild(t)}function B(){U(S)}function U(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}}};CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Sidebar.NumberInput_v2=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inObject("Link");const n=i.inString("Text","Number");const r=i.inValue("Input",0);const s=i.inTriggerButton("Set Default");const a=i.inValue("Default",0);a.setUiAttribs({hidePort:true,greyout:true});const o=i.outObject("Children");const l=i.outNumber("Result",a.get());const h=document.createElement("div");h.addEventListener("dblclick",function(){l.set(parseFloat(a.get()));r.set(parseFloat(a.get()))});h.dataset.op=i.id;h.classList.add("cablesEle");h.classList.add("sidebar__item");h.classList.add("sidebar__text-input");h.classList.add("sidebar__reloadable");const u=document.createElement("div");u.classList.add("sidebar__item-label");const c=document.createTextNode(n.get());u.appendChild(c);h.appendChild(u);const f=document.createElement("input");f.classList.add("sidebar__text-input-input");f.setAttribute("type","text");f.setAttribute("value",a.get());h.appendChild(f);f.addEventListener("input",p);t.onChange=b;n.onChange=_;a.onChange=m;i.onDelete=E;r.onChange=g;s.onTriggered=d;function d(){a.set(parseFloat(r.get()));i.refreshParams()}function g(){let e=parseFloat(r.get());if(isNaN(e)){e=0}f.value=e;l.set(e)}function p(e){let t=parseFloat(e.target.value);if(isNaN(t)){t=0}l.set(t);r.set(t);i.refreshParams()}function m(){}function _(){const e=n.get();u.textContent=e;if(CABLES.UI)i.setUiAttrib({extendTitle:e})}function b(){o.set(null);const e=t.get();if(e&&e.parentElement){e.parentElement.appendChild(h);o.set(e)}else{if(h.parentElement){h.parentElement.removeChild(h)}}}function v(e){if(e){e.style.display="block"}}function x(e){if(e){e.style.display="none"}}function E(){T(h)}function T(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["c4f3f1d7-de07-4c06-921e-32baeef4fc68"]={f:Ops.Sidebar.NumberInput_v2,objName:"Ops.Sidebar.NumberInput_v2"};Ops.Sidebar.DisplayValue_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link");const n=t.inString("Text","Value");const r=t.inString("Value","");const s=t.outObject("childs");const a=document.createElement("div");a.dataset.op=t.id;a.classList.add("cablesEle");a.classList.add("sidebar__item");a.classList.add("sidebar__value-display");const o=document.createElement("div");o.classList.add("sidebar__item-label");const l=document.createTextNode(n.get());o.appendChild(l);a.appendChild(o);const h=document.createElement("div");h.textContent=r.get();h.classList.add("sidebar__item-value-label");a.appendChild(h);i.onChange=f;n.onChange=c;r.onChange=u;t.onDelete=p;function u(){h.textContent=r.get()}function c(){const e=n.get();o.textContent=e;if(CABLES.UI){t.setUiAttrib({extendTitle:e})}}function f(){s.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(a);s.set(e)}else{if(a.parentElement){a.parentElement.removeChild(a)}}}function d(e){if(e){e.style.display="block"}}function g(e){if(e){e.style.display="none"}}function p(){m(a)}function m(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["3dd9927e-0d34-4442-8a8a-0ab843aee6e3"]={f:Ops.Sidebar.DisplayValue_v2,objName:"Ops.Sidebar.DisplayValue_v2"};Ops.Math.Divide=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),n=e.inValueFloat("number2",2),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){r.set(i.get()/n.get())}}};CABLES.OPS["86fcfd8c-038d-4b91-9820-a08114f6b7eb"]={f:Ops.Math.Divide,objName:"Ops.Math.Divide"};Ops.String.NumberToString_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Number"),n=e.inInt("Decimal Places",4),r=e.outString("Result");let s=false;let a=1;n.onChange=o;i.onChange=l;o();l();function o(){s=n.get()<100;a=Math.pow(10,n.get());l()}function l(){if(s)r.set(String(Math.round(i.get()*a)/a));else r.set(String(i.get()||0))}}};CABLES.OPS["5c6d375a-82db-4366-8013-93f56b4061a9"]={f:Ops.String.NumberToString_v2,objName:"Ops.String.NumberToString_v2"};Ops.Vars.VarTriggerNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Trigger"),n=e.inValueFloat("Value",0),r=e.outTrigger("Next");e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",n,e.varName,i,r)}};CABLES.OPS["2c29baf0-2af2-486d-9218-4299594ee9c1"]={f:Ops.Vars.VarTriggerNumber,objName:"Ops.Vars.VarTriggerNumber"};Ops.Sidebar.Button_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link");const n=t.inString("Text","Button");const r=t.outObject("childs");const s=t.outTrigger("Pressed Trigger");const a=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const h=document.createElement("button");h.classList.add("sidebar__button-input");l.appendChild(h);h.addEventListener("click",f);h.style.width="100%";const u=document.createTextNode(n.get());h.appendChild(u);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");i.onChange=g;n.onChange=d;t.onDelete=_;const c=document.createElement("div");c.classList.add("sidebar__greyout");l.appendChild(c);c.style.display="none";a.onChange=function(){c.style.display=a.get()?"block":"none"};o.onChange=function(){l.style.display=o.get()?"block":"none"};function f(){s.trigger()}function d(){const e=n.get();h.textContent=e;h.setAttribute("aria-label","button "+n.get());if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function g(){r.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(l);r.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function p(e){if(e){e.style.display="block"}}function m(e){if(e){e.style.display="none"}}function _(){b(l)}function b(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["5e9c6933-0605-4bf7-8671-a016d917f327"]={f:Ops.Sidebar.Button_v2,objName:"Ops.Sidebar.Button_v2"};Ops.Sidebar.Group=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};let i=t.inObject("link");let n=t.inString("Text","Group");const r=t.inBool("Show Title",true);let s=t.inValueBool("Default Minimized");const a=t.inBool("Visible",true);let o=t.outObject("next");let l=t.outObject("childs");a.onChange=function(){h.style.display=a.get()?"block":"none"};let h=document.createElement("div");h.dataset.op=t.id;h.classList.add("sidebar__group");p();let u=document.createElement("div");u.classList.add("sidebar__group-header");u.classList.add("cablesEle");h.appendChild(u);u.addEventListener("click",m);let c=document.createElement("div");c.classList.add("sidebar__group-header-title");u.appendChild(c);let f=document.createElement("span");f.textContent=n.get();f.classList.add("sidebar__group-header-title-text");c.appendChild(f);let d=document.createElement("span");d.classList.add("sidebar__group-header-icon");d.classList.add("iconsidebar-chevron-up");c.appendChild(d);let g=document.createElement("div");g.classList.add("sidebar__group-items");h.appendChild(g);t.toWorkPortsNeedToBeLinked(i);i.onChange=b;n.onChange=_;s.onChange=p;t.onDelete=E;r.onChange=()=>{if(r.get())u.style.display="block";else u.style.display="none"};function p(){if(s.get()){h.classList.add("sidebar__group--closed")}else{h.classList.remove("sidebar__group--closed")}}function m(e){e.stopPropagation();h.classList.toggle("sidebar__group--closed")}function _(){let e=n.get();f.textContent=e;if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function b(){l.set(null);let e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(h);l.set({parentElement:g,parentOp:t});o.set(e)}else{if(h.parentElement){h.parentElement.removeChild(h)}}}function v(e){if(e){e.style.display="block"}}function x(e){if(e){e.style.display="none"}}function E(){T(h)}function T(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["86ea2333-b51c-48ed-94c2-8b7b6e9ff34c"]={f:Ops.Sidebar.Group,objName:"Ops.Sidebar.Group"};Ops.Gl.ForceCanvasSize=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Trigger"),l=e.inBool("Active",true),n=e.inSwitch("Force",["Resolution","Aspect Ratio"],"Resolution"),h=e.inBool("Center In Parent",true),u=e.inBool("Scale to fit Parent",true),c=e.inInt("Set Width",300),f=e.inInt("Set Height",200),r=e.inDropDown("Aspect Ratio",["Custom","21:9","2:1","16:9","16:10","4:3","1:1","9:16","1:2","iPhoneXr Vert"],"16:9"),d=e.inFloat("Ratio",0),s=e.inDropDown("Fill Parent",["Auto","Width","Height","Both"],"Auto"),g=e.outTrigger("Next"),p=e.outNumber("Width"),m=e.outNumber("Height"),_=e.outNumber("Margin Left"),b=e.outNumber("Margin Top");e.setPortGroup("Size",[c,f]);e.setPortGroup("Proportions",[d,s,r]);let v=0;const a=0;const x=1;const E=2;const T=3;const A=4;s.onChange=M;n.onChange=o;h.onChange=i.onLinkChanged=C;r.onChange=I;const S=e.patch.cgl;M();function o(){if(n.get()=="Aspect Ratio"){d.set(100);I()}M()}function I(){const e=r.get();if(e=="Custom")return;else if(e=="16:9")d.set(16/9);else if(e=="4:3")d.set(4/3);else if(e=="16:10")d.set(16/10);else if(e=="21:9")d.set(21/9);else if(e=="2:1")d.set(2);else if(e=="1:1")d.set(1);else if(e=="9:16")d.set(9/16);else if(e=="1:2")d.set(.5);else if(e=="iPhoneXr Vert")d.set(9/19.5)}e.on("delete",()=>{C()});d.onChange=()=>{C()};l.onChange=function(){if(!l.get())C()};function M(){const e=n.get()=="Resolution";c.setUiAttribs({greyout:!e});f.setUiAttribs({greyout:!e});r.setUiAttribs({greyout:e});s.setUiAttribs({greyout:e});d.setUiAttribs({greyout:e});v=0;if(!e){const t=s.get();if(t=="Width")v=x;else if(t=="Height")v=E;else if(t=="Both")v=T;else if(t=="Auto")v=A}}function C(){S.canvas.style["margin-top"]="";S.canvas.style["margin-left"]="";S.canvas.styleMarginLeft=0;S.canvas.styleMarginTop=0;_.set(0);b.set(0);const e=S.canvas.parentNode.getBoundingClientRect();S.setSize(e.width,e.height);S.canvas.style.transform="scale(1)";S.canvas.style.position="absolute";S.updateSize()}i.onTriggered=function(){if(!l.get())return g.trigger();let e=c.get();let t=f.get();let i=S.canvas.parentNode.getBoundingClientRect();if(i.height==0){S.canvas.parentNode.style.height="100%";i=S.canvas.parentNode.getBoundingClientRect()}if(i.width==0){S.canvas.parentNode.style.width="100%";i=S.canvas.parentNode.getBoundingClientRect()}if(v==x){e=i.width;t=e*1/d.get()}else if(v==E){t=i.height;e=t*d.get()}else if(v==A){const n=i;t=n.height;e=t*d.get();if(e>n.width){e=n.width;t=e*1/d.get()}}else if(v==T){const n=i;t=n.height;e=t*d.get();if(e<n.width){e=n.width;t=e*1/d.get()}}e=Math.ceil(e);t=Math.ceil(t);if(h.get()){const n=i;const r=(n.height-t)/2;const s=(n.width-e)/2;_.set(s);b.set(r);S.canvas.style["margin-top"]=r+"px";S.canvas.style["margin-left"]=s+"px";S.canvas.styleMarginTop=r;S.canvas.styleMarginLeft=s}else{S.canvas.style["margin-top"]="0";S.canvas.style["margin-left"]="0";S.canvas.styleMarginTop=0;S.canvas.styleMarginLeft=0;_.set(0);b.set(0)}if(u.get()){const n=i;const a=n.width/c.get();const o=n.height/f.get();S.canvas.style.transform="scale("+Math.min(a,o)+")"}else{S.canvas.style.transform="scale(1)"}if(S.canvasWidth!=e||S.canvasHeight!=t){p.set(e);m.set(t);S.setSize(e,t)}g.trigger()}}};CABLES.OPS["a8b3380e-cd4a-4000-9ee9-1c65a11027dd"]={f:Ops.Gl.ForceCanvasSize,objName:"Ops.Gl.ForceCanvasSize"};Ops.Trigger.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const t=s.inTrigger("exe"),i=s.inTriggerButton("Clean up connections");s.setUiAttrib({resizable:true,resizableY:false,stretchPorts:true});const n=[],a=[],r=16;let o=null,l=[];t.onTriggered=c;i.onTriggered=f;i.setUiAttribs({hideParam:true,hidePort:true});for(let t=0;t<r;t++){const d=s.outTrigger("trigger "+t);a.push(d);d.onLinkChanged=u;if(t<r-1){let e=s.inTrigger("exe "+t);e.onTriggered=c;n.push(e)}}h();function h(){l.length=0;for(let e=0;e<a.length;e++)if(a[e].links.length>0)l.push(a[e])}function u(){h();clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(s.isCurrentUiOp())s.refreshParams()},60)}function c(){for(let e=0;e<l.length;e++)l[e].trigger()}function f(){let n=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[n].links.length>0)n++;t.push(a[i].links[e]);const r=a[i].links[e].getOtherPort(a[i]);s.patch.link(s,"trigger "+n,r.op,r.name);n++}for(let e=0;e<t.length;e++)t[e].remove()}u();h()}}};CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Trigger.Sequence,objName:"Ops.Trigger.Sequence"};Ops.Gl.Shader.CustomShader_v2=class extends CABLES.Op{constructor(){super(...arguments);const _=this;const e=_.attachments={};const t=_.inTrigger("render"),i=_.inStringEditor("Fragment Code"),n=_.inStringEditor("Vertex Code"),r=_.inValueBool("Use As Material",true),s=_.outTrigger("trigger"),a=_.outObject("Shader",null,"shader"),o=_.outBool("Has Errors");const b=7;const v=_.patch.cgl;const x=[];const E=[];const T=[];_.toWorkPortsNeedToBeLinked(t);i.setUiAttribs({editorSyntax:"glsl"});n.setUiAttribs({editorSyntax:"glsl"});const A=new CGL.Shader(v,"customshader",_);A.logError=false;A.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);_.setPortGroup("Source Code",[i,n]);_.setPortGroup("Options",[r]);i.set(CGL.Shader.getDefaultFragmentShader());n.set(CGL.Shader.getDefaultVertexShader());i.onChange=n.onChange=function(){if(i.isLinked()&&!i.get())return;h=true};t.onTriggered=c;let l=0;let h=true;_.onLoadedValueSet=u;function u(i){m();if(!i)return;for(let t=0;t<x.length;t++)for(let e=0;e<i.portsIn.length;e++)if(x[t]&&x[t].name==i.portsIn[e].name){x[t].set(i.portsIn[e].value);x[t].deSerializeSettings(i.portsIn[e])}}_.init=function(){m()};function c(){O();if(h)m();if(r.get())v.pushShader(A);f();s.trigger();A.popTextures();if(r.get())v.popShader()}function f(){for(let e=0;e<E.length;e++)if(E[e]&&E[e].get()&&E[e].get().tex)A.pushTexture(E[e].uniform,E[e].get().tex);else A.pushTexture(E[e],CGL.Texture.getEmptyTexture(v))}function d(){for(let e=0;e<E.length;e++)if(E[e]&&E[e].get()&&E[e].get().tex)v.setTexture(0+e+b,E[e].get().tex)}function S(t){for(let e=0;e<x.length;e++)if(x[e]&&x[e].name==t)return true;for(let e=0;e<E.length;e++)if(E[e]&&E[e].name==t)return true;return false}const g=mat4.create();const I=["modelMatrix","viewMatrix","normalMatrix","mvMatrix","projMatrix","inverseViewMatrix","camPos"];let M=0;const C=[];function p(e){const t=e.split("\n");const r=[];for(let e=0;e<t.length;e++){const i=t[e].split(";");for(let e=0;e<i.length;e++){let n=i[e].split(" ");for(let e=0;e<n.length;e++)n[e]=(n[e]+"").trim();if(n[0]==="UNI"||n[0]==="uniform"){let t=n[2];if(n.length>4)for(let e=3;e<n.length;e++)t+=n[e];n=n.filter(function(e){return e!==""});const s=n[1];let i=[];if(t){i=[t];if(t.indexOf(",")>-1)i=t.split(",")}for(let e=0;e<i.length;e++){if(I.indexOf(i[e])>-1)continue;const a=i[e].trim().replace(/\[\d+\]$/,"");if(s==="float"){C.push(a);if(!S(a)){const o=i[e].trim().match(/\[\d+\]$/);if(o){const l=parseInt(o[0].trim().slice(1,-1));const h=_.inArray(a,[]);h.uniform=new CGL.Uniform(A,"f[]",a,new Float32Array(l));x.push(h);r.push(h);const u={name:a,num:l,port:h,uni:h.uniform,changed:false};h.onChange=function(){this.changed=true}.bind(u);T.push(u)}else{const h=_.inFloat(a,0);h.uniform=new CGL.Uniform(A,"f",a,h);x.push(h);r.push(h)}}}else if(s==="int"){C.push(a);if(!S(a)){const h=_.inInt(a,0);h.uniform=new CGL.Uniform(A,"i",a,h);x.push(h);r.push(h)}}else if(s==="bool"){C.push(a);if(!S(a)){const h=_.inBool(a,false);h.uniform=new CGL.Uniform(A,"b",a,h);x.push(h);r.push(h)}}else if(s==="mat4"){C.push(a);if(!S(a)){const h=_.inArray(a,0);h.uniform=new CGL.Uniform(A,"m4",a,h);x.push(h);r.push(h);const u={name:a,num:16,port:h,uni:h.uniform,changed:false};h.onChange=function(){this.changed=true}.bind(u);T.push(u)}}else if(s==="sampler2D"||s==="samplerCube"){C.push(a);if(!S(a)){const c=_.inObject(a);let e="t";if(s==="samplerCube")e="tc";c.uniform=new CGL.Uniform(A,e,a,b+E.length);E.push(c);r.push(c);c.set(CGL.Texture.getTempTexture(v));c.on("change",(e,t)=>{if(!e)t.set(CGL.Texture.getTempTexture(v))});M++}}else if(s==="vec3"||s==="vec2"||s==="vec4"){let e=2;if(s==="vec4")e=4;if(s==="vec3")e=3;C.push(a+" X");C.push(a+" Y");if(e>2)C.push(a+" Z");if(e>3)C.push(a+" W");if(!S(a+" X")){const f=[];const u={name:a,num:e,changed:false};T.push(u);R(u);const d=_.inFloat(a+" X",0);d.onChange=function(){this.changed=true}.bind(u);x.push(d);f.push(d);u.x=d;const g=_.inFloat(a+" Y",0);g.onChange=function(){this.changed=true}.bind(u);x.push(g);f.push(g);u.y=g;if(e>2){const p=_.inFloat(a+" Z",0);p.onChange=function(){this.changed=true}.bind(u);x.push(p);f.push(p);u.z=p}if(e>3){const m=_.inFloat(a+" W",0);m.onChange=function(){this.changed=true}.bind(u);x.push(m);f.push(m);u.w=m}_.setPortGroup(a,f)}}}}}}_.setPortGroup("uniforms",r)}function m(){if(!A)return;let e=false;l++;if(l>2)e=true;A.setSource(n.get(),i.get(),e);if(v.glVersion==1){v.enableExtension("OES_standard_derivatives");A.enableExtension("GL_OES_standard_derivatives")}M=0;C.length=0;p(n.get());p(i.get());for(let t=0;t<E.length;t++)for(let e=0;e<C.length;e++)if(E[t]&&C.indexOf(E[t].name)==-1){E[t].remove();E[t]=null}for(let t=0;t<x.length;t++)for(let e=0;e<C.length;e++)if(x[t]&&C.indexOf(x[t].name)==-1){x[t].remove();x[t]=null}for(let e=0;e<T.length;e++){R(T[e]);T[e].changed=true}for(let e=0;e<x.length;e++)if(x[e]&&x[e].uniform)x[e].uniform.needsUpdate=true;A.compile();_.refreshParams();a.setRef(A);h=false;if(A.hasErrors())_.setUiError("compile","Shader has errors",2,{button:"show",buttonCb:()=>{CABLES.UI.showShaderError(A)}});else _.setUiError("compile",null);o.set(A.hasErrors())}function R(e){if(e.num==2)e.uni=new CGL.Uniform(A,"2f",e.name,[0,0]);else if(e.num==3)e.uni=new CGL.Uniform(A,"3f",e.name,[0,0,0]);else if(e.num==4)e.uni=new CGL.Uniform(A,"4f",e.name,[0,0,0,0])}function O(){for(let e=0;e<T.length;e++){const t=T[e];if(t.changed){if(t.num===2)t.uni.setValue([t.x.get(),t.y.get()]);else if(t.num===3)t.uni.setValue([t.x.get(),t.y.get(),t.z.get()]);else if(t.num===4)t.uni.setValue([t.x.get(),t.y.get(),t.z.get(),t.w.get()]);else if(t.num>4){t.uni.setValue(t.port.get())}t.changed=false}}}}};CABLES.OPS["a165fc89-a35b-4d39-8930-7345b098bd9d"]={f:Ops.Gl.Shader.CustomShader_v2,objName:"Ops.Gl.Shader.CustomShader_v2"};Ops.Sidebar.ColorPicker_v3=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={colorrick_css:".colorRick_dialog\n{\n    --width:256px;\n    --height:256px;\n    --width-hue:15px;\n    --width-opacity:15px;\n    --pad-opacity:10px;\n    --pad:10px;\n    --colorblock-height:20px;\n    --inputcontainer-height:120px;\n\n    background-color: #333;\n    width:calc(var(--width) + var(--pad-opacity) + 3 * var(--pad) + var(--width-hue) + var(--width-opacity));\n    height:calc(var(--height) + var(--colorblock-height) + 30px + var(--inputcontainer-height));\n    position: absolute;\n    border-radius: 10px;\n    overflow: hidden;\n    z-index: 999999;\n\n}\n\n.colorRick_dialog *\n{\n    font-size: 13px;\n}\n\n.colorRick_area\n{\n    width:var(--width);\n    height:var(--height);\n    left:var(--pad);\n    top:var(--pad);\n    background: linear-gradient(to right, rgb(255, 255, 255), rgb(0, 255, 11));\n    position: absolute;\n    cursor:pointer;\n}\n\n.colorRick_brightness\n{\n    background: linear-gradient(hsla(0,0%,100%,0),#000);\n    width:100%;\n    height:100%;\n    pointer-events: none;\n}\n\n.colorRick_eyeDrop\n{\n    cursor:pointer;\n    top:calc(var(--pad) + var(--pad) + var(--height));\n    margin-top:3px;\n    height:var(--width-hue);\n    width:var(--width-hue);\n    background-color:#aaa;\n    mask: url(\"data:image/svg+xml;charset=utf8, %3Csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cdefs%3E%3Cstyle%3E.cls-1{fill:none;stroke:%23000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px}%3C/style%3E%3C/defs%3E%3Cpath class='cls-1' d='m9.22 13.59 5.32-5.31-2.95-2.95-7.3 7.3a.71.71 0 0 0 0 1l1.94 1.94a.73.73 0 0 0 1 0ZM12.42 4.5l2.85-2.85a2.09 2.09 0 0 1 2.95 0h0a2.09 2.09 0 0 1 0 2.95l-2.85 2.84M10.38 4.12l5.36 5.36M5.01 14.86l-2.1 2.09M12.04 10.8H6.15M1.92 18.97h0'/%3E%3Cpath style='fill:none' d='M0 0h20v20H0z'/%3E%3C/svg%3E\");\n    position: absolute;\n    left:calc(var(--width) + var(--pad) + var(--pad));\n}\n\n.colorRick_eyeDrop:hover\n{\n    background-color:#fff;\n}\n\n\n.colorRick_hue\n{\n    cursor:pointer;\n    top:var(--pad);\n    background:linear-gradient(red,#f0f 17%,#00f 34%,#0ff 50%,#0f0 67%,#ff0 84%,red);\n    height:var(--height);\n\n    width:var(--width-hue);\n    position: absolute;\n    left:calc(var(--width) + var(--pad) + var(--pad));\n}\n\n.colorRick_opacity\n{\n    cursor:pointer;\n    top:var(--pad);\n    background:linear-gradient(rgba(255,255,255,1),rgba(255,255,255,0));\n    height:var(--height);\n\n    width:var(--width-opacity);\n    position: absolute;\n    left:calc(var(--width) + var(--pad) + var(--pad) + var(--pad) + var(--width-hue));\n}\n\n.colorRick_preview\n{\n    position: absolute;\n    width:calc(var(--width) / 10 * 9);\n    height:var(--colorblock-height);\n    top:calc(var(--height) + 20px);\n    margin-left:10px;\n}\n\n.colorRick_preview_orig\n{\n    margin-left:calc(calc(var(--width) / 10 * 9) + 10px);\n    width:calc(var(--width) / 10);\n    cursor:pointer;\n}\n\n.colorRick_cursor\n{\n    width:4px;\n    height:4px;\n    border:1px solid transparent;\n    background-color: white;\n    position: absolute;\n    pointer-events: none;\n    border-radius: 100%;\n}\n\n.colorRick_cursor_hue,.colorRick_cursor_opacity\n{\n    position: absolute;\n    width:19px;\n    margin-left: -2px;\n    height:0px;\n    border-top:1px solid white;\n    border-bottom:1px solid white;\n    position: absolute;\n    pointer-events: none;\n}\n\n.colorRick_inputcontainer\n{\n    position: absolute;\n\n    height:var(--inputcontainer-height);\n    /* top:250px; */\n    top:calc(var(--height) + 20px + 20px + 10px);\n    left:0px;\n    width:100%;\n    background-color: #000;\n    padding:10px;\n}\n\n.colorRick_inputcontainer table\n{\n    width:var(--width);\n}\n\n.colorRick_inputcontainer, .colorRick_inputcontainer table\n{\n    color:#999;\n}\n\n.colorRick_input\n{\n    background-color: #444;\n    border:0px solid transparent;\n    opacity: 1;\n    color:#ddd;\n}\n\n.colorRick_input_small\n{\n    width:60px;\n    margin-left:8px;\n}\n\n.colorRick_input_hex\n{\n    width:60px;\n}\n\n.opacity_title\n{\n    width:60px;\n    display:inline-block;\n    margin-left:6px;\n}\n\n.colorRick_invalid\n{\n    opacity: 0.5;\n}\n\n.colorRick_inputcontainer table\n{\n    /* width:90%; */\n}\n\n.colorRick_inputcontainer table,.colorRick_inputcontainer table td, .colorRick_inputcontainer table tr\n{\n    /* pointer-events: none; */\n    user-select: none;\n\n    vertical-align: top;\n}\n\n.colorRick_inputcontainer table td.right\n{\n    text-align: right;\n    height: 30px;\n}\n"};const t="#07F78C";const i=n.inObject("Link");const r=n.inString("Text","Hex Color");const s=O(t);const a=n.inValueSlider("Input Red",s[0]);const o=n.inValueSlider("Input Green",s[1]);const l=n.inValueSlider("Input Blue",s[2]);const h=n.inValueSlider("Input Opacity",1);const u=n.inTriggerButton("Set Default");const c=n.inValueString("Default",t);const f=n.inBool("Show Opacity",false);c.setUiAttribs({hidePort:true,greyout:true});const d=n.outObject("Children");const g=n.outNumber("Red",0);const p=n.outNumber("Green",0);const m=n.outNumber("Blue",0);const _=n.outNumber("Opacity",1);const b=n.outString("Hex",t);const v=document.createElement("div");v.dataset.op=n.id;v.classList.add("cablesEle");v.addEventListener("dblclick",function(){let e=c.get();S.setAttribute("value",e);if(e){if(e.length===6&&e.charAt(0)!=="#"){e="#"+e}if(e.length===7){S.value=e;I.value=e;L(e)}}});v.classList.add("sidebar__item");v.classList.add("sidebar__color-picker");v.classList.add("sidebar__reloadable");const x=document.createElement("style");x.type="text/css";x.textContent=e.colorrick_css;const E=document.getElementsByTagName("body")[0];E.appendChild(x);const T=document.createElement("div");T.classList.add("sidebar__item-label");const A=document.createTextNode(r.get());T.appendChild(A);v.appendChild(T);const S=document.createElement("input");S.classList.add("sidebar__color-picker-input");S.setAttribute("type","text");S.setAttribute("value",c.get());v.appendChild(S);S.addEventListener("input",w);const I=document.createElement("div");I.classList.add("sidebar__color-picker-color-input");I.style.backgroundColor=c.get();I.addEventListener("click",function(){new ColorRick({ele:this,color:this.style.backgroundColor||"#ff0000",opacity:h.get(),showOpacity:f.get(),onChange:(e,t)=>{console.log("col",t);if(t!=undefined){h.set(t);_.set(t)}const i=e.hex();this.style.backgroundColor=i;L(i);S.value=i;b.set(i);N(i);n.refreshParams()}})});v.appendChild(I);S.addEventListener("input",w);P();i.onChange=D;r.onChange=V;c.onChange=P;n.onDelete=U;u.onTriggered=R;a.onChange=M;o.onChange=M;l.onChange=M;function M(){const e=C();I.style.backgroundColor=e;S.value=e;L(e)}function C(){const e=CABLES.clamp(a.get(),0,1);const t=CABLES.clamp(o.get(),0,1);const i=CABLES.clamp(l.get(),0,1);const n=F(e,t,i);return n}function R(){const e=C();c.set(e);b.set(e);n.refreshParams()}function O(e){if(!e||e.length!==7){return}return e.match(/[A-Za-z0-9]{2}/g).map(function(e){return parseInt(e,16)/255})}function y(e){const t=e.toString(16);return t.length==1?"0"+t:t}function F(e,t,i){return"#"+y(Math.floor(255*e))+y(Math.floor(255*t))+y(Math.floor(255*i))}function N(e){const t=O(e);a.set(t[0]);o.set(t[1]);l.set(t[2]);b.set(e)}function w(e){let t=e.target.value;if(t.length===6&&t.charAt(0)!=="#"){t="#"+t}if(t.length===7){I.value=t;L(t);N(t);b.set(t);n.refreshParams()}}function L(e){const t=O(e);b.set(e);g.set(t[0]);p.set(t[1]);m.set(t[2])}function P(){let e=c.get();S.setAttribute("value",e);if(e){if(e.length===6&&e.charAt(0)!=="#"){e="#"+e}if(e.length===7){S.value=e;I.value=e;L(e)}}}function V(){const e=r.get();T.textContent=e;if(CABLES.UI)n.setUiAttrib({extendTitle:e})}function D(){d.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(v);d.set(e)}else{if(v.parentElement){v.parentElement.removeChild(v)}}}function k(e){if(e){e.style.display="block"}}function B(e){if(e){e.style.display="none"}}function U(){G(v)}function G(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["52dc1ef8-deb0-4664-a924-4c5548aa8a55"]={f:Ops.Sidebar.ColorPicker_v3,objName:"Ops.Sidebar.ColorPicker_v3"};Ops.Sidebar.Slider_v3=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const F=r.attachments={};const e=1e-5;const t=r.inObject("link");const i=r.inString("Text","Slider");const s=r.inValue("Min",0);const a=r.inValue("Max",1);const n=r.inValue("Step",e);const o=r.inString("Suffix","");const l=r.inBool("Grey Out",false);const h=r.inBool("Visible",true);const u=r.inValue("Input",.5);const c=r.inTriggerButton("Set Default");const f=r.inTriggerButton("Reset");let d=null;const g=r.inValue("Default",.5);g.setUiAttribs({hidePort:true,greyout:true});const p=r.outObject("childs");const m=r.outNumber("Result",g.get());r.toWorkNeedsParent("Ops.Sidebar.Sidebar");r.setPortGroup("Range",[s,a,n]);r.setPortGroup("Display",[l,h]);const _=document.createElement("div");_.addEventListener("dblclick",function(){m.set(parseFloat(g.get()));u.set(parseFloat(g.get()));L(g.get())});_.dataset.op=r.id;_.classList.add("cablesEle");_.classList.add("sidebar__item");_.classList.add("sidebar__slider");_.classList.add("sidebar__reloadable");r.patch.on("sidebarStylesChanged",()=>{y()});const b=document.createElement("div");b.classList.add("sidebar__item-label");const v=document.createElement("div");v.classList.add("sidebar__greyout");_.appendChild(v);v.style.display="none";const x=document.createTextNode(i.get());b.appendChild(x);_.appendChild(b);const E=document.createElement("input");E.value=g.get();E.classList.add("sidebar__text-input-input");E.setAttribute("type","text");E.oninput=M;_.appendChild(E);const T=document.createElement("span");_.appendChild(T);o.onChange=()=>{T.innerHTML=o.get()};const A=document.createElement("div");A.classList.add("sidebar__slider-input-wrapper");_.appendChild(A);const S=document.createElement("div");S.classList.add("sidebar__slider-input-active-track");A.appendChild(S);const I=document.createElement("input");I.classList.add("sidebar__slider-input");I.setAttribute("min",s.get());I.setAttribute("max",a.get());I.setAttribute("type","range");I.setAttribute("step",n.get());I.setAttribute("value",g.get());I.style.display="block";A.appendChild(I);y();I.addEventListener("input",O);t.onChange=B;i.onChange=k;u.onChange=C;g.onChange=D;c.onTriggered=R;s.onChange=N;a.onChange=w;n.onChange=V;r.onDelete=j;r.onLoaded=r.onInit=function(){if(r.patch.config.sidebar){r.patch.config.sidebar[i.get()];m.set(r.patch.config.sidebar[i.get()])}else{m.set(parseFloat(g.get()));u.set(parseFloat(g.get()))}};f.onTriggered=function(){const e=parseFloat(g.get());m.set(e);L(e);P(e);u.set(e);y()};l.onChange=function(){v.style.display=l.get()?"block":"none"};h.onChange=function(){_.style.display=h.get()?"block":"none"};function M(e){let t=parseFloat(e.target.value);if(isNaN(t))t=0;const i=s.get();const n=a.get();if(t<i){t=i}else if(t>n){t=n}m.set(t);y();u.set(t);r.refreshParams()}function C(){let e=parseFloat(u.get());const t=s.get();const i=a.get();if(e>i){e=i}else if(e<t){e=t}L(e);P(e);m.set(e);y()}function R(){let e=parseFloat(u.get());const t=s.get();const i=a.get();if(e>i){e=i}else if(e<t){e=t}L(e);P(e);m.set(e);g.set(e);r.refreshParams();y()}function O(e){e.preventDefault();e.stopPropagation();L(e.target.value);const t=parseFloat(e.target.value);m.set(t);u.set(t);r.refreshParams();y();return false}function V(){const e=n.get();I.setAttribute("step",e);y()}function y(e){let t=parseFloat(I.value);if(typeof e!=="undefined")t=e;let i=S.parentElement.getBoundingClientRect().width||220;if(d)i=parseInt(getComputedStyle(d.parentElement).getPropertyValue("--sidebar-width"))-20;const n=CABLES.map(t,parseFloat(I.min),parseFloat(I.max),0,i-16);S.style.width=n+"px"}function N(){const e=s.get();I.setAttribute("min",e);y()}function w(){const e=a.get();I.setAttribute("max",e);y()}function D(){const e=g.get();m.set(parseFloat(e));N();w();P(e);L(e);y(e)}function k(){const e=i.get();b.textContent=e;if(CABLES.UI)r.setUiAttrib({extendTitle:e});E.setAttribute("aria-label","slider "+i.get());I.setAttribute("aria-label","slider "+i.get())}function B(){p.set(null);d=t.get();if(d&&d.parentElement){d.parentElement.appendChild(_);p.set(d)}else if(_.parentElement)_.parentElement.removeChild(_);y()}function L(e){E.value=e}function P(e){I.value=e}function U(e){if(e)e.style.display="block"}function G(e){if(e)e.style.display="none"}function j(){H(_)}function H(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}}};CABLES.OPS["74730122-5cba-4d0d-b610-df334ec6220a"]={f:Ops.Sidebar.Slider_v3,objName:"Ops.Sidebar.Slider_v3"};Ops.Vars.VarSetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",i,e.varName)}};CABLES.OPS["b5249226-6095-4828-8a1c-080654e192fa"]={f:Ops.Vars.VarSetNumber_v2,objName:"Ops.Vars.VarSetNumber_v2"};Ops.Array.Array3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValueInt("Num Triplets",100),a=e.inValueFloat("X",0),o=e.inValueFloat("Y",0),l=e.inValueFloat("Z",0),h=e.outArray("Array",null,3),u=e.outNumber("Total points"),c=e.outNumber("Array length");s.onChange=a.onChange=o.onChange=l.onChange=i;let f=[];i();function i(){let t=Math.floor(s.get()*3);if(t<0)t=0;if(f.length!=t)f.length=t;const i=a.get();const n=o.get();const r=l.get();for(let e=0;e<t;e+=3){f[e]=i;f[e+1]=n;f[e+2]=r}h.setRef(f);u.set(t/3);c.set(t)}}};CABLES.OPS["2766606a-3ea0-4204-8613-b8950a124435"]={f:Ops.Array.Array3,objName:"Ops.Array.Array3"};Ops.Vars.VarSetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",i,e.varName)}};CABLES.OPS["8088290f-45d4-4312-b4ca-184d34ca4667"]={f:Ops.Vars.VarSetArray_v2,objName:"Ops.Vars.VarSetArray_v2"};Ops.Vars.VarGetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,i)}};CABLES.OPS["afa79294-aa9c-43bc-a49a-cade000a1de5"]={f:Ops.Vars.VarGetArray_v2,objName:"Ops.Vars.VarGetArray_v2"};Ops.Array.Array3GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array",3),n=e.inValueInt("Index"),r=e.outNumber("X"),s=e.outNumber("Y"),a=e.outNumber("Z");e.toWorkPortsNeedToBeLinked(i);i.onChange=n.onChange=o;function o(){let e=i.get();if(!e){r.set(0);s.set(0);a.set(0);return}let t=Math.min(e.length-3,n.get()*3);if(e){r.set(e[t+0]);s.set(e[t+1]);a.set(e[t+2])}}}};CABLES.OPS["56882cc4-c40d-4dc0-bf7c-db1b5a7acad0"]={f:Ops.Array.Array3GetNumbers,objName:"Ops.Array.Array3GetNumbers"};Ops.Gl.Shader.ShaderToTexture=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Render"),n=e.inObject("Shader",null,"shader"),a=e.inValueBool("Use Viewport Size",true),o=e.inValueInt("Width",512),l=e.inValueInt("Height",512),h=e.inValueSelect("filter",["nearest","linear","mipmap"]),u=e.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),c=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),f=e.inValueBool("Floating Point",false),d=e.inSwitch("Num Textures",["1","4"],"1"),r=e.outTrigger("Next"),s=e.outTexture("Texture"),g=e.outTexture("Texture 2"),p=e.outTexture("Texture 3"),m=e.outTexture("Texture 4");e.setPortGroup("Texture Size",[a,o,l]);e.setPortGroup("Texture settings",[h,c,f,u]);let _=1;const b=e.patch.cgl;const v=[0,0,0,0];const x=null;const E=[];let T=null;let A=null;o.onChange=l.onChange=f.onChange=h.onChange=d.onChange=u.onChange=c.onChange=N;a.onChange=y;const S=false;let I=null;const M=null;let C=true;const R=CGL.MESHES.getSimpleRect(b,"shader2texture rect");e.toWorkPortsNeedToBeLinked(n);h.set("nearest");y();function O(){if(h.get()=="mipmap"&&f.get()){e.setUiError("warning","HDR and mipmap filtering at the same time is not possible")}else{e.setUiError("warning",null)}}function y(){u.setUiAttribs({greyout:h.get()!="mipmap"});o.setUiAttribs({greyout:a.get()});l.setUiAttribs({greyout:a.get()});o.set(b.getViewPort()[2]);l.set(b.getViewPort()[3])}function N(){C=true;O()}function w(){if(A)A.dispose();T=null;A=null}function L(){C=false;if(I)I.delete();const e=E.length;_=parseInt(d.get());E.length=0;for(let e=0;e<_;e++)E[e]=true;if(e!=E.length){w()}I=null;let t=o.get();let i=l.get();if(a.get()){t=b.getViewPort()[2];i=b.getViewPort()[3]}let n=CGL.Texture.FILTER_NEAREST;if(h.get()=="linear")n=CGL.Texture.FILTER_LINEAR;else if(h.get()=="mipmap")n=CGL.Texture.FILTER_MIPMAP;let r=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(c.get()=="repeat")r=CGL.Texture.WRAP_REPEAT;if(c.get()=="mirrored repeat")r=CGL.Texture.WRAP_MIRRORED_REPEAT;const s=Math.min(b.maxAnisotropic,parseFloat(u.get()));if(b.glVersion>=2){I=new CGL.Framebuffer2(b,t,i,{anisotropic:s,isFloatingPointTexture:f.get(),multisampling:false,numRenderBuffers:_,wrap:r,filter:n,depth:true,multisamplingSamples:0,clear:true})}else{I=new CGL.Framebuffer(b,o.get(),l.get(),{isFloatingPointTexture:f.get(),filter:n,wrap:r})}}i.onTriggered=function(){const e=b.getViewPort();if(!I||C)L();if(a.get()&&I&&(e[2]!=I.getTextureColor().width||e[3]!=I.getTextureColor().height))L();if(!n.get()||!n.get().setDrawBuffers)return;if(n.get()!=T){T=n.get();A=n.get().copy();A.setDrawBuffers(E)}if(!A){s.set(null);return}v[0]=e[0];v[1]=e[1];v[2]=e[2];v[3]=e[3];I.renderStart(b);b.pushPMatrix();mat4.identity(b.pMatrix);b.pushViewMatrix();mat4.identity(b.vMatrix);b.pushModelMatrix();mat4.identity(b.mMatrix);b.pushShader(n.get());if(A.bindTextures)A.bindTextures();b.pushBlend(false);R.render(n.get());b.popBlend();b.popPMatrix();b.popModelMatrix();b.popViewMatrix();I.renderEnd(b);if(_>=2){s.set(I.getTextureColorNum(0));g.set(I.getTextureColorNum(1));p.set(I.getTextureColorNum(2));m.set(I.getTextureColorNum(3))}else s.set(I.getTextureColor());b.popShader();b.gl.viewport(v[0],v[1],v[2],v[3]);r.trigger()}}};CABLES.OPS["a3debb76-7d84-4548-9e7b-24891423dcce"]={f:Ops.Gl.Shader.ShaderToTexture,objName:"Ops.Gl.Shader.ShaderToTexture"};Ops.Math.MapRange=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const f=e.inValueFloat("value",0),d=e.inValueFloat("old min",0),g=e.inValueFloat("old max",1),p=e.inValueFloat("new min",0),m=e.inValueFloat("new max",1),i=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),n=e.inBool("Clamp",true),_=e.outNumber("result",0);e.setPortGroup("Input Range",[d,g]);e.setPortGroup("Output Range",[p,m]);let b=true;let v=0;let x=0;f.onChange=d.onChange=g.onChange=p.onChange=m.onChange=r;r();n.onChange=()=>{b=n.get();r()};i.onChange=function(){if(i.get()=="Smoothstep")v=1;else if(i.get()=="Smootherstep")v=2;else v=0};function r(){const e=p.get();const t=m.get();const i=d.get();const n=g.get();let r=f.get();if(b){if(r>=Math.max(n,i)){_.set(t);return}else if(r<=Math.min(n,i)){_.set(e);return}}let s=false;const a=Math.min(i,n);const o=Math.max(i,n);if(a!=i)s=true;let l=false;const h=Math.min(e,t);const u=Math.max(e,t);if(h!=e)l=true;let c=0;if(s)c=(o-r)*(u-h)/(o-a);else c=(r-a)*(u-h)/(o-a);if(l)x=u-c;else x=c+h;if(v===0){_.set(x)}else if(v==1){r=Math.max(0,Math.min(1,(x-e)/(t-e)));_.set(e+r*r*(3-2*r)*(t-e))}else if(v==2){r=Math.max(0,Math.min(1,(x-e)/(t-e)));_.set(e+r*r*r*(r*(r*6-15)+10)*(t-e))}}}};CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Ui.VizTexture=class extends CABLES.Op{constructor(){super(...arguments);const D=this;const i=D.attachments={viztex_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI samplerCube cubeMap;\nUNI float width;\nUNI float height;\nUNI float type;\nUNI float time;\nfloat LinearizeDepth(float d,float zNear,float zFar)\n{\nfloat z_n=2.*d-1.;\nreturn 2.*zNear/(zFar+zNear-z_n*(zFar-zNear));\n}\nvoid main()\n{\nvec4 col=vec4(vec3(0.),0.);\nvec4 colTex=texture(tex,texCoord);\nif(type==1.)\n{\nvec4 depth=vec4(0.);\nvec2 localST=texCoord;\nlocalST.y=1.-localST.y;\nlocalST.t=mod(localST.t*3.,1.);\nlocalST.s=mod(localST.s*4.,1.);\n#ifdef WEBGL2\n#define texCube texture\n#endif\n#ifdef WEBGL1\n#define texCube textureCube\n#endif\n\nif (texCoord.s*4.>1.&&texCoord.s*4.<2.)\n{\n\nif (texCoord.t*3.<1.)\n{\nvec3 dir=vec3(localST.s*2.-1.,-1.,-localST.t*2.+1.);\ndepth=texCube(cubeMap,dir);\n}\n\nelse if (texCoord.t*3.>2.)\n{\nvec3 dir=vec3(localST.s*2.-1.,1.,localST.t*2.-1.);\ndepth=texCube(cubeMap,dir);\n}\nelse\n{\nvec3 dir=vec3(localST.s*2.-1.,-localST.t*2.+1.,1.);\ndepth=texCube(cubeMap,dir);\n}\n}\n\nelse if (texCoord.t*3.>1.&&texCoord.t*3.<2.)\n{\nif (texCoord.x*4.<1.)\n{\nvec3 dir=vec3(-1.,-localST.t*2.+1.,localST.s*2.-1.);\ndepth=texCube(cubeMap,dir);\n}\nelse if (texCoord.x*4.<3.)\n{\nvec3 dir=vec3(1,-localST.t*2.+1.,-localST.s*2.+1.);\ndepth=texCube(cubeMap,dir);\n}\nelse \n{\nvec3 dir=vec3(-localST.s*2.+1.,-localST.t*2.+1.,-1.);\ndepth=texCube(cubeMap,dir);\n}\n}\n\ncolTex=vec4(depth);\n}\nif(type==2.)\n{\nfloat near=0.1;\nfloat far=50.;\nfloat depth=LinearizeDepth(colTex.r,near,far);\ncolTex.rgb=vec3(depth);\n}\n#ifdef ANIM_RANGE\nif(colTex.r>1.||colTex.r<0.)\ncolTex.r=mod(colTex.r,1.)*0.5+(sin(colTex.r+mod(colTex.r*3.,1.)+time*5.)*0.5+0.5)*0.5;\nif(colTex.g>1.||colTex.g<0.)\ncolTex.g=mod(colTex.g,1.)*0.5+(sin(colTex.g+mod(colTex.g*3.,1.)+time*5.)*0.5+0.5)*0.5;\nif(colTex.b>1.||colTex.b<0.)\ncolTex.b=mod(colTex.b,1.)*0.5+(sin(colTex.b+mod(colTex.b*3.,1.)+time*5.)*0.5+0.5)*0.5;\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#ifdef MOD_RANGE\ncolTex.r=mod(colTex.r,1.0001);\ncolTex.g=mod(colTex.g,1.0001);\ncolTex.b=mod(colTex.b,1.0001);\n#endif\n#ifdef ALPHA_ONE\ncolTex.a=1.;\n#endif\n#ifdef ALPHA_INV\ncolTex.a=1.-colTex.a;\n#endif\noutColor=mix(col,colTex,colTex.a);\n}\n",viztex_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nOUT vec2 texCoord;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nvoid main()\n{\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);\n    vec4 pos = vec4( vPosition, 1. );\n    mat4 mvMatrix=viewMatrix * modelMatrix;\n    gl_Position = projMatrix * mvMatrix * pos;\n}"};const k=D.inTexture("Texture In"),B=D.inBool("Show Info",false),e=D.inSwitch("Visualize outside 0-1",["Off","Anim","Modulo"],"Anim"),t=D.inSwitch("Alpha",["A","1","1-A"],"A"),U=D.inBool("Show Color",false),G=D.inFloatSlider("X",.5),j=D.inFloatSlider("Y",.5),n=D.outTexture("Texture Out"),H=D.outString("Info");D.setUiAttrib({height:150,resizable:true});const z=new CABLES.Timer;let r=null;let $=null;let W=null;let X="";let s=true;t.onChange=e.onChange=o;U.onChange=a;a();if(CABLES.UI){z.play()}function a(){G.setUiAttribs({greyout:!U.get()});j.setUiAttribs({greyout:!U.get()})}k.onChange=()=>{const e=k.get();n.setRef(e);let t="";if(k.get()&&k.isLinked())t=k.links[0].getOtherPort(k).name;D.setUiAttrib({extendTitle:t})};function o(){if(!r)return;r.toggleDefine("MOD_RANGE",e.get()=="Modulo");r.toggleDefine("ANIM_RANGE",e.get()=="Anim");r.toggleDefine("ALPHA_INV",t.get()=="1-A");r.toggleDefine("ALPHA_ONE",t.get()=="1")}D.renderVizLayerGl=(c,f)=>{if(!k.isLinked())return;if(!f.useGl)return;const d=k;const g=5;const p=g+1;const e=gui.uiProfiler.start("previewlayer texture");const m=d.op.patch.cgl;if(!this._emptyCubemap)this._emptyCubemap=CGL.Texture.getEmptyCubemapTexture(m);d.op.patch.cgl.profileData.profileTexPreviews++;const _=d.get()||CGL.Texture.getEmptyTexture(m);if(!this._mesh){const t=new CGL.Geometry("vizTexture rect");t.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];t.texCoords=[1,1,0,1,1,0,0,0];t.verticesIndices=[0,1,2,3,1,2];this._mesh=new CGL.Mesh(m,t)}if(!this._shader){this._shader=new CGL.Shader(m,"glpreviewtex");this._shader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);this._shader.setSource(i.viztex_vert,i.viztex_frag);this._shaderTexUniform=new CGL.Uniform(this._shader,"t","tex",g);this._shaderTexCubemapUniform=new CGL.Uniform(this._shader,"tc","cubeMap",p);r=this._shader;o();this._shaderTexUniformW=new CGL.Uniform(this._shader,"f","width",_.width);this._shaderTexUniformH=new CGL.Uniform(this._shader,"f","height",_.height);this._shaderTypeUniform=new CGL.Uniform(this._shader,"f","type",0);this._shaderTimeUniform=new CGL.Uniform(this._shader,"f","time",0)}m.pushPMatrix();const b=[_.width,_.height];const v=d.op.patch.cgl.canvasWidth>b[0]&&d.op.patch.cgl.canvasHeight>b[1];if(v){mat4.ortho(m.pMatrix,0,d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight,0,.001,11)}else mat4.ortho(m.pMatrix,-1,1,1,-1,.001,11);const x=m.getTexture(g);const E=m.getTexture(p);let T=0;if(_){if(_.cubemap)T=1;if(_.textureType==CGL.Texture.TYPE_DEPTH)T=2;if(T==0||T==2){m.setTexture(g,_.tex);m.setTexture(p,this._emptyCubemap.cubemap,m.gl.TEXTURE_CUBE_MAP)}else if(T==1){m.setTexture(p,_.cubemap,m.gl.TEXTURE_CUBE_MAP)}z.update();this._shaderTimeUniform.setValue(z.get());this._shaderTypeUniform.setValue(T);let t=[d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight];m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);m.pushModelMatrix();if(v){t=b;mat4.translate(m.mMatrix,m.mMatrix,[b[0]/2,b[1]/2,0]);mat4.scale(m.mMatrix,m.mMatrix,[b[0]/2,b[1]/2,0])}this._mesh.render(this._shader);m.popModelMatrix();if(T==0)m.setTexture(g,x);if(T==1)m.setTexture(p,E);m.popPMatrix();m.resetViewPort();const A=[f.width,f.height];const S=false;if(_.width>_.height)A[1]=f.width*b[1]/b[0];else{A[1]=f.width*(b[1]/b[0]);if(A[1]>f.height){const R=f.height/A[1];A[0]*=R;A[1]*=R}}const I=A[0]>b[0]&&A[1]>b[1];c.imageSmoothingEnabled=true;c.fillStyle="#ffffff";c.fillRect(f.x,f.y-10,10,10);c.fillStyle="#000000";c.fillRect(f.x,f.y-10,5,5);c.fillRect(f.x+5,f.y-10+5,5,5);let e=f.height;let i=10*f.width/e*f.scale*2;let n=i*f.height/f.width;let r=e/n;let s=f.width/i;for(let t=0;t<i+1;t++)for(let e=0;e<n+1;e++){if((t+e)%2==0)c.fillStyle="#333333";else c.fillStyle="#393939";c.fillRect(f.x-f.x%s*2+s*t,f.y-f.y%s*2+r*e,s,r)}c.fillStyle="#222";const M=(f.width-A[0])/2;const C=(e-A[1])/2;let a=f.x+(f.width-A[0])/2;let o=f.y+(e-A[1])/2;let l=A[0];let h=A[1];if(e-A[1]<0){a=f.x+(f.width-A[0]*e/A[1])/2;o=f.y;l=A[0]*e/A[1];h=e}c.fillRect(f.x,f.y,a-f.x,e);c.fillRect(f.x+l+a-f.x,f.y,l,e);c.fillRect(f.x,f.y,f.width,C);c.fillRect(f.x,f.y+A[1]+C,f.width,C);if(m.canvas&&m.canvasWidth>0&&m.canvasHeight>0&&m.canvas.width>0&&m.canvas.height>0){try{const O=l/t[0]>3||h/t[1]>3;const y=l/t[0]>10||h/t[1]>10;if(b[1]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(b[0]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(A[0]!=0&&A[1]!=0&&f.width!=0&&e!=0&&l!=0&&h!=0){c.imageSmoothingEnabled=!O;c.drawImage(m.canvas,0,0,t[0],t[1],a,o,l,h)}if(y){const N=l/t[0];const w=h/t[1];c.imageSmoothingEnabled=true;c.lineWidth=1;c.globalAlpha=.5;c.beginPath();for(let e=0;e<=t[0];e++){c.moveTo(a+e*N,o);c.lineTo(a+e*N,o+h)}for(let e=0;e<=t[1];e++){c.moveTo(a,o+e*w);c.lineTo(a+l,o+e*w)}c.strokeStyle="#555";c.stroke();c.globalAlpha=1}}catch(e){console.error("canvas drawimage exception...",e)}}let u="";if(B.get()&&d.get()&&d.get().getInfoOneLine)u+=d.get().getInfoOneLine()+"\n";H.set(u);if(U.get()){u+=X+"\n";const L=a+l*G.get();const P=o+h*j.get();for(let e=0;e<2;e++){if(e==0)c.fillStyle="#000";else c.fillStyle="#fff";c.fillRect(L-1+e,P-10+e,1,20);c.fillRect(L-10+e,P-1+e,20,1)}}if(B.get()||U.get()){D.setUiAttrib({comment:u})}if(U.get()){const F=m.gl;const V=k.get();if(!V){X="";return}if(!$)$=F.createFramebuffer();if(!W)W=new CGL.PixelReader;F.bindFramebuffer(F.FRAMEBUFFER,$);F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,V.tex,0);F.bindFramebuffer(F.FRAMEBUFFER,null);W.read(m,$,V.pixelFormat,G.get()*V.width,V.height-j.get()*V.height,1,1,e=>{if(!CGL.Texture.isPixelFormatFloat(V.pixelFormat)){X="Pixel Float: "+Math.floor(e[0]/255*100)/100;if(!isNaN(e[1]))X+=", "+Math.floor(e[1]/255*100)/100;if(!isNaN(e[2]))X+=", "+Math.floor(e[2]/255*100)/100;if(!isNaN(e[3]))X+=", "+Math.floor(e[3]/255*100)/100;X+="\n";if(V.pixelFormat.indexOf("ubyte")>0){X+="Pixel UByte: ";X+=Math.round(e[0]);if(!isNaN(e[1]))X+=", "+Math.round(e[1]);if(!isNaN(e[2]))X+=", "+Math.round(e[2]);if(!isNaN(e[3]))X+=", "+Math.round(e[3]);X+="\n"}}else{X="Pixel Float: "+Math.round(e[0]*100)/100+", "+Math.round(e[1]*100)/100+", "+Math.round(e[2]*100)/100+", "+Math.round(e[3]*100)/100;X+="\n"}})}}m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);e.finish()}}};CABLES.OPS["4ea2d7b0-ca74-45db-962b-4d1965ac20c0"]={f:Ops.Ui.VizTexture,objName:"Ops.Ui.VizTexture"};Ops.Trigger.TriggerOnce=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Exec"),n=e.inTriggerButton("Reset"),r=e.outTrigger("Next"),s=e.outBoolNum("Was Triggered");let a=false;e.toWorkPortsNeedToBeLinked(i);n.onTriggered=function(){a=false;s.set(a)};i.onTriggered=function(){if(a)return;a=true;r.trigger();s.set(a)}}};CABLES.OPS["cf3544e4-e392-432b-89fd-fcfb5c974388"]={f:Ops.Trigger.TriggerOnce,objName:"Ops.Trigger.TriggerOnce"};Ops.Trigger.TriggerSend=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTriggerButton("Trigger"),i=n.outTrigger("Next");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.onChange=s;t.onTriggered=a;n.patch.addEventListener("namedTriggersChanged",r);r();n.varName.setUiAttribs({_triggerSelect:true});function r(){if(CABLES.UI){let e=[];const t=n.patch.namedTriggers;e.push("+ create new one");for(const i in t)e.push(i);e=e.sort();n.varName.uiAttribs.values=e}}function s(){if(CABLES.UI){if(n.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"Enter a name for the new trigger",promptValue:"",promptOk:e=>{n.varName.set(e);n.patch.namedTriggers[e]=n.patch.namedTriggers[e]||[];r()}});return}n.refreshParams()}if(!n.patch.namedTriggers[n.varName.get()]){n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];n.patch.emitEvent("namedTriggersChanged")}n.setTitle(">"+n.varName.get());n.refreshParams();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())}function a(){const t=n.patch.namedTriggers[n.varName.get()];n.patch.emitEvent("namedTriggerSent",n.varName.get());if(!t){n.setUiError("unknowntrigger","unknown trigger");return}else n.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}i.trigger()}}};CABLES.OPS["ce1eaf2b-943b-4dc0-ab5e-ee11b63c9ed0"]={f:Ops.Trigger.TriggerSend,objName:"Ops.Trigger.TriggerSend"};Ops.Trigger.TriggerReceive=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.outTrigger("Triggered");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.setUiAttribs({_triggerSelect:true});s();n.patch.addEventListener("namedTriggersChanged",s);let i=null;function r(){t.trigger()}function s(){if(CABLES.UI){let t=[];let i=n.patch.namedTriggers;for(let e in i)t.push(e);t=t.sort();n.varName.uiAttribs.values=t}}n.varName.onChange=function(){if(i){let e=n.patch.namedTriggers[i];let t=e.indexOf(r);if(t!=-1)e.splice(t,1)}n.setTitle(">"+n.varName.get());n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];let e=n.patch.namedTriggers[n.varName.get()];e.push(r);i=n.varName.get();a();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())};n.on("uiParamPanel",a);function a(){if(!n.varName.get()){n.setUiError("unknowntrigger","unknown trigger")}else n.setUiError("unknowntrigger",null)}}};CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Cables.LoadingStatus_v2=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTrigger("exe"),r=n.inBool("Play Timeline",true),i=n.outTrigger("Next"),s=n.outBoolNum("Finished Initial Loading",false),a=n.outBoolNum("Loading"),o=n.outNumber("Progress"),l=n.outArray("Jobs"),h=n.outTrigger("Trigger Loading Finished ");n.toWorkPortsNeedToBeLinked(t);const u=n.patch;let c=false;const f=[];let d=true;let g=0;document.body.classList.add("cables-loading");let p=u.loading.start("loadingStatusInit","loadingStatusInit",n);n.patch.loading.on("finishedTask",m.bind(this));n.patch.loading.on("startTask",m.bind(this));function m(){const e=n.patch.loading.getListJobs();o.set(u.loading.getProgress());let t=e.length===0;const i=!t;if(i){l.set(n.patch.loading.getListJobs())}if(i){if(d){n.patch.timer.setTime(0);if(r.get()){n.patch.timer.play()}else{n.patch.timer.pause()}}d=false;document.body.classList.remove("cables-loading");document.body.classList.add("cables-loaded")}else{c=true;l.set(n.patch.loading.getListJobs());if(u.loading.getProgress()<1){n.patch.timer.setTime(0);n.patch.timer.pause()}}s.set(c);if(a.get()&&t)h.trigger();a.set(i);n.setUiAttribs({loading:i})}t.onTriggered=()=>{m();i.trigger();if(p){u.loading.finished(p);p=null}}}};CABLES.OPS["e62f7f4c-7436-437e-8451-6bc3c28545f7"]={f:Ops.Cables.LoadingStatus_v2,objName:"Ops.Cables.LoadingStatus_v2"};Ops.Trigger.GateTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),n=e.inValueBool("Pass Through",true),r=e.outTrigger("Trigger out");i.onTriggered=function(){if(n.get())r.trigger()}}};CABLES.OPS["65e8b8a2-ba13-485f-883a-2bcf377989da"]={f:Ops.Trigger.GateTrigger,objName:"Ops.Trigger.GateTrigger"};Ops.Boolean.Not=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("Boolean"),n=e.outBoolNum("Result");i.changeAlways=true;i.onChange=function(){n.set(!i.get())}}};CABLES.OPS["6d123c9f-7485-4fd9-a5c2-76e59dcbeb34"]={f:Ops.Boolean.Not,objName:"Ops.Boolean.Not"};Ops.Anim.TimeDelta=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("exe"),n=e.inValueBool("Smooth",false),r=e.inValueBool("Seconds",false),s=e.outTrigger("trigger"),a=e.outNumber("result");let o=CABLES.now();let l=0;let h=-1;i.onTriggered=function(){l=CABLES.now()-o;if(r.get())l/=1e3;if(n.get()){if(h==-1)h=l;else{h=h*.8+l*.2;l=h}}a.set(l);o=CABLES.now();s.trigger()};i.onTriggered()}};CABLES.OPS["fba0e516-b50e-4372-9a0c-dc605669ffed"]={f:Ops.Anim.TimeDelta,objName:"Ops.Anim.TimeDelta"};Ops.Gl.ImageCompose.ImageCompose_v3=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={imgcomp_frag:"IN vec2 texCoord;\nUNI vec4 bgColor;\nUNI sampler2D tex;\n#ifdef USE_UVTEX\nUNI sampler2D UVTex;\n#endif\nvoid main()\n{\n#ifndef USE_TEX\noutColor=bgColor;\n#endif\n#ifdef USE_TEX\n#ifndef USE_UVTEX\noutColor=texture(tex,texCoord);\n#else\noutColor=texture(tex,texture(UVTex,texCoord).xy);\n#endif\n#endif\n}\n"};const n=i.patch.cgl,t=i.inTrigger("Render"),r=i.inTexture("Base Texture"),s=i.inTexture("UV Texture"),a=i.inSwitch("Size",["Auto","Manual"],"Auto"),o=i.inValueInt("Width",640),l=i.inValueInt("Height",480),h=i.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),u=i.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),c=i.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),f=i.inValueSlider("R",0),d=i.inValueSlider("G",0),g=i.inValueSlider("B",0),p=i.inValueSlider("A",0),m=i.outTrigger("Next"),_=i.outTexture("texture_out",CGL.Texture.getEmptyTexture(n)),b=i.outNumber("Aspect Ratio"),v=i.outNumber("Texture Width"),F=i.outNumber("Texture Height");i.setPortGroup("Texture Size",[a,o,l]);i.setPortGroup("Texture Parameters",[u,h,c]);f.setUiAttribs({colorPick:true});i.setPortGroup("Color",[f,d,g,p]);i.toWorkPortsNeedToBeLinked(t);const x=[0,0,0,0];let E=null;let T=null;let A=true;let V=false;let S=null;let D=null;let k=null;let B=null;u.onChange=h.onChange=c.onChange=U;r.onLinkChanged=a.onChange=s.onChange=w;t.onTriggered=i.preRender=P;w();function I(){if(E)E.delete();if(T)T.delete();E=new CGL.TextureEffect(n,{isFloatingPointTexture:CGL.Texture.isPixelFormatFloat(c.get())});T=new CGL.Texture(n,{name:"image_compose_v2_"+i.id,isFloatingPointTexture:CGL.Texture.isPixelFormatFloat(c.get()),pixelFormat:c.get(),filter:M(),wrap:C(),width:R(),height:O()});E.setSourceTexture(T);v.set(R());F.set(O());b.set(R()/O());_.set(CGL.Texture.getEmptyTexture(n));A=false;w()}function M(){if(h.get()=="nearest")return CGL.Texture.FILTER_NEAREST;else if(h.get()=="linear")return CGL.Texture.FILTER_LINEAR;else if(h.get()=="mipmap")return CGL.Texture.FILTER_MIPMAP}function C(){if(u.get()=="repeat")return CGL.Texture.WRAP_REPEAT;else if(u.get()=="mirrored repeat")return CGL.Texture.WRAP_MIRRORED_REPEAT;else if(u.get()=="clamp to edge")return CGL.Texture.WRAP_CLAMP_TO_EDGE}function R(){if(r.get()&&a.get()=="Auto")return r.get().width;if(a.get()=="Auto")return n.getViewPort()[2];return Math.ceil(o.get())}function O(){if(r.get()&&a.get()=="Auto")return r.get().height;else if(a.get()=="Auto")return n.getViewPort()[3];else return Math.ceil(l.get())}function U(){A=true}function G(){if((R()!=T.width||O()!=T.height||T.pixelFormat!=c.get()||T.filter!=M()||T.wrap!=C())&&(R()!==0&&O()!==0)){I();E.setSourceTexture(T);_.set(CGL.Texture.getEmptyTexture(n));_.set(T);y();L()}}function y(){let e=null;if(a.get()=="Manual"){e=null}else if(a.get()=="Auto"){if(r.get())e="Input Texture";else e="Canvas Size";e+=": "+R()+" x "+O()}let t=false;t=a.uiAttribs.info!=e;a.setUiAttribs({info:e});if(t)i.refreshParams()}function N(){if(S)S.toggleDefine("USE_TEX",r.isLinked());if(S)S.toggleDefine("USE_UVTEX",s.isLinked())}function w(){f.setUiAttribs({greyout:r.isLinked()});g.setUiAttribs({greyout:r.isLinked()});d.setUiAttribs({greyout:r.isLinked()});p.setUiAttribs({greyout:r.isLinked()});o.setUiAttribs({greyout:a.get()=="Auto"});l.setUiAttribs({greyout:a.get()=="Auto"});o.setUiAttribs({hideParam:a.get()!="Manual"});l.setUiAttribs({hideParam:a.get()!="Manual"});if(T)if(CGL.Texture.isPixelFormatFloat(c.get())&&M()==CGL.Texture.FILTER_MIPMAP)i.setUiError("fpmipmap","Don't use mipmap and 32bit at the same time, many systems do not support this.");else i.setUiError("fpmipmap",null);y();N();L()}function L(){if(T)if(r.isLinked()&&r.get()&&T.textureType!=r.get().textureType&&(T.textureType!=CGL.Texture.TYPE_FLOAT||r.get().textureType==CGL.Texture.TYPE_FLOAT))i.setUiError("textypediff","Drawing 32bit texture into an 8 bit can result in data/precision loss",1);else i.setUiError("textypediff",null)}i.preRender=()=>{P()};function j(){if(!S){S=new CGL.Shader(n,"copytextureshader");S.setSource(S.getDefaultVertexShader(),e.imgcomp_frag);D=new CGL.Uniform(S,"t","tex",0);k=new CGL.Uniform(S,"t","UVTex",1);B=new CGL.Uniform(S,"4f","bgColor",f,d,g,p);N()}n.pushShader(S);n.currentTextureEffect.bind();if(r.get())n.setTexture(0,r.get().tex);if(s.get())n.setTexture(1,s.get().tex);n.currentTextureEffect.finish();n.popShader()}function P(){if(!E||A)I();const e=n.getViewPort();x[0]=e[0];x[1]=e[1];x[2]=e[2];x[3]=e[3];n.pushBlend(false);G();const t=n.currentTextureEffect;n.currentTextureEffect=E;n.currentTextureEffect.imgCompVer=3;n.currentTextureEffect.width=o.get();n.currentTextureEffect.height=l.get();E.setSourceTexture(T);E.startEffect(r.get()||CGL.Texture.getEmptyTexture(n,V),true);j();m.trigger();_.setRef(E.getCurrentSourceTexture());E.endEffect();n.setViewPort(x[0],x[1],x[2],x[3]);n.popBlend(false);n.currentTextureEffect=t}}};CABLES.OPS["e890a050-11b7-456e-b09b-d08cd9c1ee41"]={f:Ops.Gl.ImageCompose.ImageCompose_v3,objName:"Ops.Gl.ImageCompose.ImageCompose_v3"};Ops.Gl.ImageCompose.Color_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={color_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\nUNI float amount;\n#ifdef MASK\nUNI sampler2D mask;\n#endif\n{{CGL.BLENDMODES3}}\nvoid main()\n{\nvec4 col=vec4(r,g,b,a);\nvec4 base=texture(tex,texCoord);\nfloat am=amount;\n#ifdef MASK\nfloat msk=texture(mask,texCoord).r;\n#ifdef INVERTMASK\nmsk=1.-msk;\n#endif\nam*=1.-msk;\n#endif\noutColor=cgl_blendPixel(base,col,am);\n}\n"};const i=e.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(e),r=e.inValueSlider("Amount",1),s=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inTexture("Mask"),o=e.inValueBool("Mask Invert"),l=e.inValueSlider("r",Math.random()),h=e.inValueSlider("g",Math.random()),u=e.inValueSlider("b",Math.random()),c=e.inValueSlider("A",1),f=e.outTrigger("trigger");l.setUiAttribs({colorPick:true});e.setPortGroup("Color",[l,h,u]);const d=0;const g=e.patch.cgl;const p=new CGL.Shader(g,"textureeffect color");const m=t.color_frag||"";p.setSource(p.getDefaultVertexShader(),m);CGL.TextureEffect.setupBlending(e,p,n,r,s);const _=new CGL.Uniform(p,"t","tex",d),b=new CGL.Uniform(p,"t","mask",1),v=new CGL.Uniform(p,"f","r",l),x=new CGL.Uniform(p,"f","g",h),E=new CGL.Uniform(p,"f","b",u),T=new CGL.Uniform(p,"f","a",c),A=new CGL.Uniform(p,"f","amount",r);a.onChange=function(){if(a.isLinked())p.define("MASK");else p.removeDefine("MASK")};o.onChange=function(){if(o.get())p.define("INVERTMASK");else p.removeDefine("INVERTMASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;g.pushShader(p);g.currentTextureEffect.bind();g.setTexture(d,g.currentTextureEffect.getCurrentSourceTexture().tex);if(a.get())g.setTexture(1,a.get().tex);g.currentTextureEffect.finish();g.popShader();f.trigger()}}};CABLES.OPS["6dada2b7-da7c-47ee-87a9-a12e87055208"]={f:Ops.Gl.ImageCompose.Color_v2,objName:"Ops.Gl.ImageCompose.Color_v2"};Ops.Math.OneMinus=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Value"),n=e.outNumber("Result");i.onChange=r;r();function r(){n.set(1-i.get())}}};CABLES.OPS["f34d019d-59ae-40d6-a55d-a7691bbc40e0"]={f:Ops.Math.OneMinus,objName:"Ops.Math.OneMinus"};Ops.Math.Sum=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",0),n=e.inValueFloat("number2",0),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){const e=i.get()+n.get();if(!isNaN(e))r.set(e)}}};CABLES.OPS["c8fb181e-0b03-4b41-9e55-06b6267bc634"]={f:Ops.Math.Sum,objName:"Ops.Math.Sum"};Ops.Gl.ImageCompose.DrawImage_v3=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={drawimage_frag:"#ifdef HAS_TEXTURES\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D image;\n#endif\n#ifdef TEX_TRANSFORM\nIN mat3 transform;\n#endif\n\n{{CGL.BLENDMODES}}\n#ifdef HAS_TEXTUREALPHA\nUNI sampler2D imageAlpha;\n#endif\nUNI float amount;\n#ifdef ASPECT_RATIO\nUNI float aspectTex;\nUNI float aspectPos;\n#endif\nvoid main()\n{\nvec4 blendRGBA=vec4(0.,0.,0.,1.);\n#ifdef HAS_TEXTURES\nvec2 tc=texCoord;\n#ifdef TEX_FLIP_X\ntc.x=1.-tc.x;\n#endif\n#ifdef TEX_FLIP_Y\ntc.y=1.-tc.y;\n#endif\n#ifdef ASPECT_RATIO\n#ifdef ASPECT_AXIS_X\ntc.y=(1.-aspectPos)-(((1.-aspectPos)-tc.y)*aspectTex);\n#endif\n#ifdef ASPECT_AXIS_Y\ntc.x=(1.-aspectPos)-(((1.-aspectPos)-tc.x)/aspectTex);\n#endif\n#endif\n#ifdef TEX_TRANSFORM\nvec3 coordinates=vec3(tc.x,tc.y,1.);\ntc=(transform*coordinates).xy;\n#endif\nblendRGBA=texture(image,tc);\nvec3 blend=blendRGBA.rgb;\nvec4 baseRGBA=texture(tex,texCoord);\nvec3 base=baseRGBA.rgb;\n#ifdef PREMUL\nblend.rgb=(blend.rgb)+(base.rgb*(1.-blendRGBA.a));\n#endif\nvec3 colNew=_blend(base,blend);\n#ifdef REMOVE_ALPHA_SRC\nblendRGBA.a=1.;\n#endif\n#ifdef HAS_TEXTUREALPHA\nvec4 colImgAlpha=texture(imageAlpha,tc);\nfloat colImgAlphaAlpha=colImgAlpha.a;\n#ifdef ALPHA_FROM_LUMINANCE\nvec3 gray=vec3(dot(vec3(0.2126,0.7152,0.0722),colImgAlpha.rgb));\ncolImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.;\n#endif\n#ifdef ALPHA_FROM_INV_UMINANCE\nvec3 gray=vec3(dot(vec3(0.2126,0.7152,0.0722),colImgAlpha.rgb));\ncolImgAlphaAlpha=1.-(gray.r+gray.g+gray.b)/3.;\n#endif\n#ifdef INVERT_ALPHA\ncolImgAlphaAlpha=clamp(colImgAlphaAlpha,0.,1.);\ncolImgAlphaAlpha=1.-colImgAlphaAlpha;\n#endif\nblendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n#endif\n#endif\nfloat am=amount;\n#ifdef CLIP_REPEAT\nif(tc.y>1.||tc.y<0.||tc.x>1.||tc.x<0.)\n{\n\nam=0.;\n}\n#endif\n#ifdef ASPECT_RATIO\n#ifdef ASPECT_CROP\nif(tc.y>1.||tc.y<0.||tc.x>1.||tc.x<0.)\n{\ncolNew.rgb=base.rgb;\nam=0.;\n}\n#endif\n#endif\n#ifndef PREMUL\nblendRGBA.rgb=mix(colNew,base,1.-(am*blendRGBA.a));\nblendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n#endif\n#ifdef PREMUL\n\n\nblendRGBA=vec4(\nmix(colNew.rgb,base,1.-(am*blendRGBA.a)),\nblendRGBA.a*am+baseRGBA.a\n);\n#endif\n#ifdef ALPHA_MASK\nblendRGBA.a=baseRGBA.a;\n#endif\noutColor=blendRGBA;\n}\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=n.inTrigger("render"),i=CGL.TextureEffect.AddBlendSelect(n,"blendMode"),r=n.inValueSlider("amount",1),s=n.inTexture("Image"),a=n.inValueBool("Premultiplied",false),o=n.inValueBool("Alpha Mask",false),l=n.inValueBool("removeAlphaSrc",false),h=n.inTexture("Mask"),u=n.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance"),c=n.inBool("Invert alpha channel"),f=n.inValueBool("Aspect Ratio",false),d=n.inValueSelect("Stretch Axis",["X","Y"],"X"),g=n.inValueSlider("Position",0),p=n.inValueBool("Crop",false),m=n.outTrigger("trigger");i.set("normal");const _=n.patch.cgl;const b=new CGL.Shader(_,"drawimage");h.onLinkChanged=v;n.setPortGroup("Aspect Ratio",[f,g,p,d]);n.setPortGroup("Mask",[h,u,c]);function v(){if(h.isLinked()){l.setUiAttribs({greyout:true});u.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false})}else{l.setUiAttribs({greyout:false});u.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true})}}n.toWorkPortsNeedToBeLinked(s);b.setSource(e.drawimage_vert,e.drawimage_frag);const x=new CGL.Uniform(b,"t","tex",0),F=new CGL.Uniform(b,"t","image",1),V=new CGL.Uniform(b,"t","imageAlpha",2),E=new CGL.Uniform(b,"f","aspectTex",1),D=new CGL.Uniform(b,"f","aspectPos",g);f.onChange=p.onChange=d.onChange=T;function T(){b.removeDefine("ASPECT_AXIS_X");b.removeDefine("ASPECT_AXIS_Y");b.removeDefine("ASPECT_CROP");g.setUiAttribs({greyout:!f.get()});p.setUiAttribs({greyout:!f.get()});d.setUiAttribs({greyout:!f.get()});if(f.get()){b.define("ASPECT_RATIO");if(p.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}else{b.removeDefine("ASPECT_RATIO");if(p.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}}const A=n.inValueBool("flip x");const S=n.inValueBool("flip y");let I=n.inValueBool("Transform");let M=n.inValueSlider("Scale X",1);let C=n.inValueSlider("Scale Y",1);let R=n.inValue("Position X",0);let O=n.inValue("Position Y",0);let y=n.inValue("Rotation",0);const N=n.inValueBool("Clip Repeat",false);const k=new CGL.Uniform(b,"f","scaleX",M);const B=new CGL.Uniform(b,"f","scaleY",C);const U=new CGL.Uniform(b,"f","posX",R);const G=new CGL.Uniform(b,"f","posY",O);const j=new CGL.Uniform(b,"f","rotate",y);I.onChange=w;function w(){b.toggleDefine("TEX_TRANSFORM",I.get());M.setUiAttribs({greyout:!I.get()});C.setUiAttribs({greyout:!I.get()});R.setUiAttribs({greyout:!I.get()});O.setUiAttribs({greyout:!I.get()});y.setUiAttribs({greyout:!I.get()})}CGL.TextureEffect.setupBlending(n,b,i,r);const H=new CGL.Uniform(b,"f","amount",r);t.onTriggered=P;N.onChange=h.onChange=a.onChange=o.onChange=c.onChange=S.onChange=A.onChange=l.onChange=u.onChange=L;w();v();T();L();function L(){b.toggleDefine("REMOVE_ALPHA_SRC",l.get());b.toggleDefine("ALPHA_MASK",o.get());b.toggleDefine("CLIP_REPEAT",N.get());b.toggleDefine("HAS_TEXTUREALPHA",h.get()&&h.get().tex);b.toggleDefine("TEX_FLIP_X",A.get());b.toggleDefine("TEX_FLIP_Y",S.get());b.toggleDefine("INVERT_ALPHA",c.get());b.toggleDefine("ALPHA_FROM_LUMINANCE",u.get()=="luminance");b.toggleDefine("ALPHA_FROM_INV_UMINANCE",u.get()=="luminance_inv");b.toggleDefine("PREMUL",a.get())}function P(){if(!CGL.TextureEffect.checkOpInEffect(n))return;const e=s.get();if(e&&e.tex&&r.get()>0){_.pushShader(b);_.currentTextureEffect.bind();const t=_.currentTextureEffect.getCurrentSourceTexture();_.setTexture(0,t.tex);const i=1/(_.currentTextureEffect.getWidth()/_.currentTextureEffect.getHeight())*(e.width/e.height);E.setValue(i);_.setTexture(1,e.tex);if(h.get()&&h.get().tex){_.setTexture(2,h.get().tex)}_.pushBlendMode(CGL.BLEND_NONE,true);_.currentTextureEffect.finish();_.popBlendMode();_.popShader()}m.trigger()}}};CABLES.OPS["8f6b2f15-fcb0-4597-90c0-e5173f2969fe"]={f:Ops.Gl.ImageCompose.DrawImage_v3,objName:"Ops.Gl.ImageCompose.DrawImage_v3"};Ops.Vars.VarSetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTexture("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"object",i,e.varName)}};CABLES.OPS["4fbfc71e-1429-439f-8591-ad35961252ed"]={f:Ops.Vars.VarSetTexture_v2,objName:"Ops.Vars.VarSetTexture_v2"};Ops.Vars.VarGetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outTexture("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"object",e.varName,i)}};CABLES.OPS["5f8ce5fc-9787-45c9-9a83-0eebd2c6de15"]={f:Ops.Vars.VarGetTexture_v2,objName:"Ops.Vars.VarGetTexture_v2"};Ops.Vars.VarGetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outNumber("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,i)}};CABLES.OPS["421f5b52-c0fa-47c4-8b7a-012b9e1c864a"]={f:Ops.Vars.VarGetNumber_v2,objName:"Ops.Vars.VarGetNumber_v2"};Ops.Gl.Meshes.FullscreenRectangle=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\nvoid main()\n{\noutColor=texture(tex,texCoord);\n}\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),n=e.inSwitch("Scale",["Stretch","Fit"],"Fit"),r=e.inValueBool("Flip Y"),s=e.inValueBool("Flip X"),a=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let h=null;let u=new CGL.Geometry("fullscreen rectangle");let c=0,f=0,d=0,g=0,p=0;e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);e.toWorkPortsNeedToBeLinked(i);s.onChange=I;r.onChange=I;i.onTriggered=S;a.onLinkChanged=E;n.onChange=A;const m=new CGL.Shader(l,"fullscreenrectangle",this);m.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setSource(t.shader_vert,t.shader_frag);m.fullscreenRectUniform=new CGL.Uniform(m,"t","tex",0);m.aspectUni=new CGL.Uniform(m,"f","aspectTex",0);let _=false;let b=true;let v=false;let x=[];E();A();e.onDelete=function(){if(h)h.dispose()};a.onChange=function(){b=true};function E(){if(!CABLES.UI)return;r.setUiAttribs({greyout:!a.isLinked()});s.setUiAttribs({greyout:!a.isLinked()});n.setUiAttribs({greyout:!a.isLinked()})}function T(){let e=a.get();if(e)_=true;else _=false}e.preRender=function(){T();m.bind();if(h)h.render(m);S()};function A(){v=n.get()=="Fit"}function S(){if(l.getViewPort()[2]!=g||l.getViewPort()[3]!=p||!h)M();if(b)T();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,g,p,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(v&&a.get()){const i=a.get().width/a.get().height;let e=p;let t=p*i;if(t>g){e=g*1/i;t=g}x[0]=l.getViewPort()[0];x[1]=l.getViewPort()[1];x[2]=l.getViewPort()[2];x[3]=l.getViewPort()[3];l.setViewPort((g-t)/2,(p-e)/2,t,e)}if(_){if(a.get())l.setTexture(0,a.get().tex);h.render(m)}else{h.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(v&&a.get())l.setViewPort(x[0],x[1],x[2],x[3]);o.trigger()}function I(){h=null}function M(){const e=l.getViewPort();if(e[2]==g&&e[3]==p&&h)return;let t=0,i=0;g=e[2];p=e[3];u.vertices=new Float32Array([t+g,i+p,0,t,i+p,0,t+g,i,0,t,i,0]);let n=null;if(r.get())n=new Float32Array([1,0,0,0,1,1,0,1]);else n=new Float32Array([1,1,0,1,1,0,0,0]);if(s.get()){n[0]=0;n[2]=1;n[4]=0;n[6]=1}u.setTexCoords(n);u.verticesIndices=new Uint16Array([2,1,0,3,1,2]);u.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);u.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);u.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!h)h=new CGL.Mesh(l,u);else h.setGeom(u)}}};CABLES.OPS["255bd15b-cc91-4a12-9b4e-53c710cbb282"]={f:Ops.Gl.Meshes.FullscreenRectangle,objName:"Ops.Gl.Meshes.FullscreenRectangle"};Ops.Array.ArrayMultiply=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const n=e.inArray("In"),r=e.inValue("Value",1),s=e.outArray("Result");let a=[];s.set(a);n.onChange=r.onChange=n.onChange=function(){let t=n.get();if(!t)return;let i=r.get();if(a.length!=t.length)a.length=t.length;for(let e=0;e<t.length;e++)a[e]=t[e]*i;s.setRef(a)};n.onLinkChanged=()=>{if(n)n.copyLinkedUiAttrib("stride",s)}}};CABLES.OPS["a01c344b-4129-4b01-9c8f-36cefe86d7cc"]={f:Ops.Array.ArrayMultiply,objName:"Ops.Array.ArrayMultiply"};Ops.Extension.Deprecated.HSBtoRGB=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const u=e.inValueSlider("Hue"),c=e.inValueSlider("Saturation",1),f=e.inValueSlider("Brightness",.5),d=e.outNumber("R"),g=e.outNumber("G"),p=e.outNumber("B");u.onChange=c.onChange=f.onChange=i;i();function i(){let e=u.get();let t=c.get();let i=f.get();let n=(1-Math.abs(2*i-1))*t;let r=e*6;let s=n*(1-Math.abs(r%2-1));r=Math.floor(r)||0;let a=0;let o=0;let l=0;if(r===0){a=n;o=s;l=0}else if(r===1){a=s;o=n;l=0}else if(r===2){a=0;o=n;l=s}else if(r===3){a=0;o=s;l=n}else if(r===4){a=s;o=0;l=n}else if(r>=5){a=n;o=0;l=s}let h=i-n/2;a+=h;o+=h;l+=h;d.set(a);g.set(o);p.set(l)}}};CABLES.OPS["909ee871-b0f3-477f-bee2-d0ab40bb5804"]={f:Ops.Extension.Deprecated.HSBtoRGB,objName:"Ops.Extension.Deprecated.HSBtoRGB"};Ops.Anim.Timer_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValue("Speed",1),i=e.inValueBool("Play",true),n=e.inTriggerButton("Reset"),r=e.inValueBool("Sync to timeline",false),a=e.outNumber("Time");e.setPortGroup("Controls",[i,n,s]);const o=new CABLES.Timer;let l=null;let h=0;let u=false;i.onChange=c;c();function c(){if(i.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}n.onTriggered=f;function f(){h=0;l=null;o.setTime(0);a.set(0)}r.onChange=function(){u=r.get();i.setUiAttribs({greyout:u});n.setUiAttribs({greyout:u})};e.onAnimFrame=function(e,t,i){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){a.set(CABLES.overwriteTime*s.get())}else if(u){a.set(e*s.get())}else{o.update();const n=o.get();if(l===null){l=n;return}const r=Math.abs(n-l);l=n;h+=r*s.get();if(h!=h)h=0;a.set(h)}}}}};CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Math.Modulo=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),n=e.inValueFloat("number2",2),r=e.inValueBool("pingpong"),s=e.outNumber("result");let a=l;i.onChange=n.onChange=o;r.onChange=u;o();function o(){let e=n.get();let t=i.get();s.set(a(t,e))}function l(e,t){let i=(e%t+t)%t;if(i!=i)i=0;return i}function h(e,t){let i=2*t;e%=i;if(e>=t)return i-e;else return e}function u(){if(r.get())a=h;else a=l}}};CABLES.OPS["ebc13b25-3705-4265-8f06-5f985b6a7bb1"]={f:Ops.Math.Modulo,objName:"Ops.Math.Modulo"};Ops.Array.SwitchArray=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};let t=i.inValueInt("Index");let n=[];let r=i.outArray("Result");t.onChange=s;t.onLinkChanged=s;i.on("init",s);for(let t=0;t<10;t++){let e=i.inArray("Array "+t);n.push(e);e.onChange=s;e.onLinkChanged=s}function s(){if(t.get()>=0&&n[t.get()]&&n[t.get()].isLinked()){r.setRef(n[t.get()].get())}else r.setRef([])}}};CABLES.OPS["3fab881c-c2cf-42a0-9c42-2d8edfd93f57"]={f:Ops.Array.SwitchArray,objName:"Ops.Array.SwitchArray"};Ops.Sidebar.Toggle_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=true;const n=t.inObject("link");const r=t.inString("Text","Toggle");const s=t.inValueBool("Input",i);const a=t.inTriggerButton("Set Default");const o=t.inValueBool("Default",i);o.setUiAttribs({hidePort:true,greyout:true});const l=t.inBool("Grey Out",false);const h=t.inBool("Visible",true);const u=t.outObject("childs");const c=t.outBoolNum("Value",o.get());const f=t.outTrigger("Toggled");const d=document.createElement("div");d.dataset.op=t.id;d.classList.add("cablesEle");d.classList.add("sidebar__item");d.classList.add("sidebar__toggle");d.classList.add("sidebar__reloadable");if(i)d.classList.add("sidebar__toggle--active");d.addEventListener("dblclick",function(){c.set(o.get());s.set(o.get());f.trigger()});const g=document.createElement("div");g.classList.add("sidebar__item-label");const p=document.createTextNode(r.get());g.appendChild(p);d.appendChild(g);const m=document.createElement("div");m.classList.add("icon_toggle");m.addEventListener("click",v);d.appendChild(m);const _=document.createElement("div");_.classList.add("sidebar__greyout");d.appendChild(_);_.style.display="none";n.onChange=T;r.onChange=E;s.onChange=x;t.onDelete=I;a.onTriggered=b;function b(){const e=s.get();o.set(e);c.set(e);f.trigger();t.refreshParams()}function v(){d.classList.toggle("sidebar__toggle--active");if(d.classList.contains("sidebar__toggle--active")){c.set(true);s.set(true);m.classList.add("icon_toggle_true");m.classList.remove("icon_toggle_false");f.trigger()}else{m.classList.remove("icon_toggle_true");m.classList.add("icon_toggle_false");c.set(false);s.set(false);f.trigger()}t.refreshParams()}function x(){const e=s.get();if(e){d.classList.add("sidebar__toggle--active");c.set(true)}else{d.classList.remove("sidebar__toggle--active");c.set(false)}f.trigger()}function E(){const e=r.get();g.textContent=e;if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function T(){u.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(d);u.set(e)}else if(d.parentElement)d.parentElement.removeChild(d)}function A(e){if(e)e.style.display="block"}function S(e){if(e)e.style.display="none"}function I(){M(d)}function M(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(d)}l.onChange=function(){_.style.display=l.get()?"block":"none"};h.onChange=function(){d.style.display=h.get()?"block":"none"}}};CABLES.OPS["fb60ab7d-f2f2-4fc5-bcd0-88c6ed481908"]={f:Ops.Sidebar.Toggle_v3,objName:"Ops.Sidebar.Toggle_v3"};Ops.Boolean.BoolToNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("bool"),n=e.outNumber("number");i.onChange=function(){if(i.get())n.set(1);else n.set(0)}}};CABLES.OPS["2591c495-fceb-4f6e-937f-11b190c72ee5"]={f:Ops.Boolean.BoolToNumber,objName:"Ops.Boolean.BoolToNumber"};Ops.Devices.Mouse.Mouse_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const V=e.attachments={};const t=e.inValueBool("Active",true),i=e.inValueBool("relative"),r=e.inValueBool("normalize"),n=e.inValueBool("flip y",true),s=e.inValueSelect("Area",["Canvas","Document","Parent Element"],"Canvas"),a=e.inBool("right click prevent default",true),o=e.inValueBool("Touch support",true),l=e.inValueBool("smooth"),h=e.inValueFloat("smoothSpeed",20),u=e.inValueFloat("multiply",1),c=e.outNumber("x",0),f=e.outNumber("y",0),d=e.outBoolNum("button down"),D=e.outTrigger("click"),k=e.outTrigger("Button Up"),B=e.outTrigger("click right"),g=e.outBoolNum("mouseOver"),p=e.outNumber("button");e.setPortGroup("Behavior",[i,r,n,s,a,o]);e.setPortGroup("Smoothing",[l,h,u]);let m=0;const _=e.patch.cgl;let b=null;function v(i,n){if(r.get()){let e=_.canvas.width/_.pixelDensity;let t=_.canvas.height/_.pixelDensity;if(b==document.body){e=b.clientWidth/_.pixelDensity;t=b.clientHeight/_.pixelDensity}c.set(((i||0)/e*2-1)*u.get());f.set(((n||0)/t*2-1)*u.get())}else{c.set((i||0)*u.get());f.set((n||0)*u.get())}}l.onChange=function(){if(l.get())m=setInterval(j,5);else if(m)clearTimeout(m)};let U,G;let x=0,E=0;r.onChange=function(){T=0;A=0;v(T,A)};let T=_.canvas.width/2;let A=_.canvas.height/2;x=T;E=A;c.set(T);f.set(A);let S=0;let I=0;let M=0;let C=0;F();s.onChange=F;let R=0;function j(){R=h.get();if(R<=0)R=.01;const e=Math.abs(T-x);const t=Math.round(e/R,0);x=x<T?x+t:x-t;const i=Math.abs(A-E);const n=Math.round(i/R,0);E=E<A?E+n:E-n;v(x,E)}function O(e){d.set(false);g.set(true);R=h.get()}function y(e){p.set(e.which);d.set(true)}function N(e){p.set(0);d.set(false);k.trigger()}function w(e){B.trigger();if(a.get())e.preventDefault()}function L(e){D.trigger()}function H(e){S=0;I=0;R=100;g.set(false);d.set(false)}i.onChange=function(){M=0;C=0};function z(e){if(!i.get()){if(s.get()!="Document"){M=e.offsetX;C=e.offsetY}else{M=e.clientX;C=e.clientY}if(l.get()){T=M;if(n.get())A=b.clientHeight-C;else A=C}else{if(n.get())v(M,b.clientHeight-C);else v(M,C)}}else{if(S!=0&&I!=0){M=e.offsetX-S;C=e.offsetY-I}else{}S=e.offsetX;I=e.offsetY;T+=M;A+=C;if(A>460)A=460}}function $(e){g.set(true);z(e)}function W(e){if(event.touches&&event.touches.length>0)z(e.touches[0])}function X(e){d.set(true);if(e.touches&&e.touches.length>0)y(e.touches[0])}function Y(e){d.set(false);N()}o.onChange=function(){P();F()};function P(){if(!b)return;b.removeEventListener("touchend",Y);b.removeEventListener("touchstart",X);b.removeEventListener("touchmove",W);b.removeEventListener("click",L);b.removeEventListener("mousemove",$);b.removeEventListener("mouseleave",H);b.removeEventListener("mousedown",y);b.removeEventListener("mouseup",N);b.removeEventListener("mouseenter",O);b.removeEventListener("contextmenu",w);b=null}function F(){if(b||!t.get())P();if(!t.get())return;b=_.canvas;if(s.get()=="Document")b=document.body;if(s.get()=="Parent Element")b=_.canvas.parentElement;if(o.get()){b.addEventListener("touchend",Y);b.addEventListener("touchstart",X);b.addEventListener("touchmove",W)}b.addEventListener("mousemove",$);b.addEventListener("mouseleave",H);b.addEventListener("mousedown",y);b.addEventListener("mouseup",N);b.addEventListener("mouseenter",O);b.addEventListener("contextmenu",w);b.addEventListener("click",L)}t.onChange=function(){if(b)P();if(t.get())F()};e.onDelete=function(){P()};F()}};CABLES.OPS["9fa3fc46-3147-4e3a-8ee8-a93ea9e8786e"]={f:Ops.Devices.Mouse.Mouse_v2,objName:"Ops.Devices.Mouse.Mouse_v2"};Ops.Html.CSS.CSSFilter=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const r=e.inObject("Element");const s=e.inValueSelect("method",["-","blur","brightness","contrast","grayscale","hue-rotate","invert","opacity","saturate","sepia"]);const i=e.inValue("Value");let n="";let a="";i.onChange=h;r.onChange=h;let o=null;function l(){return s.get()+"("+i.get()+n+")"}r.onLinkChanged=function(){if(r.isLinked())return;const t=o;if(t&&t.style){let e=t.style.filter;var i="";if(e&&e.length>0){var i="";let t=e.split(" ");for(let e=0;e<t.length;e++){if(t[e].indexOf(s.get())==0)t[e]=""}i=t.join(" ")}t.style.filter=i}};function h(){const t=r.get();let n="";if(t&&t.style){if(t!=o)o=t;let i=false;let e=t.style.filter;if(e&&e.length>0){let t=e.split(" ");for(let e=0;e<t.length;e++){if(t[e].indexOf(s.get())==0){i=true;t[e]=l()}}n=t.join(" ")}if(!i)n+=" "+l();t.style.filter=n}}s.onChange=function(){let e=s.get();a=s.get()+":";if(e=="blur")n="px";if(e=="brightness")n="";if(e=="contrast")n="%";if(e=="grayscale")n="%";if(e=="hue-rotate")n="deg";if(e=="invert")n="%";if(e=="opacity")n="%";if(e=="saturate")n="";if(e=="sepia")n="%";h()}}};CABLES.OPS["33befabf-7eef-45f6-869f-30e0e4f44739"]={f:Ops.Html.CSS.CSSFilter,objName:"Ops.Html.CSS.CSSFilter"};Ops.Anim.BoolAnim=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=new CABLES.Anim;const n=e.inTrigger("exe"),r=e.inValueBool("bool"),s=i.createPort(e,"easing"),a=e.inValue("duration",.25),o=e.inValueSelect("Direction",["Both","Only True","Only False"],"Both"),l=e.inValue("value false",0),h=e.inValue("value true",1),u=e.outTrigger("trigger"),c=e.outNumber("value"),f=e.outBoolNum("finished"),d=e.outTrigger("Finished Trigger");const g=CABLES.now();e.toWorkPortsNeedToBeLinked(n);e.setPortGroup("Animation",[a,s]);e.setPortGroup("Values",[l,h]);o.onChange=r.onChange=l.onChange=h.onChange=a.onChange=p;p();function p(){if(o.get()=="Animate Both")o.set("Both");f.set(false);const e=(CABLES.now()-g)/1e3;const t=i.getValue(e);i.clear();i.setValue(e,t);if(!r.get()){if(o.get()!="Only True")i.setValue(e+a.get(),l.get());else i.setValue(e,l.get())}else{if(o.get()!="Only False")i.setValue(e+a.get(),h.get());else i.setValue(e,h.get())}}n.onTriggered=function(){const e=(CABLES.now()-g)/1e3;c.set(i.getValue(e));if(i.hasEnded(e)){if(!f.get())d.trigger();f.set(true)}u.trigger()}}};CABLES.OPS["06ad9d35-ccf5-4d31-889c-e23fa062588a"]={f:Ops.Anim.BoolAnim,objName:"Ops.Anim.BoolAnim"};Ops.Boolean.TriggerChangedFalse=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inValueBool("Value",false);let n=e.outTrigger("Next");let r=0;i.onChange=function(){let e=i.get();if(r&&!e){r=false;n.trigger()}else{r=true}}}};CABLES.OPS["6387bcb0-6091-4199-8ab7-f96ad4aa3c7d"]={f:Ops.Boolean.TriggerChangedFalse,objName:"Ops.Boolean.TriggerChangedFalse"};Ops.Extension.Deprecated.InteractionListener=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Duration",.5),n=e.outValue("Events");let r=0;let s=null;l();function a(){n.set(false)}function o(){n.set(true);clearTimeout(r);r=setTimeout(a,i.get()*1e3)}function l(){s=e.patch.cgl.canvas;s.addEventListener("mousemove",o);s.addEventListener("mouseleave",o);s.addEventListener("mousedown",o);s.addEventListener("mouseup",o);s.addEventListener("mouseenter",o)}function h(){s.removeEventListener("mousemove",o);s.removeEventListener("mouseleave",o);s.removeEventListener("mousedown",o);s.removeEventListener("mouseup",o);s.removeEventListener("mouseenter",o);s=null}this.onDelete=function(){h()}}};CABLES.OPS["1dcb1c53-1e7f-41a6-9917-e625ea803f6c"]={f:Ops.Extension.Deprecated.InteractionListener,objName:"Ops.Extension.Deprecated.InteractionListener"};Ops.Trigger.Repeat_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),n=e.inValueInt("Repeats",5),r=e.inSwitch("Direction",["Forward","Backward"],"Forward"),s=e.outTrigger("Next"),a=e.addOutPort(new CABLES.Port(e,"index"));r.onChange=o;o();function o(){if(r.get()=="Forward")i.onTriggered=l;else i.onTriggered=h}function l(){const t=Math.floor(n.get());for(let e=0;e<t;e++){a.set(e);s.trigger()}}function h(){const t=Math.floor(n.get());for(let e=t-1;e>-1;e--){a.set(e);s.trigger()}}}};CABLES.OPS["a4deea80-db97-478f-ad1a-5ee30f2f47cc"]={f:Ops.Trigger.Repeat_v2,objName:"Ops.Trigger.Repeat_v2"};Ops.Devices.Keyboard.KeyPressLearn=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const n=i.inValueInt("key code"),t=i.inValueBool("canvas only",true),r=i.inValueSelect("Mod Key",["none","alt"],"none"),s=i.inValueBool("Enabled",true),a=i.inValueBool("Prevent Default"),o=i.inTriggerButton("learn"),l=i.outTrigger("on press"),h=i.outTrigger("on release"),u=i.outBoolNum("Pressed",false),c=i.outString("Key");const f=i.patch.cgl;let d=false;let g=null;r.onChange=n.onChange=E;v();function p(e){if(d){n.set(e.keyCode);if(CABLES.UI){if(g)g.close();i.refreshParams()}d=false;b();_();if(CABLES.UI)gui.emitEvent("portValueEdited",i,n,n.get())}else{if(e.keyCode==n.get()){if(r.get()=="alt"){if(e.altKey===true){l.trigger();u.set(true);if(a.get())e.preventDefault()}}else{l.trigger();u.set(true);if(a.get())e.preventDefault()}}}}function m(t){if(t.keyCode==n.get()){let e=true;if(r.get()=="alt"&&t.altKey!=true)e=false;if(e){h.trigger();u.set(false)}}}i.onDelete=function(){f.canvas.removeEventListener("keyup",m,false);f.canvas.removeEventListener("keydown",p,false);document.removeEventListener("keyup",m,false);document.removeEventListener("keydown",p,false)};o.onTriggered=function(){if(!CABLES.UI)return;d=true;x();g=new CABLES.UI.ModalDialog({title:"Learn Key...",text:"Just press any key"});g.on("close",()=>{d=false;b();_();g=null})};function _(){if(t.get())v();else x()}function b(){document.removeEventListener("keydown",p,false);document.removeEventListener("keyup",m,false);f.canvas.removeEventListener("keydown",p,false);f.canvas.removeEventListener("keyup",m,false);u.set(false)}function v(){if(!CABLES.isNumeric(f.canvas.getAttribute("tabindex")))f.canvas.setAttribute("tabindex",1);f.canvas.addEventListener("keydown",p,false);f.canvas.addEventListener("keyup",m,false)}function x(){document.addEventListener("keydown",p,false);document.addEventListener("keyup",m,false)}s.onChange=function(){if(!s.get()){b()}else{_()}};t.onChange=function(){b();_()};function E(){let e=T(n.get());const t=r.get();if(t&&t!=="none"){e=t.charAt(0).toUpperCase()+t.slice(1)+"-"+e}i.setUiAttribs({extendTitle:e});c.set(e)}function T(e){if(!e&&e!==0)return"Unidentified";const t={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};if(t[e]){return t[e]}else{return String.fromCharCode(e)}}}};CABLES.OPS["f069c0db-4051-4eae-989e-6ef7953787fd"]={f:Ops.Devices.Keyboard.KeyPressLearn,objName:"Ops.Devices.Keyboard.KeyPressLearn"};Ops.Trigger.DelayedTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("exe"),n=e.inValueFloat("delay",1),r=e.inTriggerButton("Cancel"),s=e.outTrigger("next"),a=e.outBool("Delaying");let o=null;r.onTriggered=function(){if(o)clearTimeout(o);o=null};i.onTriggered=function(){a.set(true);if(o)clearTimeout(o);o=setTimeout(function(){a.set(false);o=null;s.trigger()},n.get()*1e3)}}};CABLES.OPS["f4ff66b0-8500-46f7-9117-832aea0c2750"]={f:Ops.Trigger.DelayedTrigger,objName:"Ops.Trigger.DelayedTrigger"};Ops.Boolean.BoolByTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("True"),n=e.inTriggerButton("false"),r=e.outBoolNum("Result");i.onTriggered=function(){r.set(true)};n.onTriggered=function(){r.set(false)}}};CABLES.OPS["31f65abe-9d6c-4ba6-a291-ef2de41d2087"]={f:Ops.Boolean.BoolByTrigger,objName:"Ops.Boolean.BoolByTrigger"};Ops.Boolean.Or=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("bool 1"),n=e.inValueBool("bool 2"),r=e.inValueBool("bool 3"),s=e.inValueBool("bool 4"),a=e.inValueBool("bool 5"),o=e.inValueBool("bool 6"),l=e.inValueBool("bool 7"),h=e.inValueBool("bool 8"),u=e.inValueBool("bool 9"),c=e.inValueBool("bool 10"),f=e.outBoolNum("result");i.onChange=n.onChange=r.onChange=s.onChange=a.onChange=o.onChange=l.onChange=h.onChange=u.onChange=c.onChange=d;function d(){f.set(i.get()||n.get()||r.get()||s.get()||a.get()||o.get()||l.get()||h.get()||u.get()||c.get())}}};CABLES.OPS["b3b36238-4592-4e11-afe3-8361c4fd6be5"]={f:Ops.Boolean.Or,objName:"Ops.Boolean.Or"};Ops.Boolean.TriggerOnChangeBoolean=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("Value"),n=e.outTrigger("True"),r=e.outTrigger("False");i.onChange=function(){if(i.get())n.trigger();else r.trigger()}}};CABLES.OPS["dba19c07-e3c4-4971-a991-c9e6212ca1c8"]={f:Ops.Boolean.TriggerOnChangeBoolean,objName:"Ops.Boolean.TriggerOnChangeBoolean"};Ops.Gl.Performance=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const V=a.attachments={};const e=a.inTrigger("exe"),o=a.inValueBool("Active",true),l=a.inValueBool("Visible",true),D=a.inValueBool("Measure GPU",true),h=a.outTrigger("childs"),t=a.inSwitch("Position",["top","bottom"],"top"),i=a.inBool("Open",false),k=a.inBool("Smooth Graph",true),B=a.inFloat("Scale",3),u=a.inFloat("Size",128),U=a.outObject("Canvas"),G=a.outNumber("FPS");const n=a.patch.cgl;const r=document.createElement("div");let s=null;let c=null;let f=false;let d=0;let g=0;let p=0;let m=0;let _=0;const b=[];const v=[];const x=[];const E=[];let T=0;let A=0;let S=null;let j=0;let H=0;const I=["|","/","-","\\"];let M=true;const z="#007f9c";const $="#aaaaaa";const W="#222222";const C="#003f5c";const R="#7a5195";const O="#ef5675";const X="#ffa600";let Y=false;let y=0;let N=0;let w=0;a.toWorkPortsNeedToBeLinked(e,h);const q=a.patch.cgl.gl;const K=q.getExtension("EXT_disjoint_timer_query_webgl2");o.onChange=e.onLinkChanged=l.onChange=()=>{F();Q()};t.onChange=Z;u.onChange=P;r.id="performance";r.style.position="absolute";r.style.left="0px";r.style.opacity="0.8";r.style.padding="10px";r.style.cursor="pointer";r.style.background="#222";r.style.color="white";r.style["font-family"]="monospace";r.style["font-size"]="12px";r.style["z-index"]="99999";r.innerHTML="&nbsp;";r.addEventListener("click",J);const L=a.patch.cgl.canvas.parentElement;L.appendChild(r);P();F();Z();Q();a.onDelete=function(){if(S)S.remove();if(r)r.remove()};function Z(){S.style["pointer-events"]="none";if(t.get()=="top"){S.style.top=r.style.top="0px";S.style.bottom=r.style.bottom="initial"}else{S.style.bottom=r.style.bottom="0px";S.style.top=r.style.top="initial"}}function Q(){if(!l.get()||!e.isLinked()||!o.get()){r.style.display="none";r.style.opacity=0;S.style.display="none"}else{r.style.display="block";r.style.opacity=1;S.style.display="block"}}function P(){if(!S)return;const t=Math.max(0,parseInt(u.get()));S.width=t;S.height=t;r.style.left=t+"px";b.length=0;v.length=0;x.length=0;E.length=0;for(let e=0;e<t;e++){b[e]=-1;v[e]=-1;x[e]=-1;E[e]=-1}}i.onChange=function(){f=i.get();F()};function J(){if(!l.get())return;r.style.opacity=1;f=!f;F()}function F(){ie();if(!S)te();if(f){S.style.display="block";r.style.left=u.get()+"px";r.style["min-height"]="56px"}else{S.style.display="none";r.style.left="0px";r.style["min-height"]="auto"}}function ee(){const t=S.height;const i=B.get();c.fillStyle=W;c.fillRect(0,0,S.width,t);c.fillStyle=C;let n=0;const r=Math.max(0,parseInt(u.get()));for(n=r;n>=0;n--){if(b[n]>30)c.fillStyle=z;if(b[n]>60)c.fillStyle=$;c.fillRect(r-n,t-b[n]*i,1,b[n]*i);if(b[n]>30)c.fillStyle=C}for(n=r;n>=0;n--){let e=0;c.fillStyle=R;e=v[n];c.fillRect(r-n,t-e*i,1,v[n]*i);c.fillStyle=O;e+=x[n];c.fillRect(r-n,t-e*i,1,x[n]*i);c.fillStyle=X;e+=E[n];c.fillRect(r-n,t-e*i,1,E[n]*i)}for(let e=10;e<t;e+=10){c.fillStyle="#888";const s=t-e*i;c.fillRect(S.width-5,s,5,1);c.font="8px arial";c.fillText(e+"ms",S.width-27,s+3)}c.fillStyle="#fff";c.fillRect(S.width-5,t-1e3/g*i,5,1);c.fillText(Math.round(1e3/g)+"ms",S.width-27,t-1e3/g*i)}function te(){S=document.createElement("canvas");S.id="performance_"+a.patch.config.glCanvasId;S.width=u.get();S.height=u.get();S.style.display="block";S.style.opacity=.9;S.style.position="absolute";S.style.left="0px";S.style.cursor="pointer";S.style.top="-64px";S.style["z-index"]="99998";L.appendChild(S);c=S.getContext("2d");S.addEventListener("click",J);P()}function ie(){if(!l.get())return;let e="";if(a.patch.cgl.profileData.profileShaderCompiles>0)e+="Shader compile ("+a.patch.cgl.profileData.profileShaderCompileName+") ";if(a.patch.cgl.profileData.profileShaderGetUniform>0)e+="Shader get uni loc! ("+a.patch.cgl.profileData.profileShaderGetUniformName+")";if(a.patch.cgl.profileData.profileTextureResize>0)e+="Texture resize! ";if(a.patch.cgl.profileData.profileFrameBuffercreate>0)e+="Framebuffer create! ";if(a.patch.cgl.profileData.profileEffectBuffercreate>0)e+="Effectbuffer create! ";if(a.patch.cgl.profileData.profileTextureDelete>0)e+="Texture delete! ";if(a.patch.cgl.profileData.profileNonTypedAttrib>0)e+="Not-Typed Buffer Attrib! "+a.patch.cgl.profileData.profileNonTypedAttribNames;if(a.patch.cgl.profileData.profileTextureNew>0)e+="new texture created! ";if(a.patch.cgl.profileData.profileGenMipMap>0)e+="generating mip maps!";if(e.length>0){e='| <span style="color:#f80;">WARNING: '+e+"<span>"}let t="";if(f){t+='<span style="color:'+C+'"></span> '+g+" fps ";t+='<span style="color:'+R+'"></span> '+Math.round(N*100)/100+"ms mainloop ";t+='<span style="color:'+O+'"></span> '+Math.round(w*100)/100+"ms onframe ";if(y)t+='<span style="color:'+X+'"></span> '+Math.round(y*100)/100+"ms GPU";t+=e;r.innerHTML=t}else{t+=g+" fps / ";t+="CPU: "+Math.round(a.patch.cgl.profileData.profileOnAnimFrameOps*100)/100+"ms / ";if(y)t+="GPU: "+Math.round(y*100)/100+"ms  ";r.innerHTML=t}if(a.patch.loading.getProgress()!=1){r.innerHTML+="<br/>loading "+Math.round(a.patch.loading.getProgress()*100)+"% "+I[++H%I.length]}if(f){let t=0;T=0;_=0;for(let e=b.length;e>b.length-b.length/3;e--){if(b[e]>-1){T+=b[e];t++}if(v[e]>-1)_+=v[e]}T/=t;_/=t;r.innerHTML+="<br/> "+n.canvasWidth+" x "+n.canvasHeight+" (x"+n.pixelDensity+") ";r.innerHTML+="<br/>frame avg: "+Math.round(_*100)/100+" ms ("+Math.round(_/T*100)+"%) / "+Math.round(T*100)/100+" ms";r.innerHTML+=" (self: "+Math.round(A*100)/100+" ms) ";r.innerHTML+="<br/>shader binds: "+Math.ceil(a.patch.cgl.profileData.profileShaderBinds/g)+" uniforms: "+Math.ceil(a.patch.cgl.profileData.profileUniformCount/g)+" mvp_uni_mat4: "+Math.ceil(a.patch.cgl.profileData.profileMVPMatrixCount/g)+" num glPrimitives: "+Math.ceil(a.patch.cgl.profileData.profileMeshNumElements/g)+" fenced pixelread: "+Math.ceil(a.patch.cgl.profileData.profileFencedPixelRead)+" mesh.setGeom: "+a.patch.cgl.profileData.profileMeshSetGeom+" videos: "+a.patch.cgl.profileData.profileVideosPlaying+" tex preview: "+a.patch.cgl.profileData.profileTexPreviews;r.innerHTML+=" draw meshes: "+Math.ceil(a.patch.cgl.profileData.profileMeshDraw/g)+" framebuffer blit: "+Math.ceil(a.patch.cgl.profileData.profileFramebuffer/g)+" texeffect blit: "+Math.ceil(a.patch.cgl.profileData.profileTextureEffect/g);r.innerHTML+=" all shader compiletime: "+Math.round(a.patch.cgl.profileData.shaderCompileTime*100)/100}a.patch.cgl.profileData.clear()}function ne(e){e.style.padding="0px";e.style.margin="0px"}function re(t,e,i,n){const r=20;t.usedAvg=t.usedAvg||t.used;if(!t.ele||M){const a=document.createElement("div");t.ele=a;if(t.childs&&t.childs.length>0)a.style.height="500px";else a.style.height=r+"px";a.style.overflow="hidden";a.style.display="inline-block";if(!t.isRoot){a.innerHTML='<div style="min-height:'+r+'px;width:100%;overflow:hidden;color:black;position:relative">&nbsp;'+t.name+"</div>";a.style["background-color"]="rgb("+t.colR+","+t.colG+","+t.colB+")";a.style["border-left"]="1px solid black"}e.appendChild(a)}if(!t.isRoot){if(performance.now()-t.lastTime>200){t.ele.style.display="none";t.hidden=true}else{if(t.hidden){t.ele.style.display="inline-block";t.hidden=false}}t.ele.style.float="left";t.ele.style.width=Math.floor(t.usedAvg/i*98)+"%"}else{t.ele.style.width="100%";t.ele.style.clear="both";t.ele.style.float="none"}if(t&&t.childs&&t.childs.length>0){let e=0;for(var s=0;s<t.childs.length;s++){t.childs[s].usedAvg=(t.childs[s].usedAvg||t.childs[s].used)*.95+t.childs[s].used*.05;e+=t.childs[s].usedAvg}for(var s=0;s<t.childs.length;s++){re(t.childs[s],t.ele,e,n+1)}}}function se(t){for(let e=0;e<t.childs.length;e++)se(t.childs[e]);t.childs.length=0}function ae(){if(!CGL.performanceMeasures)return;if(!s){a.log("create measure ele");s=document.createElement("div");s.style.width="100%";s.style["background-color"]="#444";s.style.bottom="10px";s.style.height="100px";s.style.opacity="1";s.style.position="absolute";s.style["z-index"]="99999";s.innerHTML="";L.appendChild(s)}let t=0;const i=CGL.performanceMeasures[0];for(let e=0;e<i.childs.length;e++)t+=i.childs[e].used;re(CGL.performanceMeasures[0],s,t,0);i.childs.length=0;se(CGL.performanceMeasures[0]);CGL.performanceMeasures.length=0;M=false}e.onTriggered=oe;function oe(){const e=performance.now();if(o.get()){d++;if(K&&D.get()&&l.get())a.patch.cgl.profileData.doProfileGlQuery=true;else a.patch.cgl.profileData.doProfileGlQuery=false;if(p===0)p=Date.now();if(Date.now()-p>=1e3){g=d;d=0;G.set(g);if(l.get())ie();p=Date.now()}const i=a.patch.cgl.profileData.glQueryData;y=0;if(i){let t=0;for(let e in i){t++;if(i[e].time)y+=i[e].time}}if(l.get()){ae();if(f&&!a.patch.cgl.profileData.pause){b.push(a.patch.cgl.profileData.profileFrameDelta);b.shift();v.push(m);v.shift();x.push(a.patch.cgl.profileData.profileOnAnimFrameOps-a.patch.cgl.profileData.profileMainloopMs);x.shift();E.push(y);E.shift();ee()}}j=performance.now();A=performance.now()-e;U.setRef(S)}const t=performance.now();h.trigger();if(o.get()){const n=performance.now()-t;const r=a.patch.cgl.profileData.profileMainloopMs;const s=a.patch.cgl.profileData.profileOnAnimFrameOps-a.patch.cgl.profileData.profileMainloopMs;if(k.get()){m=m*.9+n*.1;N=N*.5+r*.5;w=w*.5+s*.5}else{m=n;N=r;w=s}a.patch.cgl.profileData.clearGlQuery()}}}};CABLES.OPS["9cd2d9de-000f-4a14-bd13-e7d5f057583c"]={f:Ops.Gl.Performance,objName:"Ops.Gl.Performance"};Ops.Gl.Textures.TextTexture_v4=class extends CABLES.Op{constructor(){super(...arguments);const m=this;const u=m.attachments={text_frag:"UNI sampler2D tex;\nUNI float a;\nUNI vec3 color;\nIN vec2 texCoord;\nvec4 myround(vec4 col)\n{\nif(col.a>0.5)return vec4(1.,1.,1.,1.);\nelse return vec4(1.,1.,1.,0.);\n}\nvoid main()\n{\nvec4 col;\n#ifndef HARD_EDGE\n\ncol=texture(tex,vec2(texCoord.x,(1.-texCoord.y)));\n#endif\n#ifdef HARD_EDGE\nfloat step=0.7;\ncol=texture(tex,vec2(texCoord.x,1.-texCoord.y));\nvec4 col2=texture(tex,vec2(texCoord.x-(fwidth(texCoord.x)*step),1.-texCoord.y-(fwidth(texCoord.y)*step)));\nvec4 col3=texture(tex,vec2(texCoord.x+(fwidth(texCoord.x)*step),1.-texCoord.y+(fwidth(texCoord.y)*step)));\nvec4 col4=texture(tex,vec2(texCoord.x+(fwidth(texCoord.x)*step),1.-texCoord.y-(fwidth(texCoord.y)*step)));\nvec4 col5=texture(tex,vec2(texCoord.x-(fwidth(texCoord.x)*step),1.-texCoord.y+(fwidth(texCoord.y)*step)));\nfloat f=smoothstep(col.a,0.5,0.8);\ncol=myround(col);\ncol2=myround(col2);\ncol3=myround(col3);\ncol4=myround(col4);\ncol5=myround(col5);\n\n#endif\ncol.rgb=color.rgb;\noutColor=col;\n}\n",text_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\nUNI float aspect;\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n    pos.x*=aspect;\n\n   texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);;\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};function n(e){const t=e.toString(16);return t.length==1?"0"+t:t}function c(e,t,i){return"#"+n(Math.floor(e*255))+n(Math.floor(t*255))+n(Math.floor(i*255))}const f=m.inTriggerButton("Render"),j=m.inString("text","cables"),_=m.inString("font","Arial"),b=m.inString("weight","normal"),v=m.inValueBool("Maximize Size",true),x=m.inValueFloat("fontSize",30),t=m.inValueFloat("Line Height",1),E=m.inValueFloat("Vertical Offset",0),H=m.inBool("Show Debug",false),T=m.inValueInt("Limit Lines",0),e=m.inSwitch("Size",["Auto","Manual"],"Manual"),i=m.inValueInt("texture width",512),r=m.inValueInt("texture height",128),A=m.inSwitch("filter",["nearest","linear","mipmap"],"linear"),S=m.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),I=m.inSwitch("Anisotropic",[0,1,2,4,8,16],0),M=m.inSwitch("align",["left","center","right"],"left"),C=m.inSwitch("vertical align",["top","center","bottom"],"center"),z=m.inValueBool("Reuse Texture",true),s=m.inValueBool("Draw Mesh",true),d=m.inValueFloat("Scale Mesh",1),a=m.inValueBool("Hard Edges",false),R=m.inFloatSlider("Opacity",1),O=m.inValueSlider("r",1),y=m.inValueSlider("g",1),N=m.inValueSlider("b",1),g=m.outTrigger("Next"),$=m.outNumber("Ratio"),w=m.outTexture("texture"),o=m.outNumber("Aspect",1),W=m.outNumber("Num Lines");O.setUiAttribs({colorPick:true});m.toWorkPortsNeedToBeLinked(f);m.setPortGroup("Color",[O,y,N]);m.setPortGroup("Size",[_,e,b,v,x,t,E]);m.setPortGroup("Texture",[i,r,A,I]);m.setPortGroup("Alignment",[C,M]);m.setPortGroup("Rendering",[s,a,d]);M.onChange=C.onChange=j.onChange=x.onChange=b.onChange=_.onChange=E.onChange=t.onChange=z.onChange=T.onChange=i.onChange=r.onChange=v.onChange=function(){D=true};S.onChange=()=>{if(P)P.delete();P=null;D=true};O.onChange=y.onChange=N.onChange=R.onChange=function(){if(!s.get()||w.isLinked())D=true};w.onLinkChanged=()=>{if(w.isLinked())D=true};m.patch.on("fontLoaded",e=>{if(e==_.get()){D=true}});f.onTriggered=Q;I.onChange=A.onChange=()=>{P=null;D=true};w.ignoreValueSerialize=true;const L=m.patch.cgl;const p=document.getElementsByTagName("body")[0];let P=new CGL.Texture(L,{name:"TextTexture"});const F=document.createElement("canvas");F.id="texturetext_"+CABLES.generateUUID();F.style.display="none";p.appendChild(F);const V=F.getContext("2d");let D=true;const X=CGL.MESHES.getSimpleRect(L,"texttexture rect");const l=vec3.create();const h=new CGL.Shader(L,"texttexture");h.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);h.setSource(u.text_vert,u.text_frag);const Y=new CGL.Uniform(h,"t","tex");const q=new CGL.Uniform(h,"f","aspect",0);const K=new CGL.Uniform(h,"f","a",R);const Z=new CGL.Uniform(h,"3f","color",O,y,N);if(m.patch.isEditorMode())CABLES.UI.SIMPLEWIREFRAMERECT=CABLES.UI.SIMPLEWIREFRAMERECT||new CGL.WireframeRect(L);if(L.glVersion<2){L.gl.getExtension("OES_standard_derivatives");h.enableExtension("GL_OES_standard_derivatives")}a.onChange=function(){h.toggleDefine("HARD_EDGE",a.get())};function k(){if(e.get()=="Auto")return L.getViewPort()[2];return Math.ceil(i.get())}function B(){if(e.get()=="Auto")return L.getViewPort()[3];else return Math.ceil(r.get())}function Q(){if(V.canvas.width!=k())D=true;if(D){J();ee()}if(s.get()){l[0]=l[1]=l[2]=d.get();L.pushBlendMode(CGL.BLEND_NORMAL,false);L.pushModelMatrix();mat4.scale(L.mMatrix,L.mMatrix,l);h.popTextures();h.pushTexture(Y,P.tex);q.set(o.get());if(L.shouldDrawHelpers(m))CABLES.UI.SIMPLEWIREFRAMERECT.render(o.get(),1,1);L.pushShader(h);X.render(h);L.popShader();L.popBlendMode();L.popModelMatrix()}g.trigger()}function J(){if(!P)return;P.setSize(k(),B());V.canvas.width=F.width=k();V.canvas.height=F.height=B();o.set(F.width/F.height);D=true}e.onChange=()=>{i.setUiAttribs({greyout:e.get()!="Manual"});r.setUiAttribs({greyout:e.get()!="Manual"})};v.onChange=function(){x.setUiAttribs({greyout:v.get()});D=true};function U(e){return t.get()*e}function G(e){if(e[e.length-1]===""||e[e.length-1]==="\n"){e.length--;e=G(e)}return e}function ee(){L.checkFrameStarted("texttrexture refresh");const e="rgba(255,"+Math.floor(0*255)+","+Math.floor(N.get()*255)+","+.8+")";V.fillStyle=e;V.fillRect(0,0,k()/2,B());const t="rgba(255,"+Math.floor(0*255)+","+Math.floor(N.get()*255)+","+0+")";V.fillStyle=t;V.clearRect(0,0,k()/2,B());const i="rgba("+Math.floor(O.get()*255)+","+Math.floor(y.get()*255)+","+Math.floor(N.get()*255)+","+R.get()+")";V.fillStyle=i;let n=parseFloat(x.get());let r=_.get();if(r.indexOf(" ")>-1)r='"'+r+'"';V.font=b.get()+" "+n+"px "+r+"";V.textAlign=M.get();let s=(j.get()+"").replace(/<br\/>/g,"\n");let a=s.split("\n");D=false;a=G(a);if(v.get()){n=k();let e=0;let t=0;let i=0;do{e++;if(e>(B()+k())/2){m.log("too many iterations - maximize size");break}n-=5;V.font=b.get()+" "+n+'px "'+_.get()+'"';t=0;i=(n+(a.length-1)*U(n))*1.2;for(let e=0;e<a.length;e++)t=Math.max(t,V.measureText(a[e]).width)}while(t>V.canvas.width||i>V.canvas.height)}else{let n=true;if(k()>128){n=false;let i="";for(let e=0;e<a.length;e++){if(!a[e]){i+="\n";continue}let t=0;const p=a[e].split(" ");for(let e=0;e<p.length;e++){if(!p[e])continue;t+=V.measureText(p[e]+" ").width;if(t>k()){n=true;i+="\n"+p[e]+" ";t=V.measureText(p[e]+" ").width}else{i+=p[e]+" "}}i+="\n"}s=i;a=s.split("\n")}a=G(a);if(T.get()>0&&a.length>T.get()){a.length=T.get();a[a.length-1]+="..."}}a=G(a);const o=n;const l=o+(a.length-1)*U(n);let h=E.get()*n;if(C.get()=="top")h+=o;else if(C.get()=="center")h+=V.canvas.height/2-l/2+o;else if(C.get()=="bottom")h+=V.canvas.height-l+o;let u=999999;let c=-999999;const f=H.get();for(let t=0;t<a.length;t++){let e=0;if(M.get()=="center")e=V.canvas.width/2;if(M.get()=="right")e=V.canvas.width;V.fillText(a[t],e,h);u=Math.min(u,h-o);c=Math.max(c,h);if(f){V.lineWidth=1;V.strokeStyle="#FF0000";V.beginPath();V.moveTo(0,h);V.lineTo(21e3,h);V.stroke()}h+=U(n)}if(f){V.lineWidth=3;V.strokeStyle="#FF0000";V.strokeRect(0,u,V.canvas.width-3,c-u)}V.restore();$.set(V.canvas.height/V.canvas.width);W.set(a.length);let d=CGL.Texture.WRAP_REPEAT;if(S.get()=="mirrored repeat")d=CGL.Texture.WRAP_MIRRORED_REPEAT;if(S.get()=="clamp to edge")d=CGL.Texture.WRAP_CLAMP_TO_EDGE;let g=CGL.Texture.FILTER_LINEAR;if(A.get()=="nearest")g=CGL.Texture.FILTER_NEAREST;else if(A.get()=="mipmap")g=CGL.Texture.FILTER_MIPMAP;if(!z.get()||!P||!w.get()||P.width!=F.width||P.height!=F.height||P.anisotropic!=parseFloat(I.get())){if(P)P.delete();P=new CGL.Texture.createFromImage(L,F,{filter:g,anisotropic:parseFloat(I.get()),wrap:d})}P.flip=false;P.initTexture(F,g);w.setRef(P);P.unpackAlpha=false}}};CABLES.OPS["afab973f-c9ac-47fd-914c-70b42af5c5d4"]={f:Ops.Gl.Textures.TextTexture_v4,objName:"Ops.Gl.Textures.TextTexture_v4"};Ops.Extension.Deprecated.LocalTextureFile=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};let t=s.inObject("link"),i=s.inString("Text","Select File:"),n=s.inValueString("Id",""),a=s.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),o=s.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge");let r=s.outObject("childs");const l=s.outTexture("Texture");let h=document.createElement("div");h.dataset.op=s.id;h.classList.add("cablesEle");h.classList.add("sidebar__item");h.classList.add("sidebar__text");let u=document.createElement("div");u.classList.add("sidebar__item-label");let c=document.createTextNode(i.get());u.appendChild(c);h.appendChild(u);const f=document.createElement("input");f.type="file";f.id="file";f.name="file";f.style.width="95%";h.appendChild(f);l.set(CGL.Texture.getEmptyTexture(s.patch.cgl));const d=document.createElement("img");a.onChange=o.onChange=()=>{f.dispatchEvent(new Event("change"))};f.addEventListener("change",g,false);function g(e){const t=new FileReader;t.onabort=function(e){s.log("File read cancelled")};t.onload=function(e){let r=new Image;r.onerror=function(e){l.set(CGL.Texture.getEmptyTexture(s.patch.cgl));s.log("image error",e)};r.onload=function(e){let t=CGL.Texture.FILTER_LINEAR;let i=CGL.Texture.WRAP_REPEAT;if(a.get()=="nearest")t=CGL.Texture.FILTER_NEAREST;else if(a.get()=="linear")t=CGL.Texture.FILTER_LINEAR;else if(a.get()=="mipmap")t=CGL.Texture.FILTER_MIPMAP;else if(a.get()=="Anisotropic")t=CGL.Texture.FILTER_ANISOTROPIC;if(o.get()=="repeat")i=CGL.Texture.WRAP_REPEAT;if(o.get()=="mirrored repeat")i=CGL.Texture.WRAP_MIRRORED_REPEAT;if(o.get()=="clamp to edge")i=CGL.Texture.WRAP_CLAMP_TO_EDGE;let n=CGL.Texture.createFromImage(s.patch.cgl,r,{filter:t,wrap:i});l.set(n)};r.src=e.target.result};if(e&&e.target&&e.target.files[0])t.readAsDataURL(e.target.files[0])}t.onChange=_;i.onChange=m;n.onChange=p;s.onDelete=x;s.toWorkNeedsParent("Ops.Sidebar.Sidebar");function p(){h.id=n.get()}function m(){let e=i.get();u.textContent=e}function _(){r.set(null);let e=t.get();if(e&&e.parentElement){e.parentElement.appendChild(h);r.set(e)}else{if(h.parentElement){h.parentElement.removeChild(h)}}}function b(e){if(e)e.style.display="block"}function v(e){if(e)e.style.display="none"}function x(){E(h)}function E(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["6e8600c4-fb7d-4315-88d4-4f10009538a7"]={f:Ops.Extension.Deprecated.LocalTextureFile,objName:"Ops.Extension.Deprecated.LocalTextureFile"};Ops.Math.Multiply=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),n=e.inValueFloat("number2",1),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){const e=i.get();const t=n.get();r.set(e*t)}}};CABLES.OPS["1bbdae06-fbb2-489b-9bcc-36c9d65bd441"]={f:Ops.Math.Multiply,objName:"Ops.Math.Multiply"};Ops.Gl.Textures.SwitchTextures_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("exec"),n=this.inValueInt("num"),r=t.inValueBool("Default Texture Transparent",true),s=t.outTrigger("Next"),a=this.outTexture("texture");const o=t.patch.cgl;const l=[];let h=0;let u=-1;let c=CGL.Texture.getEmptyTexture(o);t.toWorkPortsNeedToBeLinked(i);i.onTriggered=function(){d();s.trigger()};r.onChange=function(){if(r.get())c=CGL.Texture.getEmptyTexture(o);else c=CGL.Texture.getTempTexture(o);d(true)};for(let e=0;e<16;e++){const g=t.inTexture("texture"+e);l.push(g);g.onChange=f}function f(){d(true)}function d(e){h=parseInt(n.get(),10);if(!e){if(h==u)return;if(h!=h)return}if(isNaN(h)||h<0||h>l.length-1)h=0;if(l[h].get())a.setRef(l[h].get());else a.setRef(c);u=h}}};CABLES.OPS["a82ae429-ac07-4760-882b-595a857c7ae0"]={f:Ops.Gl.Textures.SwitchTextures_v2,objName:"Ops.Gl.Textures.SwitchTextures_v2"};Ops.Gl.Textures.TextureInfo=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inObject("Texture",null,"texture"),n=e.outNumber("Name"),r=e.outString("PixelFormat"),s=e.outNumber("Width"),a=e.outNumber("Height"),o=e.outNumber("Ratio"),l=e.outNumber("Filter"),h=e.outNumber("Wrap"),u=e.outBoolNum("Flipped"),c=e.outBoolNum("HDR"),f=e.outBoolNum("Is Empty Default Texture",false),d=e.outBoolNum("Is Default Texture",false),g=e.outBoolNum("Is Cubemap"),p=e.outNumber("Id");c.setUiAttribs({title:"Float Texture"});const m=CGL.Texture.getEmptyTexture(e.patch.cgl);const _=CGL.Texture.getTempTexture(e.patch.cgl);i.onChange=function(){if(i.get()){n.set(i.get().name);s.set(i.get().width);a.set(i.get().height);o.set(i.get().width/i.get().height);let e="unknown";if(i.get().filter==CGL.Texture.FILTER_NEAREST)e="nearest";else if(i.get().filter==CGL.Texture.FILTER_LINEAR)e="linear";else if(i.get().filter==CGL.Texture.FILTER_MIPMAP)e="mipmap";l.set(i.get().filter+" "+e);let t="unknown";if(i.get().wrap==CGL.Texture.WRAP_CLAMP_TO_EDGE)t="clamp to edge";else if(i.get().wrap==CGL.Texture.WRAP_REPEAT)t="repeat";else if(i.get().wrap==CGL.Texture.WRAP_MIRRORED_REPEAT)t="mirrored repeat";h.set(i.get().wrap+" "+t);r.set(i.get().pixelFormat);p.set(i.get().id);u.set(i.get().flipped);c.set(i.get().isFloatingPoint&&i.get().isFloatingPoint());g.set(i.get().cubemap)}else{n.set("no texture");s.set(0);a.set(0);o.set(0);l.set(null);h.set(null);p.set(null);u.set(false);c.set(false);g.set(false)}f.set(i.get()==m);d.set(i.get()==_)}}};CABLES.OPS["71e5ee4c-3455-4c09-abb2-67abf382f35b"]={f:Ops.Gl.Textures.TextureInfo,objName:"Ops.Gl.Textures.TextureInfo"};Ops.Math.Compare.GreaterThan=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1"),n=e.inValueFloat("number2"),r=e.outBoolNum("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;function s(){r.set(i.get()>n.get())}}};CABLES.OPS["b250d606-f7f8-44d3-b099-c29efff2608a"]={f:Ops.Math.Compare.GreaterThan,objName:"Ops.Math.Compare.GreaterThan"};Ops.Ui.Area=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Title",""),n=e.inTriggerButton("Delete");i.setUiAttribs({hidePort:true});e.setUiAttrib({hasArea:true});e.init=i.onChange=e.onLoaded=r;r();function r(){if(CABLES.UI){gui.savedState.setUnSaved("areaOp",e.getSubPatch());e.uiAttr({comment_title:i.get()||" "});e.name=i.get()}}n.onTriggered=()=>{e.patch.deleteOp(e.id)}}};CABLES.OPS["38f79614-b0de-4960-8da5-2827e7f43415"]={f:Ops.Ui.Area,objName:"Ops.Ui.Area"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});(function e(t,i){if(typeof exports==="object"&&typeof module==="object")module.exports=i();else if(typeof define==="function"&&define.amd)define([],i);else if(typeof exports==="object")exports.ColorRick=i();else t.ColorRick=i()})(self,()=>{return(()=>{let __webpack_modules__={"./index.js":(module,__unused_webpack_exports,__webpack_require__)=>{eval('const chroma = __webpack_require__(/*! chroma-js */ "./node_modules/chroma-js/chroma.js");\n\nclass ColorRick\n{\n    constructor(options)\n    {\n        this._elements=[];\n\n        this.options=options;\n        this._opacity=options.opacity;\n\n        this._areaWidth=256;\n        this._areaHeight=150;\n\n        this._elContainer = document.createElement("div");\n        this._elContainer.classList.add("colorRick_dialog");\n        document.body.appendChild(this._elContainer);\n        this._elements.push(this._elContainer);\n\n        if(!options.showOpacity) \n        {\n            this._elContainer.style.setProperty(\'--width-opacity\', "0px");\n            this._elContainer.style.setProperty(\'--pad-opacity\', "0px");\n        }\n\n\n\n        this._elContainer.style.setProperty(\'--width\', this._areaWidth + "px");\n        this._elContainer.style.setProperty(\'--height\', this._areaHeight + "px");\n\n\n        this._elArea = document.createElement("div");\n        this._elArea.classList.add("colorRick_area");\n        this._elContainer.appendChild(this._elArea);\n        this._elements.push(this._elArea);\n\n        this._elAreaCursor = document.createElement("div");\n        this._elAreaCursor.classList.add("colorRick_cursor");\n        this._elArea.appendChild(this._elAreaCursor);\n        this._elements.push(this._elAreaCursor);\n\n        this._elBrightness = document.createElement("div");\n        this._elBrightness.classList.add("colorRick_brightness");\n        this._elArea.appendChild(this._elBrightness);\n        this._elements.push(this._elBrightness);\n\n        // hue slider\n\n        this._elHue = document.createElement("div");\n        this._elHue.classList.add("colorRick_hue");\n        this._elContainer.appendChild(this._elHue);\n        this._elements.push(this._elHue);\n\n        this._elHueCursor = document.createElement("div");\n        this._elHueCursor.classList.add("colorRick_cursor_hue");\n        this._elHue.appendChild(this._elHueCursor);\n        this._elements.push(this._elHueCursor);\n\n        // eye dropper\n\n        if(window.EyeDropper)\n        {\n            this._elDropper = document.createElement("div");\n            this._elDropper.classList.add("colorRick_eyeDrop");\n            this._elContainer.appendChild(this._elDropper);\n            this._elements.push(this._elDropper);\n    \n        }\n\n\n\n        // opacity slider\n\n        if(options.showOpacity) \n        {\n            this._elOpacity = document.createElement("div");\n            this._elOpacity.classList.add("colorRick_opacity");\n            this._elContainer.appendChild(this._elOpacity);\n            this._elements.push(this._elOpacity);\n\n            this._elOpacityCursor = document.createElement("div");\n            this._elOpacityCursor.classList.add("colorRick_cursor_opacity");\n            this._elOpacity.appendChild(this._elOpacityCursor);\n            this._elements.push(this._elOpacityCursor);\n        }\n\n\n        this._elColorBox = document.createElement("div");\n        this._elColorBox.classList.add("colorRick_preview");\n        this._elContainer.appendChild(this._elColorBox);\n        this._elements.push(this._elColorBox);\n\n        this._elColorBoxOrig = document.createElement("div");\n        this._elColorBoxOrig.classList.add("colorRick_preview");\n        this._elColorBoxOrig.classList.add("colorRick_preview_orig");\n        this._elContainer.appendChild(this._elColorBoxOrig);\n        this._elements.push(this._elColorBoxOrig);\n\n        this._elInputContainer = document.createElement("div");\n        this._elInputContainer.classList.add("colorRick_inputcontainer");\n        this._elContainer.appendChild(this._elInputContainer);\n        this._elements.push(this._elInputContainer);\n\n        \n        let inputs=\n            "<table>"+\n                "<tr>"+\n                    "<td>"+\n                        "HEX"+\n                    "</td>"+\n                    "<td class=\\"right\\">"+\n                        "<input id=\\"colorRick_input_hex\\" class=\\"colorRick_input colorRick_input_hex\\" />"+\n                        "<div class=\\"opacity_title\\" id=\\"colorrick_opacity_title\\">Opacity:</div> <input id=\\"colorRick_input_opacity\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                    "</td>"+\n                "</tr>"+\n                "<tr>"+\n                    "<td>"+\n                        "RGB"+\n                    "</td>"+\n                    "<td class=\\"right\\">"+\n                        "<input id=\\"colorRick_input_r\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                        "<input id=\\"colorRick_input_g\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                        "<input id=\\"colorRick_input_b\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                    "</td>"+\n                "</tr>"+\n                "<tr>"+\n                    "<td>"+\n                        "HSV"+\n                    "</td>"+\n                    "<td class=\\"right\\">"+\n                        "<input id=\\"colorRick_input_h\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                        "<input id=\\"colorRick_input_s\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                        "<input id=\\"colorRick_input_v\\" class=\\"colorRick_input colorRick_input_small\\" />"+\n                    "</td>"+\n                "</tr>"+\n            "</table>";\n\n\n        this._elInputContainer.innerHTML=inputs;\n\n        this._inputHex=document.getElementById("colorRick_input_hex");\n\n        this._inputOpacity=document.getElementById("colorRick_input_opacity");\n        \n        if(!options.showOpacity) \n        {\n            this._inputOpacity1=document.getElementById("colorrick_opacity_title");\n            this._inputOpacity1.style.opacity=0.0;\n            this._inputOpacity.style.opacity=0.0;\n        }\n\n        this._inputR=document.getElementById("colorRick_input_r");\n        this._inputG=document.getElementById("colorRick_input_g");\n        this._inputB=document.getElementById("colorRick_input_b");\n\n        this._inputH=document.getElementById("colorRick_input_h");\n        this._inputS=document.getElementById("colorRick_input_s");\n        this._inputV=document.getElementById("colorRick_input_v");\n\n        this._elements.push(this._inputHex);\n        this._elements.push(this._inputR,this._inputG,this._inputB);\n        this._elements.push(this._inputH,this._inputS,this._inputV);\n        \n\n        this._color=chroma("white");\n\n\n        if(this.options.color)\n        {\n            this.setColor(this.options.color);\n\n        }\n\n        this._elColorBoxOrig.style.backgroundColor=this._color.hex();\n\n\n        this.updateColorField();\n\n\n        \n\n        this._inputR.addEventListener("input",(e)=>\n        {\n            this._setColorFromRgbInputs();\n        });\n\n        this._inputG.addEventListener("input",(e)=>\n        {\n            this._setColorFromRgbInputs();\n        });\n\n        this._inputB.addEventListener("input",(e)=>\n        {\n            this._setColorFromRgbInputs();\n        });\n\n\n        this._inputH.addEventListener("input",(e)=>\n        {\n            this._setColorFromHsvInputs();\n        });\n\n        this._inputS.addEventListener("input",(e)=>\n        {\n            this._setColorFromHsvInputs();\n        });\n\n        this._inputV.addEventListener("input",(e)=>\n        {\n            this._setColorFromHsvInputs();\n        });\n\n\n\n\n        this._inputHex.addEventListener("input",(e)=>\n        {\n            if(this.validateHexInput()) this.setColor(this.validateHexInput())\n        });\n\n        this._inputHex.addEventListener("blur",(e)=>\n        {\n            if(!this.validateHexInput()) \n            {\n                this._inputHex.classList.remove("colorRick_invalid");\n                this._inputHex.value=this._color.hex();\n            }\n\n        });\n\n        this._inputOpacity.addEventListener("input",(e)=>\n        {\n            const f=parseFloat(this._inputOpacity.value);\n\n            if(f===f)\n            {\n                this._opacity=parseFloat(this._inputOpacity.value);\n                console.log(this._opacity)\n                this.updateColorField();\n            }\n        });\n\n\n\n        this._elHue.addEventListener("pointerdown",this._onHueMouse.bind(this));\n        this._elHue.addEventListener("pointermove",this._onHueMouse.bind(this));\n\n        \n        if(this._elOpacity) this._elOpacity.addEventListener("pointerdown",this._onOpacityMouse.bind(this));\n        if(this._elOpacity) this._elOpacity.addEventListener("pointermove",this._onOpacityMouse.bind(this));\n\n        if(this._elOpacity) this._elOpacity.addEventListener("wheel",(e)=>\n        {\n            let speed=0.003;\n            if(e.altKey)speed/=3;\n            if(e.deltaY>0)this._opacity-=speed;\n            else this._opacity+=speed;\n    \n            this.updateColorField();\n            \n            e.preventDefault();\n        },{"passive":false});\n\n        \n        this._elHue.addEventListener("wheel",(e)=>\n        {\n            let speed=0.5;\n            if(e.altKey)speed/=3;\n            this._hue=parseFloat(this._hue);\n\n            if(e.deltaY>0)this._hue-=speed;\n            else this._hue+=speed;\n            this._inputH.value=this._hue;\n\n            this._setColorFromHsvInputs();\n            \n            e.preventDefault();\n        },{"passive":false});\n\n\n        if(this.options.ele)\n        {\n            const r=this.options.ele.getBoundingClientRect();\n\n            const padding=30;\n            const containerSize=this._elContainer.getBoundingClientRect();\n            const leftAligned=(r.x+padding)>window.innerWidth-containerSize.width;\n\n            if(!leftAligned) this._elContainer.style.left=(r.x+padding)+"px";\n            else this._elContainer.style.left=(r.x-containerSize.width)+"px";\n            \n            if(r.y+containerSize.height>window.innerHeight) this._elContainer.style.top=(window.innerHeight-containerSize.height-10)+"px";\n            else this._elContainer.style.top=(r.y)+"px";\n        }\n\n        this._elHue.addEventListener("pointerdown",(e)=> { this._elHue.setPointerCapture(e.pointerId); if(this.options.onStart)this.options.onStart();});\n        this._elHue.addEventListener("pointerup",(e)=> { this._elHue.releasePointerCapture(e.pointerId); if(this.options.onEnd)this.options.onEnd();});\n\n        this._elArea.addEventListener("pointerdown",(e)=> { this._elArea.setPointerCapture(e.pointerId); if(this.options.onStart)this.options.onStart();});\n        this._elArea.addEventListener("pointerup",(e)=> { this._elArea.releasePointerCapture(e.pointerId); if(this.options.onEnd)this.options.onEnd();});\n\n\n        this._elArea.addEventListener("pointerdown",this._onAreaMouse.bind(this));\n        this._elArea.addEventListener("pointermove",this._onAreaMouse.bind(this));\n        this._elArea.addEventListener("wheel",(e)=>\n        {\n            let speed=0.008;\n            if(e.altKey)speed/=3;\n            \n            if(e.deltaY>0)this._hueV-=speed;\n            else this._hueV+=speed;\n\n            this._inputV.value=this._hueV;\n\n            this.updateColorField();\n            e.preventDefault();\n\n        },{"passive":false});\n\n        this._elArea.addEventListener("pointerdown",(e)=> { this._elArea.setPointerCapture(e.pointerId); });\n        this._elArea.addEventListener("pointerup",(e)=> { this._elArea.releasePointerCapture(e.pointerId); });\n\n        if(!this.options.noCloseOutside)\n            document.addEventListener("pointerdown",this._clickOutside.bind(this));\n\n\n        if(this._elDropper)\n            this._elDropper.addEventListener("click",()=>\n            {\n                let picker = new EyeDropper().open();\n                picker.then((a) =>\n                {\n                    this._inputHex.value=a.sRGBHex;\n                    this.setColor(this.validateHexInput())\n                    \n                    \n                });\n\n            \n        });\n\n        this._elColorBoxOrig.addEventListener("click",()=>{\n            this.setColor(this._elColorBoxOrig.style.backgroundColor);\n        });\n    }\n\n    _clickOutside(e)\n    {\n        if(this.options.noCloseOutside)return;\n        if(this._elContainer.contains(e.target)) return true;\n\n        this.close();\n    }\n\n    validateHexInput()\n    {\n        let v=this._inputHex.value;\n        if(v.indexOf("#")==-1) v="#"+v;\n        const valid=v.length==7;\n\n        if(valid) \n        {\n            this._inputHex.classList.remove("colorRick_invalid");\n            return v;\n        }\n        else this._inputHex.classList.add("colorRick_invalid");\n    }\n\n    setHsvInputs(h,s,v)\n    {\n        if(parseFloat(h)!=parseFloat(h)) h=0; // when grey\n        this._inputH.value=parseFloat(h)||0;\n        this._inputS.value=parseFloat(s)||0;\n        this._inputV.value=parseFloat(v)||0;\n    }\n\n    _setColorFromHsvInputs()\n    {\n        this._hue=parseFloat(this._inputH.value)||0;\n        this._hueS=parseFloat(this._inputS.value);\n        this._hueV=parseFloat(this._inputV.value);\n\n        this.updateColorField();\n    }\n\n    _setColorFromRgbInputs()\n    {\n        this.setColor([parseInt(this._inputR.value),parseInt(this._inputG.value),parseInt(this._inputB.value)]);\n    }\n\n    setColor(c)\n    {\n        this._color=chroma(c);\n        this._hue=this._color.hsv()[0];\n        this._hueS=this._color.hsv()[1];\n        this._hueV=this._color.hsv()[2];\n\n        this.setHsvInputs(this._color.hsv()[0], this._inputS.value=this._color.hsv()[1], this._inputV.value=this._color.hsv()[2]);\n\n        this.updateColorField();\n    }\n\n    updateCursors()\n    {\n        if(this._color.luminance()>0.55)this._elAreaCursor.style.backgroundColor="black";\n        else this._elAreaCursor.style.backgroundColor="white";\n\n        if(this._elOpacityCursor)this._elOpacityCursor.style.top=(this._areaHeight-(this._opacity*this._areaHeight))+"px";\n        this._elHueCursor.style.top=(this._areaHeight-(this._hue/360*this._areaHeight))+"px";\n        this._elAreaCursor.style.marginLeft=(this._color.hsv()[1]*this._areaWidth-3)+"px";\n        this._elAreaCursor.style.marginTop=(this._areaHeight-(this._color.hsv()[2]*this._areaHeight)-3)+"px";\n    }\n\n    validateHSV()\n    {\n\n    }\n\n    updateColorField()\n    {\n        if(this._hue!=this._hue)this._hue=0;\n        if(this._hue<0)this._hue=0;\n        if(this._hue>360)this._hue=360;\n\n        if(this._hueV!=this._hueV)this._hueV=0.0001;\n        if(this._hueV<0)this._hueV=0.0001;\n        if(this._hueV>1)this._hueV=1;\n\n        if(this._hueS!=this._hueS)this._hueS=0.0001;\n        if(this._hueS<0)this._hueS=0.0001;\n        if(this._hueS>1)this._hueS=1;\n\n        this._color=chroma(this._hue%360, this._hueS, this._hueV, \'hsv\');\n\n        if(this.options.onChange && (this._currentHex!=this._color.hex() || this._currentOpacity!=this._opacity))this.options.onChange(this._color,this._opacity);\n        this._currentHex=this._color.hex();\n        this._currentOpacity=this._opacity;\n\n        const rgb_bgcol=chroma(this._hue%360, 1,1, \'hsv\').rgb();\n        this._elArea.style.background="linear-gradient(to right, rgb(255, 255, 255), rgb("+rgb_bgcol[0]+", "+rgb_bgcol[1]+", "+rgb_bgcol[2]+"))"\n\n\n        \n        \n        if(this._elOpacity)\n        {\n            this._elColorBox.style.background="linear-gradient(to right,rgba("+this._color.rgb()[0]+","+this._color.rgb()[1]+","+this._color.rgb()[2]+",1) 50%,rgba("+this._color.rgb()[0]+","+this._color.rgb()[1]+","+this._color.rgb()[2]+","+this._opacity+") 51%)";\n            this._elOpacity.style.background="linear-gradient(rgba("+this._color.rgb()[0]+","+this._color.rgb()[1]+","+this._color.rgb()[2]+",1),rgba("+this._color.rgb()[0]+","+this._color.rgb()[1]+","+this._color.rgb()[2]+",0))"\n        }\n        else\n        {\n            this._elColorBox.style.backgroundColor=this._color.hex();\n        }\n\n\n        if(this._inputOpacity.value!=this._opacity) this._inputOpacity.value=Math.round(this._opacity*10000)/10000;\n        this._inputHex.value=this._color.hex();\n\n        this._inputR.value=this._color.rgb()[0];\n        this._inputG.value=this._color.rgb()[1];\n        this._inputB.value=this._color.rgb()[2];\n\n        this.updateCursors();\n    }\n\n    close()\n    {\n        if(!this.options.noCloseOutside)\n            document.removeEventListener("pointerdown",this._clickOutside.bind(this));\n\n        for(let i=0;i<this._elements.length;i++) this._elements[i].remove();\n    }\n\n    _onHueMouse(e)\n    {\n        if(e.buttons==1)\n        {\n            const y=Math.min(this._areaHeight,Math.max(0,e.offsetY));\n\n            this._hue=(1.0-(y/this._areaHeight))*360;\n\n            this.setHsvInputs(this._hue,this._hueS,this._hueV);\n\n            this.updateColorField();\n        }\n    }\n\n    _onOpacityMouse(e)\n    {\n        if(e.buttons==1)\n        {\n            const y=Math.min(this._areaHeight,Math.max(0,e.offsetY));\n\n            this._opacity=(1.0-(y/this._areaHeight));\n            this.updateColorField();\n        }\n    }\n\n\n\n    _onAreaMouse(e)\n    {\n        if(e.buttons==1)\n        {\n            const x=Math.min(this._areaWidth,Math.max(0,e.offsetX));\n            const y=Math.min(this._areaHeight,Math.max(0,e.offsetY));\n            \n            this._hueV=1.0-(y/this._areaHeight);\n            this._hueS=(x/this._areaWidth);\n\n            this._inputS.value=this._hueS;\n            this._inputV.value=this._hueV;\n            this._setColorFromHsvInputs();\n            \n        }\n    }\n};\n\nmodule.exports=ColorRick;\n\n\n\n//# sourceURL=webpack://ColorRick/./index.js?')},"./node_modules/chroma-js/chroma.js":function(module){eval("/**\n * chroma.js - JavaScript library for color conversions\n *\n * Copyright (c) 2011-2019, Gregor Aisch\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n * list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. The name Gregor Aisch may not be used to endorse or promote products\n * derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * -------------------------------------------------------\n *\n * chroma.js includes colors from colorbrewer2.org, which are released under\n * the following license:\n *\n * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,\n * and The Pennsylvania State University.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n * either express or implied. See the License for the specific\n * language governing permissions and limitations under the License.\n *\n * ------------------------------------------------------\n *\n * Named colors are taken from X11 Color Names.\n * http://www.w3.org/TR/css3-color/#svg-color\n *\n * @preserve\n */\n\n(function (global, factory) {\n     true ? module.exports = factory() :\n    0;\n})(this, (function () { 'use strict';\n\n    var limit$2 = function (x, min, max) {\n        if ( min === void 0 ) min=0;\n        if ( max === void 0 ) max=1;\n\n        return x < min ? min : x > max ? max : x;\n    };\n\n    var limit$1 = limit$2;\n\n    var clip_rgb$3 = function (rgb) {\n        rgb._clipped = false;\n        rgb._unclipped = rgb.slice(0);\n        for (var i=0; i<=3; i++) {\n            if (i < 3) {\n                if (rgb[i] < 0 || rgb[i] > 255) { rgb._clipped = true; }\n                rgb[i] = limit$1(rgb[i], 0, 255);\n            } else if (i === 3) {\n                rgb[i] = limit$1(rgb[i], 0, 1);\n            }\n        }\n        return rgb;\n    };\n\n    // ported from jQuery's $.type\n    var classToType = {};\n    for (var i$1 = 0, list$1 = ['Boolean', 'Number', 'String', 'Function', 'Array', 'Date', 'RegExp', 'Undefined', 'Null']; i$1 < list$1.length; i$1 += 1) {\n        var name = list$1[i$1];\n\n        classToType[(\"[object \" + name + \"]\")] = name.toLowerCase();\n    }\n    var type$p = function(obj) {\n        return classToType[Object.prototype.toString.call(obj)] || \"object\";\n    };\n\n    var type$o = type$p;\n\n    var unpack$B = function (args, keyOrder) {\n        if ( keyOrder === void 0 ) keyOrder=null;\n\n    \t// if called with more than 3 arguments, we return the arguments\n        if (args.length >= 3) { return Array.prototype.slice.call(args); }\n        // with less than 3 args we check if first arg is object\n        // and use the keyOrder string to extract and sort properties\n    \tif (type$o(args[0]) == 'object' && keyOrder) {\n    \t\treturn keyOrder.split('')\n    \t\t\t.filter(function (k) { return args[0][k] !== undefined; })\n    \t\t\t.map(function (k) { return args[0][k]; });\n    \t}\n    \t// otherwise we just return the first argument\n    \t// (which we suppose is an array of args)\n        return args[0];\n    };\n\n    var type$n = type$p;\n\n    var last$4 = function (args) {\n        if (args.length < 2) { return null; }\n        var l = args.length-1;\n        if (type$n(args[l]) == 'string') { return args[l].toLowerCase(); }\n        return null;\n    };\n\n    var PI$2 = Math.PI;\n\n    var utils = {\n    \tclip_rgb: clip_rgb$3,\n    \tlimit: limit$2,\n    \ttype: type$p,\n    \tunpack: unpack$B,\n    \tlast: last$4,\n    \tPI: PI$2,\n    \tTWOPI: PI$2*2,\n    \tPITHIRD: PI$2/3,\n    \tDEG2RAD: PI$2 / 180,\n    \tRAD2DEG: 180 / PI$2\n    };\n\n    var input$h = {\n    \tformat: {},\n    \tautodetect: []\n    };\n\n    var last$3 = utils.last;\n    var clip_rgb$2 = utils.clip_rgb;\n    var type$m = utils.type;\n    var _input = input$h;\n\n    var Color$D = function Color() {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var me = this;\n        if (type$m(args[0]) === 'object' &&\n            args[0].constructor &&\n            args[0].constructor === this.constructor) {\n            // the argument is already a Color instance\n            return args[0];\n        }\n\n        // last argument could be the mode\n        var mode = last$3(args);\n        var autodetect = false;\n\n        if (!mode) {\n            autodetect = true;\n            if (!_input.sorted) {\n                _input.autodetect = _input.autodetect.sort(function (a,b) { return b.p - a.p; });\n                _input.sorted = true;\n            }\n            // auto-detect format\n            for (var i = 0, list = _input.autodetect; i < list.length; i += 1) {\n                var chk = list[i];\n\n                mode = chk.test.apply(chk, args);\n                if (mode) { break; }\n            }\n        }\n\n        if (_input.format[mode]) {\n            var rgb = _input.format[mode].apply(null, autodetect ? args : args.slice(0,-1));\n            me._rgb = clip_rgb$2(rgb);\n        } else {\n            throw new Error('unknown format: '+args);\n        }\n\n        // add alpha channel\n        if (me._rgb.length === 3) { me._rgb.push(1); }\n    };\n\n    Color$D.prototype.toString = function toString () {\n        if (type$m(this.hex) == 'function') { return this.hex(); }\n        return (\"[\" + (this._rgb.join(',')) + \"]\");\n    };\n\n    var Color_1 = Color$D;\n\n    var chroma$k = function () {\n    \tvar args = [], len = arguments.length;\n    \twhile ( len-- ) args[ len ] = arguments[ len ];\n\n    \treturn new (Function.prototype.bind.apply( chroma$k.Color, [ null ].concat( args) ));\n    };\n\n    chroma$k.Color = Color_1;\n    chroma$k.version = '2.4.2';\n\n    var chroma_1 = chroma$k;\n\n    var unpack$A = utils.unpack;\n    var max$2 = Math.max;\n\n    var rgb2cmyk$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$A(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        r = r / 255;\n        g = g / 255;\n        b = b / 255;\n        var k = 1 - max$2(r,max$2(g,b));\n        var f = k < 1 ? 1 / (1-k) : 0;\n        var c = (1-r-k) * f;\n        var m = (1-g-k) * f;\n        var y = (1-b-k) * f;\n        return [c,m,y,k];\n    };\n\n    var rgb2cmyk_1 = rgb2cmyk$1;\n\n    var unpack$z = utils.unpack;\n\n    var cmyk2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$z(args, 'cmyk');\n        var c = args[0];\n        var m = args[1];\n        var y = args[2];\n        var k = args[3];\n        var alpha = args.length > 4 ? args[4] : 1;\n        if (k === 1) { return [0,0,0,alpha]; }\n        return [\n            c >= 1 ? 0 : 255 * (1-c) * (1-k), // r\n            m >= 1 ? 0 : 255 * (1-m) * (1-k), // g\n            y >= 1 ? 0 : 255 * (1-y) * (1-k), // b\n            alpha\n        ];\n    };\n\n    var cmyk2rgb_1 = cmyk2rgb;\n\n    var chroma$j = chroma_1;\n    var Color$C = Color_1;\n    var input$g = input$h;\n    var unpack$y = utils.unpack;\n    var type$l = utils.type;\n\n    var rgb2cmyk = rgb2cmyk_1;\n\n    Color$C.prototype.cmyk = function() {\n        return rgb2cmyk(this._rgb);\n    };\n\n    chroma$j.cmyk = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$C, [ null ].concat( args, ['cmyk']) ));\n    };\n\n    input$g.format.cmyk = cmyk2rgb_1;\n\n    input$g.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$y(args, 'cmyk');\n            if (type$l(args) === 'array' && args.length === 4) {\n                return 'cmyk';\n            }\n        }\n    });\n\n    var unpack$x = utils.unpack;\n    var last$2 = utils.last;\n    var rnd = function (a) { return Math.round(a*100)/100; };\n\n    /*\n     * supported arguments:\n     * - hsl2css(h,s,l)\n     * - hsl2css(h,s,l,a)\n     * - hsl2css([h,s,l], mode)\n     * - hsl2css([h,s,l,a], mode)\n     * - hsl2css({h,s,l,a}, mode)\n     */\n    var hsl2css$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var hsla = unpack$x(args, 'hsla');\n        var mode = last$2(args) || 'lsa';\n        hsla[0] = rnd(hsla[0] || 0);\n        hsla[1] = rnd(hsla[1]*100) + '%';\n        hsla[2] = rnd(hsla[2]*100) + '%';\n        if (mode === 'hsla' || (hsla.length > 3 && hsla[3]<1)) {\n            hsla[3] = hsla.length > 3 ? hsla[3] : 1;\n            mode = 'hsla';\n        } else {\n            hsla.length = 3;\n        }\n        return (mode + \"(\" + (hsla.join(',')) + \")\");\n    };\n\n    var hsl2css_1 = hsl2css$1;\n\n    var unpack$w = utils.unpack;\n\n    /*\n     * supported arguments:\n     * - rgb2hsl(r,g,b)\n     * - rgb2hsl(r,g,b,a)\n     * - rgb2hsl([r,g,b])\n     * - rgb2hsl([r,g,b,a])\n     * - rgb2hsl({r,g,b,a})\n     */\n    var rgb2hsl$3 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$w(args, 'rgba');\n        var r = args[0];\n        var g = args[1];\n        var b = args[2];\n\n        r /= 255;\n        g /= 255;\n        b /= 255;\n\n        var min = Math.min(r, g, b);\n        var max = Math.max(r, g, b);\n\n        var l = (max + min) / 2;\n        var s, h;\n\n        if (max === min){\n            s = 0;\n            h = Number.NaN;\n        } else {\n            s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (2 - max - min);\n        }\n\n        if (r == max) { h = (g - b) / (max - min); }\n        else if (g == max) { h = 2 + (b - r) / (max - min); }\n        else if (b == max) { h = 4 + (r - g) / (max - min); }\n\n        h *= 60;\n        if (h < 0) { h += 360; }\n        if (args.length>3 && args[3]!==undefined) { return [h,s,l,args[3]]; }\n        return [h,s,l];\n    };\n\n    var rgb2hsl_1 = rgb2hsl$3;\n\n    var unpack$v = utils.unpack;\n    var last$1 = utils.last;\n    var hsl2css = hsl2css_1;\n    var rgb2hsl$2 = rgb2hsl_1;\n    var round$6 = Math.round;\n\n    /*\n     * supported arguments:\n     * - rgb2css(r,g,b)\n     * - rgb2css(r,g,b,a)\n     * - rgb2css([r,g,b], mode)\n     * - rgb2css([r,g,b,a], mode)\n     * - rgb2css({r,g,b,a}, mode)\n     */\n    var rgb2css$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgba = unpack$v(args, 'rgba');\n        var mode = last$1(args) || 'rgb';\n        if (mode.substr(0,3) == 'hsl') {\n            return hsl2css(rgb2hsl$2(rgba), mode);\n        }\n        rgba[0] = round$6(rgba[0]);\n        rgba[1] = round$6(rgba[1]);\n        rgba[2] = round$6(rgba[2]);\n        if (mode === 'rgba' || (rgba.length > 3 && rgba[3]<1)) {\n            rgba[3] = rgba.length > 3 ? rgba[3] : 1;\n            mode = 'rgba';\n        }\n        return (mode + \"(\" + (rgba.slice(0,mode==='rgb'?3:4).join(',')) + \")\");\n    };\n\n    var rgb2css_1 = rgb2css$1;\n\n    var unpack$u = utils.unpack;\n    var round$5 = Math.round;\n\n    var hsl2rgb$1 = function () {\n        var assign;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$u(args, 'hsl');\n        var h = args[0];\n        var s = args[1];\n        var l = args[2];\n        var r,g,b;\n        if (s === 0) {\n            r = g = b = l*255;\n        } else {\n            var t3 = [0,0,0];\n            var c = [0,0,0];\n            var t2 = l < 0.5 ? l * (1+s) : l+s-l*s;\n            var t1 = 2 * l - t2;\n            var h_ = h / 360;\n            t3[0] = h_ + 1/3;\n            t3[1] = h_;\n            t3[2] = h_ - 1/3;\n            for (var i=0; i<3; i++) {\n                if (t3[i] < 0) { t3[i] += 1; }\n                if (t3[i] > 1) { t3[i] -= 1; }\n                if (6 * t3[i] < 1)\n                    { c[i] = t1 + (t2 - t1) * 6 * t3[i]; }\n                else if (2 * t3[i] < 1)\n                    { c[i] = t2; }\n                else if (3 * t3[i] < 2)\n                    { c[i] = t1 + (t2 - t1) * ((2 / 3) - t3[i]) * 6; }\n                else\n                    { c[i] = t1; }\n            }\n            (assign = [round$5(c[0]*255),round$5(c[1]*255),round$5(c[2]*255)], r = assign[0], g = assign[1], b = assign[2]);\n        }\n        if (args.length > 3) {\n            // keep alpha channel\n            return [r,g,b,args[3]];\n        }\n        return [r,g,b,1];\n    };\n\n    var hsl2rgb_1 = hsl2rgb$1;\n\n    var hsl2rgb = hsl2rgb_1;\n    var input$f = input$h;\n\n    var RE_RGB = /^rgb\\(\\s*(-?\\d+),\\s*(-?\\d+)\\s*,\\s*(-?\\d+)\\s*\\)$/;\n    var RE_RGBA = /^rgba\\(\\s*(-?\\d+),\\s*(-?\\d+)\\s*,\\s*(-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n    var RE_RGB_PCT = /^rgb\\(\\s*(-?\\d+(?:\\.\\d+)?)%,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*\\)$/;\n    var RE_RGBA_PCT = /^rgba\\(\\s*(-?\\d+(?:\\.\\d+)?)%,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n    var RE_HSL = /^hsl\\(\\s*(-?\\d+(?:\\.\\d+)?),\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*\\)$/;\n    var RE_HSLA = /^hsla\\(\\s*(-?\\d+(?:\\.\\d+)?),\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)$/;\n\n    var round$4 = Math.round;\n\n    var css2rgb$1 = function (css) {\n        css = css.toLowerCase().trim();\n        var m;\n\n        if (input$f.format.named) {\n            try {\n                return input$f.format.named(css);\n            } catch (e) {\n                // eslint-disable-next-line\n            }\n        }\n\n        // rgb(250,20,0)\n        if ((m = css.match(RE_RGB))) {\n            var rgb = m.slice(1,4);\n            for (var i=0; i<3; i++) {\n                rgb[i] = +rgb[i];\n            }\n            rgb[3] = 1;  // default alpha\n            return rgb;\n        }\n\n        // rgba(250,20,0,0.4)\n        if ((m = css.match(RE_RGBA))) {\n            var rgb$1 = m.slice(1,5);\n            for (var i$1=0; i$1<4; i$1++) {\n                rgb$1[i$1] = +rgb$1[i$1];\n            }\n            return rgb$1;\n        }\n\n        // rgb(100%,0%,0%)\n        if ((m = css.match(RE_RGB_PCT))) {\n            var rgb$2 = m.slice(1,4);\n            for (var i$2=0; i$2<3; i$2++) {\n                rgb$2[i$2] = round$4(rgb$2[i$2] * 2.55);\n            }\n            rgb$2[3] = 1;  // default alpha\n            return rgb$2;\n        }\n\n        // rgba(100%,0%,0%,0.4)\n        if ((m = css.match(RE_RGBA_PCT))) {\n            var rgb$3 = m.slice(1,5);\n            for (var i$3=0; i$3<3; i$3++) {\n                rgb$3[i$3] = round$4(rgb$3[i$3] * 2.55);\n            }\n            rgb$3[3] = +rgb$3[3];\n            return rgb$3;\n        }\n\n        // hsl(0,100%,50%)\n        if ((m = css.match(RE_HSL))) {\n            var hsl = m.slice(1,4);\n            hsl[1] *= 0.01;\n            hsl[2] *= 0.01;\n            var rgb$4 = hsl2rgb(hsl);\n            rgb$4[3] = 1;\n            return rgb$4;\n        }\n\n        // hsla(0,100%,50%,0.5)\n        if ((m = css.match(RE_HSLA))) {\n            var hsl$1 = m.slice(1,4);\n            hsl$1[1] *= 0.01;\n            hsl$1[2] *= 0.01;\n            var rgb$5 = hsl2rgb(hsl$1);\n            rgb$5[3] = +m[4];  // default alpha = 1\n            return rgb$5;\n        }\n    };\n\n    css2rgb$1.test = function (s) {\n        return RE_RGB.test(s) ||\n            RE_RGBA.test(s) ||\n            RE_RGB_PCT.test(s) ||\n            RE_RGBA_PCT.test(s) ||\n            RE_HSL.test(s) ||\n            RE_HSLA.test(s);\n    };\n\n    var css2rgb_1 = css2rgb$1;\n\n    var chroma$i = chroma_1;\n    var Color$B = Color_1;\n    var input$e = input$h;\n    var type$k = utils.type;\n\n    var rgb2css = rgb2css_1;\n    var css2rgb = css2rgb_1;\n\n    Color$B.prototype.css = function(mode) {\n        return rgb2css(this._rgb, mode);\n    };\n\n    chroma$i.css = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$B, [ null ].concat( args, ['css']) ));\n    };\n\n    input$e.format.css = css2rgb;\n\n    input$e.autodetect.push({\n        p: 5,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$k(h) === 'string' && css2rgb.test(h)) {\n                return 'css';\n            }\n        }\n    });\n\n    var Color$A = Color_1;\n    var chroma$h = chroma_1;\n    var input$d = input$h;\n    var unpack$t = utils.unpack;\n\n    input$d.format.gl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgb = unpack$t(args, 'rgba');\n        rgb[0] *= 255;\n        rgb[1] *= 255;\n        rgb[2] *= 255;\n        return rgb;\n    };\n\n    chroma$h.gl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$A, [ null ].concat( args, ['gl']) ));\n    };\n\n    Color$A.prototype.gl = function() {\n        var rgb = this._rgb;\n        return [rgb[0]/255, rgb[1]/255, rgb[2]/255, rgb[3]];\n    };\n\n    var unpack$s = utils.unpack;\n\n    var rgb2hcg$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$s(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var min = Math.min(r, g, b);\n        var max = Math.max(r, g, b);\n        var delta = max - min;\n        var c = delta * 100 / 255;\n        var _g = min / (255 - delta) * 100;\n        var h;\n        if (delta === 0) {\n            h = Number.NaN;\n        } else {\n            if (r === max) { h = (g - b) / delta; }\n            if (g === max) { h = 2+(b - r) / delta; }\n            if (b === max) { h = 4+(r - g) / delta; }\n            h *= 60;\n            if (h < 0) { h += 360; }\n        }\n        return [h, c, _g];\n    };\n\n    var rgb2hcg_1 = rgb2hcg$1;\n\n    var unpack$r = utils.unpack;\n    var floor$3 = Math.floor;\n\n    /*\n     * this is basically just HSV with some minor tweaks\n     *\n     * hue.. [0..360]\n     * chroma .. [0..1]\n     * grayness .. [0..1]\n     */\n\n    var hcg2rgb = function () {\n        var assign, assign$1, assign$2, assign$3, assign$4, assign$5;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$r(args, 'hcg');\n        var h = args[0];\n        var c = args[1];\n        var _g = args[2];\n        var r,g,b;\n        _g = _g * 255;\n        var _c = c * 255;\n        if (c === 0) {\n            r = g = b = _g;\n        } else {\n            if (h === 360) { h = 0; }\n            if (h > 360) { h -= 360; }\n            if (h < 0) { h += 360; }\n            h /= 60;\n            var i = floor$3(h);\n            var f = h - i;\n            var p = _g * (1 - c);\n            var q = p + _c * (1 - f);\n            var t = p + _c * f;\n            var v = p + _c;\n            switch (i) {\n                case 0: (assign = [v, t, p], r = assign[0], g = assign[1], b = assign[2]); break\n                case 1: (assign$1 = [q, v, p], r = assign$1[0], g = assign$1[1], b = assign$1[2]); break\n                case 2: (assign$2 = [p, v, t], r = assign$2[0], g = assign$2[1], b = assign$2[2]); break\n                case 3: (assign$3 = [p, q, v], r = assign$3[0], g = assign$3[1], b = assign$3[2]); break\n                case 4: (assign$4 = [t, p, v], r = assign$4[0], g = assign$4[1], b = assign$4[2]); break\n                case 5: (assign$5 = [v, p, q], r = assign$5[0], g = assign$5[1], b = assign$5[2]); break\n            }\n        }\n        return [r, g, b, args.length > 3 ? args[3] : 1];\n    };\n\n    var hcg2rgb_1 = hcg2rgb;\n\n    var unpack$q = utils.unpack;\n    var type$j = utils.type;\n    var chroma$g = chroma_1;\n    var Color$z = Color_1;\n    var input$c = input$h;\n\n    var rgb2hcg = rgb2hcg_1;\n\n    Color$z.prototype.hcg = function() {\n        return rgb2hcg(this._rgb);\n    };\n\n    chroma$g.hcg = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$z, [ null ].concat( args, ['hcg']) ));\n    };\n\n    input$c.format.hcg = hcg2rgb_1;\n\n    input$c.autodetect.push({\n        p: 1,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$q(args, 'hcg');\n            if (type$j(args) === 'array' && args.length === 3) {\n                return 'hcg';\n            }\n        }\n    });\n\n    var unpack$p = utils.unpack;\n    var last = utils.last;\n    var round$3 = Math.round;\n\n    var rgb2hex$2 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$p(args, 'rgba');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var a = ref[3];\n        var mode = last(args) || 'auto';\n        if (a === undefined) { a = 1; }\n        if (mode === 'auto') {\n            mode = a < 1 ? 'rgba' : 'rgb';\n        }\n        r = round$3(r);\n        g = round$3(g);\n        b = round$3(b);\n        var u = r << 16 | g << 8 | b;\n        var str = \"000000\" + u.toString(16); //#.toUpperCase();\n        str = str.substr(str.length - 6);\n        var hxa = '0' + round$3(a * 255).toString(16);\n        hxa = hxa.substr(hxa.length - 2);\n        switch (mode.toLowerCase()) {\n            case 'rgba': return (\"#\" + str + hxa);\n            case 'argb': return (\"#\" + hxa + str);\n            default: return (\"#\" + str);\n        }\n    };\n\n    var rgb2hex_1 = rgb2hex$2;\n\n    var RE_HEX = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n    var RE_HEXA = /^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/;\n\n    var hex2rgb$1 = function (hex) {\n        if (hex.match(RE_HEX)) {\n            // remove optional leading #\n            if (hex.length === 4 || hex.length === 7) {\n                hex = hex.substr(1);\n            }\n            // expand short-notation to full six-digit\n            if (hex.length === 3) {\n                hex = hex.split('');\n                hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];\n            }\n            var u = parseInt(hex, 16);\n            var r = u >> 16;\n            var g = u >> 8 & 0xFF;\n            var b = u & 0xFF;\n            return [r,g,b,1];\n        }\n\n        // match rgba hex format, eg #FF000077\n        if (hex.match(RE_HEXA)) {\n            if (hex.length === 5 || hex.length === 9) {\n                // remove optional leading #\n                hex = hex.substr(1);\n            }\n            // expand short-notation to full eight-digit\n            if (hex.length === 4) {\n                hex = hex.split('');\n                hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];\n            }\n            var u$1 = parseInt(hex, 16);\n            var r$1 = u$1 >> 24 & 0xFF;\n            var g$1 = u$1 >> 16 & 0xFF;\n            var b$1 = u$1 >> 8 & 0xFF;\n            var a = Math.round((u$1 & 0xFF) / 0xFF * 100) / 100;\n            return [r$1,g$1,b$1,a];\n        }\n\n        // we used to check for css colors here\n        // if _input.css? and rgb = _input.css hex\n        //     return rgb\n\n        throw new Error((\"unknown hex color: \" + hex));\n    };\n\n    var hex2rgb_1 = hex2rgb$1;\n\n    var chroma$f = chroma_1;\n    var Color$y = Color_1;\n    var type$i = utils.type;\n    var input$b = input$h;\n\n    var rgb2hex$1 = rgb2hex_1;\n\n    Color$y.prototype.hex = function(mode) {\n        return rgb2hex$1(this._rgb, mode);\n    };\n\n    chroma$f.hex = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$y, [ null ].concat( args, ['hex']) ));\n    };\n\n    input$b.format.hex = hex2rgb_1;\n    input$b.autodetect.push({\n        p: 4,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$i(h) === 'string' && [3,4,5,6,7,8,9].indexOf(h.length) >= 0) {\n                return 'hex';\n            }\n        }\n    });\n\n    var unpack$o = utils.unpack;\n    var TWOPI$2 = utils.TWOPI;\n    var min$2 = Math.min;\n    var sqrt$4 = Math.sqrt;\n    var acos = Math.acos;\n\n    var rgb2hsi$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        borrowed from here:\n        http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/rgb2hsi.cpp\n        */\n        var ref = unpack$o(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        r /= 255;\n        g /= 255;\n        b /= 255;\n        var h;\n        var min_ = min$2(r,g,b);\n        var i = (r+g+b) / 3;\n        var s = i > 0 ? 1 - min_/i : 0;\n        if (s === 0) {\n            h = NaN;\n        } else {\n            h = ((r-g)+(r-b)) / 2;\n            h /= sqrt$4((r-g)*(r-g) + (r-b)*(g-b));\n            h = acos(h);\n            if (b > g) {\n                h = TWOPI$2 - h;\n            }\n            h /= TWOPI$2;\n        }\n        return [h*360,s,i];\n    };\n\n    var rgb2hsi_1 = rgb2hsi$1;\n\n    var unpack$n = utils.unpack;\n    var limit = utils.limit;\n    var TWOPI$1 = utils.TWOPI;\n    var PITHIRD = utils.PITHIRD;\n    var cos$4 = Math.cos;\n\n    /*\n     * hue [0..360]\n     * saturation [0..1]\n     * intensity [0..1]\n     */\n    var hsi2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        borrowed from here:\n        http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/hsi2rgb.cpp\n        */\n        args = unpack$n(args, 'hsi');\n        var h = args[0];\n        var s = args[1];\n        var i = args[2];\n        var r,g,b;\n\n        if (isNaN(h)) { h = 0; }\n        if (isNaN(s)) { s = 0; }\n        // normalize hue\n        if (h > 360) { h -= 360; }\n        if (h < 0) { h += 360; }\n        h /= 360;\n        if (h < 1/3) {\n            b = (1-s)/3;\n            r = (1+s*cos$4(TWOPI$1*h)/cos$4(PITHIRD-TWOPI$1*h))/3;\n            g = 1 - (b+r);\n        } else if (h < 2/3) {\n            h -= 1/3;\n            r = (1-s)/3;\n            g = (1+s*cos$4(TWOPI$1*h)/cos$4(PITHIRD-TWOPI$1*h))/3;\n            b = 1 - (r+g);\n        } else {\n            h -= 2/3;\n            g = (1-s)/3;\n            b = (1+s*cos$4(TWOPI$1*h)/cos$4(PITHIRD-TWOPI$1*h))/3;\n            r = 1 - (g+b);\n        }\n        r = limit(i*r*3);\n        g = limit(i*g*3);\n        b = limit(i*b*3);\n        return [r*255, g*255, b*255, args.length > 3 ? args[3] : 1];\n    };\n\n    var hsi2rgb_1 = hsi2rgb;\n\n    var unpack$m = utils.unpack;\n    var type$h = utils.type;\n    var chroma$e = chroma_1;\n    var Color$x = Color_1;\n    var input$a = input$h;\n\n    var rgb2hsi = rgb2hsi_1;\n\n    Color$x.prototype.hsi = function() {\n        return rgb2hsi(this._rgb);\n    };\n\n    chroma$e.hsi = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$x, [ null ].concat( args, ['hsi']) ));\n    };\n\n    input$a.format.hsi = hsi2rgb_1;\n\n    input$a.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$m(args, 'hsi');\n            if (type$h(args) === 'array' && args.length === 3) {\n                return 'hsi';\n            }\n        }\n    });\n\n    var unpack$l = utils.unpack;\n    var type$g = utils.type;\n    var chroma$d = chroma_1;\n    var Color$w = Color_1;\n    var input$9 = input$h;\n\n    var rgb2hsl$1 = rgb2hsl_1;\n\n    Color$w.prototype.hsl = function() {\n        return rgb2hsl$1(this._rgb);\n    };\n\n    chroma$d.hsl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$w, [ null ].concat( args, ['hsl']) ));\n    };\n\n    input$9.format.hsl = hsl2rgb_1;\n\n    input$9.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$l(args, 'hsl');\n            if (type$g(args) === 'array' && args.length === 3) {\n                return 'hsl';\n            }\n        }\n    });\n\n    var unpack$k = utils.unpack;\n    var min$1 = Math.min;\n    var max$1 = Math.max;\n\n    /*\n     * supported arguments:\n     * - rgb2hsv(r,g,b)\n     * - rgb2hsv([r,g,b])\n     * - rgb2hsv({r,g,b})\n     */\n    var rgb2hsl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$k(args, 'rgb');\n        var r = args[0];\n        var g = args[1];\n        var b = args[2];\n        var min_ = min$1(r, g, b);\n        var max_ = max$1(r, g, b);\n        var delta = max_ - min_;\n        var h,s,v;\n        v = max_ / 255.0;\n        if (max_ === 0) {\n            h = Number.NaN;\n            s = 0;\n        } else {\n            s = delta / max_;\n            if (r === max_) { h = (g - b) / delta; }\n            if (g === max_) { h = 2+(b - r) / delta; }\n            if (b === max_) { h = 4+(r - g) / delta; }\n            h *= 60;\n            if (h < 0) { h += 360; }\n        }\n        return [h, s, v]\n    };\n\n    var rgb2hsv$1 = rgb2hsl;\n\n    var unpack$j = utils.unpack;\n    var floor$2 = Math.floor;\n\n    var hsv2rgb = function () {\n        var assign, assign$1, assign$2, assign$3, assign$4, assign$5;\n\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n        args = unpack$j(args, 'hsv');\n        var h = args[0];\n        var s = args[1];\n        var v = args[2];\n        var r,g,b;\n        v *= 255;\n        if (s === 0) {\n            r = g = b = v;\n        } else {\n            if (h === 360) { h = 0; }\n            if (h > 360) { h -= 360; }\n            if (h < 0) { h += 360; }\n            h /= 60;\n\n            var i = floor$2(h);\n            var f = h - i;\n            var p = v * (1 - s);\n            var q = v * (1 - s * f);\n            var t = v * (1 - s * (1 - f));\n\n            switch (i) {\n                case 0: (assign = [v, t, p], r = assign[0], g = assign[1], b = assign[2]); break\n                case 1: (assign$1 = [q, v, p], r = assign$1[0], g = assign$1[1], b = assign$1[2]); break\n                case 2: (assign$2 = [p, v, t], r = assign$2[0], g = assign$2[1], b = assign$2[2]); break\n                case 3: (assign$3 = [p, q, v], r = assign$3[0], g = assign$3[1], b = assign$3[2]); break\n                case 4: (assign$4 = [t, p, v], r = assign$4[0], g = assign$4[1], b = assign$4[2]); break\n                case 5: (assign$5 = [v, p, q], r = assign$5[0], g = assign$5[1], b = assign$5[2]); break\n            }\n        }\n        return [r,g,b,args.length > 3?args[3]:1];\n    };\n\n    var hsv2rgb_1 = hsv2rgb;\n\n    var unpack$i = utils.unpack;\n    var type$f = utils.type;\n    var chroma$c = chroma_1;\n    var Color$v = Color_1;\n    var input$8 = input$h;\n\n    var rgb2hsv = rgb2hsv$1;\n\n    Color$v.prototype.hsv = function() {\n        return rgb2hsv(this._rgb);\n    };\n\n    chroma$c.hsv = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$v, [ null ].concat( args, ['hsv']) ));\n    };\n\n    input$8.format.hsv = hsv2rgb_1;\n\n    input$8.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$i(args, 'hsv');\n            if (type$f(args) === 'array' && args.length === 3) {\n                return 'hsv';\n            }\n        }\n    });\n\n    var labConstants = {\n        // Corresponds roughly to RGB brighter/darker\n        Kn: 18,\n\n        // D65 standard referent\n        Xn: 0.950470,\n        Yn: 1,\n        Zn: 1.088830,\n\n        t0: 0.137931034,  // 4 / 29\n        t1: 0.206896552,  // 6 / 29\n        t2: 0.12841855,   // 3 * t1 * t1\n        t3: 0.008856452,  // t1 * t1 * t1\n    };\n\n    var LAB_CONSTANTS$3 = labConstants;\n    var unpack$h = utils.unpack;\n    var pow$a = Math.pow;\n\n    var rgb2lab$2 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$h(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = rgb2xyz(r,g,b);\n        var x = ref$1[0];\n        var y = ref$1[1];\n        var z = ref$1[2];\n        var l = 116 * y - 16;\n        return [l < 0 ? 0 : l, 500 * (x - y), 200 * (y - z)];\n    };\n\n    var rgb_xyz = function (r) {\n        if ((r /= 255) <= 0.04045) { return r / 12.92; }\n        return pow$a((r + 0.055) / 1.055, 2.4);\n    };\n\n    var xyz_lab = function (t) {\n        if (t > LAB_CONSTANTS$3.t3) { return pow$a(t, 1 / 3); }\n        return t / LAB_CONSTANTS$3.t2 + LAB_CONSTANTS$3.t0;\n    };\n\n    var rgb2xyz = function (r,g,b) {\n        r = rgb_xyz(r);\n        g = rgb_xyz(g);\n        b = rgb_xyz(b);\n        var x = xyz_lab((0.4124564 * r + 0.3575761 * g + 0.1804375 * b) / LAB_CONSTANTS$3.Xn);\n        var y = xyz_lab((0.2126729 * r + 0.7151522 * g + 0.0721750 * b) / LAB_CONSTANTS$3.Yn);\n        var z = xyz_lab((0.0193339 * r + 0.1191920 * g + 0.9503041 * b) / LAB_CONSTANTS$3.Zn);\n        return [x,y,z];\n    };\n\n    var rgb2lab_1 = rgb2lab$2;\n\n    var LAB_CONSTANTS$2 = labConstants;\n    var unpack$g = utils.unpack;\n    var pow$9 = Math.pow;\n\n    /*\n     * L* [0..100]\n     * a [-100..100]\n     * b [-100..100]\n     */\n    var lab2rgb$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$g(args, 'lab');\n        var l = args[0];\n        var a = args[1];\n        var b = args[2];\n        var x,y,z, r,g,b_;\n\n        y = (l + 16) / 116;\n        x = isNaN(a) ? y : y + a / 500;\n        z = isNaN(b) ? y : y - b / 200;\n\n        y = LAB_CONSTANTS$2.Yn * lab_xyz(y);\n        x = LAB_CONSTANTS$2.Xn * lab_xyz(x);\n        z = LAB_CONSTANTS$2.Zn * lab_xyz(z);\n\n        r = xyz_rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);  // D65 -> sRGB\n        g = xyz_rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z);\n        b_ = xyz_rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\n\n        return [r,g,b_,args.length > 3 ? args[3] : 1];\n    };\n\n    var xyz_rgb = function (r) {\n        return 255 * (r <= 0.00304 ? 12.92 * r : 1.055 * pow$9(r, 1 / 2.4) - 0.055)\n    };\n\n    var lab_xyz = function (t) {\n        return t > LAB_CONSTANTS$2.t1 ? t * t * t : LAB_CONSTANTS$2.t2 * (t - LAB_CONSTANTS$2.t0)\n    };\n\n    var lab2rgb_1 = lab2rgb$1;\n\n    var unpack$f = utils.unpack;\n    var type$e = utils.type;\n    var chroma$b = chroma_1;\n    var Color$u = Color_1;\n    var input$7 = input$h;\n\n    var rgb2lab$1 = rgb2lab_1;\n\n    Color$u.prototype.lab = function() {\n        return rgb2lab$1(this._rgb);\n    };\n\n    chroma$b.lab = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$u, [ null ].concat( args, ['lab']) ));\n    };\n\n    input$7.format.lab = lab2rgb_1;\n\n    input$7.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$f(args, 'lab');\n            if (type$e(args) === 'array' && args.length === 3) {\n                return 'lab';\n            }\n        }\n    });\n\n    var unpack$e = utils.unpack;\n    var RAD2DEG = utils.RAD2DEG;\n    var sqrt$3 = Math.sqrt;\n    var atan2$2 = Math.atan2;\n    var round$2 = Math.round;\n\n    var lab2lch$2 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$e(args, 'lab');\n        var l = ref[0];\n        var a = ref[1];\n        var b = ref[2];\n        var c = sqrt$3(a * a + b * b);\n        var h = (atan2$2(b, a) * RAD2DEG + 360) % 360;\n        if (round$2(c*10000) === 0) { h = Number.NaN; }\n        return [l, c, h];\n    };\n\n    var lab2lch_1 = lab2lch$2;\n\n    var unpack$d = utils.unpack;\n    var rgb2lab = rgb2lab_1;\n    var lab2lch$1 = lab2lch_1;\n\n    var rgb2lch$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$d(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = rgb2lab(r,g,b);\n        var l = ref$1[0];\n        var a = ref$1[1];\n        var b_ = ref$1[2];\n        return lab2lch$1(l,a,b_);\n    };\n\n    var rgb2lch_1 = rgb2lch$1;\n\n    var unpack$c = utils.unpack;\n    var DEG2RAD = utils.DEG2RAD;\n    var sin$3 = Math.sin;\n    var cos$3 = Math.cos;\n\n    var lch2lab$2 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        /*\n        Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n        These formulas were invented by David Dalrymple to obtain maximum contrast without going\n        out of gamut if the parameters are in the range 0-1.\n\n        A saturation multiplier was added by Gregor Aisch\n        */\n        var ref = unpack$c(args, 'lch');\n        var l = ref[0];\n        var c = ref[1];\n        var h = ref[2];\n        if (isNaN(h)) { h = 0; }\n        h = h * DEG2RAD;\n        return [l, cos$3(h) * c, sin$3(h) * c]\n    };\n\n    var lch2lab_1 = lch2lab$2;\n\n    var unpack$b = utils.unpack;\n    var lch2lab$1 = lch2lab_1;\n    var lab2rgb = lab2rgb_1;\n\n    var lch2rgb$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$b(args, 'lch');\n        var l = args[0];\n        var c = args[1];\n        var h = args[2];\n        var ref = lch2lab$1 (l,c,h);\n        var L = ref[0];\n        var a = ref[1];\n        var b_ = ref[2];\n        var ref$1 = lab2rgb (L,a,b_);\n        var r = ref$1[0];\n        var g = ref$1[1];\n        var b = ref$1[2];\n        return [r, g, b, args.length > 3 ? args[3] : 1];\n    };\n\n    var lch2rgb_1 = lch2rgb$1;\n\n    var unpack$a = utils.unpack;\n    var lch2rgb = lch2rgb_1;\n\n    var hcl2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var hcl = unpack$a(args, 'hcl').reverse();\n        return lch2rgb.apply(void 0, hcl);\n    };\n\n    var hcl2rgb_1 = hcl2rgb;\n\n    var unpack$9 = utils.unpack;\n    var type$d = utils.type;\n    var chroma$a = chroma_1;\n    var Color$t = Color_1;\n    var input$6 = input$h;\n\n    var rgb2lch = rgb2lch_1;\n\n    Color$t.prototype.lch = function() { return rgb2lch(this._rgb); };\n    Color$t.prototype.hcl = function() { return rgb2lch(this._rgb).reverse(); };\n\n    chroma$a.lch = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$t, [ null ].concat( args, ['lch']) ));\n    };\n    chroma$a.hcl = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$t, [ null ].concat( args, ['hcl']) ));\n    };\n\n    input$6.format.lch = lch2rgb_1;\n    input$6.format.hcl = hcl2rgb_1;\n\n    ['lch','hcl'].forEach(function (m) { return input$6.autodetect.push({\n        p: 2,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$9(args, m);\n            if (type$d(args) === 'array' && args.length === 3) {\n                return m;\n            }\n        }\n    }); });\n\n    /**\n    \tX11 color names\n\n    \thttp://www.w3.org/TR/css3-color/#svg-color\n    */\n\n    var w3cx11$1 = {\n        aliceblue: '#f0f8ff',\n        antiquewhite: '#faebd7',\n        aqua: '#00ffff',\n        aquamarine: '#7fffd4',\n        azure: '#f0ffff',\n        beige: '#f5f5dc',\n        bisque: '#ffe4c4',\n        black: '#000000',\n        blanchedalmond: '#ffebcd',\n        blue: '#0000ff',\n        blueviolet: '#8a2be2',\n        brown: '#a52a2a',\n        burlywood: '#deb887',\n        cadetblue: '#5f9ea0',\n        chartreuse: '#7fff00',\n        chocolate: '#d2691e',\n        coral: '#ff7f50',\n        cornflower: '#6495ed',\n        cornflowerblue: '#6495ed',\n        cornsilk: '#fff8dc',\n        crimson: '#dc143c',\n        cyan: '#00ffff',\n        darkblue: '#00008b',\n        darkcyan: '#008b8b',\n        darkgoldenrod: '#b8860b',\n        darkgray: '#a9a9a9',\n        darkgreen: '#006400',\n        darkgrey: '#a9a9a9',\n        darkkhaki: '#bdb76b',\n        darkmagenta: '#8b008b',\n        darkolivegreen: '#556b2f',\n        darkorange: '#ff8c00',\n        darkorchid: '#9932cc',\n        darkred: '#8b0000',\n        darksalmon: '#e9967a',\n        darkseagreen: '#8fbc8f',\n        darkslateblue: '#483d8b',\n        darkslategray: '#2f4f4f',\n        darkslategrey: '#2f4f4f',\n        darkturquoise: '#00ced1',\n        darkviolet: '#9400d3',\n        deeppink: '#ff1493',\n        deepskyblue: '#00bfff',\n        dimgray: '#696969',\n        dimgrey: '#696969',\n        dodgerblue: '#1e90ff',\n        firebrick: '#b22222',\n        floralwhite: '#fffaf0',\n        forestgreen: '#228b22',\n        fuchsia: '#ff00ff',\n        gainsboro: '#dcdcdc',\n        ghostwhite: '#f8f8ff',\n        gold: '#ffd700',\n        goldenrod: '#daa520',\n        gray: '#808080',\n        green: '#008000',\n        greenyellow: '#adff2f',\n        grey: '#808080',\n        honeydew: '#f0fff0',\n        hotpink: '#ff69b4',\n        indianred: '#cd5c5c',\n        indigo: '#4b0082',\n        ivory: '#fffff0',\n        khaki: '#f0e68c',\n        laserlemon: '#ffff54',\n        lavender: '#e6e6fa',\n        lavenderblush: '#fff0f5',\n        lawngreen: '#7cfc00',\n        lemonchiffon: '#fffacd',\n        lightblue: '#add8e6',\n        lightcoral: '#f08080',\n        lightcyan: '#e0ffff',\n        lightgoldenrod: '#fafad2',\n        lightgoldenrodyellow: '#fafad2',\n        lightgray: '#d3d3d3',\n        lightgreen: '#90ee90',\n        lightgrey: '#d3d3d3',\n        lightpink: '#ffb6c1',\n        lightsalmon: '#ffa07a',\n        lightseagreen: '#20b2aa',\n        lightskyblue: '#87cefa',\n        lightslategray: '#778899',\n        lightslategrey: '#778899',\n        lightsteelblue: '#b0c4de',\n        lightyellow: '#ffffe0',\n        lime: '#00ff00',\n        limegreen: '#32cd32',\n        linen: '#faf0e6',\n        magenta: '#ff00ff',\n        maroon: '#800000',\n        maroon2: '#7f0000',\n        maroon3: '#b03060',\n        mediumaquamarine: '#66cdaa',\n        mediumblue: '#0000cd',\n        mediumorchid: '#ba55d3',\n        mediumpurple: '#9370db',\n        mediumseagreen: '#3cb371',\n        mediumslateblue: '#7b68ee',\n        mediumspringgreen: '#00fa9a',\n        mediumturquoise: '#48d1cc',\n        mediumvioletred: '#c71585',\n        midnightblue: '#191970',\n        mintcream: '#f5fffa',\n        mistyrose: '#ffe4e1',\n        moccasin: '#ffe4b5',\n        navajowhite: '#ffdead',\n        navy: '#000080',\n        oldlace: '#fdf5e6',\n        olive: '#808000',\n        olivedrab: '#6b8e23',\n        orange: '#ffa500',\n        orangered: '#ff4500',\n        orchid: '#da70d6',\n        palegoldenrod: '#eee8aa',\n        palegreen: '#98fb98',\n        paleturquoise: '#afeeee',\n        palevioletred: '#db7093',\n        papayawhip: '#ffefd5',\n        peachpuff: '#ffdab9',\n        peru: '#cd853f',\n        pink: '#ffc0cb',\n        plum: '#dda0dd',\n        powderblue: '#b0e0e6',\n        purple: '#800080',\n        purple2: '#7f007f',\n        purple3: '#a020f0',\n        rebeccapurple: '#663399',\n        red: '#ff0000',\n        rosybrown: '#bc8f8f',\n        royalblue: '#4169e1',\n        saddlebrown: '#8b4513',\n        salmon: '#fa8072',\n        sandybrown: '#f4a460',\n        seagreen: '#2e8b57',\n        seashell: '#fff5ee',\n        sienna: '#a0522d',\n        silver: '#c0c0c0',\n        skyblue: '#87ceeb',\n        slateblue: '#6a5acd',\n        slategray: '#708090',\n        slategrey: '#708090',\n        snow: '#fffafa',\n        springgreen: '#00ff7f',\n        steelblue: '#4682b4',\n        tan: '#d2b48c',\n        teal: '#008080',\n        thistle: '#d8bfd8',\n        tomato: '#ff6347',\n        turquoise: '#40e0d0',\n        violet: '#ee82ee',\n        wheat: '#f5deb3',\n        white: '#ffffff',\n        whitesmoke: '#f5f5f5',\n        yellow: '#ffff00',\n        yellowgreen: '#9acd32'\n    };\n\n    var w3cx11_1 = w3cx11$1;\n\n    var Color$s = Color_1;\n    var input$5 = input$h;\n    var type$c = utils.type;\n\n    var w3cx11 = w3cx11_1;\n    var hex2rgb = hex2rgb_1;\n    var rgb2hex = rgb2hex_1;\n\n    Color$s.prototype.name = function() {\n        var hex = rgb2hex(this._rgb, 'rgb');\n        for (var i = 0, list = Object.keys(w3cx11); i < list.length; i += 1) {\n            var n = list[i];\n\n            if (w3cx11[n] === hex) { return n.toLowerCase(); }\n        }\n        return hex;\n    };\n\n    input$5.format.named = function (name) {\n        name = name.toLowerCase();\n        if (w3cx11[name]) { return hex2rgb(w3cx11[name]); }\n        throw new Error('unknown color name: '+name);\n    };\n\n    input$5.autodetect.push({\n        p: 5,\n        test: function (h) {\n            var rest = [], len = arguments.length - 1;\n            while ( len-- > 0 ) rest[ len ] = arguments[ len + 1 ];\n\n            if (!rest.length && type$c(h) === 'string' && w3cx11[h.toLowerCase()]) {\n                return 'named';\n            }\n        }\n    });\n\n    var unpack$8 = utils.unpack;\n\n    var rgb2num$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$8(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        return (r << 16) + (g << 8) + b;\n    };\n\n    var rgb2num_1 = rgb2num$1;\n\n    var type$b = utils.type;\n\n    var num2rgb = function (num) {\n        if (type$b(num) == \"number\" && num >= 0 && num <= 0xFFFFFF) {\n            var r = num >> 16;\n            var g = (num >> 8) & 0xFF;\n            var b = num & 0xFF;\n            return [r,g,b,1];\n        }\n        throw new Error(\"unknown num color: \"+num);\n    };\n\n    var num2rgb_1 = num2rgb;\n\n    var chroma$9 = chroma_1;\n    var Color$r = Color_1;\n    var input$4 = input$h;\n    var type$a = utils.type;\n\n    var rgb2num = rgb2num_1;\n\n    Color$r.prototype.num = function() {\n        return rgb2num(this._rgb);\n    };\n\n    chroma$9.num = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$r, [ null ].concat( args, ['num']) ));\n    };\n\n    input$4.format.num = num2rgb_1;\n\n    input$4.autodetect.push({\n        p: 5,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            if (args.length === 1 && type$a(args[0]) === 'number' && args[0] >= 0 && args[0] <= 0xFFFFFF) {\n                return 'num';\n            }\n        }\n    });\n\n    var chroma$8 = chroma_1;\n    var Color$q = Color_1;\n    var input$3 = input$h;\n    var unpack$7 = utils.unpack;\n    var type$9 = utils.type;\n    var round$1 = Math.round;\n\n    Color$q.prototype.rgb = function(rnd) {\n        if ( rnd === void 0 ) rnd=true;\n\n        if (rnd === false) { return this._rgb.slice(0,3); }\n        return this._rgb.slice(0,3).map(round$1);\n    };\n\n    Color$q.prototype.rgba = function(rnd) {\n        if ( rnd === void 0 ) rnd=true;\n\n        return this._rgb.slice(0,4).map(function (v,i) {\n            return i<3 ? (rnd === false ? v : round$1(v)) : v;\n        });\n    };\n\n    chroma$8.rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$q, [ null ].concat( args, ['rgb']) ));\n    };\n\n    input$3.format.rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgba = unpack$7(args, 'rgba');\n        if (rgba[3] === undefined) { rgba[3] = 1; }\n        return rgba;\n    };\n\n    input$3.autodetect.push({\n        p: 3,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$7(args, 'rgba');\n            if (type$9(args) === 'array' && (args.length === 3 ||\n                args.length === 4 && type$9(args[3]) == 'number' && args[3] >= 0 && args[3] <= 1)) {\n                return 'rgb';\n            }\n        }\n    });\n\n    /*\n     * Based on implementation by Neil Bartlett\n     * https://github.com/neilbartlett/color-temperature\n     */\n\n    var log$1 = Math.log;\n\n    var temperature2rgb$1 = function (kelvin) {\n        var temp = kelvin / 100;\n        var r,g,b;\n        if (temp < 66) {\n            r = 255;\n            g = temp < 6 ? 0 : -155.25485562709179 - 0.44596950469579133 * (g = temp-2) + 104.49216199393888 * log$1(g);\n            b = temp < 20 ? 0 : -254.76935184120902 + 0.8274096064007395 * (b = temp-10) + 115.67994401066147 * log$1(b);\n        } else {\n            r = 351.97690566805693 + 0.114206453784165 * (r = temp-55) - 40.25366309332127 * log$1(r);\n            g = 325.4494125711974 + 0.07943456536662342 * (g = temp-50) - 28.0852963507957 * log$1(g);\n            b = 255;\n        }\n        return [r,g,b,1];\n    };\n\n    var temperature2rgb_1 = temperature2rgb$1;\n\n    /*\n     * Based on implementation by Neil Bartlett\n     * https://github.com/neilbartlett/color-temperature\n     **/\n\n    var temperature2rgb = temperature2rgb_1;\n    var unpack$6 = utils.unpack;\n    var round = Math.round;\n\n    var rgb2temperature$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var rgb = unpack$6(args, 'rgb');\n        var r = rgb[0], b = rgb[2];\n        var minTemp = 1000;\n        var maxTemp = 40000;\n        var eps = 0.4;\n        var temp;\n        while (maxTemp - minTemp > eps) {\n            temp = (maxTemp + minTemp) * 0.5;\n            var rgb$1 = temperature2rgb(temp);\n            if ((rgb$1[2] / rgb$1[0]) >= (b / r)) {\n                maxTemp = temp;\n            } else {\n                minTemp = temp;\n            }\n        }\n        return round(temp);\n    };\n\n    var rgb2temperature_1 = rgb2temperature$1;\n\n    var chroma$7 = chroma_1;\n    var Color$p = Color_1;\n    var input$2 = input$h;\n\n    var rgb2temperature = rgb2temperature_1;\n\n    Color$p.prototype.temp =\n    Color$p.prototype.kelvin =\n    Color$p.prototype.temperature = function() {\n        return rgb2temperature(this._rgb);\n    };\n\n    chroma$7.temp =\n    chroma$7.kelvin =\n    chroma$7.temperature = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$p, [ null ].concat( args, ['temp']) ));\n    };\n\n    input$2.format.temp =\n    input$2.format.kelvin =\n    input$2.format.temperature = temperature2rgb_1;\n\n    var unpack$5 = utils.unpack;\n    var cbrt = Math.cbrt;\n    var pow$8 = Math.pow;\n    var sign$1 = Math.sign;\n\n    var rgb2oklab$2 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        // OKLab color space implementation taken from\n        // https://bottosson.github.io/posts/oklab/\n        var ref = unpack$5(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = [rgb2lrgb(r / 255), rgb2lrgb(g / 255), rgb2lrgb(b / 255)];\n        var lr = ref$1[0];\n        var lg = ref$1[1];\n        var lb = ref$1[2];\n        var l = cbrt(0.4122214708 * lr + 0.5363325363 * lg + 0.0514459929 * lb);\n        var m = cbrt(0.2119034982 * lr + 0.6806995451 * lg + 0.1073969566 * lb);\n        var s = cbrt(0.0883024619 * lr + 0.2817188376 * lg + 0.6299787005 * lb);\n\n        return [\n            0.2104542553 * l + 0.793617785 * m - 0.0040720468 * s,\n            1.9779984951 * l - 2.428592205 * m + 0.4505937099 * s,\n            0.0259040371 * l + 0.7827717662 * m - 0.808675766 * s\n        ];\n    };\n\n    var rgb2oklab_1 = rgb2oklab$2;\n\n    function rgb2lrgb(c) {\n        var abs = Math.abs(c);\n        if (abs < 0.04045) {\n            return c / 12.92;\n        }\n        return (sign$1(c) || 1) * pow$8((abs + 0.055) / 1.055, 2.4);\n    }\n\n    var unpack$4 = utils.unpack;\n    var pow$7 = Math.pow;\n    var sign = Math.sign;\n\n    /*\n     * L* [0..100]\n     * a [-100..100]\n     * b [-100..100]\n     */\n    var oklab2rgb$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$4(args, 'lab');\n        var L = args[0];\n        var a = args[1];\n        var b = args[2];\n\n        var l = pow$7(L + 0.3963377774 * a + 0.2158037573 * b, 3);\n        var m = pow$7(L - 0.1055613458 * a - 0.0638541728 * b, 3);\n        var s = pow$7(L - 0.0894841775 * a - 1.291485548 * b, 3);\n\n        return [\n            255 * lrgb2rgb(+4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s),\n            255 * lrgb2rgb(-1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s),\n            255 * lrgb2rgb(-0.0041960863 * l - 0.7034186147 * m + 1.707614701 * s),\n            args.length > 3 ? args[3] : 1\n        ];\n    };\n\n    var oklab2rgb_1 = oklab2rgb$1;\n\n    function lrgb2rgb(c) {\n        var abs = Math.abs(c);\n        if (abs > 0.0031308) {\n            return (sign(c) || 1) * (1.055 * pow$7(abs, 1 / 2.4) - 0.055);\n        }\n        return c * 12.92;\n    }\n\n    var unpack$3 = utils.unpack;\n    var type$8 = utils.type;\n    var chroma$6 = chroma_1;\n    var Color$o = Color_1;\n    var input$1 = input$h;\n\n    var rgb2oklab$1 = rgb2oklab_1;\n\n    Color$o.prototype.oklab = function () {\n        return rgb2oklab$1(this._rgb);\n    };\n\n    chroma$6.oklab = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$o, [ null ].concat( args, ['oklab']) ));\n    };\n\n    input$1.format.oklab = oklab2rgb_1;\n\n    input$1.autodetect.push({\n        p: 3,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack$3(args, 'oklab');\n            if (type$8(args) === 'array' && args.length === 3) {\n                return 'oklab';\n            }\n        }\n    });\n\n    var unpack$2 = utils.unpack;\n    var rgb2oklab = rgb2oklab_1;\n    var lab2lch = lab2lch_1;\n\n    var rgb2oklch$1 = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        var ref = unpack$2(args, 'rgb');\n        var r = ref[0];\n        var g = ref[1];\n        var b = ref[2];\n        var ref$1 = rgb2oklab(r, g, b);\n        var l = ref$1[0];\n        var a = ref$1[1];\n        var b_ = ref$1[2];\n        return lab2lch(l, a, b_);\n    };\n\n    var rgb2oklch_1 = rgb2oklch$1;\n\n    var unpack$1 = utils.unpack;\n    var lch2lab = lch2lab_1;\n    var oklab2rgb = oklab2rgb_1;\n\n    var oklch2rgb = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        args = unpack$1(args, 'lch');\n        var l = args[0];\n        var c = args[1];\n        var h = args[2];\n        var ref = lch2lab(l, c, h);\n        var L = ref[0];\n        var a = ref[1];\n        var b_ = ref[2];\n        var ref$1 = oklab2rgb(L, a, b_);\n        var r = ref$1[0];\n        var g = ref$1[1];\n        var b = ref$1[2];\n        return [r, g, b, args.length > 3 ? args[3] : 1];\n    };\n\n    var oklch2rgb_1 = oklch2rgb;\n\n    var unpack = utils.unpack;\n    var type$7 = utils.type;\n    var chroma$5 = chroma_1;\n    var Color$n = Color_1;\n    var input = input$h;\n\n    var rgb2oklch = rgb2oklch_1;\n\n    Color$n.prototype.oklch = function () {\n        return rgb2oklch(this._rgb);\n    };\n\n    chroma$5.oklch = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        return new (Function.prototype.bind.apply( Color$n, [ null ].concat( args, ['oklch']) ));\n    };\n\n    input.format.oklch = oklch2rgb_1;\n\n    input.autodetect.push({\n        p: 3,\n        test: function () {\n            var args = [], len = arguments.length;\n            while ( len-- ) args[ len ] = arguments[ len ];\n\n            args = unpack(args, 'oklch');\n            if (type$7(args) === 'array' && args.length === 3) {\n                return 'oklch';\n            }\n        }\n    });\n\n    var Color$m = Color_1;\n    var type$6 = utils.type;\n\n    Color$m.prototype.alpha = function(a, mutate) {\n        if ( mutate === void 0 ) mutate=false;\n\n        if (a !== undefined && type$6(a) === 'number') {\n            if (mutate) {\n                this._rgb[3] = a;\n                return this;\n            }\n            return new Color$m([this._rgb[0], this._rgb[1], this._rgb[2], a], 'rgb');\n        }\n        return this._rgb[3];\n    };\n\n    var Color$l = Color_1;\n\n    Color$l.prototype.clipped = function() {\n        return this._rgb._clipped || false;\n    };\n\n    var Color$k = Color_1;\n    var LAB_CONSTANTS$1 = labConstants;\n\n    Color$k.prototype.darken = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \tvar me = this;\n    \tvar lab = me.lab();\n    \tlab[0] -= LAB_CONSTANTS$1.Kn * amount;\n    \treturn new Color$k(lab, 'lab').alpha(me.alpha(), true);\n    };\n\n    Color$k.prototype.brighten = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \treturn this.darken(-amount);\n    };\n\n    Color$k.prototype.darker = Color$k.prototype.darken;\n    Color$k.prototype.brighter = Color$k.prototype.brighten;\n\n    var Color$j = Color_1;\n\n    Color$j.prototype.get = function (mc) {\n        var ref = mc.split('.');\n        var mode = ref[0];\n        var channel = ref[1];\n        var src = this[mode]();\n        if (channel) {\n            var i = mode.indexOf(channel) - (mode.substr(0, 2) === 'ok' ? 2 : 0);\n            if (i > -1) { return src[i]; }\n            throw new Error((\"unknown channel \" + channel + \" in mode \" + mode));\n        } else {\n            return src;\n        }\n    };\n\n    var Color$i = Color_1;\n    var type$5 = utils.type;\n    var pow$6 = Math.pow;\n\n    var EPS = 1e-7;\n    var MAX_ITER = 20;\n\n    Color$i.prototype.luminance = function(lum) {\n        if (lum !== undefined && type$5(lum) === 'number') {\n            if (lum === 0) {\n                // return pure black\n                return new Color$i([0,0,0,this._rgb[3]], 'rgb');\n            }\n            if (lum === 1) {\n                // return pure white\n                return new Color$i([255,255,255,this._rgb[3]], 'rgb');\n            }\n            // compute new color using...\n            var cur_lum = this.luminance();\n            var mode = 'rgb';\n            var max_iter = MAX_ITER;\n\n            var test = function (low, high) {\n                var mid = low.interpolate(high, 0.5, mode);\n                var lm = mid.luminance();\n                if (Math.abs(lum - lm) < EPS || !max_iter--) {\n                    // close enough\n                    return mid;\n                }\n                return lm > lum ? test(low, mid) : test(mid, high);\n            };\n\n            var rgb = (cur_lum > lum ? test(new Color$i([0,0,0]), this) : test(this, new Color$i([255,255,255]))).rgb();\n            return new Color$i(rgb.concat( [this._rgb[3]]));\n        }\n        return rgb2luminance.apply(void 0, (this._rgb).slice(0,3));\n    };\n\n\n    var rgb2luminance = function (r,g,b) {\n        // relative luminance\n        // see http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n        r = luminance_x(r);\n        g = luminance_x(g);\n        b = luminance_x(b);\n        return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n    };\n\n    var luminance_x = function (x) {\n        x /= 255;\n        return x <= 0.03928 ? x/12.92 : pow$6((x+0.055)/1.055, 2.4);\n    };\n\n    var interpolator$1 = {};\n\n    var Color$h = Color_1;\n    var type$4 = utils.type;\n    var interpolator = interpolator$1;\n\n    var mix$1 = function (col1, col2, f) {\n        if ( f === void 0 ) f=0.5;\n        var rest = [], len = arguments.length - 3;\n        while ( len-- > 0 ) rest[ len ] = arguments[ len + 3 ];\n\n        var mode = rest[0] || 'lrgb';\n        if (!interpolator[mode] && !rest.length) {\n            // fall back to the first supported mode\n            mode = Object.keys(interpolator)[0];\n        }\n        if (!interpolator[mode]) {\n            throw new Error((\"interpolation mode \" + mode + \" is not defined\"));\n        }\n        if (type$4(col1) !== 'object') { col1 = new Color$h(col1); }\n        if (type$4(col2) !== 'object') { col2 = new Color$h(col2); }\n        return interpolator[mode](col1, col2, f)\n            .alpha(col1.alpha() + f * (col2.alpha() - col1.alpha()));\n    };\n\n    var Color$g = Color_1;\n    var mix = mix$1;\n\n    Color$g.prototype.mix =\n    Color$g.prototype.interpolate = function(col2, f) {\n    \tif ( f === void 0 ) f=0.5;\n    \tvar rest = [], len = arguments.length - 2;\n    \twhile ( len-- > 0 ) rest[ len ] = arguments[ len + 2 ];\n\n    \treturn mix.apply(void 0, [ this, col2, f ].concat( rest ));\n    };\n\n    var Color$f = Color_1;\n\n    Color$f.prototype.premultiply = function(mutate) {\n    \tif ( mutate === void 0 ) mutate=false;\n\n    \tvar rgb = this._rgb;\n    \tvar a = rgb[3];\n    \tif (mutate) {\n    \t\tthis._rgb = [rgb[0]*a, rgb[1]*a, rgb[2]*a, a];\n    \t\treturn this;\n    \t} else {\n    \t\treturn new Color$f([rgb[0]*a, rgb[1]*a, rgb[2]*a, a], 'rgb');\n    \t}\n    };\n\n    var Color$e = Color_1;\n    var LAB_CONSTANTS = labConstants;\n\n    Color$e.prototype.saturate = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \tvar me = this;\n    \tvar lch = me.lch();\n    \tlch[1] += LAB_CONSTANTS.Kn * amount;\n    \tif (lch[1] < 0) { lch[1] = 0; }\n    \treturn new Color$e(lch, 'lch').alpha(me.alpha(), true);\n    };\n\n    Color$e.prototype.desaturate = function(amount) {\n    \tif ( amount === void 0 ) amount=1;\n\n    \treturn this.saturate(-amount);\n    };\n\n    var Color$d = Color_1;\n    var type$3 = utils.type;\n\n    Color$d.prototype.set = function (mc, value, mutate) {\n        if ( mutate === void 0 ) mutate = false;\n\n        var ref = mc.split('.');\n        var mode = ref[0];\n        var channel = ref[1];\n        var src = this[mode]();\n        if (channel) {\n            var i = mode.indexOf(channel) - (mode.substr(0, 2) === 'ok' ? 2 : 0);\n            if (i > -1) {\n                if (type$3(value) == 'string') {\n                    switch (value.charAt(0)) {\n                        case '+':\n                            src[i] += +value;\n                            break;\n                        case '-':\n                            src[i] += +value;\n                            break;\n                        case '*':\n                            src[i] *= +value.substr(1);\n                            break;\n                        case '/':\n                            src[i] /= +value.substr(1);\n                            break;\n                        default:\n                            src[i] = +value;\n                    }\n                } else if (type$3(value) === 'number') {\n                    src[i] = value;\n                } else {\n                    throw new Error(\"unsupported value for Color.set\");\n                }\n                var out = new Color$d(src, mode);\n                if (mutate) {\n                    this._rgb = out._rgb;\n                    return this;\n                }\n                return out;\n            }\n            throw new Error((\"unknown channel \" + channel + \" in mode \" + mode));\n        } else {\n            return src;\n        }\n    };\n\n    var Color$c = Color_1;\n\n    var rgb = function (col1, col2, f) {\n        var xyz0 = col1._rgb;\n        var xyz1 = col2._rgb;\n        return new Color$c(\n            xyz0[0] + f * (xyz1[0]-xyz0[0]),\n            xyz0[1] + f * (xyz1[1]-xyz0[1]),\n            xyz0[2] + f * (xyz1[2]-xyz0[2]),\n            'rgb'\n        )\n    };\n\n    // register interpolator\n    interpolator$1.rgb = rgb;\n\n    var Color$b = Color_1;\n    var sqrt$2 = Math.sqrt;\n    var pow$5 = Math.pow;\n\n    var lrgb = function (col1, col2, f) {\n        var ref = col1._rgb;\n        var x1 = ref[0];\n        var y1 = ref[1];\n        var z1 = ref[2];\n        var ref$1 = col2._rgb;\n        var x2 = ref$1[0];\n        var y2 = ref$1[1];\n        var z2 = ref$1[2];\n        return new Color$b(\n            sqrt$2(pow$5(x1,2) * (1-f) + pow$5(x2,2) * f),\n            sqrt$2(pow$5(y1,2) * (1-f) + pow$5(y2,2) * f),\n            sqrt$2(pow$5(z1,2) * (1-f) + pow$5(z2,2) * f),\n            'rgb'\n        )\n    };\n\n    // register interpolator\n    interpolator$1.lrgb = lrgb;\n\n    var Color$a = Color_1;\n\n    var lab = function (col1, col2, f) {\n        var xyz0 = col1.lab();\n        var xyz1 = col2.lab();\n        return new Color$a(\n            xyz0[0] + f * (xyz1[0]-xyz0[0]),\n            xyz0[1] + f * (xyz1[1]-xyz0[1]),\n            xyz0[2] + f * (xyz1[2]-xyz0[2]),\n            'lab'\n        )\n    };\n\n    // register interpolator\n    interpolator$1.lab = lab;\n\n    var Color$9 = Color_1;\n\n    var _hsx = function (col1, col2, f, m) {\n        var assign, assign$1;\n\n        var xyz0, xyz1;\n        if (m === 'hsl') {\n            xyz0 = col1.hsl();\n            xyz1 = col2.hsl();\n        } else if (m === 'hsv') {\n            xyz0 = col1.hsv();\n            xyz1 = col2.hsv();\n        } else if (m === 'hcg') {\n            xyz0 = col1.hcg();\n            xyz1 = col2.hcg();\n        } else if (m === 'hsi') {\n            xyz0 = col1.hsi();\n            xyz1 = col2.hsi();\n        } else if (m === 'lch' || m === 'hcl') {\n            m = 'hcl';\n            xyz0 = col1.hcl();\n            xyz1 = col2.hcl();\n        } else if (m === 'oklch') {\n            xyz0 = col1.oklch().reverse();\n            xyz1 = col2.oklch().reverse();\n        }\n\n        var hue0, hue1, sat0, sat1, lbv0, lbv1;\n        if (m.substr(0, 1) === 'h' || m === 'oklch') {\n            (assign = xyz0, hue0 = assign[0], sat0 = assign[1], lbv0 = assign[2]);\n            (assign$1 = xyz1, hue1 = assign$1[0], sat1 = assign$1[1], lbv1 = assign$1[2]);\n        }\n\n        var sat, hue, lbv, dh;\n\n        if (!isNaN(hue0) && !isNaN(hue1)) {\n            // both colors have hue\n            if (hue1 > hue0 && hue1 - hue0 > 180) {\n                dh = hue1 - (hue0 + 360);\n            } else if (hue1 < hue0 && hue0 - hue1 > 180) {\n                dh = hue1 + 360 - hue0;\n            } else {\n                dh = hue1 - hue0;\n            }\n            hue = hue0 + f * dh;\n        } else if (!isNaN(hue0)) {\n            hue = hue0;\n            if ((lbv1 == 1 || lbv1 == 0) && m != 'hsv') { sat = sat0; }\n        } else if (!isNaN(hue1)) {\n            hue = hue1;\n            if ((lbv0 == 1 || lbv0 == 0) && m != 'hsv') { sat = sat1; }\n        } else {\n            hue = Number.NaN;\n        }\n\n        if (sat === undefined) { sat = sat0 + f * (sat1 - sat0); }\n        lbv = lbv0 + f * (lbv1 - lbv0);\n        return m === 'oklch' ? new Color$9([lbv, sat, hue], m) : new Color$9([hue, sat, lbv], m);\n    };\n\n    var interpolate_hsx$5 = _hsx;\n\n    var lch = function (col1, col2, f) {\n    \treturn interpolate_hsx$5(col1, col2, f, 'lch');\n    };\n\n    // register interpolator\n    interpolator$1.lch = lch;\n    interpolator$1.hcl = lch;\n\n    var Color$8 = Color_1;\n\n    var num = function (col1, col2, f) {\n        var c1 = col1.num();\n        var c2 = col2.num();\n        return new Color$8(c1 + f * (c2-c1), 'num')\n    };\n\n    // register interpolator\n    interpolator$1.num = num;\n\n    var interpolate_hsx$4 = _hsx;\n\n    var hcg = function (col1, col2, f) {\n    \treturn interpolate_hsx$4(col1, col2, f, 'hcg');\n    };\n\n    // register interpolator\n    interpolator$1.hcg = hcg;\n\n    var interpolate_hsx$3 = _hsx;\n\n    var hsi = function (col1, col2, f) {\n    \treturn interpolate_hsx$3(col1, col2, f, 'hsi');\n    };\n\n    // register interpolator\n    interpolator$1.hsi = hsi;\n\n    var interpolate_hsx$2 = _hsx;\n\n    var hsl = function (col1, col2, f) {\n    \treturn interpolate_hsx$2(col1, col2, f, 'hsl');\n    };\n\n    // register interpolator\n    interpolator$1.hsl = hsl;\n\n    var interpolate_hsx$1 = _hsx;\n\n    var hsv = function (col1, col2, f) {\n    \treturn interpolate_hsx$1(col1, col2, f, 'hsv');\n    };\n\n    // register interpolator\n    interpolator$1.hsv = hsv;\n\n    var Color$7 = Color_1;\n\n    var oklab = function (col1, col2, f) {\n        var xyz0 = col1.oklab();\n        var xyz1 = col2.oklab();\n        return new Color$7(\n            xyz0[0] + f * (xyz1[0] - xyz0[0]),\n            xyz0[1] + f * (xyz1[1] - xyz0[1]),\n            xyz0[2] + f * (xyz1[2] - xyz0[2]),\n            'oklab'\n        );\n    };\n\n    // register interpolator\n    interpolator$1.oklab = oklab;\n\n    var interpolate_hsx = _hsx;\n\n    var oklch = function (col1, col2, f) {\n        return interpolate_hsx(col1, col2, f, 'oklch');\n    };\n\n    // register interpolator\n    interpolator$1.oklch = oklch;\n\n    var Color$6 = Color_1;\n    var clip_rgb$1 = utils.clip_rgb;\n    var pow$4 = Math.pow;\n    var sqrt$1 = Math.sqrt;\n    var PI$1 = Math.PI;\n    var cos$2 = Math.cos;\n    var sin$2 = Math.sin;\n    var atan2$1 = Math.atan2;\n\n    var average = function (colors, mode, weights) {\n        if ( mode === void 0 ) mode='lrgb';\n        if ( weights === void 0 ) weights=null;\n\n        var l = colors.length;\n        if (!weights) { weights = Array.from(new Array(l)).map(function () { return 1; }); }\n        // normalize weights\n        var k = l / weights.reduce(function(a, b) { return a + b; });\n        weights.forEach(function (w,i) { weights[i] *= k; });\n        // convert colors to Color objects\n        colors = colors.map(function (c) { return new Color$6(c); });\n        if (mode === 'lrgb') {\n            return _average_lrgb(colors, weights)\n        }\n        var first = colors.shift();\n        var xyz = first.get(mode);\n        var cnt = [];\n        var dx = 0;\n        var dy = 0;\n        // initial color\n        for (var i=0; i<xyz.length; i++) {\n            xyz[i] = (xyz[i] || 0) * weights[0];\n            cnt.push(isNaN(xyz[i]) ? 0 : weights[0]);\n            if (mode.charAt(i) === 'h' && !isNaN(xyz[i])) {\n                var A = xyz[i] / 180 * PI$1;\n                dx += cos$2(A) * weights[0];\n                dy += sin$2(A) * weights[0];\n            }\n        }\n\n        var alpha = first.alpha() * weights[0];\n        colors.forEach(function (c,ci) {\n            var xyz2 = c.get(mode);\n            alpha += c.alpha() * weights[ci+1];\n            for (var i=0; i<xyz.length; i++) {\n                if (!isNaN(xyz2[i])) {\n                    cnt[i] += weights[ci+1];\n                    if (mode.charAt(i) === 'h') {\n                        var A = xyz2[i] / 180 * PI$1;\n                        dx += cos$2(A) * weights[ci+1];\n                        dy += sin$2(A) * weights[ci+1];\n                    } else {\n                        xyz[i] += xyz2[i] * weights[ci+1];\n                    }\n                }\n            }\n        });\n\n        for (var i$1=0; i$1<xyz.length; i$1++) {\n            if (mode.charAt(i$1) === 'h') {\n                var A$1 = atan2$1(dy / cnt[i$1], dx / cnt[i$1]) / PI$1 * 180;\n                while (A$1 < 0) { A$1 += 360; }\n                while (A$1 >= 360) { A$1 -= 360; }\n                xyz[i$1] = A$1;\n            } else {\n                xyz[i$1] = xyz[i$1]/cnt[i$1];\n            }\n        }\n        alpha /= l;\n        return (new Color$6(xyz, mode)).alpha(alpha > 0.99999 ? 1 : alpha, true);\n    };\n\n\n    var _average_lrgb = function (colors, weights) {\n        var l = colors.length;\n        var xyz = [0,0,0,0];\n        for (var i=0; i < colors.length; i++) {\n            var col = colors[i];\n            var f = weights[i] / l;\n            var rgb = col._rgb;\n            xyz[0] += pow$4(rgb[0],2) * f;\n            xyz[1] += pow$4(rgb[1],2) * f;\n            xyz[2] += pow$4(rgb[2],2) * f;\n            xyz[3] += rgb[3] * f;\n        }\n        xyz[0] = sqrt$1(xyz[0]);\n        xyz[1] = sqrt$1(xyz[1]);\n        xyz[2] = sqrt$1(xyz[2]);\n        if (xyz[3] > 0.9999999) { xyz[3] = 1; }\n        return new Color$6(clip_rgb$1(xyz));\n    };\n\n    // minimal multi-purpose interface\n\n    // @requires utils color analyze\n\n    var chroma$4 = chroma_1;\n    var type$2 = utils.type;\n\n    var pow$3 = Math.pow;\n\n    var scale$2 = function(colors) {\n\n        // constructor\n        var _mode = 'rgb';\n        var _nacol = chroma$4('#ccc');\n        var _spread = 0;\n        // const _fixed = false;\n        var _domain = [0, 1];\n        var _pos = [];\n        var _padding = [0,0];\n        var _classes = false;\n        var _colors = [];\n        var _out = false;\n        var _min = 0;\n        var _max = 1;\n        var _correctLightness = false;\n        var _colorCache = {};\n        var _useCache = true;\n        var _gamma = 1;\n\n        // private methods\n\n        var setColors = function(colors) {\n            colors = colors || ['#fff', '#000'];\n            if (colors && type$2(colors) === 'string' && chroma$4.brewer &&\n                chroma$4.brewer[colors.toLowerCase()]) {\n                colors = chroma$4.brewer[colors.toLowerCase()];\n            }\n            if (type$2(colors) === 'array') {\n                // handle single color\n                if (colors.length === 1) {\n                    colors = [colors[0], colors[0]];\n                }\n                // make a copy of the colors\n                colors = colors.slice(0);\n                // convert to chroma classes\n                for (var c=0; c<colors.length; c++) {\n                    colors[c] = chroma$4(colors[c]);\n                }\n                // auto-fill color position\n                _pos.length = 0;\n                for (var c$1=0; c$1<colors.length; c$1++) {\n                    _pos.push(c$1/(colors.length-1));\n                }\n            }\n            resetCache();\n            return _colors = colors;\n        };\n\n        var getClass = function(value) {\n            if (_classes != null) {\n                var n = _classes.length-1;\n                var i = 0;\n                while (i < n && value >= _classes[i]) {\n                    i++;\n                }\n                return i-1;\n            }\n            return 0;\n        };\n\n        var tMapLightness = function (t) { return t; };\n        var tMapDomain = function (t) { return t; };\n\n        // const classifyValue = function(value) {\n        //     let val = value;\n        //     if (_classes.length > 2) {\n        //         const n = _classes.length-1;\n        //         const i = getClass(value);\n        //         const minc = _classes[0] + ((_classes[1]-_classes[0]) * (0 + (_spread * 0.5)));  // center of 1st class\n        //         const maxc = _classes[n-1] + ((_classes[n]-_classes[n-1]) * (1 - (_spread * 0.5)));  // center of last class\n        //         val = _min + ((((_classes[i] + ((_classes[i+1] - _classes[i]) * 0.5)) - minc) / (maxc-minc)) * (_max - _min));\n        //     }\n        //     return val;\n        // };\n\n        var getColor = function(val, bypassMap) {\n            var col, t;\n            if (bypassMap == null) { bypassMap = false; }\n            if (isNaN(val) || (val === null)) { return _nacol; }\n            if (!bypassMap) {\n                if (_classes && (_classes.length > 2)) {\n                    // find the class\n                    var c = getClass(val);\n                    t = c / (_classes.length-2);\n                } else if (_max !== _min) {\n                    // just interpolate between min/max\n                    t = (val - _min) / (_max - _min);\n                } else {\n                    t = 1;\n                }\n            } else {\n                t = val;\n            }\n\n            // domain map\n            t = tMapDomain(t);\n\n            if (!bypassMap) {\n                t = tMapLightness(t);  // lightness correction\n            }\n\n            if (_gamma !== 1) { t = pow$3(t, _gamma); }\n\n            t = _padding[0] + (t * (1 - _padding[0] - _padding[1]));\n\n            t = Math.min(1, Math.max(0, t));\n\n            var k = Math.floor(t * 10000);\n\n            if (_useCache && _colorCache[k]) {\n                col = _colorCache[k];\n            } else {\n                if (type$2(_colors) === 'array') {\n                    //for i in [0.._pos.length-1]\n                    for (var i=0; i<_pos.length; i++) {\n                        var p = _pos[i];\n                        if (t <= p) {\n                            col = _colors[i];\n                            break;\n                        }\n                        if ((t >= p) && (i === (_pos.length-1))) {\n                            col = _colors[i];\n                            break;\n                        }\n                        if (t > p && t < _pos[i+1]) {\n                            t = (t-p)/(_pos[i+1]-p);\n                            col = chroma$4.interpolate(_colors[i], _colors[i+1], t, _mode);\n                            break;\n                        }\n                    }\n                } else if (type$2(_colors) === 'function') {\n                    col = _colors(t);\n                }\n                if (_useCache) { _colorCache[k] = col; }\n            }\n            return col;\n        };\n\n        var resetCache = function () { return _colorCache = {}; };\n\n        setColors(colors);\n\n        // public interface\n\n        var f = function(v) {\n            var c = chroma$4(getColor(v));\n            if (_out && c[_out]) { return c[_out](); } else { return c; }\n        };\n\n        f.classes = function(classes) {\n            if (classes != null) {\n                if (type$2(classes) === 'array') {\n                    _classes = classes;\n                    _domain = [classes[0], classes[classes.length-1]];\n                } else {\n                    var d = chroma$4.analyze(_domain);\n                    if (classes === 0) {\n                        _classes = [d.min, d.max];\n                    } else {\n                        _classes = chroma$4.limits(d, 'e', classes);\n                    }\n                }\n                return f;\n            }\n            return _classes;\n        };\n\n\n        f.domain = function(domain) {\n            if (!arguments.length) {\n                return _domain;\n            }\n            _min = domain[0];\n            _max = domain[domain.length-1];\n            _pos = [];\n            var k = _colors.length;\n            if ((domain.length === k) && (_min !== _max)) {\n                // update positions\n                for (var i = 0, list = Array.from(domain); i < list.length; i += 1) {\n                    var d = list[i];\n\n                  _pos.push((d-_min) / (_max-_min));\n                }\n            } else {\n                for (var c=0; c<k; c++) {\n                    _pos.push(c/(k-1));\n                }\n                if (domain.length > 2) {\n                    // set domain map\n                    var tOut = domain.map(function (d,i) { return i/(domain.length-1); });\n                    var tBreaks = domain.map(function (d) { return (d - _min) / (_max - _min); });\n                    if (!tBreaks.every(function (val, i) { return tOut[i] === val; })) {\n                        tMapDomain = function (t) {\n                            if (t <= 0 || t >= 1) { return t; }\n                            var i = 0;\n                            while (t >= tBreaks[i+1]) { i++; }\n                            var f = (t - tBreaks[i]) / (tBreaks[i+1] - tBreaks[i]);\n                            var out = tOut[i] + f * (tOut[i+1] - tOut[i]);\n                            return out;\n                        };\n                    }\n\n                }\n            }\n            _domain = [_min, _max];\n            return f;\n        };\n\n        f.mode = function(_m) {\n            if (!arguments.length) {\n                return _mode;\n            }\n            _mode = _m;\n            resetCache();\n            return f;\n        };\n\n        f.range = function(colors, _pos) {\n            setColors(colors);\n            return f;\n        };\n\n        f.out = function(_o) {\n            _out = _o;\n            return f;\n        };\n\n        f.spread = function(val) {\n            if (!arguments.length) {\n                return _spread;\n            }\n            _spread = val;\n            return f;\n        };\n\n        f.correctLightness = function(v) {\n            if (v == null) { v = true; }\n            _correctLightness = v;\n            resetCache();\n            if (_correctLightness) {\n                tMapLightness = function(t) {\n                    var L0 = getColor(0, true).lab()[0];\n                    var L1 = getColor(1, true).lab()[0];\n                    var pol = L0 > L1;\n                    var L_actual = getColor(t, true).lab()[0];\n                    var L_ideal = L0 + ((L1 - L0) * t);\n                    var L_diff = L_actual - L_ideal;\n                    var t0 = 0;\n                    var t1 = 1;\n                    var max_iter = 20;\n                    while ((Math.abs(L_diff) > 1e-2) && (max_iter-- > 0)) {\n                        (function() {\n                            if (pol) { L_diff *= -1; }\n                            if (L_diff < 0) {\n                                t0 = t;\n                                t += (t1 - t) * 0.5;\n                            } else {\n                                t1 = t;\n                                t += (t0 - t) * 0.5;\n                            }\n                            L_actual = getColor(t, true).lab()[0];\n                            return L_diff = L_actual - L_ideal;\n                        })();\n                    }\n                    return t;\n                };\n            } else {\n                tMapLightness = function (t) { return t; };\n            }\n            return f;\n        };\n\n        f.padding = function(p) {\n            if (p != null) {\n                if (type$2(p) === 'number') {\n                    p = [p,p];\n                }\n                _padding = p;\n                return f;\n            } else {\n                return _padding;\n            }\n        };\n\n        f.colors = function(numColors, out) {\n            // If no arguments are given, return the original colors that were provided\n            if (arguments.length < 2) { out = 'hex'; }\n            var result = [];\n\n            if (arguments.length === 0) {\n                result = _colors.slice(0);\n\n            } else if (numColors === 1) {\n                result = [f(0.5)];\n\n            } else if (numColors > 1) {\n                var dm = _domain[0];\n                var dd = _domain[1] - dm;\n                result = __range__(0, numColors, false).map(function (i) { return f( dm + ((i/(numColors-1)) * dd) ); });\n\n            } else { // returns all colors based on the defined classes\n                colors = [];\n                var samples = [];\n                if (_classes && (_classes.length > 2)) {\n                    for (var i = 1, end = _classes.length, asc = 1 <= end; asc ? i < end : i > end; asc ? i++ : i--) {\n                        samples.push((_classes[i-1]+_classes[i])*0.5);\n                    }\n                } else {\n                    samples = _domain;\n                }\n                result = samples.map(function (v) { return f(v); });\n            }\n\n            if (chroma$4[out]) {\n                result = result.map(function (c) { return c[out](); });\n            }\n            return result;\n        };\n\n        f.cache = function(c) {\n            if (c != null) {\n                _useCache = c;\n                return f;\n            } else {\n                return _useCache;\n            }\n        };\n\n        f.gamma = function(g) {\n            if (g != null) {\n                _gamma = g;\n                return f;\n            } else {\n                return _gamma;\n            }\n        };\n\n        f.nodata = function(d) {\n            if (d != null) {\n                _nacol = chroma$4(d);\n                return f;\n            } else {\n                return _nacol;\n            }\n        };\n\n        return f;\n    };\n\n    function __range__(left, right, inclusive) {\n      var range = [];\n      var ascending = left < right;\n      var end = !inclusive ? right : ascending ? right + 1 : right - 1;\n      for (var i = left; ascending ? i < end : i > end; ascending ? i++ : i--) {\n        range.push(i);\n      }\n      return range;\n    }\n\n    //\n    // interpolates between a set of colors uzing a bezier spline\n    //\n\n    // @requires utils lab\n    var Color$5 = Color_1;\n\n    var scale$1 = scale$2;\n\n    // nth row of the pascal triangle\n    var binom_row = function(n) {\n        var row = [1, 1];\n        for (var i = 1; i < n; i++) {\n            var newrow = [1];\n            for (var j = 1; j <= row.length; j++) {\n                newrow[j] = (row[j] || 0) + row[j - 1];\n            }\n            row = newrow;\n        }\n        return row;\n    };\n\n    var bezier = function(colors) {\n        var assign, assign$1, assign$2;\n\n        var I, lab0, lab1, lab2;\n        colors = colors.map(function (c) { return new Color$5(c); });\n        if (colors.length === 2) {\n            // linear interpolation\n            (assign = colors.map(function (c) { return c.lab(); }), lab0 = assign[0], lab1 = assign[1]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return lab0[i] + (t * (lab1[i] - lab0[i])); }));\n                return new Color$5(lab, 'lab');\n            };\n        } else if (colors.length === 3) {\n            // quadratic bezier interpolation\n            (assign$1 = colors.map(function (c) { return c.lab(); }), lab0 = assign$1[0], lab1 = assign$1[1], lab2 = assign$1[2]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return ((1-t)*(1-t) * lab0[i]) + (2 * (1-t) * t * lab1[i]) + (t * t * lab2[i]); }));\n                return new Color$5(lab, 'lab');\n            };\n        } else if (colors.length === 4) {\n            // cubic bezier interpolation\n            var lab3;\n            (assign$2 = colors.map(function (c) { return c.lab(); }), lab0 = assign$2[0], lab1 = assign$2[1], lab2 = assign$2[2], lab3 = assign$2[3]);\n            I = function(t) {\n                var lab = ([0, 1, 2].map(function (i) { return ((1-t)*(1-t)*(1-t) * lab0[i]) + (3 * (1-t) * (1-t) * t * lab1[i]) + (3 * (1-t) * t * t * lab2[i]) + (t*t*t * lab3[i]); }));\n                return new Color$5(lab, 'lab');\n            };\n        } else if (colors.length >= 5) {\n            // general case (degree n bezier)\n            var labs, row, n;\n            labs = colors.map(function (c) { return c.lab(); });\n            n = colors.length - 1;\n            row = binom_row(n);\n            I = function (t) {\n                var u = 1 - t;\n                var lab = ([0, 1, 2].map(function (i) { return labs.reduce(function (sum, el, j) { return (sum + row[j] * Math.pow( u, (n - j) ) * Math.pow( t, j ) * el[i]); }, 0); }));\n                return new Color$5(lab, 'lab');\n            };\n        } else {\n            throw new RangeError(\"No point in running bezier with only one color.\")\n        }\n        return I;\n    };\n\n    var bezier_1 = function (colors) {\n        var f = bezier(colors);\n        f.scale = function () { return scale$1(f); };\n        return f;\n    };\n\n    /*\n     * interpolates between a set of colors uzing a bezier spline\n     * blend mode formulas taken from http://www.venture-ware.com/kevin/coding/lets-learn-math-photoshop-blend-modes/\n     */\n\n    var chroma$3 = chroma_1;\n\n    var blend = function (bottom, top, mode) {\n        if (!blend[mode]) {\n            throw new Error('unknown blend mode ' + mode);\n        }\n        return blend[mode](bottom, top);\n    };\n\n    var blend_f = function (f) { return function (bottom,top) {\n            var c0 = chroma$3(top).rgb();\n            var c1 = chroma$3(bottom).rgb();\n            return chroma$3.rgb(f(c0, c1));\n        }; };\n\n    var each = function (f) { return function (c0, c1) {\n            var out = [];\n            out[0] = f(c0[0], c1[0]);\n            out[1] = f(c0[1], c1[1]);\n            out[2] = f(c0[2], c1[2]);\n            return out;\n        }; };\n\n    var normal = function (a) { return a; };\n    var multiply = function (a,b) { return a * b / 255; };\n    var darken = function (a,b) { return a > b ? b : a; };\n    var lighten = function (a,b) { return a > b ? a : b; };\n    var screen = function (a,b) { return 255 * (1 - (1-a/255) * (1-b/255)); };\n    var overlay = function (a,b) { return b < 128 ? 2 * a * b / 255 : 255 * (1 - 2 * (1 - a / 255 ) * ( 1 - b / 255 )); };\n    var burn = function (a,b) { return 255 * (1 - (1 - b / 255) / (a/255)); };\n    var dodge = function (a,b) {\n        if (a === 255) { return 255; }\n        a = 255 * (b / 255) / (1 - a / 255);\n        return a > 255 ? 255 : a\n    };\n\n    // # add = (a,b) ->\n    // #     if (a + b > 255) then 255 else a + b\n\n    blend.normal = blend_f(each(normal));\n    blend.multiply = blend_f(each(multiply));\n    blend.screen = blend_f(each(screen));\n    blend.overlay = blend_f(each(overlay));\n    blend.darken = blend_f(each(darken));\n    blend.lighten = blend_f(each(lighten));\n    blend.dodge = blend_f(each(dodge));\n    blend.burn = blend_f(each(burn));\n    // blend.add = blend_f(each(add));\n\n    var blend_1 = blend;\n\n    // cubehelix interpolation\n    // based on D.A. Green \"A colour scheme for the display of astronomical intensity images\"\n    // http://astron-soc.in/bulletin/11June/289392011.pdf\n\n    var type$1 = utils.type;\n    var clip_rgb = utils.clip_rgb;\n    var TWOPI = utils.TWOPI;\n    var pow$2 = Math.pow;\n    var sin$1 = Math.sin;\n    var cos$1 = Math.cos;\n    var chroma$2 = chroma_1;\n\n    var cubehelix = function(start, rotations, hue, gamma, lightness) {\n        if ( start === void 0 ) start=300;\n        if ( rotations === void 0 ) rotations=-1.5;\n        if ( hue === void 0 ) hue=1;\n        if ( gamma === void 0 ) gamma=1;\n        if ( lightness === void 0 ) lightness=[0,1];\n\n        var dh = 0, dl;\n        if (type$1(lightness) === 'array') {\n            dl = lightness[1] - lightness[0];\n        } else {\n            dl = 0;\n            lightness = [lightness, lightness];\n        }\n\n        var f = function(fract) {\n            var a = TWOPI * (((start+120)/360) + (rotations * fract));\n            var l = pow$2(lightness[0] + (dl * fract), gamma);\n            var h = dh !== 0 ? hue[0] + (fract * dh) : hue;\n            var amp = (h * l * (1-l)) / 2;\n            var cos_a = cos$1(a);\n            var sin_a = sin$1(a);\n            var r = l + (amp * ((-0.14861 * cos_a) + (1.78277* sin_a)));\n            var g = l + (amp * ((-0.29227 * cos_a) - (0.90649* sin_a)));\n            var b = l + (amp * (+1.97294 * cos_a));\n            return chroma$2(clip_rgb([r*255,g*255,b*255,1]));\n        };\n\n        f.start = function(s) {\n            if ((s == null)) { return start; }\n            start = s;\n            return f;\n        };\n\n        f.rotations = function(r) {\n            if ((r == null)) { return rotations; }\n            rotations = r;\n            return f;\n        };\n\n        f.gamma = function(g) {\n            if ((g == null)) { return gamma; }\n            gamma = g;\n            return f;\n        };\n\n        f.hue = function(h) {\n            if ((h == null)) { return hue; }\n            hue = h;\n            if (type$1(hue) === 'array') {\n                dh = hue[1] - hue[0];\n                if (dh === 0) { hue = hue[1]; }\n            } else {\n                dh = 0;\n            }\n            return f;\n        };\n\n        f.lightness = function(h) {\n            if ((h == null)) { return lightness; }\n            if (type$1(h) === 'array') {\n                lightness = h;\n                dl = h[1] - h[0];\n            } else {\n                lightness = [h,h];\n                dl = 0;\n            }\n            return f;\n        };\n\n        f.scale = function () { return chroma$2.scale(f); };\n\n        f.hue(hue);\n\n        return f;\n    };\n\n    var Color$4 = Color_1;\n    var digits = '0123456789abcdef';\n\n    var floor$1 = Math.floor;\n    var random = Math.random;\n\n    var random_1 = function () {\n        var code = '#';\n        for (var i=0; i<6; i++) {\n            code += digits.charAt(floor$1(random() * 16));\n        }\n        return new Color$4(code, 'hex');\n    };\n\n    var type = type$p;\n    var log = Math.log;\n    var pow$1 = Math.pow;\n    var floor = Math.floor;\n    var abs$1 = Math.abs;\n\n\n    var analyze = function (data, key) {\n        if ( key === void 0 ) key=null;\n\n        var r = {\n            min: Number.MAX_VALUE,\n            max: Number.MAX_VALUE*-1,\n            sum: 0,\n            values: [],\n            count: 0\n        };\n        if (type(data) === 'object') {\n            data = Object.values(data);\n        }\n        data.forEach(function (val) {\n            if (key && type(val) === 'object') { val = val[key]; }\n            if (val !== undefined && val !== null && !isNaN(val)) {\n                r.values.push(val);\n                r.sum += val;\n                if (val < r.min) { r.min = val; }\n                if (val > r.max) { r.max = val; }\n                r.count += 1;\n            }\n        });\n\n        r.domain = [r.min, r.max];\n\n        r.limits = function (mode, num) { return limits(r, mode, num); };\n\n        return r;\n    };\n\n\n    var limits = function (data, mode, num) {\n        if ( mode === void 0 ) mode='equal';\n        if ( num === void 0 ) num=7;\n\n        if (type(data) == 'array') {\n            data = analyze(data);\n        }\n        var min = data.min;\n        var max = data.max;\n        var values = data.values.sort(function (a,b) { return a-b; });\n\n        if (num === 1) { return [min,max]; }\n\n        var limits = [];\n\n        if (mode.substr(0,1) === 'c') { // continuous\n            limits.push(min);\n            limits.push(max);\n        }\n\n        if (mode.substr(0,1) === 'e') { // equal interval\n            limits.push(min);\n            for (var i=1; i<num; i++) {\n                limits.push(min+((i/num)*(max-min)));\n            }\n            limits.push(max);\n        }\n\n        else if (mode.substr(0,1) === 'l') { // log scale\n            if (min <= 0) {\n                throw new Error('Logarithmic scales are only possible for values > 0');\n            }\n            var min_log = Math.LOG10E * log(min);\n            var max_log = Math.LOG10E * log(max);\n            limits.push(min);\n            for (var i$1=1; i$1<num; i$1++) {\n                limits.push(pow$1(10, min_log + ((i$1/num) * (max_log - min_log))));\n            }\n            limits.push(max);\n        }\n\n        else if (mode.substr(0,1) === 'q') { // quantile scale\n            limits.push(min);\n            for (var i$2=1; i$2<num; i$2++) {\n                var p = ((values.length-1) * i$2)/num;\n                var pb = floor(p);\n                if (pb === p) {\n                    limits.push(values[pb]);\n                } else { // p > pb\n                    var pr = p - pb;\n                    limits.push((values[pb]*(1-pr)) + (values[pb+1]*pr));\n                }\n            }\n            limits.push(max);\n\n        }\n\n        else if (mode.substr(0,1) === 'k') { // k-means clustering\n            /*\n            implementation based on\n            http://code.google.com/p/figue/source/browse/trunk/figue.js#336\n            simplified for 1-d input values\n            */\n            var cluster;\n            var n = values.length;\n            var assignments = new Array(n);\n            var clusterSizes = new Array(num);\n            var repeat = true;\n            var nb_iters = 0;\n            var centroids = null;\n\n            // get seed values\n            centroids = [];\n            centroids.push(min);\n            for (var i$3=1; i$3<num; i$3++) {\n                centroids.push(min + ((i$3/num) * (max-min)));\n            }\n            centroids.push(max);\n\n            while (repeat) {\n                // assignment step\n                for (var j=0; j<num; j++) {\n                    clusterSizes[j] = 0;\n                }\n                for (var i$4=0; i$4<n; i$4++) {\n                    var value = values[i$4];\n                    var mindist = Number.MAX_VALUE;\n                    var best = (void 0);\n                    for (var j$1=0; j$1<num; j$1++) {\n                        var dist = abs$1(centroids[j$1]-value);\n                        if (dist < mindist) {\n                            mindist = dist;\n                            best = j$1;\n                        }\n                        clusterSizes[best]++;\n                        assignments[i$4] = best;\n                    }\n                }\n\n                // update centroids step\n                var newCentroids = new Array(num);\n                for (var j$2=0; j$2<num; j$2++) {\n                    newCentroids[j$2] = null;\n                }\n                for (var i$5=0; i$5<n; i$5++) {\n                    cluster = assignments[i$5];\n                    if (newCentroids[cluster] === null) {\n                        newCentroids[cluster] = values[i$5];\n                    } else {\n                        newCentroids[cluster] += values[i$5];\n                    }\n                }\n                for (var j$3=0; j$3<num; j$3++) {\n                    newCentroids[j$3] *= 1/clusterSizes[j$3];\n                }\n\n                // check convergence\n                repeat = false;\n                for (var j$4=0; j$4<num; j$4++) {\n                    if (newCentroids[j$4] !== centroids[j$4]) {\n                        repeat = true;\n                        break;\n                    }\n                }\n\n                centroids = newCentroids;\n                nb_iters++;\n\n                if (nb_iters > 200) {\n                    repeat = false;\n                }\n            }\n\n            // finished k-means clustering\n            // the next part is borrowed from gabrielflor.it\n            var kClusters = {};\n            for (var j$5=0; j$5<num; j$5++) {\n                kClusters[j$5] = [];\n            }\n            for (var i$6=0; i$6<n; i$6++) {\n                cluster = assignments[i$6];\n                kClusters[cluster].push(values[i$6]);\n            }\n            var tmpKMeansBreaks = [];\n            for (var j$6=0; j$6<num; j$6++) {\n                tmpKMeansBreaks.push(kClusters[j$6][0]);\n                tmpKMeansBreaks.push(kClusters[j$6][kClusters[j$6].length-1]);\n            }\n            tmpKMeansBreaks = tmpKMeansBreaks.sort(function (a,b){ return a-b; });\n            limits.push(tmpKMeansBreaks[0]);\n            for (var i$7=1; i$7 < tmpKMeansBreaks.length; i$7+= 2) {\n                var v = tmpKMeansBreaks[i$7];\n                if (!isNaN(v) && (limits.indexOf(v) === -1)) {\n                    limits.push(v);\n                }\n            }\n        }\n        return limits;\n    };\n\n    var analyze_1 = {analyze: analyze, limits: limits};\n\n    var Color$3 = Color_1;\n\n\n    var contrast = function (a, b) {\n        // WCAG contrast ratio\n        // see http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef\n        a = new Color$3(a);\n        b = new Color$3(b);\n        var l1 = a.luminance();\n        var l2 = b.luminance();\n        return l1 > l2 ? (l1 + 0.05) / (l2 + 0.05) : (l2 + 0.05) / (l1 + 0.05);\n    };\n\n    var Color$2 = Color_1;\n    var sqrt = Math.sqrt;\n    var pow = Math.pow;\n    var min = Math.min;\n    var max = Math.max;\n    var atan2 = Math.atan2;\n    var abs = Math.abs;\n    var cos = Math.cos;\n    var sin = Math.sin;\n    var exp = Math.exp;\n    var PI = Math.PI;\n\n    var deltaE = function(a, b, Kl, Kc, Kh) {\n        if ( Kl === void 0 ) Kl=1;\n        if ( Kc === void 0 ) Kc=1;\n        if ( Kh === void 0 ) Kh=1;\n\n        // Delta E (CIE 2000)\n        // see http://www.brucelindbloom.com/index.html?Eqn_DeltaE_CIE2000.html\n        var rad2deg = function(rad) {\n            return 360 * rad / (2 * PI);\n        };\n        var deg2rad = function(deg) {\n            return (2 * PI * deg) / 360;\n        };\n        a = new Color$2(a);\n        b = new Color$2(b);\n        var ref = Array.from(a.lab());\n        var L1 = ref[0];\n        var a1 = ref[1];\n        var b1 = ref[2];\n        var ref$1 = Array.from(b.lab());\n        var L2 = ref$1[0];\n        var a2 = ref$1[1];\n        var b2 = ref$1[2];\n        var avgL = (L1 + L2)/2;\n        var C1 = sqrt(pow(a1, 2) + pow(b1, 2));\n        var C2 = sqrt(pow(a2, 2) + pow(b2, 2));\n        var avgC = (C1 + C2)/2;\n        var G = 0.5*(1-sqrt(pow(avgC, 7)/(pow(avgC, 7) + pow(25, 7))));\n        var a1p = a1*(1+G);\n        var a2p = a2*(1+G);\n        var C1p = sqrt(pow(a1p, 2) + pow(b1, 2));\n        var C2p = sqrt(pow(a2p, 2) + pow(b2, 2));\n        var avgCp = (C1p + C2p)/2;\n        var arctan1 = rad2deg(atan2(b1, a1p));\n        var arctan2 = rad2deg(atan2(b2, a2p));\n        var h1p = arctan1 >= 0 ? arctan1 : arctan1 + 360;\n        var h2p = arctan2 >= 0 ? arctan2 : arctan2 + 360;\n        var avgHp = abs(h1p - h2p) > 180 ? (h1p + h2p + 360)/2 : (h1p + h2p)/2;\n        var T = 1 - 0.17*cos(deg2rad(avgHp - 30)) + 0.24*cos(deg2rad(2*avgHp)) + 0.32*cos(deg2rad(3*avgHp + 6)) - 0.2*cos(deg2rad(4*avgHp - 63));\n        var deltaHp = h2p - h1p;\n        deltaHp = abs(deltaHp) <= 180 ? deltaHp : h2p <= h1p ? deltaHp + 360 : deltaHp - 360;\n        deltaHp = 2*sqrt(C1p*C2p)*sin(deg2rad(deltaHp)/2);\n        var deltaL = L2 - L1;\n        var deltaCp = C2p - C1p;    \n        var sl = 1 + (0.015*pow(avgL - 50, 2))/sqrt(20 + pow(avgL - 50, 2));\n        var sc = 1 + 0.045*avgCp;\n        var sh = 1 + 0.015*avgCp*T;\n        var deltaTheta = 30*exp(-pow((avgHp - 275)/25, 2));\n        var Rc = 2*sqrt(pow(avgCp, 7)/(pow(avgCp, 7) + pow(25, 7)));\n        var Rt = -Rc*sin(2*deg2rad(deltaTheta));\n        var result = sqrt(pow(deltaL/(Kl*sl), 2) + pow(deltaCp/(Kc*sc), 2) + pow(deltaHp/(Kh*sh), 2) + Rt*(deltaCp/(Kc*sc))*(deltaHp/(Kh*sh)));\n        return max(0, min(100, result));\n    };\n\n    var Color$1 = Color_1;\n\n    // simple Euclidean distance\n    var distance = function(a, b, mode) {\n        if ( mode === void 0 ) mode='lab';\n\n        // Delta E (CIE 1976)\n        // see http://www.brucelindbloom.com/index.html?Equations.html\n        a = new Color$1(a);\n        b = new Color$1(b);\n        var l1 = a.get(mode);\n        var l2 = b.get(mode);\n        var sum_sq = 0;\n        for (var i in l1) {\n            var d = (l1[i] || 0) - (l2[i] || 0);\n            sum_sq += d*d;\n        }\n        return Math.sqrt(sum_sq);\n    };\n\n    var Color = Color_1;\n\n    var valid = function () {\n        var args = [], len = arguments.length;\n        while ( len-- ) args[ len ] = arguments[ len ];\n\n        try {\n            new (Function.prototype.bind.apply( Color, [ null ].concat( args) ));\n            return true;\n        } catch (e) {\n            return false;\n        }\n    };\n\n    // some pre-defined color scales:\n    var chroma$1 = chroma_1;\n\n    var scale = scale$2;\n\n    var scales = {\n    \tcool: function cool() { return scale([chroma$1.hsl(180,1,.9), chroma$1.hsl(250,.7,.4)]) },\n    \thot: function hot() { return scale(['#000','#f00','#ff0','#fff']).mode('rgb') }\n    };\n\n    /**\n        ColorBrewer colors for chroma.js\n\n        Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The\n        Pennsylvania State University.\n\n        Licensed under the Apache License, Version 2.0 (the \"License\");\n        you may not use this file except in compliance with the License.\n        You may obtain a copy of the License at\n        http://www.apache.org/licenses/LICENSE-2.0\n\n        Unless required by applicable law or agreed to in writing, software distributed\n        under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n        CONDITIONS OF ANY KIND, either express or implied. See the License for the\n        specific language governing permissions and limitations under the License.\n    */\n\n    var colorbrewer = {\n        // sequential\n        OrRd: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#b30000', '#7f0000'],\n        PuBu: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#045a8d', '#023858'],\n        BuPu: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#810f7c', '#4d004b'],\n        Oranges: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#a63603', '#7f2704'],\n        BuGn: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b'],\n        YlOrBr: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#993404', '#662506'],\n        YlGn: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#006837', '#004529'],\n        Reds: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d'],\n        RdPu: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177', '#49006a'],\n        Greens: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#006d2c', '#00441b'],\n        YlGnBu: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#253494', '#081d58'],\n        Purples: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#54278f', '#3f007d'],\n        GnBu: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#0868ac', '#084081'],\n        Greys: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'],\n        YlOrRd: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#bd0026', '#800026'],\n        PuRd: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#980043', '#67001f'],\n        Blues: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#08519c', '#08306b'],\n        PuBuGn: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016c59', '#014636'],\n        Viridis: ['#440154', '#482777', '#3f4a8a', '#31678e', '#26838f', '#1f9d8a', '#6cce5a', '#b6de2b', '#fee825'],\n\n        // diverging\n\n        Spectral: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'],\n        RdYlGn: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'],\n        RdBu: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'],\n        PiYG: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'],\n        PRGn: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'],\n        RdYlBu: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'],\n        BrBG: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'],\n        RdGy: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'],\n        PuOr: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'],\n\n        // qualitative\n\n        Set2: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'],\n        Accent: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17', '#666666'],\n        Set1: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'],\n        Set3: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'],\n        Dark2: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d', '#666666'],\n        Paired: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'],\n        Pastel2: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc', '#cccccc'],\n        Pastel1: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec', '#f2f2f2'],\n    };\n\n    // add lowercase aliases for case-insensitive matches\n    for (var i = 0, list = Object.keys(colorbrewer); i < list.length; i += 1) {\n        var key = list[i];\n\n        colorbrewer[key.toLowerCase()] = colorbrewer[key];\n    }\n\n    var colorbrewer_1 = colorbrewer;\n\n    var chroma = chroma_1;\n\n    // feel free to comment out anything to rollup\n    // a smaller chroma.js built\n\n    // io --\x3e convert colors\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    // operators --\x3e modify existing Colors\n\n\n\n\n\n\n\n\n\n\n    // interpolators\n\n\n\n\n\n\n\n\n\n\n\n\n    // generators -- > create new colors\n    chroma.average = average;\n    chroma.bezier = bezier_1;\n    chroma.blend = blend_1;\n    chroma.cubehelix = cubehelix;\n    chroma.mix = chroma.interpolate = mix$1;\n    chroma.random = random_1;\n    chroma.scale = scale$2;\n\n    // other utility methods\n    chroma.analyze = analyze_1.analyze;\n    chroma.contrast = contrast;\n    chroma.deltaE = deltaE;\n    chroma.distance = distance;\n    chroma.limits = analyze_1.limits;\n    chroma.valid = valid;\n\n    // scale\n    chroma.scales = scales;\n\n    // colors\n    chroma.colors = w3cx11_1;\n    chroma.brewer = colorbrewer_1;\n\n    var chroma_js = chroma;\n\n    return chroma_js;\n\n}));\n\n\n//# sourceURL=webpack://ColorRick/./node_modules/chroma-js/chroma.js?")}};let __webpack_module_cache__={};function __webpack_require__(e){let t=__webpack_module_cache__[e];if(t!==undefined){return t.exports}let i=__webpack_module_cache__[e]={exports:{}};__webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__);return i.exports}let __webpack_exports__=__webpack_require__("./index.js");return __webpack_exports__})()});(()=>{var La={};(()=>{La.d=(e,t)=>{for(var i in t){if(La.o(t,i)&&!La.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{La.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{La.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var Pa={};(()=>{"use strict";La.r(Pa);La.d(Pa,{CGL:()=>wa,Framebuffer2:()=>xa,Geometry:()=>c,Mesh:()=>m,Shader:()=>x,Texture:()=>E,Uniform:()=>p});var R={};La.r(R);La.d(R,{ARRAY_TYPE:()=>_,EPSILON:()=>P,RANDOM:()=>h,equals:()=>q,setMatrixArrayType:()=>W,toRadian:()=>Y});var O={};La.r(O);La.d(O,{LDU:()=>de,add:()=>ge,adjoint:()=>re,clone:()=>Z,copy:()=>Q,create:()=>K,determinant:()=>se,equals:()=>_e,exactEquals:()=>me,frob:()=>fe,fromRotation:()=>he,fromScaling:()=>ue,fromValues:()=>ee,identity:()=>J,invert:()=>ne,mul:()=>xe,multiply:()=>ae,multiplyScalar:()=>be,multiplyScalarAndAdd:()=>ve,rotate:()=>oe,scale:()=>le,set:()=>te,str:()=>ce,sub:()=>Ee,subtract:()=>pe,transpose:()=>ie});var y={};La.r(y);La.d(y,{add:()=>Be,clone:()=>Ae,copy:()=>Se,create:()=>Te,determinant:()=>Oe,equals:()=>ze,exactEquals:()=>He,frob:()=>ke,fromRotation:()=>Pe,fromScaling:()=>Fe,fromTranslation:()=>Ve,fromValues:()=>Me,identity:()=>Ie,invert:()=>Re,mul:()=>$e,multiply:()=>ye,multiplyScalar:()=>Ge,multiplyScalarAndAdd:()=>je,rotate:()=>Ne,scale:()=>we,set:()=>Ce,str:()=>De,sub:()=>We,subtract:()=>Ue,translate:()=>Le});var N={};La.r(N);La.d(N,{add:()=>_t,adjoint:()=>it,clone:()=>qe,copy:()=>Ke,create:()=>Xe,determinant:()=>nt,equals:()=>Tt,exactEquals:()=>Et,frob:()=>mt,fromMat2d:()=>ct,fromMat4:()=>Ye,fromQuat:()=>ft,fromRotation:()=>ht,fromScaling:()=>ut,fromTranslation:()=>lt,fromValues:()=>Ze,identity:()=>Je,invert:()=>tt,mul:()=>At,multiply:()=>rt,multiplyScalar:()=>vt,multiplyScalarAndAdd:()=>xt,normalFromMat4:()=>dt,projection:()=>gt,rotate:()=>at,scale:()=>ot,set:()=>Qe,str:()=>pt,sub:()=>St,subtract:()=>bt,translate:()=>st,transpose:()=>et});var w={};La.r(w);La.d(w,{add:()=>ai,adjoint:()=>yt,clone:()=>It,copy:()=>Mt,create:()=>n,determinant:()=>Nt,equals:()=>ci,exactEquals:()=>ui,frob:()=>si,fromQuat:()=>Zt,fromQuat2:()=>$t,fromRotation:()=>Ut,fromRotationTranslation:()=>zt,fromRotationTranslationScale:()=>qt,fromRotationTranslationScaleOrigin:()=>Kt,fromScaling:()=>Bt,fromTranslation:()=>kt,fromValues:()=>Ct,fromXRotation:()=>Gt,fromYRotation:()=>jt,fromZRotation:()=>Ht,frustum:()=>Qt,getRotation:()=>Yt,getScaling:()=>Xt,getTranslation:()=>Wt,identity:()=>A,invert:()=>t,lookAt:()=>ii,mul:()=>fi,multiply:()=>wt,multiplyScalar:()=>li,multiplyScalarAndAdd:()=>hi,ortho:()=>ti,perspective:()=>Jt,perspectiveFromFieldOfView:()=>ei,rotate:()=>Pt,rotateX:()=>Ft,rotateY:()=>Vt,rotateZ:()=>Dt,scale:()=>Lt,set:()=>Rt,str:()=>ri,sub:()=>di,subtract:()=>oi,targetTo:()=>ni,translate:()=>r,transpose:()=>Ot});var L={};La.r(L);La.d(L,{add:()=>_i,angle:()=>ji,bezier:()=>Pi,ceil:()=>xi,clone:()=>gi,copy:()=>mi,create:()=>D,cross:()=>j,dist:()=>Ki,distance:()=>Ci,div:()=>qi,divide:()=>vi,dot:()=>G,equals:()=>Wi,exactEquals:()=>$i,floor:()=>Ei,forEach:()=>en,fromValues:()=>o,hermite:()=>Li,inverse:()=>Ni,len:()=>Qi,length:()=>pi,lerp:()=>wi,max:()=>Ai,min:()=>Ti,mul:()=>Yi,multiply:()=>bi,negate:()=>yi,normalize:()=>U,random:()=>Fi,rotateX:()=>Bi,rotateY:()=>Ui,rotateZ:()=>Gi,round:()=>Si,scale:()=>Ii,scaleAndAdd:()=>Mi,set:()=>k,sqrDist:()=>Zi,sqrLen:()=>Ji,squaredDistance:()=>Ri,squaredLength:()=>Oi,str:()=>zi,sub:()=>Xi,subtract:()=>B,transformMat3:()=>Di,transformMat4:()=>Vi,transformQuat:()=>ki,zero:()=>Hi});var F={};La.r(F);La.d(F,{add:()=>on,ceil:()=>cn,clone:()=>nn,copy:()=>sn,create:()=>tn,cross:()=>Mn,dist:()=>kn,distance:()=>bn,div:()=>Dn,divide:()=>un,dot:()=>In,equals:()=>Pn,exactEquals:()=>Ln,floor:()=>fn,forEach:()=>jn,fromValues:()=>rn,inverse:()=>An,len:()=>Un,length:()=>xn,lerp:()=>Cn,max:()=>gn,min:()=>dn,mul:()=>Vn,multiply:()=>hn,negate:()=>Tn,normalize:()=>Sn,random:()=>Rn,round:()=>pn,scale:()=>mn,scaleAndAdd:()=>_n,set:()=>an,sqrDist:()=>Bn,sqrLen:()=>Gn,squaredDistance:()=>vn,squaredLength:()=>En,str:()=>wn,sub:()=>Fn,subtract:()=>ln,transformMat4:()=>On,transformQuat:()=>yn,zero:()=>Nn});var V={};La.r(V);La.d(V,{add:()=>cr,calculateW:()=>Zn,clone:()=>or,conjugate:()=>nr,copy:()=>hr,create:()=>s,dot:()=>gr,equals:()=>Tr,exactEquals:()=>Er,exp:()=>Qn,fromEuler:()=>sr,fromMat3:()=>rr,fromValues:()=>lr,getAngle:()=>Wn,getAxisAngle:()=>$n,identity:()=>Hn,invert:()=>ir,len:()=>_r,length:()=>mr,lerp:()=>pr,ln:()=>Jn,mul:()=>fr,multiply:()=>Xn,normalize:()=>xr,pow:()=>er,random:()=>tr,rotateX:()=>Yn,rotateY:()=>qn,rotateZ:()=>Kn,rotationTo:()=>Ar,scale:()=>dr,set:()=>ur,setAxes:()=>Ir,setAxisAngle:()=>zn,slerp:()=>l,sqlerp:()=>Sr,sqrLen:()=>vr,squaredLength:()=>br,str:()=>ar});var z={};La.r(z);La.d(z,{add:()=>qr,clone:()=>Cr,conjugate:()=>is,copy:()=>Pr,create:()=>Mr,dot:()=>Jr,equals:()=>hs,exactEquals:()=>ls,fromMat4:()=>Lr,fromRotation:()=>wr,fromRotationTranslation:()=>yr,fromRotationTranslationValues:()=>Or,fromTranslation:()=>Nr,fromValues:()=>Rr,getDual:()=>kr,getReal:()=>Dr,getTranslation:()=>Gr,identity:()=>Fr,invert:()=>ts,len:()=>rs,length:()=>ns,lerp:()=>es,mul:()=>Zr,multiply:()=>Kr,normalize:()=>as,rotateAroundAxis:()=>Yr,rotateByQuatAppend:()=>Wr,rotateByQuatPrepend:()=>Xr,rotateX:()=>Hr,rotateY:()=>zr,rotateZ:()=>$r,scale:()=>Qr,set:()=>Vr,setDual:()=>Ur,setReal:()=>Br,sqrLen:()=>ss,squaredLength:()=>f,str:()=>os,translate:()=>jr});var $={};La.r($);La.d($,{add:()=>ds,angle:()=>Us,ceil:()=>_s,clone:()=>us,copy:()=>fs,create:()=>e,cross:()=>ws,dist:()=>qs,distance:()=>Ss,div:()=>Ys,divide:()=>ms,dot:()=>Ns,equals:()=>zs,exactEquals:()=>Hs,floor:()=>bs,forEach:()=>Qs,fromValues:()=>cs,inverse:()=>Os,len:()=>$s,length:()=>Ms,lerp:()=>Ls,max:()=>xs,min:()=>vs,mul:()=>Xs,multiply:()=>ps,negate:()=>Rs,normalize:()=>ys,random:()=>Ps,rotate:()=>Bs,round:()=>Es,scale:()=>Ts,scaleAndAdd:()=>As,set:()=>H,sqrDist:()=>Ks,sqrLen:()=>Zs,squaredDistance:()=>Is,squaredLength:()=>Cs,str:()=>js,sub:()=>Ws,subtract:()=>gs,transformMat2:()=>Fs,transformMat2d:()=>Vs,transformMat3:()=>Ds,transformMat4:()=>ks,zero:()=>Gs});const T=CABLES;const u=CABLES.SHARED;var P=1e-6;var _=typeof Float32Array!=="undefined"?Float32Array:Array;var h=Math.random;function W(e){_=e}var X=Math.PI/180;function Y(e){return e*X}function q(e,t){return Math.abs(e-t)<=P*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)};function K(){var e=new _(4);if(_!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function Z(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function Q(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function J(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function ee(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function te(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function ie(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function ne(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*s-r*n;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-n*a;e[2]=-r*a;e[3]=i*a;return e}function re(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function se(e){return e[0]*e[3]-e[2]*e[1]}function ae(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*o+s*l;e[1]=r*o+a*l;e[2]=n*h+s*u;e[3]=r*h+a*u;return e}function oe(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=n*l+s*o;e[1]=r*l+a*o;e[2]=n*-o+s*l;e[3]=r*-o+a*l;return e}function le(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1];e[0]=n*o;e[1]=r*o;e[2]=s*l;e[3]=a*l;return e}function he(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;return e}function ue(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function ce(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fe(e){return Math.hypot(e[0],e[1],e[2],e[3])}function de(e,t,i,n){e[2]=n[2]/n[0];i[0]=n[0];i[1]=n[1];i[3]=n[3]-e[2]*i[1];return[e,t,i]}function ge(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function pe(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function me(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _e(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=P*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=P*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=P*Math.max(1,Math.abs(s),Math.abs(h))}function be(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function ve(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}var xe=ae;var Ee=pe;function Te(){var e=new _(6);if(_!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function Ae(e){var t=new _(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function Se(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Ie(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Me(e,t,i,n,r,s){var a=new _(6);a[0]=e;a[1]=t;a[2]=i;a[3]=n;a[4]=r;a[5]=s;return a}function Ce(e,t,i,n,r,s,a){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;return e}function Re(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5];var l=i*s-n*r;if(!l){return null}l=1/l;e[0]=s*l;e[1]=-n*l;e[2]=-r*l;e[3]=i*l;e[4]=(r*o-s*a)*l;e[5]=(n*a-i*o)*l;return e}function Oe(e){return e[0]*e[3]-e[1]*e[2]}function ye(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1],c=i[2],f=i[3],d=i[4],g=i[5];e[0]=n*h+s*u;e[1]=r*h+a*u;e[2]=n*c+s*f;e[3]=r*c+a*f;e[4]=n*d+s*g+o;e[5]=r*d+a*g+l;return e}function Ne(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=Math.sin(i);var u=Math.cos(i);e[0]=n*u+s*h;e[1]=r*u+a*h;e[2]=n*-h+s*u;e[3]=r*-h+a*u;e[4]=o;e[5]=l;return e}function we(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=n*h;e[1]=r*h;e[2]=s*u;e[3]=a*u;e[4]=o;e[5]=l;return e}function Le(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=n*h+s*u+o;e[5]=r*h+a*u+l;return e}function Pe(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;e[4]=0;e[5]=0;return e}function Fe(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function Ve(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function De(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ke(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Be(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function Ue(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function Ge(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function je(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;return e}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function ze(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5];var l=t[0],h=t[1],u=t[2],c=t[3],f=t[4],d=t[5];return Math.abs(i-l)<=P*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=P*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-u)<=P*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-c)<=P*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-f)<=P*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-d)<=P*Math.max(1,Math.abs(o),Math.abs(d))}var $e=ye;var We=Ue;function Xe(){var e=new _(9);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function Ye(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function qe(e){var t=new _(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Ke(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function Ze(e,t,i,n,r,s,a,o,l){var h=new _(9);h[0]=e;h[1]=t;h[2]=i;h[3]=n;h[4]=r;h[5]=s;h[6]=a;h[7]=o;h[8]=l;return h}function Qe(e,t,i,n,r,s,a,o,l,h){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=h;return e}function Je(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function et(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=n;e[7]=r}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function tt(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];var c=u*a-o*h;var f=-u*s+o*l;var d=h*s-a*l;var g=i*c+n*f+r*d;if(!g){return null}g=1/g;e[0]=c*g;e[1]=(-u*n+r*h)*g;e[2]=(o*n-r*a)*g;e[3]=f*g;e[4]=(u*i-r*l)*g;e[5]=(-o*i+r*s)*g;e[6]=d*g;e[7]=(-h*i+n*l)*g;e[8]=(a*i-n*s)*g;return e}function it(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];e[0]=a*u-o*h;e[1]=r*h-n*u;e[2]=n*o-r*a;e[3]=o*l-s*u;e[4]=i*u-r*l;e[5]=r*s-i*o;e[6]=s*h-a*l;e[7]=n*l-i*h;e[8]=i*a-n*s;return e}function nt(e){var t=e[0],i=e[1],n=e[2];var r=e[3],s=e[4],a=e[5];var o=e[6],l=e[7],h=e[8];return t*(h*s-a*l)+i*(-h*r+a*o)+n*(l*r-s*o)}function rt(e,t,i){var n=t[0],r=t[1],s=t[2];var a=t[3],o=t[4],l=t[5];var h=t[6],u=t[7],c=t[8];var f=i[0],d=i[1],g=i[2];var p=i[3],m=i[4],_=i[5];var b=i[6],v=i[7],x=i[8];e[0]=f*n+d*a+g*h;e[1]=f*r+d*o+g*u;e[2]=f*s+d*l+g*c;e[3]=p*n+m*a+_*h;e[4]=p*r+m*o+_*u;e[5]=p*s+m*l+_*c;e[6]=b*n+v*a+x*h;e[7]=b*r+v*o+x*u;e[8]=b*s+v*l+x*c;return e}function st(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=i[0],d=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=o;e[5]=l;e[6]=f*n+d*a+h;e[7]=f*r+d*o+u;e[8]=f*s+d*l+c;return e}function at(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=Math.sin(i),d=Math.cos(i);e[0]=d*n+f*a;e[1]=d*r+f*o;e[2]=d*s+f*l;e[3]=d*a-f*n;e[4]=d*o-f*r;e[5]=d*l-f*s;e[6]=h;e[7]=u;e[8]=c;return e}function ot(e,t,i){var n=i[0],r=i[1];e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=r*t[3];e[4]=r*t[4];e[5]=r*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function lt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function ht(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=-i;e[4]=n;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ut(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ct(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function ft(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var h=i*a;var u=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var p=s*a;var m=s*o;var _=s*l;e[0]=1-c-g;e[3]=u-_;e[6]=f+m;e[1]=u+_;e[4]=1-h-g;e[7]=d-p;e[2]=f-m;e[5]=d+p;e[8]=1-h-c;return e}function dt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var x=i*h-s*a;var E=n*l-r*o;var T=n*h-s*o;var A=r*h-s*l;var S=u*p-c*g;var I=u*m-f*g;var M=u*_-d*g;var C=c*m-f*p;var R=c*_-d*p;var O=f*_-d*m;var y=b*O-v*R+x*C+E*M-T*I+A*S;if(!y){return null}y=1/y;e[0]=(o*O-l*R+h*C)*y;e[1]=(l*M-a*O-h*I)*y;e[2]=(a*R-o*M+h*S)*y;e[3]=(r*R-n*O-s*C)*y;e[4]=(i*O-r*M+s*I)*y;e[5]=(n*M-i*R-s*S)*y;e[6]=(p*A-m*T+_*E)*y;e[7]=(m*x-g*A-_*v)*y;e[8]=(g*T-p*x+_*b)*y;return e}function gt(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function pt(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function mt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function _t(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function bt(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function vt(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function xt(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;return e}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Tt(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];var c=t[0],f=t[1],d=t[2],g=t[3],p=t[4],m=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=P*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=P*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=P*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-g)<=P*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-p)<=P*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=P*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=P*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-b)<=P*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(u-v)<=P*Math.max(1,Math.abs(u),Math.abs(v))}var At=rt;var St=bt;function n(){var e=new _(16);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function It(e){var t=new _(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function Mt(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Ct(e,t,i,n,r,s,a,o,l,h,u,c,f,d,g,p){var m=new _(16);m[0]=e;m[1]=t;m[2]=i;m[3]=n;m[4]=r;m[5]=s;m[6]=a;m[7]=o;m[8]=l;m[9]=h;m[10]=u;m[11]=c;m[12]=f;m[13]=d;m[14]=g;m[15]=p;return m}function Rt(e,t,i,n,r,s,a,o,l,h,u,c,f,d,g,p,m){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=h;e[9]=u;e[10]=c;e[11]=f;e[12]=d;e[13]=g;e[14]=p;e[15]=m;return e}function A(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ot(e,t){if(e===t){var i=t[1],n=t[2],r=t[3];var s=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=n;e[9]=s;e[11]=t[14];e[12]=r;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function t(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var x=i*h-s*a;var E=n*l-r*o;var T=n*h-s*o;var A=r*h-s*l;var S=u*p-c*g;var I=u*m-f*g;var M=u*_-d*g;var C=c*m-f*p;var R=c*_-d*p;var O=f*_-d*m;var y=b*O-v*R+x*C+E*M-T*I+A*S;if(!y){return null}y=1/y;e[0]=(o*O-l*R+h*C)*y;e[1]=(r*R-n*O-s*C)*y;e[2]=(p*A-m*T+_*E)*y;e[3]=(f*T-c*A-d*E)*y;e[4]=(l*M-a*O-h*I)*y;e[5]=(i*O-r*M+s*I)*y;e[6]=(m*x-g*A-_*v)*y;e[7]=(u*A-f*x+d*v)*y;e[8]=(a*R-o*M+h*S)*y;e[9]=(n*M-i*R-s*S)*y;e[10]=(g*T-p*x+_*b)*y;e[11]=(c*x-u*T-d*b)*y;e[12]=(o*I-a*C-l*S)*y;e[13]=(i*C-n*I+r*S)*y;e[14]=(p*v-g*E-m*b)*y;e[15]=(u*E-c*v+f*b)*y;return e}function yt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];e[0]=o*(f*_-d*m)-c*(l*_-h*m)+p*(l*d-h*f);e[1]=-(n*(f*_-d*m)-c*(r*_-s*m)+p*(r*d-s*f));e[2]=n*(l*_-h*m)-o*(r*_-s*m)+p*(r*h-s*l);e[3]=-(n*(l*d-h*f)-o*(r*d-s*f)+c*(r*h-s*l));e[4]=-(a*(f*_-d*m)-u*(l*_-h*m)+g*(l*d-h*f));e[5]=i*(f*_-d*m)-u*(r*_-s*m)+g*(r*d-s*f);e[6]=-(i*(l*_-h*m)-a*(r*_-s*m)+g*(r*h-s*l));e[7]=i*(l*d-h*f)-a*(r*d-s*f)+u*(r*h-s*l);e[8]=a*(c*_-d*p)-u*(o*_-h*p)+g*(o*d-h*c);e[9]=-(i*(c*_-d*p)-u*(n*_-s*p)+g*(n*d-s*c));e[10]=i*(o*_-h*p)-a*(n*_-s*p)+g*(n*h-s*o);e[11]=-(i*(o*d-h*c)-a*(n*d-s*c)+u*(n*h-s*o));e[12]=-(a*(c*m-f*p)-u*(o*m-l*p)+g*(o*f-l*c));e[13]=i*(c*m-f*p)-u*(n*m-r*p)+g*(n*f-r*c);e[14]=-(i*(o*m-l*p)-a*(n*m-r*p)+g*(n*l-r*o));e[15]=i*(o*f-l*c)-a*(n*f-r*c)+u*(n*l-r*o);return e}function Nt(e){var t=e[0],i=e[1],n=e[2],r=e[3];var s=e[4],a=e[5],o=e[6],l=e[7];var h=e[8],u=e[9],c=e[10],f=e[11];var d=e[12],g=e[13],p=e[14],m=e[15];var _=t*a-i*s;var b=t*o-n*s;var v=t*l-r*s;var x=i*o-n*a;var E=i*l-r*a;var T=n*l-r*o;var A=h*g-u*d;var S=h*p-c*d;var I=h*m-f*d;var M=u*p-c*g;var C=u*m-f*g;var R=c*m-f*p;return _*R-b*C+v*M+x*I-E*S+T*A}function wt(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=t[4],l=t[5],h=t[6],u=t[7];var c=t[8],f=t[9],d=t[10],g=t[11];var p=t[12],m=t[13],_=t[14],b=t[15];var v=i[0],x=i[1],E=i[2],T=i[3];e[0]=v*n+x*o+E*c+T*p;e[1]=v*r+x*l+E*f+T*m;e[2]=v*s+x*h+E*d+T*_;e[3]=v*a+x*u+E*g+T*b;v=i[4];x=i[5];E=i[6];T=i[7];e[4]=v*n+x*o+E*c+T*p;e[5]=v*r+x*l+E*f+T*m;e[6]=v*s+x*h+E*d+T*_;e[7]=v*a+x*u+E*g+T*b;v=i[8];x=i[9];E=i[10];T=i[11];e[8]=v*n+x*o+E*c+T*p;e[9]=v*r+x*l+E*f+T*m;e[10]=v*s+x*h+E*d+T*_;e[11]=v*a+x*u+E*g+T*b;v=i[12];x=i[13];E=i[14];T=i[15];e[12]=v*n+x*o+E*c+T*p;e[13]=v*r+x*l+E*f+T*m;e[14]=v*s+x*h+E*d+T*_;e[15]=v*a+x*u+E*g+T*b;return e}function r(e,t,i){var n=i[0],r=i[1],s=i[2];var a,o,l,h;var u,c,f,d;var g,p,m,_;if(t===e){e[12]=t[0]*n+t[4]*r+t[8]*s+t[12];e[13]=t[1]*n+t[5]*r+t[9]*s+t[13];e[14]=t[2]*n+t[6]*r+t[10]*s+t[14];e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]}else{a=t[0];o=t[1];l=t[2];h=t[3];u=t[4];c=t[5];f=t[6];d=t[7];g=t[8];p=t[9];m=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=u;e[5]=c;e[6]=f;e[7]=d;e[8]=g;e[9]=p;e[10]=m;e[11]=_;e[12]=a*n+u*r+g*s+t[12];e[13]=o*n+c*r+p*s+t[13];e[14]=l*n+f*r+m*s+t[14];e[15]=h*n+d*r+_*s+t[15]}return e}function Lt(e,t,i){var n=i[0],r=i[1],s=i[2];e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;e[3]=t[3]*n;e[4]=t[4]*r;e[5]=t[5]*r;e[6]=t[6]*r;e[7]=t[7]*r;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Pt(e,t,i,n){var r=n[0],s=n[1],a=n[2];var o=Math.hypot(r,s,a);var l,h,u;var c,f,d,g;var p,m,_,b;var v,x,E,T;var A,S,I;var M,C,R;var O,y,N;if(o<P){return null}o=1/o;r*=o;s*=o;a*=o;l=Math.sin(i);h=Math.cos(i);u=1-h;c=t[0];f=t[1];d=t[2];g=t[3];p=t[4];m=t[5];_=t[6];b=t[7];v=t[8];x=t[9];E=t[10];T=t[11];A=r*r*u+h;S=s*r*u+a*l;I=a*r*u-s*l;M=r*s*u-a*l;C=s*s*u+h;R=a*s*u+r*l;O=r*a*u+s*l;y=s*a*u-r*l;N=a*a*u+h;e[0]=c*A+p*S+v*I;e[1]=f*A+m*S+x*I;e[2]=d*A+_*S+E*I;e[3]=g*A+b*S+T*I;e[4]=c*M+p*C+v*R;e[5]=f*M+m*C+x*R;e[6]=d*M+_*C+E*R;e[7]=g*M+b*C+T*R;e[8]=c*O+p*y+v*N;e[9]=f*O+m*y+x*N;e[10]=d*O+_*y+E*N;e[11]=g*O+b*y+T*N;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function Ft(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[4];var a=t[5];var o=t[6];var l=t[7];var h=t[8];var u=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*r+h*n;e[5]=a*r+u*n;e[6]=o*r+c*n;e[7]=l*r+f*n;e[8]=h*r-s*n;e[9]=u*r-a*n;e[10]=c*r-o*n;e[11]=f*r-l*n;return e}function Vt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[8];var u=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r-h*n;e[1]=a*r-u*n;e[2]=o*r-c*n;e[3]=l*r-f*n;e[8]=s*n+h*r;e[9]=a*n+u*r;e[10]=o*n+c*r;e[11]=l*n+f*r;return e}function Dt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[4];var u=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r+h*n;e[1]=a*r+u*n;e[2]=o*r+c*n;e[3]=l*r+f*n;e[4]=h*r-s*n;e[5]=u*r-a*n;e[6]=c*r-o*n;e[7]=f*r-l*n;return e}function kt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function Bt(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ut(e,t,i){var n=i[0],r=i[1],s=i[2];var a=Math.hypot(n,r,s);var o,l,h;if(a<P){return null}a=1/a;n*=a;r*=a;s*=a;o=Math.sin(t);l=Math.cos(t);h=1-l;e[0]=n*n*h+l;e[1]=r*n*h+s*o;e[2]=s*n*h-r*o;e[3]=0;e[4]=n*r*h-s*o;e[5]=r*r*h+l;e[6]=s*r*h+n*o;e[7]=0;e[8]=n*s*h+r*o;e[9]=r*s*h-n*o;e[10]=s*s*h+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Gt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function jt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ht(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function zt(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=n+n;var l=r+r;var h=s+s;var u=n*o;var c=n*l;var f=n*h;var d=r*l;var g=r*h;var p=s*h;var m=a*o;var _=a*l;var b=a*h;e[0]=1-(d+p);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(u+p);e[6]=g+m;e[7]=0;e[8]=f+_;e[9]=g-m;e[10]=1-(u+d);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function $t(e,t){var i=new _(3);var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7];var c=n*n+r*r+s*s+a*a;if(c>0){i[0]=(o*a+u*n+l*s-h*r)*2/c;i[1]=(l*a+u*r+h*n-o*s)*2/c;i[2]=(h*a+u*s+o*r-l*n)*2/c}else{i[0]=(o*a+u*n+l*s-h*r)*2;i[1]=(l*a+u*r+h*n-o*s)*2;i[2]=(h*a+u*s+o*r-l*n)*2}zt(e,t,i);return e}function Wt(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function Xt(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[4];var a=t[5];var o=t[6];var l=t[8];var h=t[9];var u=t[10];e[0]=Math.hypot(i,n,r);e[1]=Math.hypot(s,a,o);e[2]=Math.hypot(l,h,u);return e}function Yt(e,t){var i=new _(3);Xt(i,t);var n=1/i[0];var r=1/i[1];var s=1/i[2];var a=t[0]*n;var o=t[1]*r;var l=t[2]*s;var h=t[4]*n;var u=t[5]*r;var c=t[6]*s;var f=t[8]*n;var d=t[9]*r;var g=t[10]*s;var p=a+u+g;var m=0;if(p>0){m=Math.sqrt(p+1)*2;e[3]=.25*m;e[0]=(c-d)/m;e[1]=(f-l)/m;e[2]=(o-h)/m}else if(a>u&&a>g){m=Math.sqrt(1+a-u-g)*2;e[3]=(c-d)/m;e[0]=.25*m;e[1]=(o+h)/m;e[2]=(f+l)/m}else if(u>g){m=Math.sqrt(1+u-a-g)*2;e[3]=(f-l)/m;e[0]=(o+h)/m;e[1]=.25*m;e[2]=(c+d)/m}else{m=Math.sqrt(1+g-a-u)*2;e[3]=(o-h)/m;e[0]=(f+l)/m;e[1]=(c+d)/m;e[2]=.25*m}return e}function qt(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=r+r;var h=s+s;var u=a+a;var c=r*l;var f=r*h;var d=r*u;var g=s*h;var p=s*u;var m=a*u;var _=o*l;var b=o*h;var v=o*u;var x=n[0];var E=n[1];var T=n[2];e[0]=(1-(g+m))*x;e[1]=(f+v)*x;e[2]=(d-b)*x;e[3]=0;e[4]=(f-v)*E;e[5]=(1-(c+m))*E;e[6]=(p+_)*E;e[7]=0;e[8]=(d+b)*T;e[9]=(p-_)*T;e[10]=(1-(c+g))*T;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Kt(e,t,i,n,r){var s=t[0],a=t[1],o=t[2],l=t[3];var h=s+s;var u=a+a;var c=o+o;var f=s*h;var d=s*u;var g=s*c;var p=a*u;var m=a*c;var _=o*c;var b=l*h;var v=l*u;var x=l*c;var E=n[0];var T=n[1];var A=n[2];var S=r[0];var I=r[1];var M=r[2];var C=(1-(p+_))*E;var R=(d+x)*E;var O=(g-v)*E;var y=(d-x)*T;var N=(1-(f+_))*T;var w=(m+b)*T;var L=(g+v)*A;var P=(m-b)*A;var F=(1-(f+p))*A;e[0]=C;e[1]=R;e[2]=O;e[3]=0;e[4]=y;e[5]=N;e[6]=w;e[7]=0;e[8]=L;e[9]=P;e[10]=F;e[11]=0;e[12]=i[0]+S-(C*S+y*I+L*M);e[13]=i[1]+I-(R*S+N*I+P*M);e[14]=i[2]+M-(O*S+w*I+F*M);e[15]=1;return e}function Zt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var h=i*a;var u=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var p=s*a;var m=s*o;var _=s*l;e[0]=1-c-g;e[1]=u+_;e[2]=f-m;e[3]=0;e[4]=u-_;e[5]=1-h-g;e[6]=d+p;e[7]=0;e[8]=f+m;e[9]=d-p;e[10]=1-h-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Qt(e,t,i,n,r,s,a){var o=1/(i-t);var l=1/(r-n);var h=1/(s-a);e[0]=s*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(r+n)*l;e[10]=(a+s)*h;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*s*2*h;e[15]=0;return e}function Jt(e,t,i,n,r){var s=1/Math.tan(t/2),a;e[0]=s/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(r!=null&&r!==Infinity){a=1/(n-r);e[10]=(r+n)*a;e[14]=2*r*n*a}else{e[10]=-1;e[14]=-2*n}return e}function ei(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180);var s=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var h=2/(r+s);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=h;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(r-s)*h*.5;e[10]=n/(i-n);e[11]=-1;e[12]=0;e[13]=0;e[14]=n*i/(i-n);e[15]=0;return e}function ti(e,t,i,n,r,s,a){var o=1/(t-i);var l=1/(n-r);var h=1/(s-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*h;e[11]=0;e[12]=(t+i)*o;e[13]=(r+n)*l;e[14]=(a+s)*h;e[15]=1;return e}function ii(e,t,i,n){var r,s,a,o,l,h,u,c,f,d;var g=t[0];var p=t[1];var m=t[2];var _=n[0];var b=n[1];var v=n[2];var x=i[0];var E=i[1];var T=i[2];if(Math.abs(g-x)<P&&Math.abs(p-E)<P&&Math.abs(m-T)<P){return A(e)}u=g-x;c=p-E;f=m-T;d=1/Math.hypot(u,c,f);u*=d;c*=d;f*=d;r=b*f-v*c;s=v*u-_*f;a=_*c-b*u;d=Math.hypot(r,s,a);if(!d){r=0;s=0;a=0}else{d=1/d;r*=d;s*=d;a*=d}o=c*a-f*s;l=f*r-u*a;h=u*s-c*r;d=Math.hypot(o,l,h);if(!d){o=0;l=0;h=0}else{d=1/d;o*=d;l*=d;h*=d}e[0]=r;e[1]=o;e[2]=u;e[3]=0;e[4]=s;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=h;e[10]=f;e[11]=0;e[12]=-(r*g+s*p+a*m);e[13]=-(o*g+l*p+h*m);e[14]=-(u*g+c*p+f*m);e[15]=1;return e}function ni(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=n[0],l=n[1],h=n[2];var u=r-i[0],c=s-i[1],f=a-i[2];var d=u*u+c*c+f*f;if(d>0){d=1/Math.sqrt(d);u*=d;c*=d;f*=d}var g=l*f-h*c,p=h*u-o*f,m=o*c-l*u;d=g*g+p*p+m*m;if(d>0){d=1/Math.sqrt(d);g*=d;p*=d;m*=d}e[0]=g;e[1]=p;e[2]=m;e[3]=0;e[4]=c*m-f*p;e[5]=f*g-u*m;e[6]=u*p-c*g;e[7]=0;e[8]=u;e[9]=c;e[10]=f;e[11]=0;e[12]=r;e[13]=s;e[14]=a;e[15]=1;return e}function ri(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function si(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ai(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function oi(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function li(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function hi(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;e[9]=t[9]+i[9]*n;e[10]=t[10]+i[10]*n;e[11]=t[11]+i[11]*n;e[12]=t[12]+i[12]*n;e[13]=t[13]+i[13]*n;e[14]=t[14]+i[14]*n;e[15]=t[15]+i[15]*n;return e}function ui(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=e[4],o=e[5],l=e[6],h=e[7];var u=e[8],c=e[9],f=e[10],d=e[11];var g=e[12],p=e[13],m=e[14],_=e[15];var b=t[0],v=t[1],x=t[2],E=t[3];var T=t[4],A=t[5],S=t[6],I=t[7];var M=t[8],C=t[9],R=t[10],O=t[11];var y=t[12],N=t[13],w=t[14],L=t[15];return Math.abs(i-b)<=P*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-v)<=P*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=P*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=P*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-T)<=P*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-A)<=P*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(l-S)<=P*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-I)<=P*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(u-M)<=P*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-C)<=P*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(f-R)<=P*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-O)<=P*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(g-y)<=P*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(p-N)<=P*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(m-w)<=P*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(_-L)<=P*Math.max(1,Math.abs(_),Math.abs(L))}var fi=wt;var di=oi;function D(){var e=new _(3);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function gi(e){var t=new _(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function pi(e){var t=e[0];var i=e[1];var n=e[2];return Math.hypot(t,i,n)}function o(e,t,i){var n=new _(3);n[0]=e;n[1]=t;n[2]=i;return n}function mi(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function k(e,t,i,n){e[0]=t;e[1]=i;e[2]=n;return e}function _i(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function B(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function bi(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function vi(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function xi(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function Ei(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function Ti(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function Ai(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function Si(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function Ii(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function Mi(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;return e}function Ci(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return Math.hypot(i,n,r)}function Ri(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return i*i+n*n+r*r}function Oi(e){var t=e[0];var i=e[1];var n=e[2];return t*t+i*i+n*n}function yi(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function Ni(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function U(e,t){var i=t[0];var n=t[1];var r=t[2];var s=i*i+n*n+r*r;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s;return e}function G(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function j(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2];e[0]=r*l-s*o;e[1]=s*a-n*l;e[2]=n*o-r*a;return e}function wi(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);return e}function Li(e,t,i,n,r,s){var a=s*s;var o=a*(2*s-3)+1;var l=a*(s-2)+s;var h=a*(s-1);var u=a*(3-2*s);e[0]=t[0]*o+i[0]*l+n[0]*h+r[0]*u;e[1]=t[1]*o+i[1]*l+n[1]*h+r[1]*u;e[2]=t[2]*o+i[2]*l+n[2]*h+r[2]*u;return e}function Pi(e,t,i,n,r,s){var a=1-s;var o=a*a;var l=s*s;var h=o*a;var u=3*s*o;var c=3*l*a;var f=l*s;e[0]=t[0]*h+i[0]*u+n[0]*c+r[0]*f;e[1]=t[1]*h+i[1]*u+n[1]*c+r[1]*f;e[2]=t[2]*h+i[2]*u+n[2]*c+r[2]*f;return e}function Fi(e,t){t=t||1;var i=h()*2*Math.PI;var n=h()*2-1;var r=Math.sqrt(1-n*n)*t;e[0]=Math.cos(i)*r;e[1]=Math.sin(i)*r;e[2]=n*t;return e}function Vi(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[3]*n+i[7]*r+i[11]*s+i[15];a=a||1;e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/a;e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/a;e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/a;return e}function Di(e,t,i){var n=t[0],r=t[1],s=t[2];e[0]=n*i[0]+r*i[3]+s*i[6];e[1]=n*i[1]+r*i[4]+s*i[7];e[2]=n*i[2]+r*i[5]+s*i[8];return e}function ki(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3];var o=t[0],l=t[1],h=t[2];var u=r*h-s*l,c=s*o-n*h,f=n*l-r*o;var d=r*f-s*c,g=s*u-n*f,p=n*c-r*u;var m=a*2;u*=m;c*=m;f*=m;d*=2;g*=2;p*=2;e[0]=o+u+d;e[1]=l+c+g;e[2]=h+f+p;return e}function Bi(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0];s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n);s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Ui(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n);s[1]=r[1];s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Gi(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n);s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n);s[2]=r[2];e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function ji(e,t){var i=o(e[0],e[1],e[2]);var n=o(t[0],t[1],t[2]);U(i,i);U(n,n);var r=G(i,n);if(r>1){return 0}else if(r<-1){return Math.PI}else{return Math.acos(r)}}function Hi(e){e[0]=0;e[1]=0;e[2]=0;return e}function zi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function $i(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Wi(e,t){var i=e[0],n=e[1],r=e[2];var s=t[0],a=t[1],o=t[2];return Math.abs(i-s)<=P*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=P*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=P*Math.max(1,Math.abs(r),Math.abs(o))}var Xi=B;var Yi=bi;var qi=vi;var Ki=Ci;var Zi=Ri;var Qi=pi;var Ji=Oi;var en=function(){var l=D();return function(e,t,i,n,r,s){var a,o;if(!t){t=3}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}();function tn(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function nn(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function rn(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function sn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function an(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function on(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function ln(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function hn(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function un(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function cn(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function fn(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function dn(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function gn(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function pn(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function mn(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function _n(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}function bn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return Math.hypot(i,n,r,s)}function vn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return i*i+n*n+r*r+s*s}function xn(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return Math.hypot(t,i,n,r)}function En(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return t*t+i*i+n*n+r*r}function Tn(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function An(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function Sn(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[3];var a=i*i+n*n+r*r+s*s;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=n*a;e[2]=r*a;e[3]=s*a;return e}function In(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Mn(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],s=i[0]*n[2]-i[2]*n[0],a=i[0]*n[3]-i[3]*n[0],o=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],h=i[2]*n[3]-i[3]*n[2];var u=t[0];var c=t[1];var f=t[2];var d=t[3];e[0]=c*h-f*l+d*o;e[1]=-(u*h)+f*a-d*s;e[2]=u*l-c*a+d*r;e[3]=-(u*o)+c*s-f*r;return e}function Cn(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];var o=t[3];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);e[3]=o+n*(i[3]-o);return e}function Rn(e,t){t=t||1;var i,n,r,s;var a,o;do{i=h()*2-1;n=h()*2-1;a=i*i+n*n}while(a>=1);do{r=h()*2-1;s=h()*2-1;o=r*r+s*s}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*n;e[2]=t*r*l;e[3]=t*s*l;return e}function On(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*a;e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*a;e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*a;e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*a;return e}function yn(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2],h=i[3];var u=h*n+o*s-l*r;var c=h*r+l*n-a*s;var f=h*s+a*r-o*n;var d=-a*n-o*r-l*s;e[0]=u*h+d*-a+c*-l-f*-o;e[1]=c*h+d*-o+f*-a-u*-l;e[2]=f*h+d*-l+u*-o-c*-a;e[3]=t[3];return e}function Nn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function wn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ln(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Pn(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=P*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=P*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=P*Math.max(1,Math.abs(s),Math.abs(h))}var Fn=ln;var Vn=hn;var Dn=un;var kn=bn;var Bn=vn;var Un=xn;var Gn=En;var jn=function(){var l=tn();return function(e,t,i,n,r,s){var a,o;if(!t){t=4}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}();function s(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function Hn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function zn(e,t,i){i=i*.5;var n=Math.sin(i);e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=Math.cos(i);return e}function $n(e,t){var i=Math.acos(t[3])*2;var n=Math.sin(i/2);if(n>P){e[0]=t[0]/n;e[1]=t[1]/n;e[2]=t[2]/n}else{e[0]=1;e[1]=0;e[2]=0}return i}function Wn(e,t){var i=gr(e,t);return Math.acos(2*i*i-1)}function Xn(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*u+a*o+r*h-s*l;e[1]=r*u+a*l+s*o-n*h;e[2]=s*u+a*h+n*l-r*o;e[3]=a*u-n*o-r*l-s*h;return e}function Yn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+a*o;e[1]=r*l+s*o;e[2]=s*l-r*o;e[3]=a*l-n*o;return e}function qn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l-s*o;e[1]=r*l+a*o;e[2]=s*l+n*o;e[3]=a*l-r*o;return e}function Kn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*o;e[1]=r*l-n*o;e[2]=s*l+a*o;e[3]=a*l-s*o;return e}function Zn(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i;e[1]=n;e[2]=r;e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));return e}function Qn(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=Math.exp(s);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=n*l;e[2]=r*l;e[3]=o*Math.cos(a);return e}function Jn(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=a>0?Math.atan2(a,s)/a:0;e[0]=i*o;e[1]=n*o;e[2]=r*o;e[3]=.5*Math.log(i*i+n*n+r*r+s*s);return e}function er(e,t,i){Jn(e,t);dr(e,e,i);Qn(e,e);return e}function l(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=i[0],h=i[1],u=i[2],c=i[3];var f,d,g,p,m;d=r*l+s*h+a*u+o*c;if(d<0){d=-d;l=-l;h=-h;u=-u;c=-c}if(1-d>P){f=Math.acos(d);g=Math.sin(f);p=Math.sin((1-n)*f)/g;m=Math.sin(n*f)/g}else{p=1-n;m=n}e[0]=p*r+m*l;e[1]=p*s+m*h;e[2]=p*a+m*u;e[3]=p*o+m*c;return e}function tr(e){var t=h();var i=h();var n=h();var r=Math.sqrt(1-t);var s=Math.sqrt(t);e[0]=r*Math.sin(2*Math.PI*i);e[1]=r*Math.cos(2*Math.PI*i);e[2]=s*Math.sin(2*Math.PI*n);e[3]=s*Math.cos(2*Math.PI*n);return e}function ir(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*i+n*n+r*r+s*s;var o=a?1/a:0;e[0]=-i*o;e[1]=-n*o;e[2]=-r*o;e[3]=s*o;return e}function nr(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function rr(e,t){var i=t[0]+t[4]+t[8];var n;if(i>0){n=Math.sqrt(i+1);e[3]=.5*n;n=.5/n;e[0]=(t[5]-t[7])*n;e[1]=(t[6]-t[2])*n;e[2]=(t[1]-t[3])*n}else{var r=0;if(t[4]>t[0])r=1;if(t[8]>t[r*3+r])r=2;var s=(r+1)%3;var a=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[a*3+a]+1);e[r]=.5*n;n=.5/n;e[3]=(t[s*3+a]-t[a*3+s])*n;e[s]=(t[s*3+r]+t[r*3+s])*n;e[a]=(t[a*3+r]+t[r*3+a])*n}return e}function sr(e,t,i,n){var r=.5*Math.PI/180;t*=r;i*=r;n*=r;var s=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var h=Math.sin(n);var u=Math.cos(n);e[0]=s*l*u-a*o*h;e[1]=a*o*u+s*l*h;e[2]=a*l*h-s*o*u;e[3]=a*l*u+s*o*h;return e}function ar(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var or=nn;var lr=rn;var hr=sn;var ur=an;var cr=on;var fr=Xn;var dr=mn;var gr=In;var pr=Cn;var mr=xn;var _r=mr;var br=En;var vr=br;var xr=Sn;var Er=Ln;var Tr=Pn;var Ar=function(){var r=D();var s=o(1,0,0);var a=o(0,1,0);return function(e,t,i){var n=G(t,i);if(n<-.999999){j(r,s,t);if(Qi(r)<1e-6)j(r,a,t);U(r,r);zn(e,r,Math.PI);return e}else if(n>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{j(r,t,i);e[0]=r[0];e[1]=r[1];e[2]=r[2];e[3]=1+n;return xr(e,e)}}}();var Sr=function(){var a=s();var o=s();return function(e,t,i,n,r,s){l(a,t,r,s);l(o,i,n,s);l(e,a,o,2*s*(1-s));return e}}();var Ir=function(){var r=Xe();return function(e,t,i,n){r[0]=i[0];r[3]=i[1];r[6]=i[2];r[1]=n[0];r[4]=n[1];r[7]=n[2];r[2]=-t[0];r[5]=-t[1];r[8]=-t[2];return xr(e,rr(e,r))}}();function Mr(){var e=new _(8);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function Cr(e){var t=new _(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function Rr(e,t,i,n,r,s,a,o){var l=new _(8);l[0]=e;l[1]=t;l[2]=i;l[3]=n;l[4]=r;l[5]=s;l[6]=a;l[7]=o;return l}function Or(e,t,i,n,r,s,a){var o=new _(8);o[0]=e;o[1]=t;o[2]=i;o[3]=n;var l=r*.5,h=s*.5,u=a*.5;o[4]=l*n+h*i-u*t;o[5]=h*n+u*e-l*i;o[6]=u*n+l*t-h*e;o[7]=-l*e-h*t-u*i;return o}function yr(e,t,i){var n=i[0]*.5,r=i[1]*.5,s=i[2]*.5,a=t[0],o=t[1],l=t[2],h=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=n*h+r*l-s*o;e[5]=r*h+s*a-n*l;e[6]=s*h+n*o-r*a;e[7]=-n*a-r*o-s*l;return e}function Nr(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function wr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Lr(e,t){var i=s();Yt(i,t);var n=new _(3);Wt(n,t);yr(e,i,n);return e}function Pr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function Fr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Vr(e,t,i,n,r,s,a,o,l){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;return e}var Dr=hr;function kr(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var Br=hr;function Ur(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function Gr(e,t){var i=t[4],n=t[5],r=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],h=t[3];e[0]=(i*h+s*a+n*l-r*o)*2;e[1]=(n*h+s*o+r*a-i*l)*2;e[2]=(r*h+s*l+i*o-n*a)*2;return e}function jr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,h=i[2]*.5,u=t[4],c=t[5],f=t[6],d=t[7];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=a*o+r*h-s*l+u;e[5]=a*l+s*o-n*h+c;e[6]=a*h+n*l-r*o+f;e[7]=-n*o-r*l-s*h+d;return e}function Hr(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;Yn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function zr(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;qn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function $r(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;Kn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function Wr(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3],o=t[0],l=t[1],h=t[2],u=t[3];e[0]=o*a+u*n+l*s-h*r;e[1]=l*a+u*r+h*n-o*s;e[2]=h*a+u*s+o*r-l*n;e[3]=u*a-o*n-l*r-h*s;o=t[4];l=t[5];h=t[6];u=t[7];e[4]=o*a+u*n+l*s-h*r;e[5]=l*a+u*r+h*n-o*s;e[6]=h*a+u*s+o*r-l*n;e[7]=u*a-o*n-l*r-h*s;return e}function Xr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*u+a*o+r*h-s*l;e[1]=r*u+a*l+s*o-n*h;e[2]=s*u+a*h+n*l-r*o;e[3]=a*u-n*o-r*l-s*h;o=i[4];l=i[5];h=i[6];u=i[7];e[4]=n*u+a*o+r*h-s*l;e[5]=r*u+a*l+s*o-n*h;e[6]=s*u+a*h+n*l-r*o;e[7]=a*u-n*o-r*l-s*h;return e}function Yr(e,t,i,n){if(Math.abs(n)<P){return Pr(e,t)}var r=Math.hypot(i[0],i[1],i[2]);n=n*.5;var s=Math.sin(n);var a=s*i[0]/r;var o=s*i[1]/r;var l=s*i[2]/r;var h=Math.cos(n);var u=t[0],c=t[1],f=t[2],d=t[3];e[0]=u*h+d*a+c*l-f*o;e[1]=c*h+d*o+f*a-u*l;e[2]=f*h+d*l+u*o-c*a;e[3]=d*h-u*a-c*o-f*l;var g=t[4],p=t[5],m=t[6],_=t[7];e[4]=g*h+_*a+p*l-m*o;e[5]=p*h+_*o+m*a-g*l;e[6]=m*h+_*l+g*o-p*a;e[7]=_*h-g*a-p*o-m*l;return e}function qr(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function Kr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[4],l=i[5],h=i[6],u=i[7],c=t[4],f=t[5],d=t[6],g=t[7],p=i[0],m=i[1],_=i[2],b=i[3];e[0]=n*b+a*p+r*_-s*m;e[1]=r*b+a*m+s*p-n*_;e[2]=s*b+a*_+n*m-r*p;e[3]=a*b-n*p-r*m-s*_;e[4]=n*u+a*o+r*h-s*l+c*b+g*p+f*_-d*m;e[5]=r*u+a*l+s*o-n*h+f*b+g*m+d*p-c*_;e[6]=s*u+a*h+n*l-r*o+d*b+g*_+c*m-f*p;e[7]=a*u-n*o-r*l-s*h+g*b-c*p-f*m-d*_;return e}var Zr=Kr;function Qr(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var Jr=gr;function es(e,t,i,n){var r=1-n;if(Jr(t,i)<0)n=-n;e[0]=t[0]*r+i[0]*n;e[1]=t[1]*r+i[1]*n;e[2]=t[2]*r+i[2]*n;e[3]=t[3]*r+i[3]*n;e[4]=t[4]*r+i[4]*n;e[5]=t[5]*r+i[5]*n;e[6]=t[6]*r+i[6]*n;e[7]=t[7]*r+i[7]*n;return e}function ts(e,t){var i=f(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function is(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var ns=mr;var rs=ns;var f=br;var ss=f;function as(e,t){var i=f(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i;var r=t[1]/i;var s=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var h=t[6];var u=t[7];var c=n*o+r*l+s*h+a*u;e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=(o-n*c)/i;e[5]=(l-r*c)/i;e[6]=(h-s*c)/i;e[7]=(u-a*c)/i}return e}function os(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ls(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function hs(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7];var u=t[0],c=t[1],f=t[2],d=t[3],g=t[4],p=t[5],m=t[6],_=t[7];return Math.abs(i-u)<=P*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=P*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=P*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-d)<=P*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-g)<=P*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-p)<=P*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=P*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-_)<=P*Math.max(1,Math.abs(h),Math.abs(_))}function e(){var e=new _(2);if(_!=Float32Array){e[0]=0;e[1]=0}return e}function us(e){var t=new _(2);t[0]=e[0];t[1]=e[1];return t}function cs(e,t){var i=new _(2);i[0]=e;i[1]=t;return i}function fs(e,t){e[0]=t[0];e[1]=t[1];return e}function H(e,t,i){e[0]=t;e[1]=i;return e}function ds(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function gs(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function ps(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function ms(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function _s(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function bs(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function vs(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function xs(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function Es(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function Ts(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function As(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;return e}function Ss(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.hypot(i,n)}function Is(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Ms(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function Cs(e){var t=e[0],i=e[1];return t*t+i*i}function Rs(e,t){e[0]=-t[0];e[1]=-t[1];return e}function Os(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function ys(e,t){var i=t[0],n=t[1];var r=i*i+n*n;if(r>0){r=1/Math.sqrt(r)}e[0]=t[0]*r;e[1]=t[1]*r;return e}function Ns(e,t){return e[0]*t[0]+e[1]*t[1]}function ws(e,t,i){var n=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=n;return e}function Ls(e,t,i,n){var r=t[0],s=t[1];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);return e}function Ps(e,t){t=t||1;var i=h()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function Fs(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r;e[1]=i[1]*n+i[3]*r;return e}function Vs(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r+i[4];e[1]=i[1]*n+i[3]*r+i[5];return e}function Ds(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[3]*r+i[6];e[1]=i[1]*n+i[4]*r+i[7];return e}function ks(e,t,i){var n=t[0];var r=t[1];e[0]=i[0]*n+i[4]*r+i[12];e[1]=i[1]*n+i[5]*r+i[13];return e}function Bs(e,t,i,n){var r=t[0]-i[0],s=t[1]-i[1],a=Math.sin(n),o=Math.cos(n);e[0]=r*o-s*a+i[0];e[1]=r*a+s*o+i[1];return e}function Us(e,t){var i=e[0],n=e[1],r=t[0],s=t[1];var a=i*i+n*n;if(a>0){a=1/Math.sqrt(a)}var o=r*r+s*s;if(o>0){o=1/Math.sqrt(o)}var l=(i*r+n*s)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function Gs(e){e[0]=0;e[1]=0;return e}function js(e){return"vec2("+e[0]+", "+e[1]+")"}function Hs(e,t){return e[0]===t[0]&&e[1]===t[1]}function zs(e,t){var i=e[0],n=e[1];var r=t[0],s=t[1];return Math.abs(i-r)<=P*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=P*Math.max(1,Math.abs(n),Math.abs(s))}var $s=Ms;var Ws=gs;var Xs=ps;var Ys=ms;var qs=Ss;var Ks=Is;var Zs=Cs;var Qs=function(){var l=e();return function(e,t,i,n,r,s){var a,o;if(!t){t=2}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];r(l,l,s);e[a]=l[0];e[a+1]=l[1]}return e}}();class c{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new u.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let n="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)n="float";else if(i==2)n="vec2";else if(i==3)n="vec3";else if(i==4)n="vec4";const r={name:e,data:t,itemSize:i,type:n};this._attributes[e]=r}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,n){let r=D();if(t==undefined)t=1;if(i==undefined)i=1;if(n==undefined)n=1;for(let e=0;e<this.vertexNormals.length;e+=3){k(r,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);r[0]*=-t;r[1]*=-i;r[2]*=-n;U(r,r);this.vertexNormals[e+0]=r[0];this.vertexNormals[e+1]=r[1];this.vertexNormals[e+2]=r[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const n=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+n;this.vertices=T.utils.float32Concat(this._vertices,t.vertices);this.texCoords=T.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=T.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=T.utils.float32Concat(this.tangents,t.tangents);this.biTangents=T.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new c(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=D();const n=D();const r=D();function s(e){B(i,e[0],e[1]);B(n,e[0],e[2]);j(r,i,n);U(r,r);if(t&&t.forceZUp){if(r[2]<0){r[0]*=-1;r[1]*=-1;r[2]*=-1}}return r}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const h=[];h.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];h[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=h[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const u=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];U(u,u);this.vertexNormals[this.verticesIndices[t+e]*3+0]=u[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=u[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=u[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const x=this.vertices.length/3*2;this.texCoords=new Float32Array(x);for(let e=0;e<x;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const n=[];n.length=i*2;const r=D();const s=D();const a=D();const o=e();const l=e();const h=e();const u=D();const c=D();for(let e=0;e<t;e+=1){const E=this.verticesIndices[e*3];const T=this.verticesIndices[e*3+1];const A=this.verticesIndices[e*3+2];k(r,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);k(s,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);k(a,this.vertices[A*3],this.vertices[A*3+1],this.vertices[A*3+2]);H(o,this.texCoords[E*2],this.texCoords[E*2+1]);H(l,this.texCoords[T*2],this.texCoords[T*2+1]);H(h,this.texCoords[A*2],this.texCoords[A*2+1]);const S=s[0]-r[0];const I=a[0]-r[0];const M=s[1]-r[1];const C=a[1]-r[1];const R=s[2]-r[2];const O=a[2]-r[2];const y=l[0]-o[0];const N=h[0]-o[0];const w=l[1]-o[1];const L=h[1]-o[1];const P=1/(y*L-N*w);k(u,(L*S-w*I)*P,(L*M-w*C)*P,(L*R-w*O)*P);k(c,(y*I-N*S)*P,(y*C-N*M)*P,(y*O-N*R)*P);n[E]=u;n[T]=u;n[A]=u;n[E+i]=c;n[T+i]=c;n[A+i]=c}const f=D();const d=D();const g=D();const p=D();const m=D();const _=D();const b=D();const v=D();for(let e=0;e<i;e+=1){if(!n[e])continue;k(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);k(d,n[e][0],n[e][1],n[e][2]);const F=G(f,d);Ii(m,f,F);B(_,d,m);U(v,_);j(b,f,d);const V=1;Ii(g,v,1/V);j(p,f,g);this.tangents[e*3+0]=g[0];this.tangents[e*3+1]=g[1];this.tangents[e*3+2]=g[2];this.biTangents[e*3+0]=p[0];this.biTangents[e*3+1]=p[1];this.biTangents[e*3+2]=p[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const n=[];let r=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);n.push(r);r++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=n;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new i(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let n=0;const r=this.getBounds();const s=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(n=0;n<this.vertices.length;n+=3){if(this.vertices[n+0]==this.vertices[n+0]){if(e)this.vertices[n+0]-=s[0];if(t)this.vertices[n+1]-=s[1];if(i)this.vertices[n+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const n=this.vertices[e*3+0];const r=this.vertices[e*3+1];this.texCoords[e*2+0]=n/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-r/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}c.buildFromFaces=function(t,e,i){const n=[];const r=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const h=[-1,-1,-1];if(i)for(let e=0;e<n.length;e+=3){if(n[e+0]==a[0]&&n[e+1]==a[1]&&n[e+2]==a[2])h[0]=e/3;if(n[e+0]==o[0]&&n[e+1]==o[1]&&n[e+2]==o[2])h[1]=e/3;if(n[e+0]==l[0]&&n[e+1]==l[1]&&n[e+2]==l[2])h[2]=e/3}if(h[0]==-1){n.push(a[0],a[1],a[2]);h[0]=(n.length-1)/3}if(h[1]==-1){n.push(o[0],o[1],o[2]);h[1]=(n.length-1)/3}if(h[2]==-1){n.push(l[0],l[1],l[2]);h[2]=(n.length-1)/3}r.push(h[0]);r.push(h[1]);r.push(h[2])}const s=new c(e);s.name=e;s.vertices=n;s.verticesIndices=r;return s};class i{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof i){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new i(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!T.utils.isNumeric(e)||!T.utils.isNumeric(t)||!T.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}Vi(this._max,this._max,e);Vi(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();r(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class Js{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new u.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(e,t,i=false){if(this._oldWidthRp!=e*this.pixelDensity||this._oldHeightRp!=t*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=e*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=t*this.pixelDensity;if(!i){this.canvasEle.style.width=e+"px";this.canvasEle.style.height=t+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class ea extends u.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,T.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,T.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,T.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,T.now)()}}class a{constructor(){this._arr=[n()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const e=n();this._arr.push(e)}Mt(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class ta{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const n={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(n);this._cgl.emitEvent("heavyEvent",n)}}class ia extends u.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";#patch=null;gApi=0;_textureslots=[];_pMatrixStack=new a;_mMatrixStack=new a;_vMatrixStack=new a;canvasScale=1;constructor(e){super();this._log=new u.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new ea;this._identView=D();this._ident=D();k(this._identView,0,0,-2);k(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new ta(this);this.pMatrix=n();this.mMatrix=n();this.vMatrix=n();A(this.mMatrix);A(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new Js({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;Jt(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);A(this.mMatrix);A(this.vMatrix);r(this.mMatrix,this.mMatrix,e);r(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,n){console.log("no screenshot function implemented")}saveScreenshot(i,n,e,t,r){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const h="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+h+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(n)n(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}class na extends u.Events{id=T.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=T.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=T.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=T.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}class ra{constructor(e,t,i,n,r,s,a,o,l,h){this._log=new u.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=h;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof n=="object"&&n instanceof T.Port){this._port=n;this._value=this._port.get();if(r&&s&&a){if(!(r instanceof T.Port)||!(s instanceof T.Port)||!(a instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=r;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(r&&s){if(!(r instanceof T.Port)||!(s instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=r;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(r){if(!(r instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=r;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=n;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class sa{_name="unknown";constructor(){}}const aa=8;class d{constructor(e={}){this.id=T.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||d.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=aa;if(!e.height)e.height=aa}}d.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const r=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let n=a.b||1;for(let e=0;e<s*s;e++){r[e*4+0]=t;r[e*4+1]=i;r[e*4+2]=n;r[e*4+3]=255}return r}else if(e=="randomUInt"){const r=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=Math.random()*255;r[e*4+1]=Math.random()*255;r[e*4+2]=Math.random()*255;r[e*4+3]=255}return r}else if(e=="random"||e=="randomFloat"){const r=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=(Math.random()-.5)*2;r[e*4+1]=(Math.random()-.5)*2;r[e*4+2]=(Math.random()-.5)*2;r[e*4+3]=1}return r}else if(e=="stripes"){const o=[];let i=a.r;let n=a.g;let r=a.b;if(i===undefined)i=1;if(n===undefined)n=1;if(r===undefined)r=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*n);o.push((200+t/s*25+e/s*25)*r)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*n);o.push((40+t/s*25+e/s*25)*r)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return d.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};d.FILTER_NEAREST=0;d.FILTER_LINEAR=1;d.FILTER_MIPMAP=2;d.WRAP_REPEAT=0;d.WRAP_MIRRORED_REPEAT=1;d.WRAP_CLAMP_TO_EDGE=2;d.TYPE_DEFAULT=0;d.TYPE_DEPTH=1;d.TYPE_FLOAT=2;d.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";d.PFORMATSTR_R8UB="R 8bit ubyte";d.PFORMATSTR_RG8UB="RG 8bit ubyte";d.PFORMATSTR_RGB8UB="RGB 8bit ubyte";d.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";d.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";d.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";d.PFORMATSTR_R16F="R 16bit float";d.PFORMATSTR_RG16F="RG 16bit float";d.PFORMATSTR_RGB16F="RGB 16bit float";d.PFORMATSTR_RGBA16F="RGBA 16bit float";d.PFORMATSTR_R32F="R 32bit float";d.PFORMATSTR_RG32F="RG 32bit float";d.PFORMATSTR_RGB32F="RGB 32bit float";d.PFORMATSTR_RGBA32F="RGBA 32bit float";d.PFORMATSTR_DEPTH="DEPTH";d.PIXELFORMATS=[d.PFORMATSTR_RGB565,d.PFORMATSTR_R8UB,d.PFORMATSTR_RG8UB,d.PFORMATSTR_RGB8UB,d.PFORMATSTR_RGBA8UB,d.PFORMATSTR_SRGBA8,d.PFORMATSTR_R11FG11FB10F,d.PFORMATSTR_R16F,d.PFORMATSTR_RG16F,d.PFORMATSTR_RGBA16F,d.PFORMATSTR_R32F,d.PFORMATSTR_RGBA32F];const oa={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const la={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const ha=180/Math.PI;const ua=Math.PI/180;const g={MATH:{DEG2RAD:ua,RAD2DEG:ha},SHADER:oa,BLEND_MODES:la};const S="\n";const ca={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:c,BoundingBox:i,FpsCounter:ea,CgCanvas:Js};window.CABLES=window.CABLES||{};window.CABLES.CG={...window.CABLES.CG,...ca};window.CG={...window.CG,...ca};window.glMatrix=R;window.mat2=O;window.mat2d=y;window.mat3=N;window.mat4=w;window.quat=V;window.quat2=z;window.vec2=$;window.vec3=L;window.vec4=F;class p extends ra{constructor(e,t,i,n,r,s,a,o,l,h){super(e,t,i,n,r,s,a,o,l,h);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new p(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return p.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}p.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const I={};I.lastMesh=null;class m extends sa{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let n=i||{};if(T.utils.isNumeric(n))n={glPrimitive:i};this._log=new u.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=n.glPrimitive||null;this.opId=n.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,n,r){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:n,offset:r,instanced:t==g.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,n){if(!e)return;if(!i&&!n)return;if(!e.name)this._log.stack("no attrname?!");const r=this.#cgl.gl;r.bindBuffer(r.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=n-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=n-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(n>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+"'"+e.name+"' buffersubdata out of bounds ?",t.length,n,i,e);return}r.bufferSubData(r.ARRAY_BUFFER,i*4,t,i,n-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,n){this.setAttribute(e,t,i,n)}setAttribute(e,t,i,n={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof n=="function"){r=n}if(typeof n=="object"){if(n.cb)r=n.cb;if(n.instanced)s=n.instanced}if(e==g.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const u=this._attributes[a];if(u.name==e){if(u.numItems===o){}else{this._resizeAttr(t,u)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,u.buffer);this._bufferArray(t,u);return u}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let h=this.#cgl.gl.FLOAT;if(n&&n.type)h=n.type;const u={buffer:l,name:e,cb:r,itemSize:i,numItems:o,startItem:0,instanced:s,type:h};this._bufferArray(t,u);if(e==g.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=u;this._attributes.push(u);this._attribLocs={};return u}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new p(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;I.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const n={texCoords:g.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:g.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:g.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const r in i)if(i[r].data&&i[r].data.length)this.setAttribute(n[r]||r,i[r].data,i[r].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(i[e]==-1){if(n._attrLocationLastShaderTime!=t.lastCompile){n._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,n.buffer);if(n.instanced){if(n.itemSize<=4){if(!n.itemSize||n.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(n.itemSize==16){const r=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,n.type,false,r,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,n.type,false,r,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,n.type,false,r,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,n.type,false,r,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",n.name)}}else{if(!n.itemSize||n.itemSize==0)this._log.warn("attrib itemsize error",this._name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);if(n.pointer){for(let e=0;e<n.pointer.length;e++){const s=n.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,n.itemSize,n.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(n)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;I.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(I.lastMesh!=this){if(I.lastMesh)I.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();I.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==null)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let n=1;let r=this.#cgl.profileData.doProfileGlQuery;let s=false;if(r){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const h=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const u=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",u)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/n*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(r&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(g.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const b={};b.getSimpleRect=function(e,t,i=1){const n=new c(t);n.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];n.texCoords=[1,1,0,1,1,0,0,0];n.verticesIndices=[0,1,2,2,1,3];n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(n)};b.getSimpleCube=function(e,t){const i=new c(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new m(e,i)};class v{constructor(e,t){this._cgl=e;this._log=new u.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new E(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==E.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=b.getSimpleRect(this._cgl,"texEffectRect")}}v.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};v.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};v.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};v.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};v.AddBlendSelect=function(e,t,i){const n=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return n};v.AddBlendAlphaMask=function(e,t,i){const n=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return n};v.setupBlending=function(i,n,r,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";v.onChangeBlendSelect(n,r.get(),e);let t=r.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[r,e,s]);let a=false;r.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}v.onChangeBlendSelect(n,r.get(),a)};const fa={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=v.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=v.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new p(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){E.getRandomTexture(e);e.setTexture(7,E.getRandomTexture(e).tex)}}};const da="{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n";let ga=0;function M(){return da}function C(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+S+"IN vec2 texCoord;"+S+"{{MODULES_HEAD}}"+S+"void main()"+S+"{"+S+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+S+"    {{MODULE_COLOR}}"+S+"    outColor = col;"+S+"}"}class x extends na{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new u.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++ga;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=M();this.srcFrag=C();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=n();this._tempCamPosMatrix=n();this._tempInverseViewMatrix=n();this._tempInverseProjMatrix=n();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new x(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in fa){if(e.includes(t)){const i=new fa[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let n="";let r="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+S+s+"};"+S+S;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")n=n.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")r=r.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);const l=r.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=r.lastIndexOf(s);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+S;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+S;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsVert.push(i)}}return[r,n]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+S;i.srcHeadVert+="#define ATTRIB_"+e.name+S;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+S;if(!t)i.srcHeadVert+="#endif"+S;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+S;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+S;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+S;if(!t)i.srcHeadVert+="#endif"+S;i.srcVert=""+S+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+S;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+S;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+S;if(!t)i.srcHeadFrag+="#endif"+S}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+S;let i="";if(this._defines.length)i="\n// cgl generated"+S;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+S;const n=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const m=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=m.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+S;let r="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=M();this.srcFrag=C()}r="#version 300 es"+S+"// "+S+"// vertex shader "+this._name+S+"// "+S+"precision "+this.precision+" float;"+S+"precision "+this.precision+" sampler2D;"+S+""+S+"#define WEBGL2"+S+"#define texture2D texture"+S+"#define UNI uniform"+S+"#define IN in"+S+"#define OUT out"+S;s="#version 300 es"+S+"// "+S+"// fragment shader "+this._name+S+"// "+S+"precision "+this.precision+" float;"+S+"precision "+this.precision+" sampler2D;"+S+""+S+"#define WEBGL2"+S+"#define texture2D texture"+S+"#define IN in"+S+"#define OUT out"+S+"#define UNI uniform"+S+"{{DRAWBUFFER}}"+S;let a="\n// cgl generated"+S;let o="\n// cgl generated"+S;s+="\n// active mods: --------------- ";r+="\n// active mods: --------------- ";let l=false;let h=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";h=true}}}}if(!h)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";r+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+S;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+S}}let u=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")u++}}if(u>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+u+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+S+s;if(!r.includes("precision"))r="precision "+this.precision+" float;"+S+r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+S;r+="#define MOBILE"+S}r=t+r+i+n[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+n[1]+o+"\n// -- \n"+this.srcFrag;let f="";let d="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let g=false;for(let n=0;n<this._moduleNames.length;n++){let t="";let i="";if(!g){g=true;for(let e=0;e<this._attributes.length;e++){const x=this._getAttrSrc(this._attributes[e],true);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)d+=x.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const E=this._modules[e];if(E.name==this._moduleNames[n]){f+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";d+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";t+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";i+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";if(E.attributes)for(let e=0;e<E.attributes.length;e++){const x=this._getAttrSrc(E.attributes[e],false);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)d+=x.srcHeadFrag}f+=E.srcHeadVert||"";d+=E.srcHeadFrag||"";t+=E.srcBodyVert||"";i+=E.srcBodyFrag||"";f+="\n//---- end mod ------\n";d+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,E.prefix);i=i.replace(/{{mod}}/g,E.prefix);f=f.replace(/{{mod}}/g,E.prefix);d=d.replace(/{{mod}}/g,E.prefix);t=t.replace(/MOD_/g,E.prefix);i=i.replace(/MOD_/g,E.prefix);f=f.replace(/MOD_/g,E.prefix);d=d.replace(/MOD_/g,E.prefix)}}r=r.replace("{{"+this._moduleNames[n]+"}}",t);s=s.replace("{{"+this._moduleNames[n]+"}}",i)}r=r.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",d);r=this._addLibs(r);s=this._addLibs(s);let p="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){p="out vec4 outColor;"+S;p+="#define gl_FragColor outColor"+S}else{p+="#define MULTI_COLORTARGETS"+S;p+="vec4 outColor;"+S;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)p+="#define gl_FragColor outColor"+e+""+S;p+="layout(location = "+e+") out vec4 outColor"+e+";"+S;t++}}s=s.replace("{{DRAWBUFFER}}",p);if(!this._program){this._program=this._createProgram(r,s)}else{this._program=this._createProgram(r,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=r;I.lastMesh=null;I.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,T.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;I.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,g.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){t(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){t(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){t(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=n();fi(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){t(this._tempNormalMatrix,this._cgl.mMatrix);Ot(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="frag";return a}addUniformVert(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="both";return a}addUniformStructFrag(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";r[i+"."+s.name]=a}}return r}addUniformStructVert(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";r[i+"."+s.name]=a}}return r}addUniformStructBoth(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";r[i+"."+s.name]=a}}return r}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=x.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=x.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const n=this._cgl.gl.getShaderInfoLog(this.fshader);const r=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||E.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const n=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return n}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,n){return C(e,t,i,n)}getDefaultVertexShader(){return M()}}x.getDefaultVertexShader=M;x.getDefaultFragmentShader=C;x.getErrorFragmentShader=function(){return""+S+"void main()"+S+"{"+S+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+S+"   g= step(0.1,g);"+S+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+S+"}"};x.createShader=function(e,t,i,n){if(e.aborted)return;const r=e.gl.createShader(i);e.gl.shaderSource(r,t);e.gl.compileShader(r);if(!e.gl.getShaderParameter(r,e.gl.COMPILE_STATUS)){n.error={str:t,infoLog:e.gl.getShaderInfoLog(r)};if(CABLES.UI)gui.emitEvent("ShaderError",n);if(!n.error.infoLog){n._log.warn("empty shader info log",this._name);return}n.setSource(x.getDefaultVertexShader(),x.getErrorFragmentShader())}return r};class pa extends T.RenderLoop{#patch;#cgl;#renderOneFrame;#animReq;frameNum=0;onOneFrameRendered=null;_frameNext=0;_frameInterval=0;_lastFrameTime=0;reqAnimTimeStamp=0;_frameWasdelayed=true;aborted=false;constructor(e,t){super();this.#cgl=e;this.#patch=t;this.#patch.renderloop=this;this.exec(0)}exec(e){cancelAnimationFrame(this.#animReq);this.#patch.config.fpsLimit=this.#patch.config.fpsLimit||0;if(this.#patch.config.fpsLimit){this._frameInterval=1e3/this.#patch.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.#patch.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.#patch.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(T.Patch.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.#patch.config.doRequestAnimation){this.#animReq=this.#patch.getDocument().defaultView.requestAnimationFrame(this.exec.bind(this))}}renderFrame(e){const t=this.#patch.timer.getTime();const i=performance.now();this.#cgl.frameStartTime=this.#patch.timer.getTime();const n=e-this.reqAnimTimeStamp||e;this.#patch.updateAnims(null,n,e);this.#cgl.profileData.profileFrameDelta=n;this.reqAnimTimeStamp=e;this.#cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.#patch.emitEvent(T.Patch.EVENT_RENDER_FRAME,t);this.frameNum++;if(this.frameNum==1){if(this.#patch.config.onFirstFrameRendered)this.#patch.config.onFirstFrameRendered()}}pause(){cancelAnimationFrame(this.#animReq);this.#animReq=null;this.paused=true}resume(){cancelAnimationFrame(this.#animReq);this.paused=false;this.exec(0)}}const ma={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class _a extends ia{#cursor="auto";frameStartTime=0;constructor(e){super(e);this.gApi=ia.API_WEBGL;this.aborted=false;e.cgl=this;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new u.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new x(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(x.getDefaultVertexShader(),x.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null;this.setCanvas(e.config.glCanvasId||e.config.glCanvas||"glcanvas");if(e.config.glCanvasResizeToWindow===true)this.setAutoResize("window");if(e.config.glCanvasResizeToParent===true)this.setAutoResize("parent");if(this.aborted)e.aborted=true;e.on(T.Patch.EVENT_DISPOSE,()=>{this.dispose()});e.on("patchClearStart",()=>{this.TextureEffectMesh=null});this.renderLoop=new pa(this,e)}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push(e,t,i,n);this.setViewPort(e,t,i,n)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,n){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(n);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,n){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(ia.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(g.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e,t=true){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();if(t)e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;T.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=E.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let n=this.gl.getError();if(n!=this.gl.NO_ERROR){let e="";if(n==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(n==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(n==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(n==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(n==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(n==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(n==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,n,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}n=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==g.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==g.BLEND_MODES.BLEND_NONE){}else if(e==g.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==g.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(T.utils.isNumeric(t))t={glPrimitive:t};return new m(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new x(this,"errormaterial");this.errorShader.setSource(x.getDefaultVertexShader(),x.getErrorFragmentShader());return this.errorShader}}const ba=8;const va=new u.Logger("cgl_texture");class E extends d{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new u.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=E.FILTER_NEAREST;this.wrap=E.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=E.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=E.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=E.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=E.PFORMATSTR_RGBA32F;if(this.textureType==E.TYPE_DEPTH)this.pixelFormat=E.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return E.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new E(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=ba;if(t!=t||t<=0||!t)t=ba;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,n,r){this.filter=n;this.wrap=r;if(n==undefined)this.filter=E.FILTER_LINEAR;if(r==undefined)this.wrap=E.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==E.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return E.isPowerOfTwo(this.width)&&E.isPowerOfTwo(this.height)}printInfo(){va.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===E.FILTER_NEAREST)e+=" nearest";if(this.filter===E.FILTER_LINEAR)e+=" linear";if(this.filter===E.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===E.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===E.WRAP_REPEAT)e+=" repeat";if(this.wrap===E.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return E.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==E.TYPE_FLOAT&&this.filter==E.FILTER_MIPMAP){this.filter=E.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=E.FILTER_NEAREST;this.wrap=E.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==E.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==E.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==E.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==E.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==E.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==E.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}E.load=function(i,n,r,e){if(!n)return r({error:true});let s=null;if(!i.patch.loading.existByName(n))s=i.patch.loading.start("cgl.texture",n);const a=new E(i);a.name=n;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(r)r(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(r)r(null,a)})};a.image.src=n;return a};E.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=E.getTemporaryTexture(e,256,E.FILTER_LINEAR,E.REPEAT);return e.tempTexture};E.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=E.getTemporaryTexture(e,256,E.FILTER_LINEAR,E.REPEAT,1,.2,.2);return e.errorTexture};E.getEmptyTexture=function(e,t){if(t)return E.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new E(e,{name:"emptyTexture"});const n=E.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(n,i,i,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.tempTextureEmpty};E.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new E(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.tempTextureEmptyFloat};E.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=E.getDefaultTextureData("randomUInt",t);e.randomTexture=new E(e);e.randomTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.randomTexture};E.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=E.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new E(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.getRandomFloatTexture};E.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=E.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new E(e);e.blackTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.blackTexture};E.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const n=t.gl.TEXTURE_CUBE_MAP;const r=E.FILTER_NEAREST;const s=E.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(n,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(n,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(n,null);return{id:T.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:r,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};E.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return E.getTempTexture(e)};E.getTemporaryTexture=function(e,t,i,n,r,s,a){const o=E.getDefaultTextureData("stripes",256,{r:r,g:s,b:a});const l=new E(e);l.initFromData(o,t,t,i,n);return l};E.createFromImage=function(e,t,i){i=i||{};const n=new E(e,i);n.flip=false;n.image=t;n.width=t.videoWidth||t.width||8;n.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))n.wrap=i.wrap;n.initTexture(t,i.filter);return n};E.fromImage=function(e,t,i,n){console.error("deprecated texture from image...");const r=new E(e);r.flip=false;if(i)r.filter=i;if(n)r.wrap=n;r.image=t;r.initTexture(t);return r};E.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};E.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==E.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==E.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==E.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==E.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==E.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==E.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==E.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==E.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==E.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==E.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};E.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=E.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let n=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==E.PFORMATSTR_RGBA32F)t=E.PFORMATSTR_RGBA16F;if(t==E.PFORMATSTR_RG32F)t=E.PFORMATSTR_RG16F;if(t==E.PFORMATSTR_R32F)t=E.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const r=e.enableExtension("EXT_color_buffer_half_float");if(!r){console.warn("no 16bit extension, fallback to 32bit",t);if(t==E.PFORMATSTR_RGBA16F)t=E.PFORMATSTR_RGBA32F;if(t==E.PFORMATSTR_RGB16F)t=E.PFORMATSTR_RGB32F;if(t==E.PFORMATSTR_RG16F)t=E.PFORMATSTR_RG32F;if(t==E.PFORMATSTR_R16F)t=E.PFORMATSTR_R32F}else{n=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==E.PFORMATSTR_RGBA16F||t==E.PFORMATSTR_RG16F||t==E.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");n=s.HALF_FLOAT_OES}}if(t==E.PFORMATSTR_RGBA8UB){}else if(t==E.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==E.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==E.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==E.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=n}else if(t==E.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=n;i.glDataFormat=e.gl.RED}else if(t==E.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=n;i.glDataFormat=e.gl.RG}else if(t==E.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=n}else if(t==E.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=n;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=n}else if(t==E.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{va.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==E.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=E.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)va.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};E.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};E.isPixelFormatFloat=e=>{return(e||"").includes("float")};E.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};T.Op.prototype.outTexture=function(e,t){const i=this.addOutPort(new T.Port(this,e,T.Port.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||E.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i};class xa{constructor(t,e,i,n){this._log=new u.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=n||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=E.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=E.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!n.pixelFormat){if(n.isFloatingPointTexture)this._options.pixelFormat=E.PFORMATSTR_RGBA32F;else this._options.pixelFormat=E.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new E(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let r=E.FILTER_NEAREST;if(this._options.shadowMap)r=E.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new E(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:r,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const n=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=E.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=E.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=E.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)r=this._cgl.gl.DEPTH_COMPONENT16;if(n){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==E.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const Ea=function(e){this.draw=function(e,t,i){}};const Ta=function(e){this.render=function(e,t){}};const Aa=function(e){this.render=function(e,t,i,n){}};class Sa{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,n){this.coloruni.set(e,t,i,n)}}const Ia=Math.PI/180;const Ma=180/Math.PI;const Ca=null;const Ra=window.navigator.userAgent.includes("Windows");const Oa=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(Ra)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const n=e||t.detail;i=-(n%3?n*10:n/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const ya=Oa;const Na=Oa;const wa={Framebuffer2:xa,Geometry:c,BoundingBox:i,Marker:Ea,WirePoint:Ta,WireCube:Aa,MatrixStack:a,Mesh:m,MESH:I,ShaderLibMods:fa,Shader:x,Uniform:p,MESHES:b,getWheelSpeed:ya,getWheelDelta:Na,Context:_a,Texture:E,TextureEffect:v,onLoadingAssetsFinished:Ca,ProfileData:ta,UniColorShader:Sa,...g.BLEND_MODES,...g.SHADER,...g.MATH,...g.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL={...window.CABLES.CGL,...wa};window.CGL={...window.CGL,...wa};window.cgInitialized=false;window.addEventListener("INIT_CG",e=>{if(window.cgInitialized&&!CABLES.UI)return;window.cgInitialized=true;const t=new _a(e.detail)});T.Anim.slerpQuaternion=function(e,t,i,n,r,s){if(!T.Anim.slerpQuaternion.q1){T.Anim.slerpQuaternion.q1=quat.create();T.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const h=i.keys[o].time;const u=(e-l)/(h-l);quat.set(T.Anim.slerpQuaternion.q1,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value);quat.set(T.Anim.slerpQuaternion.q2,i.keys[o].value,n.keys[o].value,r.keys[o].value,s.keys[o].value);quat.slerp(t,T.Anim.slerpQuaternion.q1,T.Anim.slerpQuaternion.q2,u)}return t}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in Pa)e[t]=Pa[t];if(Pa.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{VarGetOpWrapper:()=>t,VarSetOpWrapper:()=>e});const a=CABLES;class e{constructor(t,e,i,n,r,s){this._valuePort=i;this._varNamePort=n;this._op=t;this._type=e;this._typeId=-1;this._triggerPort=r;this._nextPort=s;this._var=null;this._btnCreate=t.inTriggerButton("Create new variable");this._btnCreate.setUiAttribs({hidePort:true});this._btnCreate.onTriggered=this._createVar.bind(this);this._helper=t.inUiTriggerButtons("",["Rename"]);this._helper.setUiAttribs({hidePort:true});this._helper.onTriggered=e=>{CABLES.CMD.PATCH.renameVariable(t.varName.get())};this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]);n.setUiAttribs({_variableSelect:true});this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this));this._op.patch.addEventListener("variableRename",this._renameVar.bind(this));this._varNamePort.onChange=this._updateName.bind(this);this._isTexture=this._valuePort.uiAttribs.objType==="texture";this._valuePort.changeAlways=true;if(this._triggerPort){this._triggerPort.onTriggered=()=>{this._setVarValue(true)}}else{this._valuePort.onChange=this._setVarValue.bind(this)}this._op.init=()=>{this._updateName();if(!this._triggerPort)this._setVarValue();this._updateErrorUi()};if(e=="array")this._typeId=a.Port.TYPE_ARRAY;else if(e=="object")this._typeId=a.Port.TYPE_OBJECT;else if(e=="string")this._typeId=a.Port.TYPE_STRING;else if(e=="texture")this._typeId=a.Port.TYPE_TEXTURE;else this._typeId=a.Port.TYPE_VALUE}_updateErrorUi(){if(CABLES.UI){if(!this._varNamePort.get())this._op.setUiError("novarname","no variable selected");else{if(this._op.hasUiErrors)this._op.setUiError("novarname",null)}}}_updateName(){this._var=null;const e=this._varNamePort.get();this._op.setTitle("var set");this._op.setUiAttrib({extendTitle:"#"+e});this._updateErrorUi();const t=this._op.patch.getVar(e);if(t&&!t.type)t.type=this._type;if(!this._op.patch.hasVar(e)&&e!=0&&!this._triggerPort){this._setVarValue()}if(!this._op.patch.hasVar(e)&&e!=0&&this._triggerPort){if(this._type=="string")this._op.patch.setVarValue(e,"");else if(this._type=="number")this._op.patch.setVarValue(e,"");else this._op.patch.setVarValue(e,null)}if(this._op.isCurrentUiOp()){this._updateVarNamesDropdown();this._op.refreshParams()}this._updateDisplay();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded&&CABLES.UI.loaded){const e=gui.uiProfiler.start("[vars] _updateVarNamesDropdown");const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._varNamePort.uiAttribs.values=t;e.finish()}}_renameVar(e,t){if(e!=this._varNamePort.get())return;this._varNamePort.set(t);this._updateName()}_setVarValue(e){let t=this._valuePort.get();if(!this._var){const i=this._varNamePort.get();if(!i)return;if(this._typeId==a.Port.TYPE_VALUE&&typeof t=="string")t=parseFloat(t);this._op.patch.setVarValue(i,t,this._type);this._var=this._op.patch.getVar(i)}if(this._typeId==a.Port.TYPE_VALUE||this._typeId==a.Port.TYPE_STRING){this._var.setValue(t)}else if(this._typeId==a.Port.TYPE_ARRAY){this._arr=[];a.utils.copyArray(t,this._arr);this._var.setValue(this._arr)}else{if(this._typeId==a.Port.TYPE_OBJECT){if(this._isTexture)this._var.setValue(CGL.Texture.getEmptyTexture(this._op.patch.cgl));else this._var.setValue(null);if(t&&t.tex&&t._cgl&&!this._isTexture)this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture");else this._op.setUiError("texobj",null)}this._var.setValue(t)}if(e&&this._nextPort)this._nextPort.trigger()}}class t{constructor(e,t,i,n){this._op=e;this._type=t;this._varnamePort=i;this._variable=null;this._valueOutPort=n;this._listenerId=null;this._typeId=0;if(t=="array")this._typeId=a.Port.TYPE_ARRAY;else if(t=="object")this._typeId=a.Port.TYPE_OBJECT;else if(t=="texture")this._typeId=a.Port.TYPE_TEXTURE;else if(t=="string")this._typeId=a.Port.TYPE_STRING;else this._typeId=a.Port.TYPE_VALUE;if(n)this._isTexture=n.uiAttribs.objType==="texture";this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.on("uiErrorChange",this._updateTitle.bind(this));this._op.patch.on("variableRename",this._renameVar.bind(this));this._op.patch.on("variableDeleted",e=>{if(this._op.isCurrentUiOp())this._op.refreshParams()});i.setUiAttribs({_variableSelect:true});i.setUiAttribs({_variableSelectGet:true});this._varnamePort.onChange=this._changeVar.bind(this);this._op.patch.addEventListener("variablesChanged",this._init.bind(this));this._op.onDelete=()=>{if(this._variable&&this._listenerId)this._variable.off(this._listenerId)};this._op.init=()=>{this._init()}}get variable(){return this._variable}_changeVar(){if(this._variable&&this._listenerId){this._variable.off(this._listenerId)}this._init()}_renameVar(e,t){if(e!=this._varnamePort.get())return;this._varnamePort.set(t);this._updateVarNamesDropdown();this._updateTitle();this._listenerId=this._variable.on("change",this._setValueOut.bind(this))}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded){const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._op.varName.uiAttribs.values=t}}_setValueOut(e){if(this._valueOutPort)if(this._typeId==a.Port.TYPE_NUMBER||this._typeId==a.Port.TYPE_STRING)this._valueOutPort.set(e);else if(this._typeId==a.Port.TYPE_ARRAY||this._typeId==a.Port.TYPE_OBJECT||this._isTexture)this._valueOutPort.setRef(e);else console.log("unkown type?")}_updateTitle(){if(this._variable){this._op.setUiError("unknownvar",null);this._op.setTitle("var get");this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()});if(this._valueOutPort)this._setValueOut(this._variable.getValue())}else{this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")");this._op.setUiAttrib({extendTitle:"#invalid"});if(this._valueOutPort)this._setValueOut(0)}}_init(){this._updateVarNamesDropdown();if(this._variable&&this._listenerId)this._variable.off(this._listenerId);this._variable=this._op.patch.getVar(this._op.varName.get());if(this._variable)this._listenerId=this._variable.on("change",this._setValueOut.bind(this));this._updateTitle();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{PixelReader:()=>t});const e=CABLES.SHARED;class t{constructor(){this._log=new e.Logger("LoadingStatus");this.pixelData=null;this._finishedFence=true;this._size=0;this._pbo=null}_fence(s){const a=s.gl;this._finishedFence=false;return new Promise(function(t,i){if(s.aborted)return;let n=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);if(!n)return;a.flush();function r(){if(s.aborted)return;const e=a.clientWaitSync(n,0,0);if(e==a.WAIT_FAILED){console.error("fence wait failed");if(i)i()}else if(e==a.TIMEOUT_EXPIRED){return setTimeout(r,0)}else if(e==a.CONDITION_SATISFIED){t();a.deleteSync(n)}else if(e==a.ALREADY_SIGNALED){t();a.deleteSync(n)}else{this._log.log("unknown fence status",e)}}r()})}read(i,n,e,r,s,a,o,t){if(CABLES.UI)if(!CABLES.UI.loaded||performance.now()-CABLES.UI.loadedTime<1e3)return;if(!this._finishedFence)return;const l=i.gl;let h=1;if(i.aborted)return;if(!n)return;if(e===CGL.Texture.TYPE_FLOAT)e=CGL.Texture.PFORMATSTR_RGBA32F;let u=CGL.Texture.isPixelFormatFloat(e);if(u)h=4;if(CGL.Texture.isPixelFormatHalfFloat(e))h=2;const c=CGL.Texture.setUpGlPixelFormat(i,e);const f=c.numColorChannels*a*o;if(a==0||o==0||f==0)return;if(!this._pixelData||this._size!=f*h){if(h>1)this._pixelData=new Float32Array(f);else this._pixelData=new Uint8Array(f);this._size=f*h}let d=l.UNSIGNED_BYTE;if(h>1)d=l.FLOAT;if(this._size==0||!this._pixelData){this._log.error("readpixel size 0",this._size,a,o);return}if(this._finishedFence){this._pbo=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.bufferData(l.PIXEL_PACK_BUFFER,this._pixelData.byteLength,l.DYNAMIC_READ);l.bindFramebuffer(l.FRAMEBUFFER,n);l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);i.profileData.profileFencedPixelRead++;if(this._size!=f*h)this._log.error("buffer size invalid",f,a,o,h);let e=c.glDataType;if(h>1)e=i.gl.FLOAT;let t=c.glDataFormat;l.readPixels(r,s,a,o,t,e,0);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null)}let g=this._pixelData.byteLength;if(this._finishedFence&&this._pbo)this._fence(i).then(e=>{this._wasTriggered=false;this._finishedFence=true;if(!e&&this._pixelData&&this._pixelData.byteLength==g){l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._pixelData);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);if(t)t(this._pixelData)}l.deleteBuffer(this._pbo);this._pbo=null});return true}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var Pa={};(()=>{Pa.d=(e,t)=>{for(var i in t){if(Pa.o(t,i)&&!Pa.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{Pa.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{Pa.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var Fa={};(()=>{"use strict";Pa.r(Fa);Pa.d(Fa,{CopyTexture:()=>La});var R={};Pa.r(R);Pa.d(R,{ARRAY_TYPE:()=>_,EPSILON:()=>P,RANDOM:()=>h,equals:()=>q,setMatrixArrayType:()=>W,toRadian:()=>Y});var O={};Pa.r(O);Pa.d(O,{LDU:()=>de,add:()=>ge,adjoint:()=>re,clone:()=>Z,copy:()=>Q,create:()=>K,determinant:()=>se,equals:()=>_e,exactEquals:()=>me,frob:()=>fe,fromRotation:()=>he,fromScaling:()=>ue,fromValues:()=>ee,identity:()=>J,invert:()=>ne,mul:()=>xe,multiply:()=>ae,multiplyScalar:()=>be,multiplyScalarAndAdd:()=>ve,rotate:()=>oe,scale:()=>le,set:()=>te,str:()=>ce,sub:()=>Ee,subtract:()=>pe,transpose:()=>ie});var y={};Pa.r(y);Pa.d(y,{add:()=>Be,clone:()=>Ae,copy:()=>Se,create:()=>Te,determinant:()=>Oe,equals:()=>ze,exactEquals:()=>He,frob:()=>ke,fromRotation:()=>Pe,fromScaling:()=>Fe,fromTranslation:()=>Ve,fromValues:()=>Me,identity:()=>Ie,invert:()=>Re,mul:()=>$e,multiply:()=>ye,multiplyScalar:()=>Ge,multiplyScalarAndAdd:()=>je,rotate:()=>Ne,scale:()=>we,set:()=>Ce,str:()=>De,sub:()=>We,subtract:()=>Ue,translate:()=>Le});var N={};Pa.r(N);Pa.d(N,{add:()=>_t,adjoint:()=>it,clone:()=>qe,copy:()=>Ke,create:()=>Xe,determinant:()=>nt,equals:()=>Tt,exactEquals:()=>Et,frob:()=>mt,fromMat2d:()=>ct,fromMat4:()=>Ye,fromQuat:()=>ft,fromRotation:()=>ht,fromScaling:()=>ut,fromTranslation:()=>lt,fromValues:()=>Ze,identity:()=>Je,invert:()=>tt,mul:()=>At,multiply:()=>rt,multiplyScalar:()=>vt,multiplyScalarAndAdd:()=>xt,normalFromMat4:()=>dt,projection:()=>gt,rotate:()=>at,scale:()=>ot,set:()=>Qe,str:()=>pt,sub:()=>St,subtract:()=>bt,translate:()=>st,transpose:()=>et});var w={};Pa.r(w);Pa.d(w,{add:()=>ai,adjoint:()=>yt,clone:()=>It,copy:()=>Mt,create:()=>n,determinant:()=>Nt,equals:()=>ci,exactEquals:()=>ui,frob:()=>si,fromQuat:()=>Zt,fromQuat2:()=>$t,fromRotation:()=>Ut,fromRotationTranslation:()=>zt,fromRotationTranslationScale:()=>qt,fromRotationTranslationScaleOrigin:()=>Kt,fromScaling:()=>Bt,fromTranslation:()=>kt,fromValues:()=>Ct,fromXRotation:()=>Gt,fromYRotation:()=>jt,fromZRotation:()=>Ht,frustum:()=>Qt,getRotation:()=>Yt,getScaling:()=>Xt,getTranslation:()=>Wt,identity:()=>A,invert:()=>t,lookAt:()=>ii,mul:()=>fi,multiply:()=>wt,multiplyScalar:()=>li,multiplyScalarAndAdd:()=>hi,ortho:()=>ti,perspective:()=>Jt,perspectiveFromFieldOfView:()=>ei,rotate:()=>Pt,rotateX:()=>Ft,rotateY:()=>Vt,rotateZ:()=>Dt,scale:()=>Lt,set:()=>Rt,str:()=>ri,sub:()=>di,subtract:()=>oi,targetTo:()=>ni,translate:()=>r,transpose:()=>Ot});var L={};Pa.r(L);Pa.d(L,{add:()=>_i,angle:()=>ji,bezier:()=>Pi,ceil:()=>xi,clone:()=>gi,copy:()=>mi,create:()=>D,cross:()=>j,dist:()=>Ki,distance:()=>Ci,div:()=>qi,divide:()=>vi,dot:()=>G,equals:()=>Wi,exactEquals:()=>$i,floor:()=>Ei,forEach:()=>en,fromValues:()=>o,hermite:()=>Li,inverse:()=>Ni,len:()=>Qi,length:()=>pi,lerp:()=>wi,max:()=>Ai,min:()=>Ti,mul:()=>Yi,multiply:()=>bi,negate:()=>yi,normalize:()=>U,random:()=>Fi,rotateX:()=>Bi,rotateY:()=>Ui,rotateZ:()=>Gi,round:()=>Si,scale:()=>Ii,scaleAndAdd:()=>Mi,set:()=>k,sqrDist:()=>Zi,sqrLen:()=>Ji,squaredDistance:()=>Ri,squaredLength:()=>Oi,str:()=>zi,sub:()=>Xi,subtract:()=>B,transformMat3:()=>Di,transformMat4:()=>Vi,transformQuat:()=>ki,zero:()=>Hi});var F={};Pa.r(F);Pa.d(F,{add:()=>on,ceil:()=>cn,clone:()=>nn,copy:()=>sn,create:()=>tn,cross:()=>Mn,dist:()=>kn,distance:()=>bn,div:()=>Dn,divide:()=>un,dot:()=>In,equals:()=>Pn,exactEquals:()=>Ln,floor:()=>fn,forEach:()=>jn,fromValues:()=>rn,inverse:()=>An,len:()=>Un,length:()=>xn,lerp:()=>Cn,max:()=>gn,min:()=>dn,mul:()=>Vn,multiply:()=>hn,negate:()=>Tn,normalize:()=>Sn,random:()=>Rn,round:()=>pn,scale:()=>mn,scaleAndAdd:()=>_n,set:()=>an,sqrDist:()=>Bn,sqrLen:()=>Gn,squaredDistance:()=>vn,squaredLength:()=>En,str:()=>wn,sub:()=>Fn,subtract:()=>ln,transformMat4:()=>On,transformQuat:()=>yn,zero:()=>Nn});var V={};Pa.r(V);Pa.d(V,{add:()=>cr,calculateW:()=>Zn,clone:()=>or,conjugate:()=>nr,copy:()=>hr,create:()=>s,dot:()=>gr,equals:()=>Tr,exactEquals:()=>Er,exp:()=>Qn,fromEuler:()=>sr,fromMat3:()=>rr,fromValues:()=>lr,getAngle:()=>Wn,getAxisAngle:()=>$n,identity:()=>Hn,invert:()=>ir,len:()=>_r,length:()=>mr,lerp:()=>pr,ln:()=>Jn,mul:()=>fr,multiply:()=>Xn,normalize:()=>xr,pow:()=>er,random:()=>tr,rotateX:()=>Yn,rotateY:()=>qn,rotateZ:()=>Kn,rotationTo:()=>Ar,scale:()=>dr,set:()=>ur,setAxes:()=>Ir,setAxisAngle:()=>zn,slerp:()=>l,sqlerp:()=>Sr,sqrLen:()=>vr,squaredLength:()=>br,str:()=>ar});var z={};Pa.r(z);Pa.d(z,{add:()=>qr,clone:()=>Cr,conjugate:()=>is,copy:()=>Pr,create:()=>Mr,dot:()=>Jr,equals:()=>hs,exactEquals:()=>ls,fromMat4:()=>Lr,fromRotation:()=>wr,fromRotationTranslation:()=>yr,fromRotationTranslationValues:()=>Or,fromTranslation:()=>Nr,fromValues:()=>Rr,getDual:()=>kr,getReal:()=>Dr,getTranslation:()=>Gr,identity:()=>Fr,invert:()=>ts,len:()=>rs,length:()=>ns,lerp:()=>es,mul:()=>Zr,multiply:()=>Kr,normalize:()=>as,rotateAroundAxis:()=>Yr,rotateByQuatAppend:()=>Wr,rotateByQuatPrepend:()=>Xr,rotateX:()=>Hr,rotateY:()=>zr,rotateZ:()=>$r,scale:()=>Qr,set:()=>Vr,setDual:()=>Ur,setReal:()=>Br,sqrLen:()=>ss,squaredLength:()=>f,str:()=>os,translate:()=>jr});var $={};Pa.r($);Pa.d($,{add:()=>ds,angle:()=>Us,ceil:()=>_s,clone:()=>us,copy:()=>fs,create:()=>e,cross:()=>ws,dist:()=>qs,distance:()=>Ss,div:()=>Ys,divide:()=>ms,dot:()=>Ns,equals:()=>zs,exactEquals:()=>Hs,floor:()=>bs,forEach:()=>Qs,fromValues:()=>cs,inverse:()=>Os,len:()=>$s,length:()=>Ms,lerp:()=>Ls,max:()=>xs,min:()=>vs,mul:()=>Xs,multiply:()=>ps,negate:()=>Rs,normalize:()=>ys,random:()=>Ps,rotate:()=>Bs,round:()=>Es,scale:()=>Ts,scaleAndAdd:()=>As,set:()=>H,sqrDist:()=>Ks,sqrLen:()=>Zs,squaredDistance:()=>Is,squaredLength:()=>Cs,str:()=>js,sub:()=>Ws,subtract:()=>gs,transformMat2:()=>Fs,transformMat2d:()=>Vs,transformMat3:()=>Ds,transformMat4:()=>ks,zero:()=>Gs});const T=CABLES;const u=CABLES.SHARED;var P=1e-6;var _=typeof Float32Array!=="undefined"?Float32Array:Array;var h=Math.random;function W(e){_=e}var X=Math.PI/180;function Y(e){return e*X}function q(e,t){return Math.abs(e-t)<=P*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)};function K(){var e=new _(4);if(_!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function Z(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function Q(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function J(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function ee(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function te(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function ie(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function ne(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*s-r*n;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-n*a;e[2]=-r*a;e[3]=i*a;return e}function re(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function se(e){return e[0]*e[3]-e[2]*e[1]}function ae(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*o+s*l;e[1]=r*o+a*l;e[2]=n*h+s*u;e[3]=r*h+a*u;return e}function oe(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=n*l+s*o;e[1]=r*l+a*o;e[2]=n*-o+s*l;e[3]=r*-o+a*l;return e}function le(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1];e[0]=n*o;e[1]=r*o;e[2]=s*l;e[3]=a*l;return e}function he(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;return e}function ue(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function ce(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fe(e){return Math.hypot(e[0],e[1],e[2],e[3])}function de(e,t,i,n){e[2]=n[2]/n[0];i[0]=n[0];i[1]=n[1];i[3]=n[3]-e[2]*i[1];return[e,t,i]}function ge(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function pe(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function me(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _e(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=P*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=P*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=P*Math.max(1,Math.abs(s),Math.abs(h))}function be(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function ve(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}var xe=ae;var Ee=pe;function Te(){var e=new _(6);if(_!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function Ae(e){var t=new _(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function Se(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Ie(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Me(e,t,i,n,r,s){var a=new _(6);a[0]=e;a[1]=t;a[2]=i;a[3]=n;a[4]=r;a[5]=s;return a}function Ce(e,t,i,n,r,s,a){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;return e}function Re(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5];var l=i*s-n*r;if(!l){return null}l=1/l;e[0]=s*l;e[1]=-n*l;e[2]=-r*l;e[3]=i*l;e[4]=(r*o-s*a)*l;e[5]=(n*a-i*o)*l;return e}function Oe(e){return e[0]*e[3]-e[1]*e[2]}function ye(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1],c=i[2],f=i[3],d=i[4],g=i[5];e[0]=n*h+s*u;e[1]=r*h+a*u;e[2]=n*c+s*f;e[3]=r*c+a*f;e[4]=n*d+s*g+o;e[5]=r*d+a*g+l;return e}function Ne(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=Math.sin(i);var u=Math.cos(i);e[0]=n*u+s*h;e[1]=r*u+a*h;e[2]=n*-h+s*u;e[3]=r*-h+a*u;e[4]=o;e[5]=l;return e}function we(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=n*h;e[1]=r*h;e[2]=s*u;e[3]=a*u;e[4]=o;e[5]=l;return e}function Le(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=n*h+s*u+o;e[5]=r*h+a*u+l;return e}function Pe(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;e[4]=0;e[5]=0;return e}function Fe(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function Ve(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function De(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ke(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Be(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function Ue(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function Ge(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function je(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;return e}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function ze(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5];var l=t[0],h=t[1],u=t[2],c=t[3],f=t[4],d=t[5];return Math.abs(i-l)<=P*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=P*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-u)<=P*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-c)<=P*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-f)<=P*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-d)<=P*Math.max(1,Math.abs(o),Math.abs(d))}var $e=ye;var We=Ue;function Xe(){var e=new _(9);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function Ye(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function qe(e){var t=new _(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Ke(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function Ze(e,t,i,n,r,s,a,o,l){var h=new _(9);h[0]=e;h[1]=t;h[2]=i;h[3]=n;h[4]=r;h[5]=s;h[6]=a;h[7]=o;h[8]=l;return h}function Qe(e,t,i,n,r,s,a,o,l,h){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=h;return e}function Je(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function et(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=n;e[7]=r}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function tt(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];var c=u*a-o*h;var f=-u*s+o*l;var d=h*s-a*l;var g=i*c+n*f+r*d;if(!g){return null}g=1/g;e[0]=c*g;e[1]=(-u*n+r*h)*g;e[2]=(o*n-r*a)*g;e[3]=f*g;e[4]=(u*i-r*l)*g;e[5]=(-o*i+r*s)*g;e[6]=d*g;e[7]=(-h*i+n*l)*g;e[8]=(a*i-n*s)*g;return e}function it(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];e[0]=a*u-o*h;e[1]=r*h-n*u;e[2]=n*o-r*a;e[3]=o*l-s*u;e[4]=i*u-r*l;e[5]=r*s-i*o;e[6]=s*h-a*l;e[7]=n*l-i*h;e[8]=i*a-n*s;return e}function nt(e){var t=e[0],i=e[1],n=e[2];var r=e[3],s=e[4],a=e[5];var o=e[6],l=e[7],h=e[8];return t*(h*s-a*l)+i*(-h*r+a*o)+n*(l*r-s*o)}function rt(e,t,i){var n=t[0],r=t[1],s=t[2];var a=t[3],o=t[4],l=t[5];var h=t[6],u=t[7],c=t[8];var f=i[0],d=i[1],g=i[2];var p=i[3],m=i[4],_=i[5];var b=i[6],v=i[7],x=i[8];e[0]=f*n+d*a+g*h;e[1]=f*r+d*o+g*u;e[2]=f*s+d*l+g*c;e[3]=p*n+m*a+_*h;e[4]=p*r+m*o+_*u;e[5]=p*s+m*l+_*c;e[6]=b*n+v*a+x*h;e[7]=b*r+v*o+x*u;e[8]=b*s+v*l+x*c;return e}function st(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=i[0],d=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=o;e[5]=l;e[6]=f*n+d*a+h;e[7]=f*r+d*o+u;e[8]=f*s+d*l+c;return e}function at(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=Math.sin(i),d=Math.cos(i);e[0]=d*n+f*a;e[1]=d*r+f*o;e[2]=d*s+f*l;e[3]=d*a-f*n;e[4]=d*o-f*r;e[5]=d*l-f*s;e[6]=h;e[7]=u;e[8]=c;return e}function ot(e,t,i){var n=i[0],r=i[1];e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=r*t[3];e[4]=r*t[4];e[5]=r*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function lt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function ht(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=-i;e[4]=n;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ut(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ct(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function ft(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var h=i*a;var u=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var p=s*a;var m=s*o;var _=s*l;e[0]=1-c-g;e[3]=u-_;e[6]=f+m;e[1]=u+_;e[4]=1-h-g;e[7]=d-p;e[2]=f-m;e[5]=d+p;e[8]=1-h-c;return e}function dt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var x=i*h-s*a;var E=n*l-r*o;var T=n*h-s*o;var A=r*h-s*l;var S=u*p-c*g;var I=u*m-f*g;var M=u*_-d*g;var C=c*m-f*p;var R=c*_-d*p;var O=f*_-d*m;var y=b*O-v*R+x*C+E*M-T*I+A*S;if(!y){return null}y=1/y;e[0]=(o*O-l*R+h*C)*y;e[1]=(l*M-a*O-h*I)*y;e[2]=(a*R-o*M+h*S)*y;e[3]=(r*R-n*O-s*C)*y;e[4]=(i*O-r*M+s*I)*y;e[5]=(n*M-i*R-s*S)*y;e[6]=(p*A-m*T+_*E)*y;e[7]=(m*x-g*A-_*v)*y;e[8]=(g*T-p*x+_*b)*y;return e}function gt(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function pt(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function mt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function _t(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function bt(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function vt(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function xt(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;return e}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Tt(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];var c=t[0],f=t[1],d=t[2],g=t[3],p=t[4],m=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=P*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=P*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=P*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-g)<=P*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-p)<=P*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=P*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=P*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-b)<=P*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(u-v)<=P*Math.max(1,Math.abs(u),Math.abs(v))}var At=rt;var St=bt;function n(){var e=new _(16);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function It(e){var t=new _(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function Mt(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Ct(e,t,i,n,r,s,a,o,l,h,u,c,f,d,g,p){var m=new _(16);m[0]=e;m[1]=t;m[2]=i;m[3]=n;m[4]=r;m[5]=s;m[6]=a;m[7]=o;m[8]=l;m[9]=h;m[10]=u;m[11]=c;m[12]=f;m[13]=d;m[14]=g;m[15]=p;return m}function Rt(e,t,i,n,r,s,a,o,l,h,u,c,f,d,g,p,m){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=h;e[9]=u;e[10]=c;e[11]=f;e[12]=d;e[13]=g;e[14]=p;e[15]=m;return e}function A(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ot(e,t){if(e===t){var i=t[1],n=t[2],r=t[3];var s=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=n;e[9]=s;e[11]=t[14];e[12]=r;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function t(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var x=i*h-s*a;var E=n*l-r*o;var T=n*h-s*o;var A=r*h-s*l;var S=u*p-c*g;var I=u*m-f*g;var M=u*_-d*g;var C=c*m-f*p;var R=c*_-d*p;var O=f*_-d*m;var y=b*O-v*R+x*C+E*M-T*I+A*S;if(!y){return null}y=1/y;e[0]=(o*O-l*R+h*C)*y;e[1]=(r*R-n*O-s*C)*y;e[2]=(p*A-m*T+_*E)*y;e[3]=(f*T-c*A-d*E)*y;e[4]=(l*M-a*O-h*I)*y;e[5]=(i*O-r*M+s*I)*y;e[6]=(m*x-g*A-_*v)*y;e[7]=(u*A-f*x+d*v)*y;e[8]=(a*R-o*M+h*S)*y;e[9]=(n*M-i*R-s*S)*y;e[10]=(g*T-p*x+_*b)*y;e[11]=(c*x-u*T-d*b)*y;e[12]=(o*I-a*C-l*S)*y;e[13]=(i*C-n*I+r*S)*y;e[14]=(p*v-g*E-m*b)*y;e[15]=(u*E-c*v+f*b)*y;return e}function yt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],p=t[13],m=t[14],_=t[15];e[0]=o*(f*_-d*m)-c*(l*_-h*m)+p*(l*d-h*f);e[1]=-(n*(f*_-d*m)-c*(r*_-s*m)+p*(r*d-s*f));e[2]=n*(l*_-h*m)-o*(r*_-s*m)+p*(r*h-s*l);e[3]=-(n*(l*d-h*f)-o*(r*d-s*f)+c*(r*h-s*l));e[4]=-(a*(f*_-d*m)-u*(l*_-h*m)+g*(l*d-h*f));e[5]=i*(f*_-d*m)-u*(r*_-s*m)+g*(r*d-s*f);e[6]=-(i*(l*_-h*m)-a*(r*_-s*m)+g*(r*h-s*l));e[7]=i*(l*d-h*f)-a*(r*d-s*f)+u*(r*h-s*l);e[8]=a*(c*_-d*p)-u*(o*_-h*p)+g*(o*d-h*c);e[9]=-(i*(c*_-d*p)-u*(n*_-s*p)+g*(n*d-s*c));e[10]=i*(o*_-h*p)-a*(n*_-s*p)+g*(n*h-s*o);e[11]=-(i*(o*d-h*c)-a*(n*d-s*c)+u*(n*h-s*o));e[12]=-(a*(c*m-f*p)-u*(o*m-l*p)+g*(o*f-l*c));e[13]=i*(c*m-f*p)-u*(n*m-r*p)+g*(n*f-r*c);e[14]=-(i*(o*m-l*p)-a*(n*m-r*p)+g*(n*l-r*o));e[15]=i*(o*f-l*c)-a*(n*f-r*c)+u*(n*l-r*o);return e}function Nt(e){var t=e[0],i=e[1],n=e[2],r=e[3];var s=e[4],a=e[5],o=e[6],l=e[7];var h=e[8],u=e[9],c=e[10],f=e[11];var d=e[12],g=e[13],p=e[14],m=e[15];var _=t*a-i*s;var b=t*o-n*s;var v=t*l-r*s;var x=i*o-n*a;var E=i*l-r*a;var T=n*l-r*o;var A=h*g-u*d;var S=h*p-c*d;var I=h*m-f*d;var M=u*p-c*g;var C=u*m-f*g;var R=c*m-f*p;return _*R-b*C+v*M+x*I-E*S+T*A}function wt(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=t[4],l=t[5],h=t[6],u=t[7];var c=t[8],f=t[9],d=t[10],g=t[11];var p=t[12],m=t[13],_=t[14],b=t[15];var v=i[0],x=i[1],E=i[2],T=i[3];e[0]=v*n+x*o+E*c+T*p;e[1]=v*r+x*l+E*f+T*m;e[2]=v*s+x*h+E*d+T*_;e[3]=v*a+x*u+E*g+T*b;v=i[4];x=i[5];E=i[6];T=i[7];e[4]=v*n+x*o+E*c+T*p;e[5]=v*r+x*l+E*f+T*m;e[6]=v*s+x*h+E*d+T*_;e[7]=v*a+x*u+E*g+T*b;v=i[8];x=i[9];E=i[10];T=i[11];e[8]=v*n+x*o+E*c+T*p;e[9]=v*r+x*l+E*f+T*m;e[10]=v*s+x*h+E*d+T*_;e[11]=v*a+x*u+E*g+T*b;v=i[12];x=i[13];E=i[14];T=i[15];e[12]=v*n+x*o+E*c+T*p;e[13]=v*r+x*l+E*f+T*m;e[14]=v*s+x*h+E*d+T*_;e[15]=v*a+x*u+E*g+T*b;return e}function r(e,t,i){var n=i[0],r=i[1],s=i[2];var a,o,l,h;var u,c,f,d;var g,p,m,_;if(t===e){e[12]=t[0]*n+t[4]*r+t[8]*s+t[12];e[13]=t[1]*n+t[5]*r+t[9]*s+t[13];e[14]=t[2]*n+t[6]*r+t[10]*s+t[14];e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]}else{a=t[0];o=t[1];l=t[2];h=t[3];u=t[4];c=t[5];f=t[6];d=t[7];g=t[8];p=t[9];m=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=u;e[5]=c;e[6]=f;e[7]=d;e[8]=g;e[9]=p;e[10]=m;e[11]=_;e[12]=a*n+u*r+g*s+t[12];e[13]=o*n+c*r+p*s+t[13];e[14]=l*n+f*r+m*s+t[14];e[15]=h*n+d*r+_*s+t[15]}return e}function Lt(e,t,i){var n=i[0],r=i[1],s=i[2];e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;e[3]=t[3]*n;e[4]=t[4]*r;e[5]=t[5]*r;e[6]=t[6]*r;e[7]=t[7]*r;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Pt(e,t,i,n){var r=n[0],s=n[1],a=n[2];var o=Math.hypot(r,s,a);var l,h,u;var c,f,d,g;var p,m,_,b;var v,x,E,T;var A,S,I;var M,C,R;var O,y,N;if(o<P){return null}o=1/o;r*=o;s*=o;a*=o;l=Math.sin(i);h=Math.cos(i);u=1-h;c=t[0];f=t[1];d=t[2];g=t[3];p=t[4];m=t[5];_=t[6];b=t[7];v=t[8];x=t[9];E=t[10];T=t[11];A=r*r*u+h;S=s*r*u+a*l;I=a*r*u-s*l;M=r*s*u-a*l;C=s*s*u+h;R=a*s*u+r*l;O=r*a*u+s*l;y=s*a*u-r*l;N=a*a*u+h;e[0]=c*A+p*S+v*I;e[1]=f*A+m*S+x*I;e[2]=d*A+_*S+E*I;e[3]=g*A+b*S+T*I;e[4]=c*M+p*C+v*R;e[5]=f*M+m*C+x*R;e[6]=d*M+_*C+E*R;e[7]=g*M+b*C+T*R;e[8]=c*O+p*y+v*N;e[9]=f*O+m*y+x*N;e[10]=d*O+_*y+E*N;e[11]=g*O+b*y+T*N;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function Ft(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[4];var a=t[5];var o=t[6];var l=t[7];var h=t[8];var u=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*r+h*n;e[5]=a*r+u*n;e[6]=o*r+c*n;e[7]=l*r+f*n;e[8]=h*r-s*n;e[9]=u*r-a*n;e[10]=c*r-o*n;e[11]=f*r-l*n;return e}function Vt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[8];var u=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r-h*n;e[1]=a*r-u*n;e[2]=o*r-c*n;e[3]=l*r-f*n;e[8]=s*n+h*r;e[9]=a*n+u*r;e[10]=o*n+c*r;e[11]=l*n+f*r;return e}function Dt(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[4];var u=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r+h*n;e[1]=a*r+u*n;e[2]=o*r+c*n;e[3]=l*r+f*n;e[4]=h*r-s*n;e[5]=u*r-a*n;e[6]=c*r-o*n;e[7]=f*r-l*n;return e}function kt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function Bt(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ut(e,t,i){var n=i[0],r=i[1],s=i[2];var a=Math.hypot(n,r,s);var o,l,h;if(a<P){return null}a=1/a;n*=a;r*=a;s*=a;o=Math.sin(t);l=Math.cos(t);h=1-l;e[0]=n*n*h+l;e[1]=r*n*h+s*o;e[2]=s*n*h-r*o;e[3]=0;e[4]=n*r*h-s*o;e[5]=r*r*h+l;e[6]=s*r*h+n*o;e[7]=0;e[8]=n*s*h+r*o;e[9]=r*s*h-n*o;e[10]=s*s*h+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Gt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function jt(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ht(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function zt(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=n+n;var l=r+r;var h=s+s;var u=n*o;var c=n*l;var f=n*h;var d=r*l;var g=r*h;var p=s*h;var m=a*o;var _=a*l;var b=a*h;e[0]=1-(d+p);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(u+p);e[6]=g+m;e[7]=0;e[8]=f+_;e[9]=g-m;e[10]=1-(u+d);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function $t(e,t){var i=new _(3);var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7];var c=n*n+r*r+s*s+a*a;if(c>0){i[0]=(o*a+u*n+l*s-h*r)*2/c;i[1]=(l*a+u*r+h*n-o*s)*2/c;i[2]=(h*a+u*s+o*r-l*n)*2/c}else{i[0]=(o*a+u*n+l*s-h*r)*2;i[1]=(l*a+u*r+h*n-o*s)*2;i[2]=(h*a+u*s+o*r-l*n)*2}zt(e,t,i);return e}function Wt(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function Xt(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[4];var a=t[5];var o=t[6];var l=t[8];var h=t[9];var u=t[10];e[0]=Math.hypot(i,n,r);e[1]=Math.hypot(s,a,o);e[2]=Math.hypot(l,h,u);return e}function Yt(e,t){var i=new _(3);Xt(i,t);var n=1/i[0];var r=1/i[1];var s=1/i[2];var a=t[0]*n;var o=t[1]*r;var l=t[2]*s;var h=t[4]*n;var u=t[5]*r;var c=t[6]*s;var f=t[8]*n;var d=t[9]*r;var g=t[10]*s;var p=a+u+g;var m=0;if(p>0){m=Math.sqrt(p+1)*2;e[3]=.25*m;e[0]=(c-d)/m;e[1]=(f-l)/m;e[2]=(o-h)/m}else if(a>u&&a>g){m=Math.sqrt(1+a-u-g)*2;e[3]=(c-d)/m;e[0]=.25*m;e[1]=(o+h)/m;e[2]=(f+l)/m}else if(u>g){m=Math.sqrt(1+u-a-g)*2;e[3]=(f-l)/m;e[0]=(o+h)/m;e[1]=.25*m;e[2]=(c+d)/m}else{m=Math.sqrt(1+g-a-u)*2;e[3]=(o-h)/m;e[0]=(f+l)/m;e[1]=(c+d)/m;e[2]=.25*m}return e}function qt(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=r+r;var h=s+s;var u=a+a;var c=r*l;var f=r*h;var d=r*u;var g=s*h;var p=s*u;var m=a*u;var _=o*l;var b=o*h;var v=o*u;var x=n[0];var E=n[1];var T=n[2];e[0]=(1-(g+m))*x;e[1]=(f+v)*x;e[2]=(d-b)*x;e[3]=0;e[4]=(f-v)*E;e[5]=(1-(c+m))*E;e[6]=(p+_)*E;e[7]=0;e[8]=(d+b)*T;e[9]=(p-_)*T;e[10]=(1-(c+g))*T;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Kt(e,t,i,n,r){var s=t[0],a=t[1],o=t[2],l=t[3];var h=s+s;var u=a+a;var c=o+o;var f=s*h;var d=s*u;var g=s*c;var p=a*u;var m=a*c;var _=o*c;var b=l*h;var v=l*u;var x=l*c;var E=n[0];var T=n[1];var A=n[2];var S=r[0];var I=r[1];var M=r[2];var C=(1-(p+_))*E;var R=(d+x)*E;var O=(g-v)*E;var y=(d-x)*T;var N=(1-(f+_))*T;var w=(m+b)*T;var L=(g+v)*A;var P=(m-b)*A;var F=(1-(f+p))*A;e[0]=C;e[1]=R;e[2]=O;e[3]=0;e[4]=y;e[5]=N;e[6]=w;e[7]=0;e[8]=L;e[9]=P;e[10]=F;e[11]=0;e[12]=i[0]+S-(C*S+y*I+L*M);e[13]=i[1]+I-(R*S+N*I+P*M);e[14]=i[2]+M-(O*S+w*I+F*M);e[15]=1;return e}function Zt(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var h=i*a;var u=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var p=s*a;var m=s*o;var _=s*l;e[0]=1-c-g;e[1]=u+_;e[2]=f-m;e[3]=0;e[4]=u-_;e[5]=1-h-g;e[6]=d+p;e[7]=0;e[8]=f+m;e[9]=d-p;e[10]=1-h-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Qt(e,t,i,n,r,s,a){var o=1/(i-t);var l=1/(r-n);var h=1/(s-a);e[0]=s*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(r+n)*l;e[10]=(a+s)*h;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*s*2*h;e[15]=0;return e}function Jt(e,t,i,n,r){var s=1/Math.tan(t/2),a;e[0]=s/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(r!=null&&r!==Infinity){a=1/(n-r);e[10]=(r+n)*a;e[14]=2*r*n*a}else{e[10]=-1;e[14]=-2*n}return e}function ei(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180);var s=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var h=2/(r+s);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=h;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(r-s)*h*.5;e[10]=n/(i-n);e[11]=-1;e[12]=0;e[13]=0;e[14]=n*i/(i-n);e[15]=0;return e}function ti(e,t,i,n,r,s,a){var o=1/(t-i);var l=1/(n-r);var h=1/(s-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*h;e[11]=0;e[12]=(t+i)*o;e[13]=(r+n)*l;e[14]=(a+s)*h;e[15]=1;return e}function ii(e,t,i,n){var r,s,a,o,l,h,u,c,f,d;var g=t[0];var p=t[1];var m=t[2];var _=n[0];var b=n[1];var v=n[2];var x=i[0];var E=i[1];var T=i[2];if(Math.abs(g-x)<P&&Math.abs(p-E)<P&&Math.abs(m-T)<P){return A(e)}u=g-x;c=p-E;f=m-T;d=1/Math.hypot(u,c,f);u*=d;c*=d;f*=d;r=b*f-v*c;s=v*u-_*f;a=_*c-b*u;d=Math.hypot(r,s,a);if(!d){r=0;s=0;a=0}else{d=1/d;r*=d;s*=d;a*=d}o=c*a-f*s;l=f*r-u*a;h=u*s-c*r;d=Math.hypot(o,l,h);if(!d){o=0;l=0;h=0}else{d=1/d;o*=d;l*=d;h*=d}e[0]=r;e[1]=o;e[2]=u;e[3]=0;e[4]=s;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=h;e[10]=f;e[11]=0;e[12]=-(r*g+s*p+a*m);e[13]=-(o*g+l*p+h*m);e[14]=-(u*g+c*p+f*m);e[15]=1;return e}function ni(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=n[0],l=n[1],h=n[2];var u=r-i[0],c=s-i[1],f=a-i[2];var d=u*u+c*c+f*f;if(d>0){d=1/Math.sqrt(d);u*=d;c*=d;f*=d}var g=l*f-h*c,p=h*u-o*f,m=o*c-l*u;d=g*g+p*p+m*m;if(d>0){d=1/Math.sqrt(d);g*=d;p*=d;m*=d}e[0]=g;e[1]=p;e[2]=m;e[3]=0;e[4]=c*m-f*p;e[5]=f*g-u*m;e[6]=u*p-c*g;e[7]=0;e[8]=u;e[9]=c;e[10]=f;e[11]=0;e[12]=r;e[13]=s;e[14]=a;e[15]=1;return e}function ri(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function si(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ai(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function oi(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function li(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function hi(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;e[9]=t[9]+i[9]*n;e[10]=t[10]+i[10]*n;e[11]=t[11]+i[11]*n;e[12]=t[12]+i[12]*n;e[13]=t[13]+i[13]*n;e[14]=t[14]+i[14]*n;e[15]=t[15]+i[15]*n;return e}function ui(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=e[4],o=e[5],l=e[6],h=e[7];var u=e[8],c=e[9],f=e[10],d=e[11];var g=e[12],p=e[13],m=e[14],_=e[15];var b=t[0],v=t[1],x=t[2],E=t[3];var T=t[4],A=t[5],S=t[6],I=t[7];var M=t[8],C=t[9],R=t[10],O=t[11];var y=t[12],N=t[13],w=t[14],L=t[15];return Math.abs(i-b)<=P*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-v)<=P*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=P*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=P*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-T)<=P*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-A)<=P*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(l-S)<=P*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-I)<=P*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(u-M)<=P*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-C)<=P*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(f-R)<=P*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-O)<=P*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(g-y)<=P*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(p-N)<=P*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(m-w)<=P*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(_-L)<=P*Math.max(1,Math.abs(_),Math.abs(L))}var fi=wt;var di=oi;function D(){var e=new _(3);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function gi(e){var t=new _(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function pi(e){var t=e[0];var i=e[1];var n=e[2];return Math.hypot(t,i,n)}function o(e,t,i){var n=new _(3);n[0]=e;n[1]=t;n[2]=i;return n}function mi(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function k(e,t,i,n){e[0]=t;e[1]=i;e[2]=n;return e}function _i(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function B(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function bi(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function vi(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function xi(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function Ei(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function Ti(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function Ai(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function Si(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function Ii(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function Mi(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;return e}function Ci(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return Math.hypot(i,n,r)}function Ri(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return i*i+n*n+r*r}function Oi(e){var t=e[0];var i=e[1];var n=e[2];return t*t+i*i+n*n}function yi(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function Ni(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function U(e,t){var i=t[0];var n=t[1];var r=t[2];var s=i*i+n*n+r*r;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s;return e}function G(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function j(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2];e[0]=r*l-s*o;e[1]=s*a-n*l;e[2]=n*o-r*a;return e}function wi(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);return e}function Li(e,t,i,n,r,s){var a=s*s;var o=a*(2*s-3)+1;var l=a*(s-2)+s;var h=a*(s-1);var u=a*(3-2*s);e[0]=t[0]*o+i[0]*l+n[0]*h+r[0]*u;e[1]=t[1]*o+i[1]*l+n[1]*h+r[1]*u;e[2]=t[2]*o+i[2]*l+n[2]*h+r[2]*u;return e}function Pi(e,t,i,n,r,s){var a=1-s;var o=a*a;var l=s*s;var h=o*a;var u=3*s*o;var c=3*l*a;var f=l*s;e[0]=t[0]*h+i[0]*u+n[0]*c+r[0]*f;e[1]=t[1]*h+i[1]*u+n[1]*c+r[1]*f;e[2]=t[2]*h+i[2]*u+n[2]*c+r[2]*f;return e}function Fi(e,t){t=t||1;var i=h()*2*Math.PI;var n=h()*2-1;var r=Math.sqrt(1-n*n)*t;e[0]=Math.cos(i)*r;e[1]=Math.sin(i)*r;e[2]=n*t;return e}function Vi(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[3]*n+i[7]*r+i[11]*s+i[15];a=a||1;e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/a;e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/a;e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/a;return e}function Di(e,t,i){var n=t[0],r=t[1],s=t[2];e[0]=n*i[0]+r*i[3]+s*i[6];e[1]=n*i[1]+r*i[4]+s*i[7];e[2]=n*i[2]+r*i[5]+s*i[8];return e}function ki(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3];var o=t[0],l=t[1],h=t[2];var u=r*h-s*l,c=s*o-n*h,f=n*l-r*o;var d=r*f-s*c,g=s*u-n*f,p=n*c-r*u;var m=a*2;u*=m;c*=m;f*=m;d*=2;g*=2;p*=2;e[0]=o+u+d;e[1]=l+c+g;e[2]=h+f+p;return e}function Bi(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0];s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n);s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Ui(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n);s[1]=r[1];s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Gi(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n);s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n);s[2]=r[2];e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function ji(e,t){var i=o(e[0],e[1],e[2]);var n=o(t[0],t[1],t[2]);U(i,i);U(n,n);var r=G(i,n);if(r>1){return 0}else if(r<-1){return Math.PI}else{return Math.acos(r)}}function Hi(e){e[0]=0;e[1]=0;e[2]=0;return e}function zi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function $i(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Wi(e,t){var i=e[0],n=e[1],r=e[2];var s=t[0],a=t[1],o=t[2];return Math.abs(i-s)<=P*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=P*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=P*Math.max(1,Math.abs(r),Math.abs(o))}var Xi=B;var Yi=bi;var qi=vi;var Ki=Ci;var Zi=Ri;var Qi=pi;var Ji=Oi;var en=function(){var l=D();return function(e,t,i,n,r,s){var a,o;if(!t){t=3}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}();function tn(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function nn(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function rn(e,t,i,n){var r=new _(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function sn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function an(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function on(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function ln(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function hn(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function un(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function cn(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function fn(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function dn(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function gn(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function pn(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function mn(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function _n(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}function bn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return Math.hypot(i,n,r,s)}function vn(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return i*i+n*n+r*r+s*s}function xn(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return Math.hypot(t,i,n,r)}function En(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return t*t+i*i+n*n+r*r}function Tn(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function An(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function Sn(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[3];var a=i*i+n*n+r*r+s*s;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=n*a;e[2]=r*a;e[3]=s*a;return e}function In(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Mn(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],s=i[0]*n[2]-i[2]*n[0],a=i[0]*n[3]-i[3]*n[0],o=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],h=i[2]*n[3]-i[3]*n[2];var u=t[0];var c=t[1];var f=t[2];var d=t[3];e[0]=c*h-f*l+d*o;e[1]=-(u*h)+f*a-d*s;e[2]=u*l-c*a+d*r;e[3]=-(u*o)+c*s-f*r;return e}function Cn(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];var o=t[3];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);e[3]=o+n*(i[3]-o);return e}function Rn(e,t){t=t||1;var i,n,r,s;var a,o;do{i=h()*2-1;n=h()*2-1;a=i*i+n*n}while(a>=1);do{r=h()*2-1;s=h()*2-1;o=r*r+s*s}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*n;e[2]=t*r*l;e[3]=t*s*l;return e}function On(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*a;e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*a;e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*a;e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*a;return e}function yn(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2],h=i[3];var u=h*n+o*s-l*r;var c=h*r+l*n-a*s;var f=h*s+a*r-o*n;var d=-a*n-o*r-l*s;e[0]=u*h+d*-a+c*-l-f*-o;e[1]=c*h+d*-o+f*-a-u*-l;e[2]=f*h+d*-l+u*-o-c*-a;e[3]=t[3];return e}function Nn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function wn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ln(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Pn(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=P*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=P*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=P*Math.max(1,Math.abs(s),Math.abs(h))}var Fn=ln;var Vn=hn;var Dn=un;var kn=bn;var Bn=vn;var Un=xn;var Gn=En;var jn=function(){var l=tn();return function(e,t,i,n,r,s){var a,o;if(!t){t=4}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}();function s(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function Hn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function zn(e,t,i){i=i*.5;var n=Math.sin(i);e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=Math.cos(i);return e}function $n(e,t){var i=Math.acos(t[3])*2;var n=Math.sin(i/2);if(n>P){e[0]=t[0]/n;e[1]=t[1]/n;e[2]=t[2]/n}else{e[0]=1;e[1]=0;e[2]=0}return i}function Wn(e,t){var i=gr(e,t);return Math.acos(2*i*i-1)}function Xn(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*u+a*o+r*h-s*l;e[1]=r*u+a*l+s*o-n*h;e[2]=s*u+a*h+n*l-r*o;e[3]=a*u-n*o-r*l-s*h;return e}function Yn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+a*o;e[1]=r*l+s*o;e[2]=s*l-r*o;e[3]=a*l-n*o;return e}function qn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l-s*o;e[1]=r*l+a*o;e[2]=s*l+n*o;e[3]=a*l-r*o;return e}function Kn(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*o;e[1]=r*l-n*o;e[2]=s*l+a*o;e[3]=a*l-s*o;return e}function Zn(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i;e[1]=n;e[2]=r;e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));return e}function Qn(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=Math.exp(s);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=n*l;e[2]=r*l;e[3]=o*Math.cos(a);return e}function Jn(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=a>0?Math.atan2(a,s)/a:0;e[0]=i*o;e[1]=n*o;e[2]=r*o;e[3]=.5*Math.log(i*i+n*n+r*r+s*s);return e}function er(e,t,i){Jn(e,t);dr(e,e,i);Qn(e,e);return e}function l(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=i[0],h=i[1],u=i[2],c=i[3];var f,d,g,p,m;d=r*l+s*h+a*u+o*c;if(d<0){d=-d;l=-l;h=-h;u=-u;c=-c}if(1-d>P){f=Math.acos(d);g=Math.sin(f);p=Math.sin((1-n)*f)/g;m=Math.sin(n*f)/g}else{p=1-n;m=n}e[0]=p*r+m*l;e[1]=p*s+m*h;e[2]=p*a+m*u;e[3]=p*o+m*c;return e}function tr(e){var t=h();var i=h();var n=h();var r=Math.sqrt(1-t);var s=Math.sqrt(t);e[0]=r*Math.sin(2*Math.PI*i);e[1]=r*Math.cos(2*Math.PI*i);e[2]=s*Math.sin(2*Math.PI*n);e[3]=s*Math.cos(2*Math.PI*n);return e}function ir(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*i+n*n+r*r+s*s;var o=a?1/a:0;e[0]=-i*o;e[1]=-n*o;e[2]=-r*o;e[3]=s*o;return e}function nr(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function rr(e,t){var i=t[0]+t[4]+t[8];var n;if(i>0){n=Math.sqrt(i+1);e[3]=.5*n;n=.5/n;e[0]=(t[5]-t[7])*n;e[1]=(t[6]-t[2])*n;e[2]=(t[1]-t[3])*n}else{var r=0;if(t[4]>t[0])r=1;if(t[8]>t[r*3+r])r=2;var s=(r+1)%3;var a=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[a*3+a]+1);e[r]=.5*n;n=.5/n;e[3]=(t[s*3+a]-t[a*3+s])*n;e[s]=(t[s*3+r]+t[r*3+s])*n;e[a]=(t[a*3+r]+t[r*3+a])*n}return e}function sr(e,t,i,n){var r=.5*Math.PI/180;t*=r;i*=r;n*=r;var s=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var h=Math.sin(n);var u=Math.cos(n);e[0]=s*l*u-a*o*h;e[1]=a*o*u+s*l*h;e[2]=a*l*h-s*o*u;e[3]=a*l*u+s*o*h;return e}function ar(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var or=nn;var lr=rn;var hr=sn;var ur=an;var cr=on;var fr=Xn;var dr=mn;var gr=In;var pr=Cn;var mr=xn;var _r=mr;var br=En;var vr=br;var xr=Sn;var Er=Ln;var Tr=Pn;var Ar=function(){var r=D();var s=o(1,0,0);var a=o(0,1,0);return function(e,t,i){var n=G(t,i);if(n<-.999999){j(r,s,t);if(Qi(r)<1e-6)j(r,a,t);U(r,r);zn(e,r,Math.PI);return e}else if(n>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{j(r,t,i);e[0]=r[0];e[1]=r[1];e[2]=r[2];e[3]=1+n;return xr(e,e)}}}();var Sr=function(){var a=s();var o=s();return function(e,t,i,n,r,s){l(a,t,r,s);l(o,i,n,s);l(e,a,o,2*s*(1-s));return e}}();var Ir=function(){var r=Xe();return function(e,t,i,n){r[0]=i[0];r[3]=i[1];r[6]=i[2];r[1]=n[0];r[4]=n[1];r[7]=n[2];r[2]=-t[0];r[5]=-t[1];r[8]=-t[2];return xr(e,rr(e,r))}}();function Mr(){var e=new _(8);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function Cr(e){var t=new _(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function Rr(e,t,i,n,r,s,a,o){var l=new _(8);l[0]=e;l[1]=t;l[2]=i;l[3]=n;l[4]=r;l[5]=s;l[6]=a;l[7]=o;return l}function Or(e,t,i,n,r,s,a){var o=new _(8);o[0]=e;o[1]=t;o[2]=i;o[3]=n;var l=r*.5,h=s*.5,u=a*.5;o[4]=l*n+h*i-u*t;o[5]=h*n+u*e-l*i;o[6]=u*n+l*t-h*e;o[7]=-l*e-h*t-u*i;return o}function yr(e,t,i){var n=i[0]*.5,r=i[1]*.5,s=i[2]*.5,a=t[0],o=t[1],l=t[2],h=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=n*h+r*l-s*o;e[5]=r*h+s*a-n*l;e[6]=s*h+n*o-r*a;e[7]=-n*a-r*o-s*l;return e}function Nr(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function wr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Lr(e,t){var i=s();Yt(i,t);var n=new _(3);Wt(n,t);yr(e,i,n);return e}function Pr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function Fr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Vr(e,t,i,n,r,s,a,o,l){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;return e}var Dr=hr;function kr(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var Br=hr;function Ur(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function Gr(e,t){var i=t[4],n=t[5],r=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],h=t[3];e[0]=(i*h+s*a+n*l-r*o)*2;e[1]=(n*h+s*o+r*a-i*l)*2;e[2]=(r*h+s*l+i*o-n*a)*2;return e}function jr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,h=i[2]*.5,u=t[4],c=t[5],f=t[6],d=t[7];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=a*o+r*h-s*l+u;e[5]=a*l+s*o-n*h+c;e[6]=a*h+n*l-r*o+f;e[7]=-n*o-r*l-s*h+d;return e}function Hr(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;Yn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function zr(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;qn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function $r(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*n+l*s-h*r,f=l*a+u*r+h*n-o*s,d=h*a+u*s+o*r-l*n,g=u*a-o*n-l*r-h*s;Kn(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function Wr(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3],o=t[0],l=t[1],h=t[2],u=t[3];e[0]=o*a+u*n+l*s-h*r;e[1]=l*a+u*r+h*n-o*s;e[2]=h*a+u*s+o*r-l*n;e[3]=u*a-o*n-l*r-h*s;o=t[4];l=t[5];h=t[6];u=t[7];e[4]=o*a+u*n+l*s-h*r;e[5]=l*a+u*r+h*n-o*s;e[6]=h*a+u*s+o*r-l*n;e[7]=u*a-o*n-l*r-h*s;return e}function Xr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0],l=i[1],h=i[2],u=i[3];e[0]=n*u+a*o+r*h-s*l;e[1]=r*u+a*l+s*o-n*h;e[2]=s*u+a*h+n*l-r*o;e[3]=a*u-n*o-r*l-s*h;o=i[4];l=i[5];h=i[6];u=i[7];e[4]=n*u+a*o+r*h-s*l;e[5]=r*u+a*l+s*o-n*h;e[6]=s*u+a*h+n*l-r*o;e[7]=a*u-n*o-r*l-s*h;return e}function Yr(e,t,i,n){if(Math.abs(n)<P){return Pr(e,t)}var r=Math.hypot(i[0],i[1],i[2]);n=n*.5;var s=Math.sin(n);var a=s*i[0]/r;var o=s*i[1]/r;var l=s*i[2]/r;var h=Math.cos(n);var u=t[0],c=t[1],f=t[2],d=t[3];e[0]=u*h+d*a+c*l-f*o;e[1]=c*h+d*o+f*a-u*l;e[2]=f*h+d*l+u*o-c*a;e[3]=d*h-u*a-c*o-f*l;var g=t[4],p=t[5],m=t[6],_=t[7];e[4]=g*h+_*a+p*l-m*o;e[5]=p*h+_*o+m*a-g*l;e[6]=m*h+_*l+g*o-p*a;e[7]=_*h-g*a-p*o-m*l;return e}function qr(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function Kr(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[4],l=i[5],h=i[6],u=i[7],c=t[4],f=t[5],d=t[6],g=t[7],p=i[0],m=i[1],_=i[2],b=i[3];e[0]=n*b+a*p+r*_-s*m;e[1]=r*b+a*m+s*p-n*_;e[2]=s*b+a*_+n*m-r*p;e[3]=a*b-n*p-r*m-s*_;e[4]=n*u+a*o+r*h-s*l+c*b+g*p+f*_-d*m;e[5]=r*u+a*l+s*o-n*h+f*b+g*m+d*p-c*_;e[6]=s*u+a*h+n*l-r*o+d*b+g*_+c*m-f*p;e[7]=a*u-n*o-r*l-s*h+g*b-c*p-f*m-d*_;return e}var Zr=Kr;function Qr(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var Jr=gr;function es(e,t,i,n){var r=1-n;if(Jr(t,i)<0)n=-n;e[0]=t[0]*r+i[0]*n;e[1]=t[1]*r+i[1]*n;e[2]=t[2]*r+i[2]*n;e[3]=t[3]*r+i[3]*n;e[4]=t[4]*r+i[4]*n;e[5]=t[5]*r+i[5]*n;e[6]=t[6]*r+i[6]*n;e[7]=t[7]*r+i[7]*n;return e}function ts(e,t){var i=f(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function is(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var ns=mr;var rs=ns;var f=br;var ss=f;function as(e,t){var i=f(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i;var r=t[1]/i;var s=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var h=t[6];var u=t[7];var c=n*o+r*l+s*h+a*u;e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=(o-n*c)/i;e[5]=(l-r*c)/i;e[6]=(h-s*c)/i;e[7]=(u-a*c)/i}return e}function os(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ls(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function hs(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7];var u=t[0],c=t[1],f=t[2],d=t[3],g=t[4],p=t[5],m=t[6],_=t[7];return Math.abs(i-u)<=P*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=P*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=P*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-d)<=P*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-g)<=P*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-p)<=P*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=P*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-_)<=P*Math.max(1,Math.abs(h),Math.abs(_))}function e(){var e=new _(2);if(_!=Float32Array){e[0]=0;e[1]=0}return e}function us(e){var t=new _(2);t[0]=e[0];t[1]=e[1];return t}function cs(e,t){var i=new _(2);i[0]=e;i[1]=t;return i}function fs(e,t){e[0]=t[0];e[1]=t[1];return e}function H(e,t,i){e[0]=t;e[1]=i;return e}function ds(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function gs(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function ps(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function ms(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function _s(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function bs(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function vs(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function xs(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function Es(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function Ts(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function As(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;return e}function Ss(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.hypot(i,n)}function Is(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Ms(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function Cs(e){var t=e[0],i=e[1];return t*t+i*i}function Rs(e,t){e[0]=-t[0];e[1]=-t[1];return e}function Os(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function ys(e,t){var i=t[0],n=t[1];var r=i*i+n*n;if(r>0){r=1/Math.sqrt(r)}e[0]=t[0]*r;e[1]=t[1]*r;return e}function Ns(e,t){return e[0]*t[0]+e[1]*t[1]}function ws(e,t,i){var n=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=n;return e}function Ls(e,t,i,n){var r=t[0],s=t[1];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);return e}function Ps(e,t){t=t||1;var i=h()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function Fs(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r;e[1]=i[1]*n+i[3]*r;return e}function Vs(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r+i[4];e[1]=i[1]*n+i[3]*r+i[5];return e}function Ds(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[3]*r+i[6];e[1]=i[1]*n+i[4]*r+i[7];return e}function ks(e,t,i){var n=t[0];var r=t[1];e[0]=i[0]*n+i[4]*r+i[12];e[1]=i[1]*n+i[5]*r+i[13];return e}function Bs(e,t,i,n){var r=t[0]-i[0],s=t[1]-i[1],a=Math.sin(n),o=Math.cos(n);e[0]=r*o-s*a+i[0];e[1]=r*a+s*o+i[1];return e}function Us(e,t){var i=e[0],n=e[1],r=t[0],s=t[1];var a=i*i+n*n;if(a>0){a=1/Math.sqrt(a)}var o=r*r+s*s;if(o>0){o=1/Math.sqrt(o)}var l=(i*r+n*s)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function Gs(e){e[0]=0;e[1]=0;return e}function js(e){return"vec2("+e[0]+", "+e[1]+")"}function Hs(e,t){return e[0]===t[0]&&e[1]===t[1]}function zs(e,t){var i=e[0],n=e[1];var r=t[0],s=t[1];return Math.abs(i-r)<=P*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=P*Math.max(1,Math.abs(n),Math.abs(s))}var $s=Ms;var Ws=gs;var Xs=ps;var Ys=ms;var qs=Ss;var Ks=Is;var Zs=Cs;var Qs=function(){var l=e();return function(e,t,i,n,r,s){var a,o;if(!t){t=2}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];r(l,l,s);e[a]=l[0];e[a+1]=l[1]}return e}}();class c{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new u.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let n="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)n="float";else if(i==2)n="vec2";else if(i==3)n="vec3";else if(i==4)n="vec4";const r={name:e,data:t,itemSize:i,type:n};this._attributes[e]=r}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,n){let r=D();if(t==undefined)t=1;if(i==undefined)i=1;if(n==undefined)n=1;for(let e=0;e<this.vertexNormals.length;e+=3){k(r,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);r[0]*=-t;r[1]*=-i;r[2]*=-n;U(r,r);this.vertexNormals[e+0]=r[0];this.vertexNormals[e+1]=r[1];this.vertexNormals[e+2]=r[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const n=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+n;this.vertices=T.utils.float32Concat(this._vertices,t.vertices);this.texCoords=T.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=T.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=T.utils.float32Concat(this.tangents,t.tangents);this.biTangents=T.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new c(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=D();const n=D();const r=D();function s(e){B(i,e[0],e[1]);B(n,e[0],e[2]);j(r,i,n);U(r,r);if(t&&t.forceZUp){if(r[2]<0){r[0]*=-1;r[1]*=-1;r[2]*=-1}}return r}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const h=[];h.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];h[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=h[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const u=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];U(u,u);this.vertexNormals[this.verticesIndices[t+e]*3+0]=u[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=u[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=u[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const x=this.vertices.length/3*2;this.texCoords=new Float32Array(x);for(let e=0;e<x;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const n=[];n.length=i*2;const r=D();const s=D();const a=D();const o=e();const l=e();const h=e();const u=D();const c=D();for(let e=0;e<t;e+=1){const E=this.verticesIndices[e*3];const T=this.verticesIndices[e*3+1];const A=this.verticesIndices[e*3+2];k(r,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);k(s,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);k(a,this.vertices[A*3],this.vertices[A*3+1],this.vertices[A*3+2]);H(o,this.texCoords[E*2],this.texCoords[E*2+1]);H(l,this.texCoords[T*2],this.texCoords[T*2+1]);H(h,this.texCoords[A*2],this.texCoords[A*2+1]);const S=s[0]-r[0];const I=a[0]-r[0];const M=s[1]-r[1];const C=a[1]-r[1];const R=s[2]-r[2];const O=a[2]-r[2];const y=l[0]-o[0];const N=h[0]-o[0];const w=l[1]-o[1];const L=h[1]-o[1];const P=1/(y*L-N*w);k(u,(L*S-w*I)*P,(L*M-w*C)*P,(L*R-w*O)*P);k(c,(y*I-N*S)*P,(y*C-N*M)*P,(y*O-N*R)*P);n[E]=u;n[T]=u;n[A]=u;n[E+i]=c;n[T+i]=c;n[A+i]=c}const f=D();const d=D();const g=D();const p=D();const m=D();const _=D();const b=D();const v=D();for(let e=0;e<i;e+=1){if(!n[e])continue;k(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);k(d,n[e][0],n[e][1],n[e][2]);const F=G(f,d);Ii(m,f,F);B(_,d,m);U(v,_);j(b,f,d);const V=1;Ii(g,v,1/V);j(p,f,g);this.tangents[e*3+0]=g[0];this.tangents[e*3+1]=g[1];this.tangents[e*3+2]=g[2];this.biTangents[e*3+0]=p[0];this.biTangents[e*3+1]=p[1];this.biTangents[e*3+2]=p[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const n=[];let r=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);n.push(r);r++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=n;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new i(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let n=0;const r=this.getBounds();const s=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(n=0;n<this.vertices.length;n+=3){if(this.vertices[n+0]==this.vertices[n+0]){if(e)this.vertices[n+0]-=s[0];if(t)this.vertices[n+1]-=s[1];if(i)this.vertices[n+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const n=this.vertices[e*3+0];const r=this.vertices[e*3+1];this.texCoords[e*2+0]=n/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-r/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}c.buildFromFaces=function(t,e,i){const n=[];const r=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const h=[-1,-1,-1];if(i)for(let e=0;e<n.length;e+=3){if(n[e+0]==a[0]&&n[e+1]==a[1]&&n[e+2]==a[2])h[0]=e/3;if(n[e+0]==o[0]&&n[e+1]==o[1]&&n[e+2]==o[2])h[1]=e/3;if(n[e+0]==l[0]&&n[e+1]==l[1]&&n[e+2]==l[2])h[2]=e/3}if(h[0]==-1){n.push(a[0],a[1],a[2]);h[0]=(n.length-1)/3}if(h[1]==-1){n.push(o[0],o[1],o[2]);h[1]=(n.length-1)/3}if(h[2]==-1){n.push(l[0],l[1],l[2]);h[2]=(n.length-1)/3}r.push(h[0]);r.push(h[1]);r.push(h[2])}const s=new c(e);s.name=e;s.vertices=n;s.verticesIndices=r;return s};class i{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof i){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new i(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!T.utils.isNumeric(e)||!T.utils.isNumeric(t)||!T.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}Vi(this._max,this._max,e);Vi(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();r(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class Js{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new u.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(e,t,i=false){if(this._oldWidthRp!=e*this.pixelDensity||this._oldHeightRp!=t*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=e*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=t*this.pixelDensity;if(!i){this.canvasEle.style.width=e+"px";this.canvasEle.style.height=t+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class ea extends u.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,T.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,T.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,T.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,T.now)()}}class a{constructor(){this._arr=[n()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const e=n();this._arr.push(e)}Mt(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class ta{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const n={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(n);this._cgl.emitEvent("heavyEvent",n)}}class ia extends u.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";#patch=null;gApi=0;_textureslots=[];_pMatrixStack=new a;_mMatrixStack=new a;_vMatrixStack=new a;canvasScale=1;constructor(e){super();this._log=new u.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new ea;this._identView=D();this._ident=D();k(this._identView,0,0,-2);k(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new ta(this);this.pMatrix=n();this.mMatrix=n();this.vMatrix=n();A(this.mMatrix);A(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new Js({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;Jt(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);A(this.mMatrix);A(this.vMatrix);r(this.mMatrix,this.mMatrix,e);r(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,n){console.log("no screenshot function implemented")}saveScreenshot(i,n,e,t,r){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const h="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+h+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(n)n(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}class na extends u.Events{id=T.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=T.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=T.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=T.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}class ra{constructor(e,t,i,n,r,s,a,o,l,h){this._log=new u.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=h;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof n=="object"&&n instanceof T.Port){this._port=n;this._value=this._port.get();if(r&&s&&a){if(!(r instanceof T.Port)||!(s instanceof T.Port)||!(a instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=r;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(r&&s){if(!(r instanceof T.Port)||!(s instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=r;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(r){if(!(r instanceof T.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=r;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=n;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class sa{_name="unknown";constructor(){}}const aa=8;class d{constructor(e={}){this.id=T.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||d.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=aa;if(!e.height)e.height=aa}}d.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const r=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let n=a.b||1;for(let e=0;e<s*s;e++){r[e*4+0]=t;r[e*4+1]=i;r[e*4+2]=n;r[e*4+3]=255}return r}else if(e=="randomUInt"){const r=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=Math.random()*255;r[e*4+1]=Math.random()*255;r[e*4+2]=Math.random()*255;r[e*4+3]=255}return r}else if(e=="random"||e=="randomFloat"){const r=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=(Math.random()-.5)*2;r[e*4+1]=(Math.random()-.5)*2;r[e*4+2]=(Math.random()-.5)*2;r[e*4+3]=1}return r}else if(e=="stripes"){const o=[];let i=a.r;let n=a.g;let r=a.b;if(i===undefined)i=1;if(n===undefined)n=1;if(r===undefined)r=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*n);o.push((200+t/s*25+e/s*25)*r)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*n);o.push((40+t/s*25+e/s*25)*r)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return d.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};d.FILTER_NEAREST=0;d.FILTER_LINEAR=1;d.FILTER_MIPMAP=2;d.WRAP_REPEAT=0;d.WRAP_MIRRORED_REPEAT=1;d.WRAP_CLAMP_TO_EDGE=2;d.TYPE_DEFAULT=0;d.TYPE_DEPTH=1;d.TYPE_FLOAT=2;d.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";d.PFORMATSTR_R8UB="R 8bit ubyte";d.PFORMATSTR_RG8UB="RG 8bit ubyte";d.PFORMATSTR_RGB8UB="RGB 8bit ubyte";d.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";d.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";d.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";d.PFORMATSTR_R16F="R 16bit float";d.PFORMATSTR_RG16F="RG 16bit float";d.PFORMATSTR_RGB16F="RGB 16bit float";d.PFORMATSTR_RGBA16F="RGBA 16bit float";d.PFORMATSTR_R32F="R 32bit float";d.PFORMATSTR_RG32F="RG 32bit float";d.PFORMATSTR_RGB32F="RGB 32bit float";d.PFORMATSTR_RGBA32F="RGBA 32bit float";d.PFORMATSTR_DEPTH="DEPTH";d.PIXELFORMATS=[d.PFORMATSTR_RGB565,d.PFORMATSTR_R8UB,d.PFORMATSTR_RG8UB,d.PFORMATSTR_RGB8UB,d.PFORMATSTR_RGBA8UB,d.PFORMATSTR_SRGBA8,d.PFORMATSTR_R11FG11FB10F,d.PFORMATSTR_R16F,d.PFORMATSTR_RG16F,d.PFORMATSTR_RGBA16F,d.PFORMATSTR_R32F,d.PFORMATSTR_RGBA32F];const oa={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const la={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const ha=180/Math.PI;const ua=Math.PI/180;const g={MATH:{DEG2RAD:ua,RAD2DEG:ha},SHADER:oa,BLEND_MODES:la};const S="\n";const ca={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:c,BoundingBox:i,FpsCounter:ea,CgCanvas:Js};window.CABLES=window.CABLES||{};window.CABLES.CG={...window.CABLES.CG,...ca};window.CG={...window.CG,...ca};window.glMatrix=R;window.mat2=O;window.mat2d=y;window.mat3=N;window.mat4=w;window.quat=V;window.quat2=z;window.vec2=$;window.vec3=L;window.vec4=F;class p extends ra{constructor(e,t,i,n,r,s,a,o,l,h){super(e,t,i,n,r,s,a,o,l,h);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new p(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return p.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}p.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const I={};I.lastMesh=null;class fa extends sa{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let n=i||{};if(T.utils.isNumeric(n))n={glPrimitive:i};this._log=new u.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=n.glPrimitive||null;this.opId=n.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,n,r){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:n,offset:r,instanced:t==g.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,n){if(!e)return;if(!i&&!n)return;if(!e.name)this._log.stack("no attrname?!");const r=this.#cgl.gl;r.bindBuffer(r.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=n-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=n-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(n>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+"'"+e.name+"' buffersubdata out of bounds ?",t.length,n,i,e);return}r.bufferSubData(r.ARRAY_BUFFER,i*4,t,i,n-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,n){this.setAttribute(e,t,i,n)}setAttribute(e,t,i,n={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof n=="function"){r=n}if(typeof n=="object"){if(n.cb)r=n.cb;if(n.instanced)s=n.instanced}if(e==g.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const u=this._attributes[a];if(u.name==e){if(u.numItems===o){}else{this._resizeAttr(t,u)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,u.buffer);this._bufferArray(t,u);return u}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let h=this.#cgl.gl.FLOAT;if(n&&n.type)h=n.type;const u={buffer:l,name:e,cb:r,itemSize:i,numItems:o,startItem:0,instanced:s,type:h};this._bufferArray(t,u);if(e==g.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=u;this._attributes.push(u);this._attribLocs={};return u}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(g.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new p(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;I.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const n={texCoords:g.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:g.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:g.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const r in i)if(i[r].data&&i[r].data.length)this.setAttribute(n[r]||r,i[r].data,i[r].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(i[e]==-1){if(n._attrLocationLastShaderTime!=t.lastCompile){n._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,n.buffer);if(n.instanced){if(n.itemSize<=4){if(!n.itemSize||n.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(n.itemSize==16){const r=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,n.type,false,r,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,n.type,false,r,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,n.type,false,r,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,n.type,false,r,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",n.name)}}else{if(!n.itemSize||n.itemSize==0)this._log.warn("attrib itemsize error",this._name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);if(n.pointer){for(let e=0;e<n.pointer.length;e++){const s=n.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,n.itemSize,n.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(n)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;I.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(I.lastMesh!=this){if(I.lastMesh)I.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();I.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==null)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let n=1;let r=this.#cgl.profileData.doProfileGlQuery;let s=false;if(r){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const h=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const u=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",u)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/n*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(r&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(g.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const m={};m.getSimpleRect=function(e,t,i=1){const n=new c(t);n.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];n.texCoords=[1,1,0,1,1,0,0,0];n.verticesIndices=[0,1,2,2,1,3];n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(n)};m.getSimpleCube=function(e,t){const i=new c(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new fa(e,i)};class b{constructor(e,t){this._cgl=e;this._log=new u.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new x(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==x.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=m.getSimpleRect(this._cgl,"texEffectRect")}}b.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};b.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};b.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};b.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};b.AddBlendSelect=function(e,t,i){const n=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return n};b.AddBlendAlphaMask=function(e,t,i){const n=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return n};b.setupBlending=function(i,n,r,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";b.onChangeBlendSelect(n,r.get(),e);let t=r.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[r,e,s]);let a=false;r.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}b.onChangeBlendSelect(n,r.get(),a)};const da={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=b.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=b.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new p(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){x.getRandomTexture(e);e.setTexture(7,x.getRandomTexture(e).tex)}}};const ga="{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n";let pa=0;function M(){return ga}function C(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+S+"IN vec2 texCoord;"+S+"{{MODULES_HEAD}}"+S+"void main()"+S+"{"+S+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+S+"    {{MODULE_COLOR}}"+S+"    outColor = col;"+S+"}"}class v extends na{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new u.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++pa;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=M();this.srcFrag=C();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=n();this._tempCamPosMatrix=n();this._tempInverseViewMatrix=n();this._tempInverseProjMatrix=n();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new v(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in da){if(e.includes(t)){const i=new da[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let n="";let r="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+S+s+"};"+S+S;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")n=n.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")r=r.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);const l=r.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=r.lastIndexOf(s);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+S;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+S;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsVert.push(i)}}return[r,n]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+S;i.srcHeadVert+="#define ATTRIB_"+e.name+S;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+S;if(!t)i.srcHeadVert+="#endif"+S;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+S;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+S;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+S;if(!t)i.srcHeadVert+="#endif"+S;i.srcVert=""+S+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+S;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+S;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+S;if(!t)i.srcHeadFrag+="#endif"+S}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+S;let i="";if(this._defines.length)i="\n// cgl generated"+S;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+S;const n=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const m=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=m.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+S;let r="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=M();this.srcFrag=C()}r="#version 300 es"+S+"// "+S+"// vertex shader "+this._name+S+"// "+S+"precision "+this.precision+" float;"+S+"precision "+this.precision+" sampler2D;"+S+""+S+"#define WEBGL2"+S+"#define texture2D texture"+S+"#define UNI uniform"+S+"#define IN in"+S+"#define OUT out"+S;s="#version 300 es"+S+"// "+S+"// fragment shader "+this._name+S+"// "+S+"precision "+this.precision+" float;"+S+"precision "+this.precision+" sampler2D;"+S+""+S+"#define WEBGL2"+S+"#define texture2D texture"+S+"#define IN in"+S+"#define OUT out"+S+"#define UNI uniform"+S+"{{DRAWBUFFER}}"+S;let a="\n// cgl generated"+S;let o="\n// cgl generated"+S;s+="\n// active mods: --------------- ";r+="\n// active mods: --------------- ";let l=false;let h=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";h=true}}}}if(!h)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";r+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+S;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+S}}let u=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")u++}}if(u>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+u+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+S+s;if(!r.includes("precision"))r="precision "+this.precision+" float;"+S+r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+S;r+="#define MOBILE"+S}r=t+r+i+n[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+n[1]+o+"\n// -- \n"+this.srcFrag;let f="";let d="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let g=false;for(let n=0;n<this._moduleNames.length;n++){let t="";let i="";if(!g){g=true;for(let e=0;e<this._attributes.length;e++){const x=this._getAttrSrc(this._attributes[e],true);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)d+=x.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const E=this._modules[e];if(E.name==this._moduleNames[n]){f+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";d+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";t+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";i+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";if(E.attributes)for(let e=0;e<E.attributes.length;e++){const x=this._getAttrSrc(E.attributes[e],false);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)d+=x.srcHeadFrag}f+=E.srcHeadVert||"";d+=E.srcHeadFrag||"";t+=E.srcBodyVert||"";i+=E.srcBodyFrag||"";f+="\n//---- end mod ------\n";d+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,E.prefix);i=i.replace(/{{mod}}/g,E.prefix);f=f.replace(/{{mod}}/g,E.prefix);d=d.replace(/{{mod}}/g,E.prefix);t=t.replace(/MOD_/g,E.prefix);i=i.replace(/MOD_/g,E.prefix);f=f.replace(/MOD_/g,E.prefix);d=d.replace(/MOD_/g,E.prefix)}}r=r.replace("{{"+this._moduleNames[n]+"}}",t);s=s.replace("{{"+this._moduleNames[n]+"}}",i)}r=r.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",d);r=this._addLibs(r);s=this._addLibs(s);let p="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){p="out vec4 outColor;"+S;p+="#define gl_FragColor outColor"+S}else{p+="#define MULTI_COLORTARGETS"+S;p+="vec4 outColor;"+S;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)p+="#define gl_FragColor outColor"+e+""+S;p+="layout(location = "+e+") out vec4 outColor"+e+";"+S;t++}}s=s.replace("{{DRAWBUFFER}}",p);if(!this._program){this._program=this._createProgram(r,s)}else{this._program=this._createProgram(r,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=r;I.lastMesh=null;I.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,T.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;I.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,g.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,g.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){t(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){t(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){t(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=n();fi(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){t(this._tempNormalMatrix,this._cgl.mMatrix);Ot(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="frag";return a}addUniformVert(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,n,r,s){const a=new p(this,e,t,i,n,r,s);a.shaderType="both";return a}addUniformStructFrag(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";r[i+"."+s.name]=a}}return r}addUniformStructVert(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";r[i+"."+s.name]=a}}return r}addUniformStructBoth(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new p(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";r[i+"."+s.name]=a}}return r}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=v.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=v.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const n=this._cgl.gl.getShaderInfoLog(this.fshader);const r=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||x.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const n=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return n}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,n){return C(e,t,i,n)}getDefaultVertexShader(){return M()}}v.getDefaultVertexShader=M;v.getDefaultFragmentShader=C;v.getErrorFragmentShader=function(){return""+S+"void main()"+S+"{"+S+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+S+"   g= step(0.1,g);"+S+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+S+"}"};v.createShader=function(e,t,i,n){if(e.aborted)return;const r=e.gl.createShader(i);e.gl.shaderSource(r,t);e.gl.compileShader(r);if(!e.gl.getShaderParameter(r,e.gl.COMPILE_STATUS)){n.error={str:t,infoLog:e.gl.getShaderInfoLog(r)};if(CABLES.UI)gui.emitEvent("ShaderError",n);if(!n.error.infoLog){n._log.warn("empty shader info log",this._name);return}n.setSource(v.getDefaultVertexShader(),v.getErrorFragmentShader())}return r};class ma extends T.RenderLoop{#patch;#cgl;#renderOneFrame;#animReq;frameNum=0;onOneFrameRendered=null;_frameNext=0;_frameInterval=0;_lastFrameTime=0;reqAnimTimeStamp=0;_frameWasdelayed=true;aborted=false;constructor(e,t){super();this.#cgl=e;this.#patch=t;this.#patch.renderloop=this;this.exec(0)}exec(e){cancelAnimationFrame(this.#animReq);this.#patch.config.fpsLimit=this.#patch.config.fpsLimit||0;if(this.#patch.config.fpsLimit){this._frameInterval=1e3/this.#patch.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.#patch.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.#patch.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(T.Patch.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.#patch.config.doRequestAnimation){this.#animReq=this.#patch.getDocument().defaultView.requestAnimationFrame(this.exec.bind(this))}}renderFrame(e){const t=this.#patch.timer.getTime();const i=performance.now();this.#cgl.frameStartTime=this.#patch.timer.getTime();const n=e-this.reqAnimTimeStamp||e;this.#patch.updateAnims(null,n,e);this.#cgl.profileData.profileFrameDelta=n;this.reqAnimTimeStamp=e;this.#cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.#patch.emitEvent(T.Patch.EVENT_RENDER_FRAME,t);this.frameNum++;if(this.frameNum==1){if(this.#patch.config.onFirstFrameRendered)this.#patch.config.onFirstFrameRendered()}}pause(){cancelAnimationFrame(this.#animReq);this.#animReq=null;this.paused=true}resume(){cancelAnimationFrame(this.#animReq);this.paused=false;this.exec(0)}}const _a={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class ba extends ia{#cursor="auto";frameStartTime=0;constructor(e){super(e);this.gApi=ia.API_WEBGL;this.aborted=false;e.cgl=this;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new u.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new v(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(v.getDefaultVertexShader(),v.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null;this.setCanvas(e.config.glCanvasId||e.config.glCanvas||"glcanvas");if(e.config.glCanvasResizeToWindow===true)this.setAutoResize("window");if(e.config.glCanvasResizeToParent===true)this.setAutoResize("parent");if(this.aborted)e.aborted=true;e.on(T.Patch.EVENT_DISPOSE,()=>{this.dispose()});e.on("patchClearStart",()=>{this.TextureEffectMesh=null});this.renderLoop=new ma(this,e)}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push(e,t,i,n);this.setViewPort(e,t,i,n)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,n){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(n);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,n){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(ia.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(g.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e,t=true){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();if(t)e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;T.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=x.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let n=this.gl.getError();if(n!=this.gl.NO_ERROR){let e="";if(n==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(n==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(n==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(n==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(n==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(n==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(n==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,n,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}n=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==g.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==g.BLEND_MODES.BLEND_NONE){}else if(e==g.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==g.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==g.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(T.utils.isNumeric(t))t={glPrimitive:t};return new fa(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new v(this,"errormaterial");this.errorShader.setSource(v.getDefaultVertexShader(),v.getErrorFragmentShader());return this.errorShader}}const va=8;const xa=new u.Logger("cgl_texture");class x extends d{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new u.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=x.FILTER_NEAREST;this.wrap=x.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=x.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=x.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=x.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=x.PFORMATSTR_RGBA32F;if(this.textureType==x.TYPE_DEPTH)this.pixelFormat=x.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return x.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new x(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=va;if(t!=t||t<=0||!t)t=va;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,n,r){this.filter=n;this.wrap=r;if(n==undefined)this.filter=x.FILTER_LINEAR;if(r==undefined)this.wrap=x.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==x.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return x.isPowerOfTwo(this.width)&&x.isPowerOfTwo(this.height)}printInfo(){xa.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===x.FILTER_NEAREST)e+=" nearest";if(this.filter===x.FILTER_LINEAR)e+=" linear";if(this.filter===x.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===x.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===x.WRAP_REPEAT)e+=" repeat";if(this.wrap===x.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return x.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==x.TYPE_FLOAT&&this.filter==x.FILTER_MIPMAP){this.filter=x.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=x.FILTER_NEAREST;this.wrap=x.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==x.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==x.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==x.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==x.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==x.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==x.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}x.load=function(i,n,r,e){if(!n)return r({error:true});let s=null;if(!i.patch.loading.existByName(n))s=i.patch.loading.start("cgl.texture",n);const a=new x(i);a.name=n;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(r)r(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(r)r(null,a)})};a.image.src=n;return a};x.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=x.getTemporaryTexture(e,256,x.FILTER_LINEAR,x.REPEAT);return e.tempTexture};x.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=x.getTemporaryTexture(e,256,x.FILTER_LINEAR,x.REPEAT,1,.2,.2);return e.errorTexture};x.getEmptyTexture=function(e,t){if(t)return x.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new x(e,{name:"emptyTexture"});const n=x.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(n,i,i,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.tempTextureEmpty};x.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new x(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.tempTextureEmptyFloat};x.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=x.getDefaultTextureData("randomUInt",t);e.randomTexture=new x(e);e.randomTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.randomTexture};x.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=x.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new x(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.getRandomFloatTexture};x.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=x.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new x(e);e.blackTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.blackTexture};x.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const n=t.gl.TEXTURE_CUBE_MAP;const r=x.FILTER_NEAREST;const s=x.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(n,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(n,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(n,null);return{id:T.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:r,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};x.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return x.getTempTexture(e)};x.getTemporaryTexture=function(e,t,i,n,r,s,a){const o=x.getDefaultTextureData("stripes",256,{r:r,g:s,b:a});const l=new x(e);l.initFromData(o,t,t,i,n);return l};x.createFromImage=function(e,t,i){i=i||{};const n=new x(e,i);n.flip=false;n.image=t;n.width=t.videoWidth||t.width||8;n.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))n.wrap=i.wrap;n.initTexture(t,i.filter);return n};x.fromImage=function(e,t,i,n){console.error("deprecated texture from image...");const r=new x(e);r.flip=false;if(i)r.filter=i;if(n)r.wrap=n;r.image=t;r.initTexture(t);return r};x.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};x.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==x.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==x.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==x.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==x.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==x.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==x.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==x.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==x.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==x.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==x.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};x.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=x.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let n=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==x.PFORMATSTR_RGBA32F)t=x.PFORMATSTR_RGBA16F;if(t==x.PFORMATSTR_RG32F)t=x.PFORMATSTR_RG16F;if(t==x.PFORMATSTR_R32F)t=x.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const r=e.enableExtension("EXT_color_buffer_half_float");if(!r){console.warn("no 16bit extension, fallback to 32bit",t);if(t==x.PFORMATSTR_RGBA16F)t=x.PFORMATSTR_RGBA32F;if(t==x.PFORMATSTR_RGB16F)t=x.PFORMATSTR_RGB32F;if(t==x.PFORMATSTR_RG16F)t=x.PFORMATSTR_RG32F;if(t==x.PFORMATSTR_R16F)t=x.PFORMATSTR_R32F}else{n=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==x.PFORMATSTR_RGBA16F||t==x.PFORMATSTR_RG16F||t==x.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");n=s.HALF_FLOAT_OES}}if(t==x.PFORMATSTR_RGBA8UB){}else if(t==x.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==x.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==x.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==x.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=n}else if(t==x.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=n;i.glDataFormat=e.gl.RED}else if(t==x.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=n;i.glDataFormat=e.gl.RG}else if(t==x.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=n}else if(t==x.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=n;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=n}else if(t==x.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{xa.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==x.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=x.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)xa.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};x.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};x.isPixelFormatFloat=e=>{return(e||"").includes("float")};x.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};T.Op.prototype.outTexture=function(e,t){const i=this.addOutPort(new T.Port(this,e,T.Port.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||x.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i};class Ea{constructor(t,e,i,n){this._log=new u.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=n||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=x.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=x.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!n.pixelFormat){if(n.isFloatingPointTexture)this._options.pixelFormat=x.PFORMATSTR_RGBA32F;else this._options.pixelFormat=x.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new x(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let r=x.FILTER_NEAREST;if(this._options.shadowMap)r=x.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new x(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:r,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const n=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=x.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=x.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=x.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)r=this._cgl.gl.DEPTH_COMPONENT16;if(n){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==x.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const Ta=function(e){this.draw=function(e,t,i){}};const Aa=function(e){this.render=function(e,t){}};const Sa=function(e){this.render=function(e,t,i,n){}};class Ia{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,n){this.coloruni.set(e,t,i,n)}}const Ma=Math.PI/180;const Ca=180/Math.PI;const Ra=null;const Oa=window.navigator.userAgent.includes("Windows");const ya=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(Oa)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const n=e||t.detail;i=-(n%3?n*10:n/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const Na=ya;const wa=ya;const E={Framebuffer2:Ea,Geometry:c,BoundingBox:i,Marker:Ta,WirePoint:Aa,WireCube:Sa,MatrixStack:a,Mesh:fa,MESH:I,ShaderLibMods:da,Shader:v,Uniform:p,MESHES:m,getWheelSpeed:Na,getWheelDelta:wa,Context:ba,Texture:x,TextureEffect:b,onLoadingAssetsFinished:Ra,ProfileData:ta,UniColorShader:Ia,...g.BLEND_MODES,...g.SHADER,...g.MATH,...g.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL={...window.CABLES.CGL,...E};window.CGL={...window.CGL,...E};window.cgInitialized=false;window.addEventListener("INIT_CG",e=>{if(window.cgInitialized&&!CABLES.UI)return;window.cgInitialized=true;const t=new ba(e.detail)});T.Anim.slerpQuaternion=function(e,t,i,n,r,s){if(!T.Anim.slerpQuaternion.q1){T.Anim.slerpQuaternion.q1=quat.create();T.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const h=i.keys[o].time;const u=(e-l)/(h-l);quat.set(T.Anim.slerpQuaternion.q1,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value);quat.set(T.Anim.slerpQuaternion.q2,i.keys[o].value,n.keys[o].value,r.keys[o].value,s.keys[o].value);quat.slerp(t,T.Anim.slerpQuaternion.q1,T.Anim.slerpQuaternion.q2,u)}return t};class La{constructor(e,t,i){this.cgl=e;this._options=i;this.fb=null;let n=i.shader;this._useDefaultShader=true;if(i.shader)this._useDefaultShader=false;i.numRenderBuffers=i.numRenderBuffers||1;if(!n){n="".endl()+"IN vec2 texCoord;";for(let e=0;e<i.numRenderBuffers;e++){n=n.endl()+"UNI sampler2D tex"+e+";".endl()}n=n.endl()+"void main()".endl()+"{";if(i.numRenderBuffers==1){n=n.endl()+"    outColor= texture(tex0,texCoord);".endl()}else for(let e=0;e<i.numRenderBuffers;e++){n=n.endl()+"outColor"+e+" = texture(tex"+e+",texCoord);".endl()}n=n.endl()+"}"}const r=i.vertexShader||"".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new E.Shader(e,"corelib copytexture "+t);this.bgShader.setSource(r,n);if(!i.vertexShader)this.bgShader.ignoreMissingUniforms=true;new E.Uniform(this.bgShader,"t","tex",0);new E.Uniform(this.bgShader,"t","tex1",1);new E.Uniform(this.bgShader,"t","tex2",2);new E.Uniform(this.bgShader,"t","tex3",3);this.mesh=E.MESHES.getSimpleRect(this.cgl,"texEffectRect")}setSize(e,t){this._options.width=e;this._options.height=t}copy(e,t,i,n,r){const s=this.cgl;if(!e)e=E.Texture.getEmptyTexture(this.cgl);let a=this._options.width||e.width,o=this._options.height||e.height;if(this.fb){if(a<=0)a=8;if(o<=0)o=8;if(this.fb.getWidth()!=a||this.fb.getHeight()!=o)this.fb.setSize(a,o)}else{let e=E.Texture.FILTER_LINEAR;let t=E.Texture.WRAP_CLAMP_TO_EDGE;if(this._options.isFloatingPointTexture)e=E.Texture.FILTER_NEAREST;if(this._options.hasOwnProperty("filter"))e=this._options.filter;if(this._options.hasOwnProperty("wrap"))t=this._options.wrap;const l={isFloatingPointTexture:this._options.isFloatingPointTexture,pixelFormat:this._options.pixelFormat,numRenderBuffers:this._options.numRenderBuffers||1,filter:e,wrap:t};if(s.glVersion==1)this.fb=new E.Framebuffer(s,a,o,l);else this.fb=new E.Framebuffer2(s,a,o,l)}s.tempData.renderOffscreen=true;this.fb.renderStart(s);s.setTexture(0,e.tex);if(t)s.setTexture(1,t.tex);if(i)s.setTexture(2,i.tex);if(n)s.setTexture(3,n.tex);if(r)s.setTexture(4,r.tex);s.pushShader(this.bgShader);this.mesh.render(this.bgShader);s.popShader();this.fb.renderEnd();s.tempData.renderOffscreen=false;return this.fb.getTextureColor()}dispose(){if(this.fb)this.fb.dispose();if(this.bgShader)this.bgShader.dispose();if(this.mesh)this.mesh.dispose()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in Fa)e[t]=Fa[t];if(Fa.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{WireframeCube:()=>e,WireframeRect:()=>t});class e{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");this.geom.setPointVertices([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);if(e==undefined)e=1;if(t==undefined)t=e;if(i==undefined)i=e;vec3.set(this._vScale,e,t,i);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}class t{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");const t=-1;const i=1;this.geom.setPointVertices([t,t,0,i,t,0,i,t,0,i,i,0,i,i,0,t,i,0,t,i,0,t,t,0]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);vec3.set(this._vScale,e||1,t||e||1,i||e||1);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();